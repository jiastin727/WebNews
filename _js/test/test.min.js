//Activate dropdown & tab
$(".ui.pssdropdown").dropdown();
$(".ui.dropdown").dropdown();
$(".menu .item").tab();
moment().format();

// Global Variable
const NonceValue = "rdsystem2020";
const ColorOwner = "#00139f";
const ColorPlacein = "#099c2c";
const ColorFinish = "#7d7d7d";
const ColorCancel = "#7c0000";

const ihpprogress_a = "PROCESS"; //POSISI DI OPERATOR
const ihpprogress_b = "IHP"; //POSISI DI OPERATOR SETELAH KLIK TOMBOL CREATE IHP
const ihpprogress_c = "PLACE-IN"; //OPERATOR KIRIM KE DESIGNER
const ihpprogress_d = "DESIGNER"; //DESIGNER CONFIRM
const ihpprogress_e = "REQ-APPROVAL"; //DESIGNER CLICK REQUEST SHD APPROVAL
const ihpprogress_f = "APPROVED"; //SHD APPROVED IHP
const ihpprogress_g = "-"; //STATUS FINISH-CLOSE
const ihpprogress_h = "IHP KEMBALI"; //IHP DIKEMBALIKAN KE OPERATOR MSC
const ihpprogress_i = "DONE"; //IHP SELESAI
const ihpprogress_j = "REQ-CLOSE"; //PERMINTAAN CLOSING IHP DARI DESIGNER KE SHD
const ihpprogress_k = "REQ-CANCEL"; //PERMINTAAN CANCEL IHP DARI DESIGNER KE SHD

var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocpssihp = "../RND_BackEnd/backend_test/";
// var restlocpssihp = decodeURIComponent(getCookie("restlocpssihp"));
let Ucrypt = new Encryption();
var Udecrypt = Ucrypt.decrypt(EncU, NonceValue);
var Sdecrypt = Ucrypt.decrypt(EncS, NonceValue);
var SHDdecr = Ucrypt.decrypt(EncN, NonceValue);

function TableListFunc(FSearch, FYear, FIHP, FStatus) {
  $("#IHPList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned eight wide column'B>" +
      "<'right aligned eight wide column'p>" +
      ">" +
      ">",
    buttons: [
      {
        text: "10",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(10).draw();
        },
      },
      {
        text: "25",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(25).draw();
        },
      },
      {
        text: "50",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(50).draw();
        },
      },
      {
        text: "100",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(100).draw();
        },
      },
      {
        text: "1000",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(1000).draw();
        },
      },
    ],
    destroy: true,
    stateSave: true,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    pageLength: 10,
    data: [],
    language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Search..",
      processing: '<i class="circle notch loading icon huge"></i>',
    },
    order: [[0, "desc"]],
    columns: [
      {
        data: null,
        render: function (data) {
          if (data[23] == "NO_DATA") {
            return data[23];
          } else {
            return data[11];
          }
        },
      },
      { data: 0 },
      { data: 2 },
      {
        data: null,
        render: function (data) {
          return data[3];
        },
      },
      { data: 12 },
      {
        data: null,
        render: function (data, type, row) {
          if (data[4] == "HOME APPLIANCES") {
            return `HA`;
          } else if (data[4] == "AUDIO") {
            return `AUD`;
          } else if (data[4] == "VIDEO") {
            return `VID`;
          } else if (data[4] == "SPECIAL PRODUCT") {
            return `SPP`;
          } else {
            return `${data[4]}`;
          }
        },
      },
      { data: 5 },
      { data: 6 },
      {
        data: null,
        render: function (data) {
          return data[21];
        },
      },
      {
        data: null,
        render: function (data) {
          if (data[23] == "NO_DATA") {
            return '';
          } else {
            return data[23];
          }
        },
      },
      { data: 7 },
      {
        data: null,
        render: function (data) {
          return data[16];
        },
      },
      { data: 13 },
      {
        data: null,
        render: function (data) {
          return data[22];
        },
      },

      { data: 10 },
      { data: 9 },
      {
        data: null,
        render: function (data, type, row) {
          if ((data[13] == Udecrypt || data[20] == Udecrypt) && data[9] !== ihpprogress_b ) {
            return `<i class="edit outline editihp iconcoloredit icon" idpss="${data[14]}" iditem="${data[15]}">`;
          } else {
            if (data[19] == Sdecrypt && SHDdecr && data[9] !== ihpprogress_b ) {
              return `<i class="edit outline editihp iconcoloredit icon" idpss="${data[14]}" iditem="${data[15]}">`;
            } else {
              return "";
            }
          }
        },
      },
    ],
    columnDefs: [{ className: "center aligned", targets: [5, 6, 8, 9, 16] }],

    createdRow: function (row, data, index) {
      //WARNA NULL / DATA TIDAK DITEMUKAN
      if (data[23] == "NO_DATA") {
        $(row).addClass("errorhilite");
      }

      //WARNA OWNER & PLACE IN
      if (data[13] == Udecrypt && data[9] == ihpprogress_c) {
        $(row).find("td").css("color", ColorPlacein);
      }

      //WARNA OWNER & DESIGNER
      if (
        (data[13] == Udecrypt && data[9] == ihpprogress_d) ||
        (data[13] == Udecrypt && data[9] == ihpprogress_f)
      ) {
        $(row).find("td").css("color", ColorOwner);
      }

      if (data[13] == Udecrypt && data[9] == ihpprogress_f) {
        $(row).find("td").css("background-color", "#e2ffe1");
      }

      //WARNA FINISH & CLOSE
      if (
        data[10] == "FINISH" ||
        data[10] == "CLOSE" ||
        data[9] == ihpprogress_b ||
        data[9] == ihpprogress_h
      ) {
        $(row).find("td").css("color", ColorFinish);
      }

      //WARNA CANCEL
      if (data[10] == "CANCEL") {
        $(row).find("td").css("color", ColorCancel);
      }

      //WARNA REQUEST APPROVAL SHD
      if (
        data[9] == ihpprogress_e ||
        data[9] == ihpprogress_j ||
        data[9] == ihpprogress_k
      ) {
        $(row).addClass("needapprove");
      }
    },

    ajax: {
      url: `${restlocpssihp}table_placein`,
      type: "POST",
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        FSearch: FSearch,
        FYear: FYear,
        FIHP: FIHP,
        FStatus: FStatus,
      },
      error: function () {
        //window.location.href = "./?link=loclogout";
        Swal.fire(
          "Error",
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
          "error"
        );
      },
    },
  });
}

//Click Icon Edit item IHP
$("#IHPList").on("click", ".editihp", function () {
  var iditem = $(this).attr("iditem");
  var idpss = $(this).attr("idpss");
  $(".windoweditihp").modal("show");
  LoadSampleDistribution(idpss, iditem);
  //Modal Window Control
  $(".windoweditihp").modal({
    closable: false,
    autofocus: false,
  });
});

function LoadSampleDistribution(IDpssx, IDitemx) {
  $.ajax({
    type: "POST",
    url: `${restlocpssihp}load_itemihp`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: { idpss: IDpssx, iditem: IDitemx },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      var qel = Number(obj["read_checker"][0]["qty_electronic"]);
      var qcy = Number(obj["read_checker"][0]["qty_cycle"]);
      var qme = Number(obj["read_checker"][0]["qty_mechanic"]);
      var qid = Number(obj["read_checker"][0]["qty_ind"]);
      var qso = Number(obj["read_checker"][0]["qty_software"]);
      var qpc = Number(obj["read_checker"][0]["qty_pcb"]);
      var qmq = Number(obj["read_checker"][0]["qty_mqa"]);
      var qdq = Number(obj["read_checker"][0]["qty_dqa"]);
      var qau = Number(obj["read_checker"][0]["qty_autrans"]);
      var qot = Number(obj["read_checker"][0]["qty_others"]);
      var qo1 = Number(obj["read_checker"][0]["qty_others1"]);
      var qo2 = Number(obj["read_checker"][0]["qty_others2"]);
      var qtyconfirm = Number(obj["read_item"][0]["qty_confirm"]);
      var qtyused =
        qel + qcy + qme + qid + qso + qpc + qmq + qdq + qau + qot + qo1 + qo2;
      var qtysaldo = qtyconfirm - qtyused;
      $("#QtySisa").text(qtysaldo);

      //simpan di input hidden untuk diterusakan ketika modal window final result di tampilkan
      $("#IHPCCRequest").val(obj["read_item"][0]["progress_item"]);

      if (
        obj["read_item"][0]["progress_item"] == ihpprogress_f ||
        obj["read_item"][0]["progress_item"] == ihpprogress_g ||
        obj["read_item"][0]["progress_item"] == ihpprogress_h ||
        obj["read_item"][0]["progress_item"] == ihpprogress_i
      ) {
        if (
          obj["read_item"][0]["progress_item"] == ihpprogress_h ||
          obj["read_item"][0]["progress_item"] == ihpprogress_i
        ) {
          $(".SampleDistributionArea").hide();
          $(".FinalResultArea").hide();
          $(".ApprovedArea").hide();
          $(".ApprovedAreaBtnClick").show();
        } else {
          $(".SampleDistributionArea").hide();
          $(".FinalResultArea").hide();
          $(".RequestCancelCloseArea").hide();
          $(".ApprovedArea").show();
          $(".ApprovedAreaBtnClick").hide();
        }
      } else {
        if (
          obj["read_item"][0]["progress_item"] == ihpprogress_j ||
          obj["read_item"][0]["progress_item"] == ihpprogress_k
        ) {
          $(".SampleDistributionArea").hide();
          $(".FinalResultArea").show();
        } else {
          $(".SampleDistributionArea").show();
          $(".FinalResultArea").show();
        }

        $(".ApprovedArea").hide();
        $(".ApprovedAreaBtnClick").hide();

        if (
          obj["read_item"][0]["progress_item"] == ihpprogress_d ||
          obj["read_item"][0]["progress_item"] == ihpprogress_e ||
          obj["read_item"][0]["progress_item"] == ihpprogress_f ||
          obj["read_item"][0]["progress_item"] == ihpprogress_j ||
          obj["read_item"][0]["progress_item"] == ihpprogress_k
        ) {
          $("#DesgnConfirm").addClass("disabled");
          $("#FinalResult").removeClass("disabled");
          $(".SaveDrawingLoc").removeClass("disabled");
          $("#InputDrawingLoc").removeClass("disabled");
          $("#DesgnConfirmTxt").text("Confirmed");
          $("#DesgnConfirmDate").html(
            '<i class="calendar outline icon"></i>Designer Confirm Date : ' +
              obj["read_item"][0]["tanggal_placein"]
          );
          $("#ElectEdit").html(
            '<button class="ui teal label editdistihp" sid="1" id="ELECTRONIC HARDWARE"><i class="edit icon"></i>Edit</button>'
          );
          $("#HomeAppEdit").html(
            '<button class="ui teal label editdistihp" sid="2" id="ENERGY CONVERSION"><i class="edit icon"></i>Edit</button>'
          );
          $("#MechEdit").html(
            '<button class="ui teal label editdistihp" sid="3" id="MECHANIC"><i class="edit icon"></i>Edit</button>'
          );
          $("#IDEdit").html(
            '<button class="ui teal label editdistihp" sid="4" id="INDUSTRIAL DESIGN"><i class="edit icon"></i>Edit</button>'
          );
          $("#SoftEdit").html(
            '<button class="ui teal label editdistihp" sid="5" id="SOFTWARE"><i class="edit icon"></i>Edit</button>'
          );
          $("#PCBEdit").html(
            '<button class="ui teal label editdistihp" sid="6" id="PCB"><i class="edit icon"></i>Edit</button>'
          );
          $("#MQAEdit").html(
            '<button class="ui teal label editdistihp" sid="7" id="MQA"><i class="edit icon"></i>Edit</button>'
          );
          $("#DQAEdit").html(
            '<button class="ui teal label editdistihp" sid="8" id="DQA"><i class="edit icon"></i>Edit</button>'
          );
          $("#AuTEdit").html(
            '<button class="ui teal label editdistihp" sid="9" id="AUTRANS"><i class="edit icon"></i>Edit</button>'
          );
          $("#OthEdit").html(
            '<button class="ui teal label editdistihp" sid="10" id="OTHERS"><i class="edit icon"></i>Edit</button>'
          );
          $("#Oth1Edit").html(
            '<button class="ui teal label editdistihp" sid="11" id="OTHERS1"><i class="edit icon"></i>Edit</button>'
          );
          $("#Oth2Edit").html(
            '<button class="ui teal label editdistihp" sid="12" id="OTHERS2"><i class="edit icon"></i>Edit</button>'
          );

          if (obj["read_checker"]["status"] !== false) {
            if (obj["read_checker"][0][2] && obj["read_checker"][0][3]) {
              if (obj["read_checker"][0][5]) {
                $("#ElectSend").html(
                  '<button class="ui basic green label resenddistribute" sid="1" sname="' +
                    obj["read_checker"][0][2] +
                    '">Re-Send</button>'
                );
              } else {
                $("#ElectSend").html(
                  '<button class="ui green label senddistribute" sid="1" sname="' +
                    obj["read_checker"][0][2] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#ElectSend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][7] && obj["read_checker"][0][8]) {
              if (obj["read_checker"][0][10]) {
                $("#HomeAppSend").html(
                  '<button class="ui basic green label resenddistribute" sid="2" sname="' +
                    obj["read_checker"][0][7] +
                    '">Re-Send</button>'
                );
              } else {
                $("#HomeAppSend").html(
                  '<button class="ui green label senddistribute" sid="2" sname="' +
                    obj["read_checker"][0][7] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#HomeAppSend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][12] && obj["read_checker"][0][13]) {
              if (obj["read_checker"][0][15]) {
                $("#MechSend").html(
                  '<button class="ui basic green label resenddistribute" sid="3" sname="' +
                    obj["read_checker"][0][12] +
                    '">Re-Send</button>'
                );
              } else {
                $("#MechSend").html(
                  '<button class="ui green label senddistribute" sid="3" sname="' +
                    obj["read_checker"][0][12] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#MechSend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][17] && obj["read_checker"][0][18]) {
              if (obj["read_checker"][0][20]) {
                $("#IDSend").html(
                  '<button class="ui basic green label resenddistribute" sid="4" sname="' +
                    obj["read_checker"][0][17] +
                    '">Re-Send</button>'
                );
              } else {
                $("#IDSend").html(
                  '<button class="ui green label senddistribute" sid="4" sname="' +
                    obj["read_checker"][0][17] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#IDSend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][22] && obj["read_checker"][0][23]) {
              if (obj["read_checker"][0][25]) {
                $("#SoftSend").html(
                  '<button class="ui basic green label resenddistribute" sid="5" sname="' +
                    obj["read_checker"][0][22] +
                    '">Re-Send</button>'
                );
              } else {
                $("#SoftSend").html(
                  '<button class="ui green label senddistribute" sid="5" sname="' +
                    obj["read_checker"][0][22] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#SoftSend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][27] && obj["read_checker"][0][28]) {
              if (obj["read_checker"][0][30]) {
                $("#PCBSend").html(
                  '<button class="ui basic green label resenddistribute" sid="6" sname="' +
                    obj["read_checker"][0][27] +
                    '">Re-Send</button>'
                );
              } else {
                $("#PCBSend").html(
                  '<button class="ui green label senddistribute" sid="6" sname="' +
                    obj["read_checker"][0][27] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#PCBSend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][32] && obj["read_checker"][0][33]) {
              if (obj["read_checker"][0][35]) {
                $("#MQASend").html(
                  '<button class="ui basic green label resenddistribute" sid="7" sname="' +
                    obj["read_checker"][0][32] +
                    '">Re-Send</button>'
                );
              } else {
                $("#MQASend").html(
                  '<button class="ui green label senddistribute" sid="7" sname="' +
                    obj["read_checker"][0][32] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#MQASend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][37] && obj["read_checker"][0][38]) {
              if (obj["read_checker"][0][40]) {
                $("#DQASend").html(
                  '<button class="ui basic green label resenddistribute" sid="8" sname="' +
                    obj["read_checker"][0][37] +
                    '">Re-Send</button>'
                );
              } else {
                $("#DQASend").html(
                  '<button class="ui green label senddistribute" sid="8" sname="' +
                    obj["read_checker"][0][37] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#DQASend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][42] && obj["read_checker"][0][43]) {
              if (obj["read_checker"][0][45]) {
                $("#AuTSend").html(
                  '<button class="ui basic green label resenddistribute" sid="9" sname="' +
                    obj["read_checker"][0][42] +
                    '">Re-Send</button>'
                );
              } else {
                $("#AuTSend").html(
                  '<button class="ui green label senddistribute" sid="9" sname="' +
                    obj["read_checker"][0][42] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#AuTSend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][47] && obj["read_checker"][0][48]) {
              if (obj["read_checker"][0][50]) {
                $("#OthSend").html(
                  '<button class="ui basic green label resenddistribute" sid="10" sname="' +
                    obj["read_checker"][0][47] +
                    '">Re-Send</button>'
                );
              } else {
                $("#OthSend").html(
                  '<button class="ui green label senddistribute" sid="10" sname="' +
                    obj["read_checker"][0][47] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#OthSend").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][52] && obj["read_checker"][0][53]) {
              if (obj["read_checker"][0][55]) {
                $("#Oth1Send").html(
                  '<button class="ui basic green label resenddistribute" sid="11" sname="' +
                    obj["read_checker"][0][52] +
                    '">Re-Send</button>'
                );
              } else {
                $("#Oth1Send").html(
                  '<button class="ui green label senddistribute" sid="11" sname="' +
                    obj["read_checker"][0][52] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#Oth1Send").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
            if (obj["read_checker"][0][57] && obj["read_checker"][0][58]) {
              if (obj["read_checker"][0][60]) {
                $("#Oth2Send").html(
                  '<button class="ui basic green label resenddistribute" sid="12" sname="' +
                    obj["read_checker"][0][57] +
                    '">Re-Send</button>'
                );
              } else {
                $("#Oth2Send").html(
                  '<button class="ui green label senddistribute" sid="12" sname="' +
                    obj["read_checker"][0][57] +
                    '"><i class="paper plane icon"></i>Send</button>'
                );
              }
            } else {
              $("#Oth2Send").html(
                '<button class="ui basic label disabled" ><i class="paper plane icon"></i>Send</button>'
              );
            }
          } else {
            console.log(
              "Developer Note: Table Error, table `tb_checker` belum terisi saat designer confirm.."
            );
          }

          $(".editdistihp").on("click", function () {
            var idihp = $(this).attr("id").toUpperCase();
            var sid = $(this).attr("sid");
            $(".windoweditdistributeihp").modal("show");
            $("span#labeldist").text(idihp);

            $.ajax({
              type: "POST",
              url: `${restlocpssihp}load_allchecker`,
              headers: {
                user: vusrnm,
                token: vtoken,
              },
              data: {
                iditem: IDitemx,
                sid: sid,
              },
              cache: false,
              success: function (response) {
                var obj = JSON.parse(response);
                if (obj.status == false) {
                  Swal.fire(
                    "Error",
                    "Ada kendala di koneksi/database, data tidak tersimpan !",
                    "error"
                  );
                } else {
                  var qtyuse = Number(obj["read_checker"][0][1]);
                  var qtys = qtysaldo + qtyuse;
                  jmlData = obj["read_namachecker"].length;
                  $("#PICIHP").empty();

                  for (a = 0; a < jmlData; a++) {
                    if (
                      obj["read_namachecker"][a][0] == obj["read_checker"][0][0]
                    ) {
                      $("#PICIHP").append(
                        '<option value="' +
                          obj["read_namachecker"][a][0] +
                          '" selected>' +
                          obj["read_namachecker"][a][0] +
                          "</option>"
                      );
                    } else {
                      $("#PICIHP").append(
                        '<option value="' +
                          obj["read_namachecker"][a][0] +
                          '">' +
                          obj["read_namachecker"][a][0] +
                          "</option>"
                      );
                    }
                  }
                  $("#PICIHP").dropdown(
                    "set selected",
                    obj["read_checker"][0][0]
                  );
                  $("#QtyIHP").val(obj["read_checker"][0][1]);
                  $("#NoteIHP").val(obj["read_checker"][0][2]);
                  $("#PSSid").val(IDpssx);
                  $("#IHPid").val(IDitemx);
                  $("#IHPsid").val(sid);
                  $("#MaxQty").text(qtys);
                  $("#SaldoQty").text(qtysaldo);
                  $("#QtySisa").text(qtysaldo);
                  $("#AllQty").text(qtyconfirm);
                }
              },
              error: function () {
                window.location.href = "./?link=loclogout";
                Swal.fire(
                  "Error",
                  "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
                  "error"
                );
              },
            });
          });

          $(".senddistribute").on("click", function () {
            var sid = $(this).attr("sid");
            var snm = $(this).attr("sname");
            $.ajax({
              type: "POST",
              url: `${restlocpssihp}send_checker`,
              headers: {
                user: vusrnm,
                token: vtoken,
              },
              data: {
                iditem: IDitemx,
                sid: sid,
                checker: snm,
              },
              cache: false,
              success: function (response) {
                var obj = JSON.parse(response);
                if (obj.status == false) {
                  Swal.fire(
                    "Error",
                    "Ada kendala di koneksi/database, data tidak tersimpan !",
                    "error"
                  );
                } else {
                  Swal.fire({
                    text: "IHP sent",
                    timer: 2000,
                    toast: true,
                    showConfirmButton: false,
                  });
                  //reload table sample distributions
                  LoadSampleDistribution(IDpssx, IDitemx);
                }
              },
              error: function () {
                window.location.href = "./?link=loclogout";
                Swal.fire(
                  "Error",
                  "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
                  "error"
                );
              },
            });
          });

          $(".resenddistribute").on("click", function () {
            var sid = $(this).attr("sid");
            var snm = $(this).attr("sname");
            $.ajax({
              type: "POST",
              url: `${restlocpssihp}resend_checker`,
              headers: {
                user: vusrnm,
                token: vtoken,
              },
              data: {
                iditem: IDitemx,
                sid: sid,
                checker: snm,
              },
              cache: false,
              success: function (response) {
                var obj = JSON.parse(response);
                if (obj.status == false) {
                  Swal.fire(
                    "Error",
                    "Ada kendala di koneksi/database, data tidak tersimpan !",
                    "error"
                  );
                } else {
                  Swal.fire({
                    text: "IHP sent",
                    timer: 2000,
                    toast: true,
                    showConfirmButton: false,
                  });
                  //reload table sample distributions
                  LoadSampleDistribution(IDpssx, IDitemx);
                }
              },
              error: function () {
                window.location.href = "./?link=loclogout";
                Swal.fire(
                  "Error",
                  "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
                  "error"
                );
              },
            });
          });

         

          //Modal Window Control
          $(".windoweditdistributeihp").modal({
            closable: false,
            autofocus: false,
          });

          //Modal Window Control
          $(".windowfinalresult").modal({
            //closable: false,
            autofocus: false,
          });

          $(".windowcloseihpshd").modal({
            //closable: false,
            autofocus: false,
          });


        } else {
          $("#FinalResult").addClass("disabled");
          $(".SaveDrawingLoc").addClass("disabled");
          $("#InputDrawingLoc").addClass("disabled");

          $("#DesgnConfirm").removeClass("disabled");
          $("#DesgnConfirmTxt").text("Designer Confirm");
          $("#DesgnConfirmDate").text("");
          $(
            "#ElectEdit, #HomeAppEdit, #MechEdit, #IDEdit, #SoftEdit, #PCBEdit, #MQAEdit, #DQAEdit, #AuTEdit, #OthEdit, #Oth1Edit, #Oth2Edit"
          ).html(
            '<button class="ui grey label basic disabled"><i class="edit icon"></i>Edit</button>'
          );
          $(
            "#ElectSend, #HomeAppSend, #MechSend, #IDSend, #SoftSend, #PCBSend, #MQASend, #DQASend, #AuTSend, #OthSend, #Oth1Send, #Oth2Send"
          ).html(
            '<button class="ui grey label basic disabled"><i class="paper plane icon"></i>Send</button>'
          );
        }
      }

      if (obj["read_item"][0]["file_upload"] == null) {
        var file = "<i>Belum ada spec yang diupload</i>";
      } else {
        var file =
          '<a target="_blank" href="./?link=filespecpss&f=' +
          obj["read_item"][0]["file_upload"] +
          '">' +
          obj["read_item"][0]["file_upload"] +
          "</a>&nbsp;&nbsp;<span class='ui basic purple horizontal label viewspecsupplier' id='viewspecsupplier'>View All Spec</span>";
      }

      if (obj["read_note_ihp"][0]["note"] == null) {
        $(".ihp-noteheader").hide()
      } else {
        $(".ihp-noteheader").show()
        $(".note-ihp-kembali").text(obj["read_note_ihp"][0]["note"])
      }

      if (isEmpty(obj)) {
        console.log("Gagal load tabel, data kosong");
      } else if (obj) {
        if (obj.status == false) {
          Swal.fire(
            "Error",
            "Ada kendala di koneksi/database, data gagal diload !",
            "error"
          );
        } else {
          $(".windoweditihp").modal("show");
          $(".inputdist").text("");
          $("#IHPNo").text(obj["read_item"][0]["no_ihp"]);
          $("#IHPDate").text(obj["read_item"][0]["tanggal_ihp"]);
          $("#IHPNoPSS").text(obj["read_item"][0]["ps_no"]);
          $("#IHPChassis").text(obj["read_item"][0]["chasis"]);
          $("#IHPType").text(obj["read_item"][0]["type"]);
          $("#IHPNegoName").text(obj["read_item"][0]["negosiator"]);
          $("#IHPDesgName").text(obj["read_item"][0]["designer"]);
          $("#IHPDescription").text(obj["read_item"][0]["description_item"]);
          $("#IHPCategory").text(obj["read_item"][0]["jenis_project"]);
          $("#IHPVendorMatNum").text(
            obj["read_item"][0]["vendor_material_number"]
          );
          $("#IHPVendor").text(obj["read_item"][0]["vendor"]);
          $("#IHPManufacture").text(obj["read_item"][0]["manufacture"]);
          $("#IHPNoGudang").text(obj["read_item"][0]["no_gudang"]);
          $("#IHPQty").text(obj["read_item"][0]["qty_confirm"]);
          $("#InputDrawingLoc").val(obj["read_item"][0]["drawing_loc"]);

          $("#IHPIdItem").val(IDitemx);
          $("#PSSidx").val(IDpssx);
          $("#IHPFile").html(file);

          ViewSpecSupplier();

          if (
            obj["read_item"][0]["progress_item"] == ihpprogress_j ||
            obj["read_item"][0]["progress_item"] == ihpprogress_k
          ) {
            $("#InfoCCReq").html(
              "<h3>Designer menunggu persetujuan Head Of untuk Close/Cancel IHP ini.</h3>"
            );
          } else {
            $("#InfoCCReq").html("&nbsp;");
          }

          if (obj["read_checker"]["status"] !== false) {
            $("#ElectName").text(obj["read_checker"][0][2]);
            $("#ElectQty").text(obj["read_checker"][0][3]);
            $("#ElectNote").text(obj["read_checker"][0][4]);
            $("#HomeAppName").text(obj["read_checker"][0][7]);
            $("#HomeAppQty").text(obj["read_checker"][0][8]);
            $("#HomeAppNote").text(obj["read_checker"][0][9]);
            $("#MechName").text(obj["read_checker"][0][12]);
            $("#MechQty").text(obj["read_checker"][0][13]);
            $("#MechNote").text(obj["read_checker"][0][14]);
            $("#IDName").text(obj["read_checker"][0][17]);
            $("#IDQty").text(obj["read_checker"][0][18]);
            $("#IDNote").text(obj["read_checker"][0][19]);
            $("#SoftName").text(obj["read_checker"][0][22]);
            $("#SoftQty").text(obj["read_checker"][0][23]);
            $("#SoftNote").text(obj["read_checker"][0][24]);
            $("#PCBName").text(obj["read_checker"][0][27]);
            $("#PCBQty").text(obj["read_checker"][0][28]);
            $("#PCBNote").text(obj["read_checker"][0][29]);
            $("#MQAName").text(obj["read_checker"][0][32]);
            $("#MQAQty").text(obj["read_checker"][0][33]);
            $("#MQANote").text(obj["read_checker"][0][34]);
            $("#DQAName").text(obj["read_checker"][0][37]);
            $("#DQAQty").text(obj["read_checker"][0][38]);
            $("#DQANote").text(obj["read_checker"][0][39]);
            $("#AuTName").text(obj["read_checker"][0][42]);
            $("#AuTQty").text(obj["read_checker"][0][43]);
            $("#AuTNote").text(obj["read_checker"][0][44]);
            $("#OthName").text(obj["read_checker"][0][47]);
            $("#OthQty").text(obj["read_checker"][0][48]);
            $("#OthNote").text(obj["read_checker"][0][49]);
            $("#Oth1Name").text(obj["read_checker"][0][52]);
            $("#Oth1Qty").text(obj["read_checker"][0][53]);
            $("#Oth1Note").text(obj["read_checker"][0][55]);
            $("#Oth2Name").text(obj["read_checker"][0][57]);
            $("#Oth2Qty").text(obj["read_checker"][0][58]);
            $("#Oth2Note").text(obj["read_checker"][0][59]);
          }
        }
      }
    },
    error: function () {
      window.location.href = "./?link=loclogout";
      Swal.fire(
        "Error",
        "Ada kendala di koneksi/database, data gagal diload !",
        "error"
      );
      console.log(
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
      );
    },
  });

}


$("#FinalResult").on("click", function () {
  // $("#PSSid").val(IDpssx);
  // $("#IHPid").val(IDitemx);
  var a = $("#PSSidx").val();
  var b = $("#IHPIdItem").val();
  var CCreq = $("#IHPCCRequest").val();
  $(".windowfinalresult").modal("show");
  $("#SHDNote").val('');
  $("#SHDNoteClose").val('');

  //console.log(CCreq);
  $.ajax({
    type: "POST",
    url: `${restlocpssihp}load_allresult`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      idpss: a,
      iditem: b,
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        Swal.fire(
          "Error",
          "Ada kendala di koneksi/database, data tidak tersimpan !",
          "error"
        );
      } else {
        var checkerMQA = obj[0]["checker_mqa"];
        var picsignMQA = obj[0]["pic_confirm_mqa"];
        var reqpin = obj[0]["req_pin"];

        //var designerreqpin = "BL";

        if (
          obj[0]["checker_electronic"] &&
          obj[0]["pic_confirm_electronic"] == null
        ) {
          if (obj[0]["status_electronic"]) {
            $("#ElectResult").html(
              "Hasil sementara: " +
                obj[0]["status_electronic"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_electronic"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_electronic"]) {
              $("#ElectResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_electronic"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_electronic"] + "</i>" );
            } else {
              $("#ElectResult").html( "<i>PIC evaluasi " + obj[0]["checker_electronic"] + " belum menerima sample</i>" );
            }
          }
          var el = 1;
        } else {
          $("#ElectResult").text(obj[0]["status_electronic"]);
          var el = 0;
        }

        if (
          obj[0]["checker_cycle"] &&
          obj[0]["pic_confirm_cycle"] == null
        ) {
          if (obj[0]["status_cycle"]) {
            $("#HAResult").html(
              "Hasil sementara: " +
                obj[0]["status_cycle"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_cycle"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_cycle"]) {
              $("#HAResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_cycle"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_cycle"] + "</i>" );
            } else {
              $("#HAResult").html( "<i>PIC evaluasi " + obj[0]["checker_cycle"] + " belum menerima sample</i>" );
            }
          }
          var cy = 1;
        } else {
          $("#HAResult").text(obj[0]["status_cycle"]);
          var cy = 0;
        }

        if (
          obj[0]["checker_mechanic"] &&
          obj[0]["pic_confirm_mechanic"] == null
        ) {
          if (obj[0]["status_mechanic"]) {
            $("#MechResult").html(
              "Hasil sementara: " +
                obj[0]["status_mechanic"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_mechanic"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_mechanic"]) {
              $("#MechResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_mechanic"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_mechanic"] + "</i>" );
            } else {
              $("#MechResult").html( "<i>PIC evaluasi " + obj[0]["checker_mechanic"] + " belum menerima sample</i>" );
            }
          }
          var me = 1;
        } else {
          $("#MechResult").text(obj[0]["status_mechanic"]);
          var me = 0;
        }

        if ( obj[0]["checker_ind"] && obj[0]["pic_confirm_ind"] == null ) {
          if (obj[0]["status_ind"]) {
            $("#IDeResult").html( "Hasil sementara: " + obj[0]["status_ind"] + " <i>, dievaluasi oleh: " + obj[0]["checker_ind"] + "</i>"
            );
          } else {
            if (obj[0]["date_received_ind"]) {
              $("#IDeResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_ind"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_ind"] + "</i>" );
            } else {
              $("#IDeResult").html( "<i>PIC evaluasi " + obj[0]["checker_ind"] + " belum menerima sample</i>" );
            }
          }
          var id = 1;
        } else {
          $("#IDeResult").text(obj[0]["status_ind"]);
          var id = 0;
        }

        if (
          obj[0]["checker_software"] &&
          obj[0]["pic_confirm_software"] == null
        ) {
          if (obj[0]["status_software"]) {
            $("#SoftResult").html(
              "Hasil sementara: " +
                obj[0]["status_software"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_software"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_software"]) {
              $("#SoftResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_software"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_software"] + "</i>" );
            } else {
              $("#SoftResult").html( "<i>PIC evaluasi " + obj[0]["checker_software"] + " belum menerima sample</i>" );
            }
          }
          var so = 1;
        } else {
          $("#SoftResult").text(obj[0]["status_software"]);
          var so = 0;
        }

        if (
          obj[0]["checker_pcb"] &&
          obj[0]["pic_confirm_pcb"] == null
        ) {
          if (obj[0]["status_pcb"]) {
            $("#PCBResult").html(
              "Hasil sementara: " +
                obj[0]["status_pcb"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_pcb"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_pcb"]) {
              $("#PCBResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_pcb"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_pcb"] + "</i>" );
            } else {
              $("#PCBResult").html( "<i>PIC evaluasi " + obj[0]["checker_pcb"] + " belum menerima sample</i>" );
            }
          }
          var pc = 1;
        } else {
          $("#PCBResult").text(obj[0]["status_pcb"]);
          var pc = 0;
        }

        if (
          obj[0]["checker_mqa"] &&
          obj[0]["pic_confirm_mqa"] == null
        ) {
          if (obj[0]["status_mqa"]) {
            $("#MQAResult").html(
              "Hasil sementara: " +
                obj[0]["status_mqa"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_mqa"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_mqa"]) {
              $("#MQAResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_mqa"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_mqa"] + "</i>" );
            } else {
              $("#MQAResult").html( "<i>PIC evaluasi " + obj[0]["checker_mqa"] + " belum menerima sample</i>" );
            }
          }
          var mq = 1;
        } else {
          $("#MQAResult").text(obj[0]["status_mqa"]);
          var mq = 0;
        }

        if (
          obj[0]["checker_dqa"] &&
          obj[0]["pic_confirm_dqa"] == null
        ) {
          if (obj[0]["status_dqa"]) {
            $("#DQAResult").html(
              "Hasil sementara: " +
                obj[0]["status_dqa"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_dqa"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_dqa"]) {
              $("#DQAResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_dqa"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_dqa"] + "</i>" );
            } else {
              $("#DQAResult").html( "<i>PIC evaluasi " + obj[0]["checker_dqa"] + " belum menerima sample</i>" );
            }
          }
          var dq = 1;
        } else {
          $("#DQAResult").text(obj[0]["status_dqa"]);
          var dq = 0;
        }

        if (
          obj[0]["checker_autrans"] &&
          obj[0]["pic_confirm_autrans"] == null
        ) {
          if (obj[0]["status_autrans"]) {
            $("#AuTResult").html(
              "Hasil sementara: " +
                obj[0]["status_autrans"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_autrans"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_autrans"]) {
              $("#AuTResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_autrans"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_autrans"] + "</i>" );
            } else {
              $("#AuTResult").html( "<i>PIC evaluasi " + obj[0]["checker_autrans"] + " belum menerima sample</i>" );
            }
          }
          var au = 1;
        } else {
          $("#AuTResult").text(obj[0]["status_autrans"]);
          var au = 0;
        }

        if (
          obj[0]["checker_others"] &&
          obj[0]["pic_confirm_others"] == null
        ) {
          if (obj[0]["status_others"]) {
            $("#OthResult").html(
              "Hasil sementara: " +
                obj[0]["status_others"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_others"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_others"]) {
              $("#OthResult").html( "<i>Sample diterima tgl "+ obj[0]["date_received_others"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_others"] + "</i>" );
            } else {
              $("#OthResult").html( "<i>PIC evaluasi " + obj[0]["checker_others"] + " belum menerima sample</i>" );
            }
          }
          var oa = 1;
        } else {
          $("#OthResult").text(obj[0]["status_others"]);
          var oa = 0;
        }

        if (
          obj[0]["checker_others1"] &&
          obj[0]["pic_confirm_others1"] == null
        ) {
          if (obj[0]["status_others1"]) {
            $("#Oth1Result").html(
              "Hasil sementara: " +
                obj[0]["status_others1"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_others1"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_others1"]) {
              $("#Oth1Result").html( "<i>Sample diterima tgl "+ obj[0]["date_received_others1"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_others1"] + "</i>" );
            } else {
              $("#Oth1Result").html( "<i>PIC evaluasi " + obj[0]["checker_others1"] + " belum menerima sample</i>" );
            }
          }
          var ob = 1;
        } else {
          $("#Oth1Result").text(obj[0]["status_others1"]);
          var ob = 0;
        }

        if (
          obj[0]["checker_others2"] &&
          obj[0]["pic_confirm_others2"] == null
        ) {
          if (obj[0]["status_others2"]) {
            $("#Oth2Result").html(
              "Hasil sementara: " +
                obj[0]["status_others2"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_others2"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_others2"]) {
              $("#Oth2Result").html( "<i>Sample diterima tgl "+ obj[0]["date_received_others2"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_others2"] + "</i>" );
            } else {
              $("#Oth2Result").html( "<i>PIC evaluasi " + obj[0]["checker_others2"] + " belum menerima sample</i>" );
            }
          }
          var oc = 1;
        } else {
          $("#Oth2Result").text(obj[0]["status_others2"]);
          var oc = 0;
        }
        var docel = obj[0]["acuan_electronic"];
        var doccy = obj[0]["acuan_cycle"];
        var docme = obj[0]["acuan_mechanic"];
        var docid = obj[0]["acuan_ind"];
        var docso = obj[0]["acuan_software"];
        var docpc = obj[0]["acuan_pcb"];
        var docmq = obj[0]["acuan_mqa"];
        var docdq = obj[0]["acuan_dqa"];
        var docat = obj[0]["acuan_autrans"];
        var docot = obj[0]["acuan_others"];
        var doco1 = obj[0]["acuan_others1"];
        var doco2 = obj[0]["acuan_others2"];

        var lnkel = obj[0]["link_electronic"];
        var lnkcy = obj[0]["link_cycle"];
        var lnkme = obj[0]["link_mechanic"];
        var lnkid = obj[0]["link_ind"];
        var lnkso = obj[0]["link_software"];
        var lnkpc = obj[0]["link_pcb"];
        var lnkmq = obj[0]["link_mqa"];
        var lnkdq = obj[0]["link_dqa"];
        var lnkat = obj[0]["link_autrans"];
        var lnkot = obj[0]["link_others"];
        var lnko1 = obj[0]["link_others1"];
        var lnko2 = obj[0]["link_others2"];

        
        if (lnkel && lnkel!==null) {
          if(!docel){ var docel = "Dokumen Electronic"; }
          var linkel =
            '<a target="_blank" href="../RND_Upload/' + lnkel + '">' + docel + "</a>";
        } else {
          var linkel = docel;
        }

        if (lnkcy) {
          if(!doccy){ var doccy = "Dokumen Energy Conversion"; }
          var linkcy =
            '<a target="_blank" href="../RND_Upload/' + lnkcy + '">' + doccy + "</a>";
        } else {
          var linkcy = doccy;
        }
        if (lnkme) {
          if(!docme){ var docme = "Dokumen Mechanic"; }
          var linkme =
            '<a target="_blank" href="../RND_Upload/' + lnkme + '">' + docme + "</a>";
        } else {
          var linkme = docme;
        }
        if (lnkid) {
          if(!docid){ var docid = "Dokumen Industrial Design"; }
          var linkid =
            '<a target="_blank" href="../RND_Upload/' + lnkid + '">' + docid + "</a>";
        } else {
          var linkid = docid;
        }
        if (lnkso) {
          if(!docso){ var docso = "Dokumen Software"; }
          var linkso =
            '<a target="_blank" href="../RND_Upload/' + lnkso + '">' + docso + "</a>";
        } else {
          var linkso = docso;
        }
        if (lnkpc) {
          if(!docpc){ var docpc = "Dokumen PCB"; }
          var linkpc =
            '<a target="_blank" href="../RND_Upload/' + lnkpc + '">' + docpc + "</a>";
        } else {
          var linkpc = docpc;
        }
        if (lnkmq) {
          if(!docmq){ var docmq = "Dokumen MQA"; }
          var linkmq =
            '<a target="_blank" href="../RND_Upload/' + lnkmq + '">' + docmq + "</a>";
        } else {
          var linkmq = docmq;
        }
        if (lnkdq) {
          if(!docdq){ var docdq = "Dokumen DQA"; }
          var linkdq =
            '<a target="_blank" href="../RND_Upload/' + lnkdq + '">' + docdq + "</a>";
        } else {
          var linkdq = docdq;
        }
        if (lnkat) {
          if(!docat){ var docat = "Dokumen Autrans"; }
          var linkat =
            '<a target="_blank" href="../RND_Upload/' + lnkat + '">' + docat + "</a>";
        } else {
          var linkat = docat;
        }
        if (lnkot) {
          if(!docot){ var docot = "Dokumen Others"; }
          var linkot =
            '<a target="_blank" href="../RND_Upload/' + lnkot + '">' + docot + "</a>";
        } else {
          var linkot = docot;
        }
        if (lnko1) {
          if(!doco1){ var doco1 = "Dokumen Others 1"; }
          var linko1 =
            '<a target="_blank" href="../RND_Upload/' + lnko1 + '">' + doco1 + "</a>";
        } else {
          var linko1 = doco1;
        }
        if (lnko2) {
          if(!doco2){ var doco2 = "Dokumen Others 2"; }
          var linko2 =
            '<a target="_blank" href="../RND_Upload/' + lnko2 + '">' + doco2 + "</a>";
        } else {
          var linko2 = doco2;
        }

        $("#ElectDocs").html(linkel);
        $("#HADocs").html(linkcy);
        $("#MechDocs").html(linkme);
        $("#IDDocs").html(linkid);
        $("#SoftDocs").html(linkso);
        $("#PCBDocs").html(linkpc);
        $("#MQADocs").html(linkmq);
        $("#DQADocs").html(linkdq);
        $("#AuTDocs").html(linkat);
        $("#OthDocs").html(linkot);
        //$("#Oth1Docs").html(linko1);
        //$("#Oth2Docs").html(linko2);


        // $("#ElectDocs").text(obj[0]["acuan_electronic"]);
        // $("#HADocs").text(obj[0]["acuan_cycle"]);
        // $("#MechDocs").text(obj[0]["acuan_mechanic"]);
        // $("#IDDocs").text(obj[0]["acuan_ind"]);
        // $("#SoftDocs").text(obj[0]["acuan_software"]);
        // $("#PCBDocs").text(obj[0]["acuan_pcb"]);
        // $("#MQADocs").text(obj[0]["acuan_mqa"]);
        // $("#DQADocs").text(obj[0]["acuan_dqa"]);
        // $("#AuTDocs").text(obj[0]["acuan_autrans"]);
        // $("#OthDocs").text(obj[0]["acuan_others"]);


        if (obj[0]["signed_by"]) {
          $("#ReqApprovalBtn").addClass("disabled");
          $("#ReqApprovalBtn").addClass("black");
          $("#ReqApprovalBtn").removeClass("green");
          $("#spanReqAppBtn").text(
            "Approved by " +
              obj[0]["signed_by"] +
              " # " +
              obj[0]["signed_date"]
          );
          $("#spanReqAppBtnshd").text(
            "Approved by " +
              obj[0]["signed_by"] +
              " # " +
              obj[0]["signed_date"]
          );
          $(".FResult").addClass("disabled");
          $(".FResult2").addClass("disabled");
        } else {
          $("#ReqApprovalBtn").removeClass("disabled");
          $("#ReqApprovalBtn").removeClass("black");
          $("#ReqApprovalBtn").addClass("green");
          $("#spanReqAppBtn").text("Request Approval");
          $("#spanReqAppBtnshd").text("Sign Approve");
          $(".FResult").removeClass("disabled");
          $(".FResult2").removeClass("disabled");
        }

        // if(checkerMQA && !picsignMQA){
        //   $('#spanReqAppBtn').text('Wait MQA Result & Sign');
        //   $('#spanReqAppBtnshd').text('Wait MQA Result & Sign');
        //   $('#ReqApprovalBtn').addClass('disabled');
        //   $('.FResult').addClass('disabled');
        //   $('.FResult2').addClass('disabled');
        // } else {
        //}

        var ttl =
          el + cy + me + id + so + pc + mq + dq + au + oa + ob + oc;
        if (ttl > 0) {
          //$('#spanReqAppBtn').text('Wait MQA Result & Sign');
          //$('#spanReqAppBtnshd').text('Wait MQA Result & Sign');
          $("#ReqApprovalBtn").addClass("disabled");
          $(".FResult").addClass("disabled");
          $(".FResult2").addClass("disabled");
        }

        if (
          obj[0]["pic_confirm_electronic"] == null &&
          obj[0]["pic_confirm_cycle"] == null &&
          obj[0]["pic_confirm_mechanic"] == null &&
          obj[0]["pic_confirm_ind"] == null &&
          obj[0]["pic_confirm_software"] == null &&
          obj[0]["pic_confirm_pcb"] == null &&
          obj[0]["pic_confirm_mqa"] == null &&
          obj[0]["pic_confirm_dqa"] == null &&
          obj[0]["pic_confirm_autrans"] == null &&
          obj[0]["pic_confirm_others"] == null &&
          obj[0]["pic_confirm_others1"] == null &&
          obj[0]["pic_confirm_others2"] == null
        ) {
          $("#spanReqAppBtn").text("All result Empty");
          $("#spanReqAppBtnshd").text("All result Empty");
          $("#ReqApprovalBtn").addClass("disabled");
          $(".FResult").addClass("disabled");
          $(".FResult2").addClass("disabled");
        }

        // console.log(CCreq);

        if (CCreq == ihpprogress_j) {
          $("#RCloseIHPBtn").addClass("disabled");
          $("#RCloseIHPBtn").text("Closing IHP Requested !");
          $("#CloseIHPBtn").text("Approve to Close IHP");
        } else {
          $("#RCloseIHPBtn").removeClass("disabled");
          $("#RCloseIHPBtn").text("Request Close IHP");
          $("#CloseIHPBtn").text("Close IHP");
        }

        if (CCreq == ihpprogress_k) {
          $("#RCancelIHPBtn").addClass("disabled");
          $("#RCancelIHPBtn").text("Canceling IHP Requested !");
          $("#CancelIHPBtn").text("Approve to Cancel IHP");
        } else {
          $("#RCancelIHPBtn").removeClass("disabled");
          $("#RCancelIHPBtn").text("Request Cancel IHP");
          $("#CancelIHPBtn").text("Cancel IHP");
        }

        $("#ElectPIC").text(obj[0]["pic_confirm_electronic"]);
        $("#HAPIC").text(obj[0]["pic_confirm_cycle"]);
        $("#MechPIC").text(obj[0]["pic_confirm_mechanic"]);
        $("#IDePIC").text(obj[0]["pic_confirm_ind"]);
        $("#SoftPIC").text(obj[0]["pic_confirm_software"]);
        $("#PCBPIC").text(obj[0]["pic_confirm_pcb"]);
        $("#MQAPIC").text(obj[0]["pic_confirm_mqa"]);
        $("#DQAPIC").text(obj[0]["pic_confirm_dqa"]);
        $("#AuTPIC").text(obj[0]["pic_confirm_autrans"]);
        $("#OthPIC").text(obj[0]["pic_confirm_others"]);
        $("#Oth1PIC").text(obj[0]["pic_confirm_others1"]);
        $("#Oth2PIC").text(obj[0]["pic_confirm_others2"]);
        $("#NoIHP").text(obj[0]["no_ihp"]);
        $("#FResult").dropdown("clear");
        $("#FResult").dropdown(
          "set selected",
          obj[0]["final_result"]
        );
        $("#FResult2").dropdown("clear");
        $("#FResult2").dropdown(
          "set selected",
          obj[0]["final_result"]
        );
        $("#PINReq").dropdown("clear");
        $("#PINReq").dropdown("set selected", reqpin);

        if (obj[0]["final_result"]) {
          $("#spanReqAppBtn").text("Wait Head Of Approval");
          $("#ReqApprovalBtn").addClass("disabled");
        } else {
          $("#ReqApprovalBtn").removeClass("disabled");
        }
      }
    },
    error: function () {
      window.location.href = "./?link=loclogout";
      Swal.fire(
        "Error",
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
        "error"
      );
    },
  });
});



$("#UnSignReport").on("click", function () {
  var a = $("#PSSidx").val();
  var b = $("#IHPIdItem").val();
  var CCreq = $("#IHPCCRequest").val();
  $(".windowunsign").modal("show");
  
  


  $.ajax({
    type: "POST",
    url: `${restlocpssihp}load_allresult`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      idpss: a,
      iditem: b,
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        Swal.fire(
          "Error",
          "Ada kendala di koneksi/database, data tidak tersimpan !",
          "error"
        );
      } else {


        if (
          obj[0]["checker_electronic"] &&
          obj[0]["pic_confirm_electronic"] == null
        ) {
          if (obj[0]["status_electronic"]) {
            $("#ElectResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_electronic"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_electronic"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_electronic"]) {
              $("#ElectResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_electronic"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_electronic"] + "</i>" );
            } else {
              $("#ElectResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_electronic"] + " belum menerima sample</i>" );
            }
          }
          var el = 1;
        } else {
          $("#ElectResultUS").text(obj[0]["status_electronic"]);
          var el = 0;
        }

        if (
          obj[0]["checker_cycle"] &&
          obj[0]["pic_confirm_cycle"] == null
        ) {
          if (obj[0]["status_cycle"]) {
            $("#HAResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_cycle"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_cycle"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_cycle"]) {
              $("#HAResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_cycle"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_cycle"] + "</i>" );
            } else {
              $("#HAResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_cycle"] + " belum menerima sample</i>" );
            }
          }
          var cy = 1;
        } else {
          $("#HAResultUS").text(obj[0]["status_cycle"]);
          var cy = 0;
        }

        if (
          obj[0]["checker_mechanic"] &&
          obj[0]["pic_confirm_mechanic"] == null
        ) {
          if (obj[0]["status_mechanic"]) {
            $("#MechResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_mechanic"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_mechanic"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_mechanic"]) {
              $("#MechResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_mechanic"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_mechanic"] + "</i>" );
            } else {
              $("#MechResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_mechanic"] + " belum menerima sample</i>" );
            }
          }
          var me = 1;
        } else {
          $("#MechResultUS").text(obj[0]["status_mechanic"]);
          var me = 0;
        }

        if ( obj[0]["checker_ind"] && obj[0]["pic_confirm_ind"] == null ) {
          if (obj[0]["status_ind"]) {
            $("#IDeResultUS").html( "Hasil sementara: " + obj[0]["status_ind"] + " <i>, dievaluasi oleh: " + obj[0]["checker_ind"] + "</i>"
            );
          } else {
            if (obj[0]["date_received_ind"]) {
              $("#IDeResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_ind"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_ind"] + "</i>" );
            } else {
              $("#IDeResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_ind"] + " belum menerima sample</i>" );
            }
          }
          var id = 1;
        } else {
          $("#IDeResultUS").text(obj[0]["status_ind"]);
          var id = 0;
        }

        if (
          obj[0]["checker_software"] &&
          obj[0]["pic_confirm_software"] == null
        ) {
          if (obj[0]["status_software"]) {
            $("#SoftResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_software"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_software"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_software"]) {
              $("#SoftResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_software"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_software"] + "</i>" );
            } else {
              $("#SoftResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_software"] + " belum menerima sample</i>" );
            }
          }
          var so = 1;
        } else {
          $("#SoftResultUS").text(obj[0]["status_software"]);
          var so = 0;
        }

        if (
          obj[0]["checker_pcb"] &&
          obj[0]["pic_confirm_pcb"] == null
        ) {
          if (obj[0]["status_pcb"]) {
            $("#PCBResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_pcb"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_pcb"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_pcb"]) {
              $("#PCBResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_pcb"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_pcb"] + "</i>" );
            } else {
              $("#PCBResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_pcb"] + " belum menerima sample</i>" );
            }
          }
          var pc = 1;
        } else {
          $("#PCBResultUS").text(obj[0]["status_pcb"]);
          var pc = 0;
        }

        if (
          obj[0]["checker_mqa"] &&
          obj[0]["pic_confirm_mqa"] == null
        ) {
          if (obj[0]["status_mqa"]) {
            $("#MQAResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_mqa"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_mqa"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_mqa"]) {
              $("#MQAResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_mqa"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_mqa"] + "</i>" );
            } else {
              $("#MQAResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_mqa"] + " belum menerima sample</i>" );
            }
          }
          var mq = 1;
        } else {
          $("#MQAResultUS").text(obj[0]["status_mqa"]);
          var mq = 0;
        }

        if (
          obj[0]["checker_dqa"] &&
          obj[0]["pic_confirm_dqa"] == null
        ) {
          if (obj[0]["status_dqa"]) {
            $("#DQAResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_dqa"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_dqa"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_dqa"]) {
              $("#DQAResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_dqa"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_dqa"] + "</i>" );
            } else {
              $("#DQAResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_dqa"] + " belum menerima sample</i>" );
            }
          }
          var dq = 1;
        } else {
          $("#DQAResultUS").text(obj[0]["status_dqa"]);
          var dq = 0;
        }

        if (
          obj[0]["checker_autrans"] &&
          obj[0]["pic_confirm_autrans"] == null
        ) {
          if (obj[0]["status_autrans"]) {
            $("#AuTResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_autrans"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_autrans"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_autrans"]) {
              $("#AuTResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_autrans"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_autrans"] + "</i>" );
            } else {
              $("#AuTResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_autrans"] + " belum menerima sample</i>" );
            }
          }
          var au = 1;
        } else {
          $("#AuTResultUS").text(obj[0]["status_autrans"]);
          var au = 0;
        }

        if (
          obj[0]["checker_others"] &&
          obj[0]["pic_confirm_others"] == null
        ) {
          if (obj[0]["status_others"]) {
            $("#OthResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_others"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_others"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_others"]) {
              $("#OthResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_others"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_others"] + "</i>" );
            } else {
              $("#OthResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_others"] + " belum menerima sample</i>" );
            }
          }
          var oa = 1;
        } else {
          $("#OthResultUS").text(obj[0]["status_others"]);
          var oa = 0;
        }

        if (
          obj[0]["checker_others1"] &&
          obj[0]["pic_confirm_others1"] == null
        ) {
          if (obj[0]["status_others1"]) {
            $("#Oth1ResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_others1"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_others1"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_others1"]) {
              $("#Oth1ResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_others1"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_others1"] + "</i>" );
            } else {
              $("#Oth1ResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_others1"] + " belum menerima sample</i>" );
            }
          }
          var ob = 1;
        } else {
          $("#Oth1ResultUSUS").text(obj[0]["status_others1"]);
          var ob = 0;
        }

        if (
          obj[0]["checker_others2"] &&
          obj[0]["pic_confirm_others2"] == null
        ) {
          if (obj[0]["status_others2"]) {
            $("#Oth2ResultUS").html(
              "Hasil sementara: " +
                obj[0]["status_others2"] +
                " <i>, dievaluasi oleh: " +
                obj[0]["checker_others2"] +
                "</i>"
            );
          } else {
            if (obj[0]["date_received_others2"]) {
              $("#Oth2ResultUS").html( "<i>Sample diterima tgl "+ obj[0]["date_received_others2"]+" dan masih proses, dievaluasi oleh: " + obj[0]["checker_others2"] + "</i>" );
            } else {
              $("#Oth2ResultUS").html( "<i>PIC evaluasi " + obj[0]["checker_others2"] + " belum menerima sample</i>" );
            }
          }
          var oc = 1;
        } else {
          $("#Oth2ResultUS").text(obj[0]["status_others2"]);
          var oc = 0;
        }
        var docel = obj[0]["acuan_electronic"];
        var doccy = obj[0]["acuan_cycle"];
        var docme = obj[0]["acuan_mechanic"];
        var docid = obj[0]["acuan_ind"];
        var docso = obj[0]["acuan_software"];
        var docpc = obj[0]["acuan_pcb"];
        var docmq = obj[0]["acuan_mqa"];
        var docdq = obj[0]["acuan_dqa"];
        var docat = obj[0]["acuan_autrans"];
        var docot = obj[0]["acuan_others"];
        var doco1 = obj[0]["acuan_others1"];
        var doco2 = obj[0]["acuan_others2"];

        var lnkel = obj[0]["link_electronic"];
        var lnkcy = obj[0]["link_cycle"];
        var lnkme = obj[0]["link_mechanic"];
        var lnkid = obj[0]["link_ind"];
        var lnkso = obj[0]["link_software"];
        var lnkpc = obj[0]["link_pcb"];
        var lnkmq = obj[0]["link_mqa"];
        var lnkdq = obj[0]["link_dqa"];
        var lnkat = obj[0]["link_autrans"];
        var lnkot = obj[0]["link_others"];
        var lnko1 = obj[0]["link_others1"];
        var lnko2 = obj[0]["link_others2"];

        
        if (lnkel && lnkel!==null) {
          if(!docel){ var docel = "Dokumen Electronic"; }
          var linkel =
            '<a target="_blank" href="../RND_Upload/' + lnkel + '">' + docel + "</a>";
        } else {
          var linkel = docel;
        }

        if (lnkcy) {
          if(!doccy){ var doccy = "Dokumen Energy Conversion"; }
          var linkcy =
            '<a target="_blank" href="../RND_Upload/' + lnkcy + '">' + doccy + "</a>";
        } else {
          var linkcy = doccy;
        }
        if (lnkme) {
          if(!docme){ var docme = "Dokumen Mechanic"; }
          var linkme =
            '<a target="_blank" href="../RND_Upload/' + lnkme + '">' + docme + "</a>";
        } else {
          var linkme = docme;
        }
        if (lnkid) {
          if(!docid){ var docid = "Dokumen Industrial Design"; }
          var linkid =
            '<a target="_blank" href="../RND_Upload/' + lnkid + '">' + docid + "</a>";
        } else {
          var linkid = docid;
        }
        if (lnkso) {
          if(!docso){ var docso = "Dokumen Software"; }
          var linkso =
            '<a target="_blank" href="../RND_Upload/' + lnkso + '">' + docso + "</a>";
        } else {
          var linkso = docso;
        }
        if (lnkpc) {
          if(!docpc){ var docpc = "Dokumen PCB"; }
          var linkpc =
            '<a target="_blank" href="../RND_Upload/' + lnkpc + '">' + docpc + "</a>";
        } else {
          var linkpc = docpc;
        }
        if (lnkmq) {
          if(!docmq){ var docmq = "Dokumen MQA"; }
          var linkmq =
            '<a target="_blank" href="../RND_Upload/' + lnkmq + '">' + docmq + "</a>";
        } else {
          var linkmq = docmq;
        }
        if (lnkdq) {
          if(!docdq){ var docdq = "Dokumen DQA"; }
          var linkdq =
            '<a target="_blank" href="../RND_Upload/' + lnkdq + '">' + docdq + "</a>";
        } else {
          var linkdq = docdq;
        }
        if (lnkat) {
          if(!docat){ var docat = "Dokumen Autrans"; }
          var linkat =
            '<a target="_blank" href="../RND_Upload/' + lnkat + '">' + docat + "</a>";
        } else {
          var linkat = docat;
        }
        if (lnkot) {
          if(!docot){ var docot = "Dokumen Others"; }
          var linkot =
            '<a target="_blank" href="../RND_Upload/' + lnkot + '">' + docot + "</a>";
        } else {
          var linkot = docot;
        }
        if (lnko1) {
          if(!doco1){ var doco1 = "Dokumen Others 1"; }
          var linko1 =
            '<a target="_blank" href="../RND_Upload/' + lnko1 + '">' + doco1 + "</a>";
        } else {
          var linko1 = doco1;
        }
        if (lnko2) {
          if(!doco2){ var doco2 = "Dokumen Others 2"; }
          var linko2 =
            '<a target="_blank" href="../RND_Upload/' + lnko2 + '">' + doco2 + "</a>";
        } else {
          var linko2 = doco2;
        }

        $("#ElectDocsUS").html(linkel);
        $("#HADocsUS").html(linkcy);
        $("#MechDocsUS").html(linkme);
        $("#IDDocsUS").html(linkid);
        $("#SoftDocsUS").html(linkso);
        $("#PCBDocsUS").html(linkpc);
        $("#MQADocsUS").html(linkmq);
        $("#DQADocsUS").html(linkdq);
        $("#AuTDocsUS").html(linkat);
        $("#OthDocsUS").html(linkot);
        //$("#Oth1Docs").html(linko1);
        //$("#Oth2Docs").html(linko2);

        if ( obj[0]["pic_confirm_electronic"] == null || obj[0]["pic_confirm_electronic"] == "" ) {
          $("#ElectUnSign").html("");
        } else {
          $("#ElectUnSign").html("<button class='ui small violet button BtnUnSign' sid='1'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_cycle"] == null || obj[0]["pic_confirm_cycle"] == "" ) {
          $("#HAUnSign").html("");
        } else {
          $("#HAUnSign").html("<button class='ui small violet button BtnUnSign' sid='2'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_mechanic"] == null || obj[0]["pic_confirm_mechanic"] == "" ) {
          $("#MechUnSign").html("");
        } else {
          $("#MechUnSign").html("<button class='ui small violet button BtnUnSign' sid='3'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_ind"] == null || obj[0]["pic_confirm_ind"] == "" ) {
          $("#IDUnSign").html("");
        } else {
          $("#IDUnSign").html("<button class='ui small violet button BtnUnSign' sid='4'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_software"] == null || obj[0]["pic_confirm_software"] == "" ) {
          $("#SoftUnSign").html("");
        } else {
          $("#SoftUnSign").html("<button class='ui small violet button BtnUnSign' sid='5'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_pcb"] == null || obj[0]["pic_confirm_pcb"] == "" ) {
          $("#PCBUnSign").html("");
        } else {
          $("#PCBUnSign").html("<button class='ui small violet button BtnUnSign' sid='6'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_mqa"] == null || obj[0]["pic_confirm_mqa"] == "" ) {
          $("#MQAUnSign").html("");
        } else {
          $("#MQAUnSign").html("<button class='ui small violet button BtnUnSign' sid='7'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_dqa"] == null || obj[0]["pic_confirm_dqa"] == "" ) {
          $("#DQAUnSign").html("");
        } else {
          $("#DQAUnSign").html("<button class='ui small violet button BtnUnSign' sid='8'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_autrans"] == null || obj[0]["pic_confirm_autrans"] == "" ) {
          $("#AuTUnSign").html("");
        } else {
          $("#AuTUnSign").html("<button class='ui small violet button BtnUnSign' sid='9'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_others"] == null || obj[0]["pic_confirm_others"] == "" ) {
          $("#OthUnSign").html("");
        } else {
          $("#OthUnSign").html("<button class='ui small violet button BtnUnSign' sid='10'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_others1"] == null || obj[0]["pic_confirm_others1"] == "" ) {
          $("#Oth1UnSign").html("");
        } else {
          $("#Oth1UnSign").html("<button class='ui small violet button BtnUnSign' sid='11'><i class='redo icon'></i>Un-Sign</button>");
        }

        if ( obj[0]["pic_confirm_others2"] == null || obj[0]["pic_confirm_others2"] == "" ) {
          $("#Oth2UnSign").html("");
        } else {
          $("#Oth2UnSign").html("<button class='ui small violet button BtnUnSign' sid='12'><i class='redo icon'></i>Un-Sign</button>");
        }

        $("#ElectPICUS").text(obj[0]["pic_confirm_electronic"]);
        $("#HAPICUS").text(obj[0]["pic_confirm_cycle"]);
        $("#MechPICUS").text(obj[0]["pic_confirm_mechanic"]);
        $("#IDePICUS").text(obj[0]["pic_confirm_ind"]);
        $("#SoftPICUS").text(obj[0]["pic_confirm_software"]);
        $("#PCBPICUS").text(obj[0]["pic_confirm_pcb"]);
        $("#MQAPICUS").text(obj[0]["pic_confirm_mqa"]);
        $("#DQAPICUS").text(obj[0]["pic_confirm_dqa"]);
        $("#AuTPICUS").text(obj[0]["pic_confirm_autrans"]);
        $("#OthPICUS").text(obj[0]["pic_confirm_others"]);
        $("#Oth1PICUS").text(obj[0]["pic_confirm_others1"]);
        $("#Oth2PICUS").text(obj[0]["pic_confirm_others2"]);

      }


      $(".BtnUnSign").on("click", function () {
        // var idihp = $(this).attr("id").toUpperCase();
        var sid = $(this).attr("sid");
        console.log (sid);
        console.log(a);
        console.log(b);

        Swal.fire({
          title: "<h3>UnSign Selected Report ?</h3>",
          icon: "warning",
          confirmButtonText: "Ya",
          showCancelButton: true,
        }).then((result) => {
          if (result.value) {
            $.ajax({
              type: "POST",
              url: `${restlocpssihp}unsign_ihpresult`,
              headers: {
                user: vusrnm,
                token: vtoken,
              },
              data: {
                idpss: a,
                iditem: b,
                sid : sid
              },
              cache: false,
              success: function (response) {
                var obj = JSON.parse(JSON.parse(response));
                if (obj.status == false) {
                  Swal.fire(
                    "Error",
                    "Ada kendal di koneksi/database, data tidak tersimpan !",
                    "error"
                  );
                } else {
                  Swal.fire({
                    title: "Un-Signed!",
                    text: "Report berhasil di Un-Sign !",
                    timer: 1500,
                    position: "top-end",
                    icon: "success",
                    showConfirmButton: false,
                  });
                  ReadItemPSSTable();
                }
              },
              error: function () {
                //window.location.href = "./?link=loclogout";
                Swal.fire(
                  "Error",
                  "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
                  "error"
                );
              },
            });
          }
        });
        $(".windowunsign").modal("hide");

        


        // $.ajax({
        //   type: "POST",
        //   url: `${restlocpssihp}load_allcheckerxx`,
        //   headers: {
        //     user: vusrnm,
        //     token: vtoken,
        //   },
        //   data: {
        //     iditem: IDitemx,
        //     sid: sid,
        //   },
        //   cache: false,
        //   success: function (response) {
        //     var obj = JSON.parse(response);
        //     if (obj.status == false) {
        //       Swal.fire(
        //         "Error",
        //         "Ada kendala di koneksi/database, data tidak tersimpan !",
        //         "error"
        //       );
        //     } else {
        //       var qtyuse = Number(obj["read_checker"][0][1]);
        //       var qtys = qtysaldo + qtyuse;
        //       jmlData = obj["read_namachecker"].length;
        //       $("#PICIHP").empty();
    
        //       for (a = 0; a < jmlData; a++) {
        //         if (
        //           obj["read_namachecker"][a][0] == obj["read_checker"][0][0]
        //         ) {
        //           $("#PICIHP").append(
        //             '<option value="' +
        //               obj["read_namachecker"][a][0] +
        //               '" selected>' +
        //               obj["read_namachecker"][a][0] +
        //               "</option>"
        //           );
        //         } else {
        //           $("#PICIHP").append(
        //             '<option value="' +
        //               obj["read_namachecker"][a][0] +
        //               '">' +
        //               obj["read_namachecker"][a][0] +
        //               "</option>"
        //           );
        //         }
        //       }
        //       $("#PICIHP").dropdown(
        //         "set selected",
        //         obj["read_checker"][0][0]
        //       );
        //       $("#QtyIHP").val(obj["read_checker"][0][1]);
        //       $("#NoteIHP").val(obj["read_checker"][0][2]);
        //       $("#PSSid").val(IDpssx);
        //       $("#IHPid").val(IDitemx);
        //       $("#IHPsid").val(sid);
        //       $("#MaxQty").text(qtys);
        //       $("#SaldoQty").text(qtysaldo);
        //       $("#QtySisa").text(qtysaldo);
        //       $("#AllQty").text(qtyconfirm);
        //     }
        //   },
        //   error: function () {
        //     window.location.href = "./?link=loclogout";
        //     Swal.fire(
        //       "Error",
        //       "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
        //       "error"
        //     );
        //   },
        // });
      });



    },
    error: function () {
      window.location.href = "./?link=loclogout";
      Swal.fire(
        "Error",
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
        "error"
      );
    },
  });


  




});

function ViewSpecSupplier() {
  $("#viewspecsupplier").on("click", function (e) {
    $(".windowspecsupplier").modal("show");
    var idpss = $("#PSSidx").val();
    var iditem = $("#IHPIdItem").val();

    $.ajax({
      type: "POST",
      url: `${restlocpssihp}read_spec`,
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        idpss: idpss,
        iditem: iditem,
      },
      cache: false,
      success: function (response) {
        var obj = JSON.parse(response);
        if (isEmpty(obj)) {
          console.log("Gagal load, data kosong");
          return false;
        } else if (obj) {

          if (obj.status == false) {
            $("#SpecList").empty();
          } else {
            jmlData = obj.length;
            $("#SpecList").empty();
            for (a = 0; a < jmlData; a++) {
              var filelink = "<a target='_blank' href='../RND_Upload/SpecOperator/"+obj[a]["file"]+"'>";
              var namafile = obj[a]["file"];

              if (obj[a]["note_spec"] == "" || obj[a]["note_spec"]==null){
                var note ="";
              } else {
                var note = obj[a]["note_spec"];
              }

              $("#TableSpecList").find("tbody").append(
                  "<tr><td class='center'>" +
                    obj[a]["created_date"] +
                    "</td><td class='center'>" +
                    filelink+namafile +
                    "</a>" +
                    "</td><td class='center'>" +
                    note +
                    "</td></tr>"
                );
            }
          }
        } else {
          Swal.fire(
            "Error",
            "Ada kendal di koneksi/database, data tidak tersimpan !",
            "error"
          );
        }
      },
      error: function () {
       // window.location.href = "./?link=loclogout";
        Swal.fire(
          "Error",
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
          "error"
        );
      },
    });
  });
}


$("#SaveIHP").on("click", function () {
  var idpss = $("#PSSid").val();
  var iditem = $("#IHPid").val();
  var sid = $("#IHPsid").val();
  var pic = $("#PICIHP").val();
  var qty = $("#QtyIHP").val(); //qty yang terisi di input
  var note = $("#NoteIHP").val();
  var maxqty = $("#MaxQty").text(); //max input

  if (pic) {
    if (qty) {
      if (Number(qty) <= Number(maxqty)) {
        $.ajax({
          type: "POST",
          url: `${restlocpssihp}save_checker`,
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            iditem: iditem,
            sid: sid,
            pic: pic,
            qty: qty,
            note: note,
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
              Swal.fire(
                "Error",
                "Ada kendala di koneksi/database, data tidak tersimpan !",
                "error"
              );
            } else {
              Swal.fire({
                text: "Saved !",
                timer: 2000,
                toast: true,
                showConfirmButton: false,
              });

              //reload table sample distributions
              $(".windoweditdistributeihp").modal("hide");
              $(".windoweditihp").modal("show");
              LoadSampleDistribution(idpss, iditem);
            }
          },
          error: function () {
            window.location.href = "./?link=loclogout";
            Swal.fire(
              "Error",
              "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
              "error"
            );
          },
        });
      } else {
        Swal.fire(
          "Error",
          "Maaf, Isian Sample Qty terlalu besar dari Sisa Sample",
          "warning"
        );
      }
    } else {
      Swal.fire("Error", "Jumlah sample belum terisi !", "warning");
    }
  } else {
    Swal.fire("Error", "Nama belum dipilih !", "warning");
  }
});

$("#DelIHP").on("click", function () {
  var idpss = $("#PSSid").val();
  var iditem = $("#IHPid").val();
  var sid = $("#IHPsid").val();
  $.ajax({
    type: "POST",
    url: `${restlocpssihp}delete_checker`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      iditem: iditem,
      sid: sid,
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        Swal.fire(
          "Error",
          "Ada kendala di koneksi/database, data tidak tersimpan !",
          "error"
        );
      } else {
        Swal.fire({
          text: "Deleted !",
          timer: 2000,
          toast: true,
          showConfirmButton: false,
        });
        //reload table sample distributions
        $(".windoweditdistributeihp").modal("hide");
        $(".windoweditihp").modal("show");
        LoadSampleDistribution(idpss, iditem);
      }
    },
    error: function () {
      window.location.href = "./?link=loclogout";
      Swal.fire(
        "Error",
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
        "error"
      );
    },
  });
});

$("#DesgnConfirm").on("click", function (e) {
  var iditem = $("#IHPIdItem").val();
  var user = $("#IHPUsername").val();
  Swal.fire({
    title: "<h3>Terima IHP ini ?</h3>",
    text:
      "Pastikan anda telah menerima material yang sesuai dengan No IHP ini.",
    icon: "warning",
    confirmButtonText: "Ya",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `${restlocpssihp}designer_confirm`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          user: user,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(JSON.parse(response));
          if (obj.status == false) {
            Swal.fire(
              "Error",
              "Ada kendala di koneksi/database, data tidak tersimpan !",
              "error"
            );
          } else {
            Swal.fire({
              title: "Received !",
              timer: 1500,
              icon: "success",
              showConfirmButton: false,
            });
            //LoadTableList();
            var sfi = getCookie("sfilihp");
            var tfi = getCookie("tfilihp");
            var ifi = getCookie("ifilihp");
            var stf = getCookie("stfilihp");
            TableListFunc(sfi, tfi, ifi, stf);

            $("#DesgnConfirm").addClass("disabled");
            $(".windoweditihp").modal("hide");
          }
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          Swal.fire(
            "Error",
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
            "error"
          );
        },
      });
    }
  });
});

$(".SaveDrawingLoc").on("click", function (e) {
  var iditem = $("#IHPIdItem").val();
  var user = $("#IHPUsername").val();
  var drwloc = $("#InputDrawingLoc").val();
  Swal.fire({
    title: "<h3>Save DrawingLoc</h3>",
    text: "Simpan data DrawingLoc di Item IHP ini?",
    icon: "warning",
    confirmButtonText: "Ya",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `${restlocpssihp}save_drawingloc`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          drwloc: drwloc,
          user: user,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(JSON.parse(response));
          if (obj.status == false) {
            Swal.fire(
              "Error",
              "Ada kendala di koneksi/database, data tidak tersimpan !",
              "error"
            );
          } else {
            Swal.fire({
              title: "DrawingLoc Saved !",
              timer: 1500,
              icon: "success",
              showConfirmButton: false,
            });
            // LoadTableList();
            var sfi = getCookie("sfilihp");
            var tfi = getCookie("tfilihp");
            var ifi = getCookie("ifilihp");
            var stf = getCookie("stfilihp");
            TableListFunc(sfi, tfi, ifi, stf);

          }
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          Swal.fire(
            "Error",
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
            "error"
          );
        },
      });
    }
  });
});

$(".sendapprovefresult").on("click", function (e) {
  var iditem = $("#IHPIdItem").val();
  var noihp = $("#NoIHP").text();
  var status = $("#FResult2").val();
  var pinreq = $("#PINReq").val();
  if (status && pinreq) {
    Swal.fire({
      title: "<h3>Kirim Permintaan Approval ?</h3>",
      text: noihp + " > " + status,
      icon: "warning",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url: `${restlocpssihp}set_finalresult`,
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            iditem: iditem,
            status: status,
            pinreq: pinreq,
            user: Udecrypt,
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(JSON.parse(response));
            if (obj.status == false) {
              Swal.fire(
                "Error",
                "Ada kendala di koneksi/database, data tidak tersimpan !",
                "error"
              );
            } else {
              Swal.fire({
                title: "Sent to Head Of !",
                timer: 1500,
                icon: "success",
                showConfirmButton: false,
              });
              // LoadTableList();
              var sfi = getCookie("sfilihp");
              var tfi = getCookie("tfilihp");
              var ifi = getCookie("ifilihp");
              var stf = getCookie("stfilihp");
              TableListFunc(sfi, tfi, ifi, stf);

              $(".windowfinalresult").modal("hide");
            }
          },
          error: function () {
            window.location.href = "./?link=loclogout";
            Swal.fire(
              "Error",
              "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
              "error"
            );
          },
        });
      }
    });
  } else {
    Swal.fire({
      title: "Final Result dan Request PIN harus dipilih terlebih dahulu !",
      timer: 1500,
      icon: "error",
      showConfirmButton: false,
    });
  }
});

$(".signapproveihp").on("click", function (e) {
  var iditem = $("#IHPIdItem").val();
  var noihp = $("#NoIHP").text();
  var status = $("#FResult").val();
  var pinreq = $("#PINReq").val();
  var shdnote = $("#SHDNote").val();
  if (status) {
    Swal.fire({
      title: "<h3>Sign Approval IHP ?</h3>",
      text: noihp + " > " + status,
      icon: "warning",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url: `${restlocpssihp}sign_shd`,
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            iditem: iditem,
            status: status,
            pinreq: pinreq,
            shdnote: shdnote,
            user: Udecrypt,
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(JSON.parse(response));
            if (obj.status == false) {
              Swal.fire(
                "Error",
                "Ada kendala di koneksi/database, data tidak tersimpan !",
                "error"
              );
            } else {
              Swal.fire({
                title: "Signed !",
                timer: 1500,
                icon: "success",
                showConfirmButton: false,
              });
              // LoadTableList();
              var sfi = getCookie("sfilihp");
              var tfi = getCookie("tfilihp");
              var ifi = getCookie("ifilihp");
              var stf = getCookie("stfilihp");
              TableListFunc(sfi, tfi, ifi, stf);

              $(".windowfinalresult").modal("hide");
            }
          },
          error: function () {
            window.location.href = "./?link=loclogout";
            Swal.fire(
              "Error",
              "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
              "error"
            );
          },
        });
      }
    });
  } else {
    Swal.fire({
      title: "Final Result harus dipilih terlebih dahulu !",
      timer: 1500,
      icon: "error",
      showConfirmButton: false,
    });
  }
});




$("#CloseIHPBtn").on("click", function (e) {
  var iditem = $("#IHPIdItem").val();
  var status = $("#FResult").val();
  var idpss = $("#PSSidx").val();
  $(".windowcloseihpshd").modal("show");
  $("#SHDNote").val('');
  $("#SHDNoteClose").val('');
  $("#PINReqClose").dropdown("set selected", 'NO');

  $("#IHPCloseSHD").on("click", function (e) {
    var pinreqclose = $("#PINReqClose").val();
    var resultclose = $("#FResultClose").val();
    var noteclose = $("#SHDNoteClose").val();
  
    Swal.fire({
      title: "<h3>Set IHP Status to CLOSE ???</h3>",
      icon: "warning",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url: `${restlocpssihp}close_ihp`,
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            iditem: iditem,
            status: status,
            idpss: idpss,
            pinreqclose: pinreqclose,
            resultclose : resultclose,
            noteclose : noteclose,
            user: Udecrypt,
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(JSON.parse(response));
            if (obj.status == false) {
              Swal.fire(
                "Error",
                "Ada kendala di koneksi/database, data tidak tersimpan !",
                "error"
              );
            } else {
              Swal.fire({
                title: "IHP Closed !",
                timer: 1500,
                icon: "success",
                showConfirmButton: false,
              });
              // LoadTableList();
              var sfi = getCookie("sfilihp");
              var tfi = getCookie("tfilihp");
              var ifi = getCookie("ifilihp");
              var stf = getCookie("stfilihp");
              TableListFunc(sfi, tfi, ifi, stf);

              $(".windowcloseihpshd").modal("hide");
            }
          },
          error: function () {
            //window.location.href = "./?link=loclogout";
            Swal.fire(
              "Error",
              "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
              "error"
            );
          },
        });
      }
    });
  });

});






$("#CancelIHPBtn").on("click", function () {
  var iditem = $("#IHPIdItem").val();
  var idpss = $("#PSSidx").val();

  (async () => {
    const { value: reason } = await Swal.fire({
      title: "Reason",
      input: "text",
      inputPlaceholder: "Alasan Pembatalan IHP",
    });

    if (reason) {
      $.ajax({
        type: "POST",
        url: `${restlocpssihp}cancel_ihp`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          user: Udecrypt,
          idpss: idpss,
          reason: reason,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(response);
          if (isEmpty(obj)) {
            console.log("-Fail-");
            return false;
          } else if (obj) {
          }
          // LoadTableList();
          var sfi = getCookie("sfilihp");
          var tfi = getCookie("tfilihp");
          var ifi = getCookie("ifilihp");
          var stf = getCookie("stfilihp");
          TableListFunc(sfi, tfi, ifi, stf);

          $(".windowfinalresult").modal("hide");
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          console.log(
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
          );
        },
      });
    }
  })();
});

$("#RCloseIHPBtn").on("click", function (e) {
  var iditem = $("#IHPIdItem").val();
  var status = $("#FResult2").val();
  Swal.fire({
    title: "<h3>Request IHP Status to CLOSE ?</h3>",
    icon: "warning",
    confirmButtonText: "Ya",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `${restlocpssihp}close_ihpdesigner`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          status: status,
          user: Udecrypt,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(JSON.parse(response));
          if (obj.status == false) {
            Swal.fire(
              "Error",
              "Ada kendala di koneksi/database, data tidak tersimpan !",
              "error"
            );
          } else {
            Swal.fire({
              title: "Request IHP: Close !",
              timer: 1500,
              icon: "success",
              showConfirmButton: false,
            });
            // LoadTableList();
            var sfi = getCookie("sfilihp");
            var tfi = getCookie("tfilihp");
            var ifi = getCookie("ifilihp");
            var stf = getCookie("stfilihp");
            TableListFunc(sfi, tfi, ifi, stf);

            $(".windowfinalresult").modal("hide");
          }
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          Swal.fire(
            "Error",
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
            "error"
          );
        },
      });
    }
  });
});

$("#RCancelIHPBtn").on("click", function () {
  var iditem = $("#IHPIdItem").val();

  (async () => {
    const { value: reason } = await Swal.fire({
      title: "Reason",
      input: "text",
      inputPlaceholder: "Alasan Permintaan Pembatalan IHP",
    });

    if (reason) {
      $.ajax({
        type: "POST",
        url: `${restlocpssihp}cancel_ihpdesigner`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          user: Udecrypt,
          reason: reason,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(response);
          if (isEmpty(obj)) {
            console.log("-Fail-");
            return false;
          } else if (obj) {
          }
          // LoadTableList();
          var sfi = getCookie("sfilihp");
          var tfi = getCookie("tfilihp");
          var ifi = getCookie("ifilihp");
          var stf = getCookie("stfilihp");
          TableListFunc(sfi, tfi, ifi, stf);

          $(".windowfinalresult").modal("hide");
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          console.log(
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
          );
        },
      });
    }
  })();
});

$("#IHPStatusBtn").on("click", function (e) {
  var iditem = $("#IHPIdItem").val();
  var noihp = $("#NoIHP").text();
  var ihpsts = $("#IHPStatus").val();
  Swal.fire({
    title: "<h3>Change IHP Status to " + ihpsts + "?</h3>",
    text: noihp + " > " + ihpsts,
    icon: "warning",
    confirmButtonText: "Ya",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `${restlocpssihp}set_finalstatus`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          ihpsts: ihpsts,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(JSON.parse(response));
          if (obj.status == false) {
            Swal.fire(
              "Error",
              "Ada kendala di koneksi/database, data tidak tersimpan !",
              "error"
            );
          } else {
            Swal.fire({
              title: "Saved",
              timer: 1500,
              icon: "success",
              showConfirmButton: false,
            });
            // LoadTableList();
            var sfi = getCookie("sfilihp");
            var tfi = getCookie("tfilihp");
            var ifi = getCookie("ifilihp");
            var stf = getCookie("stfilihp");
            TableListFunc(sfi, tfi, ifi, stf);
            
            $(".windoweditihp").modal("hide");
          }
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          Swal.fire(
            "Error",
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
            "error"
          );
        },
      });
    }
  });
});

$("#IHPKembali").on("click", function (e) {
  var idpss = $("#PSSidx").val();
  var iditem = $("#IHPIdItem").val();
  Swal.fire({
    title: "<h3>IHP dikembalikan ke MSC (Operator) ?</h3>",
    html:
      "Sebelum dikembalikan, <br>Pastikan dokumen dan persyaratan lain untuk tahapan selanjutnya sudah lengkap.",
    icon: "warning",
    confirmButtonText: "OK",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `${restlocpssihp}set_ihpkembali`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          idpss: idpss,
          user: Udecrypt,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(JSON.parse(response));
          if (obj.status == false) {
            Swal.fire(
              "Error",
              "Ada kendala di koneksi/database, data tidak tersimpan !",
              "error"
            );
          } else {
            Swal.fire({
              title: "Sent",
              timer: 1500,
              icon: "success",
              showConfirmButton: false,
            });
            var sfi = getCookie("sfilihp");
            var tfi = getCookie("tfilihp");
            var ifi = getCookie("ifilihp");
            var stf = getCookie("stfilihp");
            TableListFunc(sfi, tfi, ifi, stf);
            //LoadTableList();
            $(".windoweditihp").modal("hide");
          }
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          Swal.fire(
            "Error",
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
            "error"
          );
        },
      });
      $(".windoweditihp").modal("hide");
    }
  });
});




// function LoadTableList() {
  //Read Filter Cookies
  var d = new Date();
  var yearnow = d.getFullYear();
  var sfilter = getCookie("sfilihp");
  var tfilter = getCookie("tfilihp");
  var ifilter = getCookie("ifilihp");
  var stfilter = getCookie("stfilihp");

  if (sfilter) {
    $("#filtercari").val(sfilter);
    var sfilterstart = sfilter;
  } else {
    setCookie("sfilihp", "", 5);
    var sfilterstart = "";
  }
  if (tfilter) {
    $("#filtertahun").dropdown("set selected", tfilter);
    var tfilterstart = tfilter;
  } else {
    setCookie("tfilihp", yearnow, 5);
    var tfilterstart = yearnow;
  }
  if (ifilter) {
    $("#filterihp").dropdown("set selected", ifilter);
    var ifilterstart = ifilter;
  } else {
    setCookie("ifilihp", "ALL", 5);
    var ifilterstart = "ALL";
  }
  if (stfilter) {
    $("#filterstatus").dropdown("set selected", stfilter);
    var stfilterstart = stfilter;
  } else {
    setCookie("stfilihp", "ALL", 5);
    var stfilterstart = "ALL";
  }

  //Load Table
  TableListFunc(sfilterstart, tfilterstart, ifilterstart, stfilterstart);
// }

//RESPON KETIKA INPUT PENCARIAN DI KETIK
$("#filtercari").on("keyup", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterIHP = $("#filterihp").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("sfilihp", FilterCari, 5);
  setCookie("tfilihp", FilterTahun, 5);
  setCookie("ifilihp", FilterIHP, 5);
  setCookie("stfilihp", FilterStatus, 5);
  $("#IHPList").DataTable().destroy();
  TableListFunc(FilterCari, FilterTahun, FilterIHP, FilterStatus);
});

//RESPON KETIKA FILTER TAHUN DI RUBAH
$("#filtertahun, #filterihp, #filterstatus").on("change", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterIHP = $("#filterihp").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("sfilihp", FilterCari, 5);
  setCookie("tfilihp", FilterTahun, 5);
  setCookie("ifilihp", FilterIHP, 5);
  setCookie("stfilihp", FilterStatus, 5);
  $("#IHPList").DataTable().destroy();
  TableListFunc(FilterCari, FilterTahun, FilterIHP, FilterStatus);
});

//RESET FILTER
$(".resetfilter").on("click", function () {
  var d = new Date();
  var yearnow = d.getFullYear();
  $("#filtercari").val("");
  $("#filtertahun").dropdown("set selected", yearnow);
  $("#filterihp").dropdown("set selected", "ALL");
  $("#filterstatus").dropdown("set selected", "ALL");
  setCookie("sfilihp", "", 5);
  setCookie("tfilihp", yearnow, 5);
  setCookie("ifilihp", "ALL", 5);
  setCookie("stfilihp", "ALL", 5);
  $("#IHPList").DataTable().destroy();
  TableListFunc("", yearnow, "ALL", "ALL");
});

$(document).ready(function () {
  //Load Table List IHP
 // LoadTableList();

  //Tab Action Link
  $("#tabregpss").on("click", function () {
    window.location.href = "./?link=pssheader";
  });
  $("#tabpsslist").on("click", function () {
    window.location.href = "./?link=pss";
  });
  $("#tabihp").on("click", function () {
    window.location.href = "./?link=ihp";
  });
  $("#tabihpeval").on("click", function () {
    window.location.href = "./?link=ihpevaluation";
  });
  $("#tabtabelan").on("click", function () {
    window.location.href = "./?link=an";
  });

  //Print IHP in PDF
  $("#PrintIHPPDF").on("click", function (e) {
    var idpss = $("#PSSidx").val();
    var iditem = $("#IHPIdItem").val();
    $.redirect(
      "./?link=viewihppdf",
      { idpss: idpss, iditem: iditem },
      "POST",
      "_blank"
    );
  });

  //Print IHP in PDF
  $("#PrintIHPPDFApproved").on("click", function (e) {
    var idpss = $("#PSSidx").val();
    var iditem = $("#IHPIdItem").val();
    $.redirect(
      "./?link=viewihppdf",
      { idpss: idpss, iditem: iditem },
      "POST",
      "_blank"
    );
  });

  //Print IHP in PDF
  $("#PrintIHPPDFApproved2").on("click", function (e) {
    var idpss = $("#PSSidx").val();
    var iditem = $("#IHPIdItem").val();
    $.redirect(
      "./?link=viewihppdf",
      { idpss: idpss, iditem: iditem },
      "POST",
      "_blank"
    );
  });

  //Print Label Material
  $("#DesLabelMat").on("click", function (e) {
    var iditem = $("#IHPIdItem").val();
    var idpss = $("#PSSidx").val();
    (async () => {
      const { value: cetak } = await Swal.fire({
        title: "Jumlah cetak Label Material",
        input: "select",
        inputOptions: {
          "1": "1",
          "2": "2",
          "3": "3",
          "4": "4",
          "5": "5",
          "6": "6",
          "7": "7",
          "8": "8",
        },
        showCancelButton: true,
      });
      if (cetak) {
        //menggunakan plugin tambahan redirect
        $.redirect(
          "./?link=cetaklabelmat",
          { jumlah: cetak, idpss: idpss, iditem: iditem },
          "POST",
          "_blank"
        );
      }
    })();
  });

  //Print Label Acc
  $("#DesLabelAcc").on("click", function (e) {
    var iditem = $("#IHPIdItem").val();
    var idpss = $("#PSSidx").val();
    (async () => {
      const { value: cetak } = await Swal.fire({
        title: "Jumlah cetak Label Acc",
        input: "select",
        inputOptions: {
          "1": "1",
          "2": "2",
          "3": "3",
          "4": "4",
        },
        showCancelButton: true,
      });
      if (cetak) {
        //menggunakan plugin tambahan redirect
        $.redirect(
          "./?link=cetaklabelacc",
          { jumlah: cetak, idpss: idpss, iditem: iditem },
          "POST",
          "_blank"
        );
      }
    })();
  });

   //Print Label Acc
   $("#DesLabelAcc2").on("click", function (e) {
    var iditem = $("#IHPIdItem").val();
    var idpss = $("#PSSidx").val();
    (async () => {
      const { value: cetak } = await Swal.fire({
        title: "Jumlah cetak Label Acc",
        input: "select",
        inputOptions: {
          "1": "1",
          "2": "2",
          "3": "3",
          "4": "4",
        },
        showCancelButton: true,
      });
      if (cetak) {
        //menggunakan plugin tambahan redirect
        $.redirect(
          "./?link=cetaklabelacc",
          { jumlah: cetak, idpss: idpss, iditem: iditem },
          "POST",
          "_blank"
        );
      }
    })();
  });

  //Save IHP
  $("#OprSave").on("click", function (e) {
    SaveIHP();
  });

  //Create IHP
  $("#OprCreateIHP").on("click", function (e) {
    CreateIHP();
  });

  //Back Close Modal
  $("#OprBack").on("click", function (e) {
    $(".windoweditihp").modal("hide");
  });

  $("#BackDistributeIHP").on("click", function (e) {
    $(".windoweditihp").modal("hide");
  });

  $("#BackFResultIHP").on("click", function (e) {
    $(".windowfinalresult").modal("hide");
  });

  $("#BackIHP").on("click", function (e) {
    $(".windoweditdistributeihp").modal("hide");
    $(".windoweditihp").modal("show");
  });

  $("#BackUnSign").on("click", function (e) {
    $(".windowunsign").modal("hide");
  });

  
  //Download xls base on filter
  $("#dwnldxls").on("click", function () {
    var iddownload= "IHPDESIGNER";
    var search   	= $('#filtercari').val();
    var thnfilter = $('#filtertahun').val();
    var ihpfilter = $('#filterihp').val();
    var stsfilter = $('#filterstatus').val();

    $.redirect(
      "./?link=ihpdwnldxls",
      { 
        id: iddownload,
        search: search, 
        thnfilter: thnfilter,
        ihpfilter: ihpfilter,
        stsfilter: stsfilter
      },
      "POST",
      "_blank"
    );
  });
});
