const fungsilogout = false;
$('.ui.dropdown').dropdown({
    forceSelection:false
});

$(".menu .item").tab();

const NonceValue = "rdsystem2020";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocmds = decodeURIComponent(getCookie("restlocmdsdinamis"));
let table_setting_this="";
var global_namatab="";

let searchval="";
let searchvalkar="";

// tombol tab
$("#mds_set_submenu").on("click", function(){

    window.location.href = "./?link=mdsd_direct&linkmds=mds_set_submenu";
})

$("#mds_role_setting").on("click", function(){

    window.location.href = "./?link=mdsd_direct&linkmds=mds_role_setting";
})

$("#mds_set_menu").on("click", function(){

    window.location.href = "./?link=mdsd_direct&linkmds=mds_set_menu";
})
 
$('.tabsuratgolive').on('click', function() {
  window.location.href = "./?link=golivemds";
});
$('.tabhasilmonitoring').on('click', function() {
  window.location.href = "./?link=monitormds";
});
$('.tabversion').on('click', function() {
  window.location.href = "./?link=versionhistory&app=MDS";
});


// >>> FUNGSI MENJALANKAN FUNGSI KETIKA HALAMAN LOAD (READY)
$( document ).ready(function() {
    
    if(is_admin){
        // jika user admin

        // menampilkan data role
        datatable_tb_role(searchval);

        // menampilkan data role tiap karyawan
        datatable_tb_karyawan(searchvalkar);
    }
});

$('#tb_list_role').on('click','.edit_role', function() {
    let iddata=$(this).attr("btnid");
    view_data_edit(iddata);
    $('.modal_edit_role').modal('show');
});

// fungsi tutup modal
$('.closemodal_btn').on('click', function() {
    let namamodal=$(this).attr('modalname');
    $('.'+namamodal).modal('hide');
    // $('.uploaddvr').modal('hide');
});



// >>> FUNGSI MENGAMBIL DATA YANG INGIN DIUPDATE SESUAI ID
function view_data_edit (iddata){
    $("#stored_id_data_role").val(iddata);

    $("#tb_form_edit_role").find("#container_edit_data_role").html(`
        <button class="ui right floated loading small gray button" id="loading_edit_data">
            edit tab
        </button>
    `)

    $("#nama_role_edit").val("");
    $("#keterangan_edit").val("");
    

    $(document).ready(function () {
        

        $.ajax({
            type: "POST",
            url: `${restlocmds}view_edit_role`,

            headers: {
                user: vusrnm,
                token: vtoken,
            },
            data:{
                iddata: iddata,

            },
                success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
            Swal.fire('Error','Ada kendal di koneksi/database!','error')
            
            } else if(obj.status==false) {

            Swal.fire({
                title: obj.message,
                text: "",
                icon: 'error',
                showCancelButton: false,
                confirmButtonText: 'Ya',
            });
            
            $("#tb_form_edit_role").find("#container_edit_data_role").html(`
                <div class="ui right floated green labeled icon small button" id="edit_data_tab" disabled>
                    <i class="save icon"></i>Edit Tab
                </div>
            `)

            // $('.modal_edit').modal('hide');
            
            
            } else {
                let datasub=obj.data;

                $("#tb_form_edit_role").find("#container_edit_data_role").html(`
                    <div class="ui right floated green labeled icon small button" id="edit_data_role" btnid="${datasub["id_role"]}">
                        <i class="save icon"></i>Edit Role
                    </div>
                `)

                $("#nama_role_edit").val(datasub["nama_role"]);
                $("#keterangan_edit").val(datasub["keterangan"]);

            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        }
        });

            


        
        
    });


}



$('#tb_form_edit_role').on('click','#edit_data_role', function() {
    // console.log($("#tb_form_edit").find("#container_edit_data_upload").html());
    
    $("#tb_form_edit_role").find("#container_edit_data_role").html(`
        <button class="ui right floated loading small gray button" id="loading_edit_data">
            edit tab
        </button>
    `)

    let id_edit = $("#stored_id_data_role").val();
    // return false;
    if(is_admin){
        // merupakan admin --> bisa melakukan update
        let val_namarole=$("#nama_role_edit").val()
        let keterangan=$("#keterangan_edit").val()
        if(val_namarole!=="" || val_namasub !== null){
           
                $.ajax({
                    type: "POST",
                    url: `${restlocmds}update_role_new`,
            
                    headers: {
                        user: vusrnm,
                        token: vtoken,
                    },
                    data:{
                        idrole:id_edit,
                        namarole:val_namarole,
                        keterangan:keterangan

                    },
                        success: function (response){
                    var obj = JSON.parse(response);
                    console.log(obj);
                    if(isEmpty(obj)) {
                        Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
                        
                    
                    } else if(obj.status==false) {

                        Swal.fire({
                            title: obj.message,
                            text: "",
                            icon: 'error',
                            showCancelButton: false,
                            confirmButtonText: 'Ya',
                        });

                        $("#tb_form_edit_role").find("#container_edit_data_role").html(`
                            <div class="ui right floated green labeled icon small button" id="edit_data_role" btnid="${id_edit}">
                                <i class="save icon"></i>Edit role
                            </div>
                        `)

                        $('.modal_edit_role').modal('hide');

                    } else {

                        Swal.fire({
                            title: 'berhasil update data tab',
                            icon: 'success',
                            text: "klik refresh untuk melihat perubahan",
                            // showDenyButton: true,
                            // showCancelButton: true,
                            confirmButtonText: 'refresh',
                            // denyButtonText: `tumpuk data lama`,
                            // confirmButtonColor: '#21ba45',
                            // confirmButtonColor: '#3085d6',
                          }).then((result) => {
                            location.reload(); // force reload
                            if (result.isConfirmed) {
                                location.reload();
                            }
                        
                          })

                        $("#tb_form_edit_role").find("#container_edit_data_role").html(`
                                <div class="ui right floated green labeled icon small button" id="edit_data_role" btnid="${id_edit}">
                                    <i class="save icon"></i>Edit Role
                                </div>
                            `)

                        $('.modal_edit_role').modal('hide');

                        

                        datatable_tb_karyawan(searchvalkar)
                        datatable_tb_role(searchval)
                    
                    }
                },
                error: function(){
                    if(fungsilogout){
            
                            window.location.href="./_logout.php";
                    }else{
                            console.log("error session")
                    }
                }
                });

        }else{

            Swal.fire({
                title: "Nama sub tab tidak boleh kosong",
                text: "",
                icon: 'error',
                showCancelButton: false,
                confirmButtonText: 'Ya',
            });

            $("#tb_form_edit_role").find("#container_edit_data_role").html(`
                                <div class="ui right floated green labeled icon small button" id="edit_data_role" btnid="${id_edit}">
                                    <i class="save icon"></i>Edit Role
                                </div>
                            `)
        }
        

    }else{
        console.log("not allowed")
    }

});



// DROPDOWN PILIH NAMA KARYAWAN
$("#drop_karyawan").on("change", function(){
        
    let id_karyawan=$("#drop_karyawan").dropdown("get value");
    let text_karyawan=$("#drop_karyawan").dropdown("get text");
    // remove semua setting yang ada sebelumnya
    // $("#tb_pilih_tab").find(".class_setting").each(function(){
    //     $(this).remove();
    // });

    if(id_karyawan !== "" || text_karyawan !==""){
        
        get_info_karyawan(id_karyawan,text_karyawan);

    }else{
        Swal.fire({
            title: "error, data karyawan tidak ada",
            text: "",
            icon: 'error',
            showCancelButton: false,
            confirmButtonText: 'Ya',
        });
    }
    

    // if(id_namatab!==null||id_namatab!==""||id_namatab!=="none"){
    //     // JIKA YANG DIPILIH ADALAH TAB VALID --> CEK ULANG DI DB
    //     $("#stored_id_tab").val(id_namatab);
    //     $("#stored_nama_tab").val(text_namatab);
        
    //     cek_ada_tab(id_namatab,text_namatab);

    // }
    
    
});



// >>> FUNGSI DATATABLE LIST ROLE
function datatable_tb_role(FSearch) {
        

    $('#tb_list_role').DataTable({

        dom: "<'ui stackable grid'" +
            "<'row'" +
            "<'left aligned ten wide column'>" +
            ">" +
            "<'row dt-table'" +
            "<'sixteen wide column'tr>" +
            ">" +
            "<'row'" +
            "<'left aligned eight wide column'B>" +
            "<'right aligned eight wide column'p>" +
            ">" +
            ">",

        buttons: 
        [
            {
                text: '10',
                action: function (e, dt, node, config) {
                    $('#tb_list_role').DataTable().page.len(10).draw();
                }
            },
            {
                text: '25',
                action: function (e, dt, node, config) {
                    $('#tb_list_role').DataTable().page.len(25).draw();
                }
            },
            {
                text: '50',
                action: function (e, dt, node, config) {
                    $('#tb_list_role').DataTable().page.len(50).draw();

                }
            },
            {
                text: '100',
                action: function (e, dt, node, config) {
                    $('#tb_list_role').DataTable().page.len(100).draw();

                }
            },
            // {
            //     text: '500',
            //     action: function (e, dt, node, config) {
            //         $('#tb_list_tab').DataTable().page.len(500).draw();
            //     }
            // },
            // {
            //     text: '1000',
            //     action: function (e, dt, node, config) {
            //         $('#tb_list_tab').DataTable().page.len(1000).draw();
            //     }
            // }
        ],


    destroy: true,
    stateSave: false,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    pageLength: 10,
    data: [],

    language: {
        sLengthMenu: "_MENU_",
        search: "",
        searchPlaceholder: "Search..",
        processing: '<i class="circle notch loading icon huge"></i>',
        emptyTable: 'tidak ada data yang ditampilkan',
    },

    order: [[0, "desc"]],

    columns: [
        
        { data  : 'namarole' },
        { data  : 'keteranganrole'},
        { data  : null,
            render: function(data,row){

                    //return `<i class="book icon editdata">`;

                    return `<span class='docicon' style='white-space: nowrap !important; word-spacing:5px !important;'><i class="ui edit outline icon iconcoloredit edit_role" btnid="${data['idrole']}"></i>&nbsp;<i class="ui trash icon iconcoloredit delete_role1" btnid="${data['idrole']}"></i></span>`;
                    //return '<i class="edit icon editdata" idedit="${data[0]}">
            }
            
        },

    ],

    


    
    ajax: {
        
        url     : `${restlocmds}table_role`,
        type    : 'POST',
        //PENTING!! error uncaught lenght
        headers: {
            user: vusrnm,
            token: vtoken,
        },
        // data search
        data    : {
        // FStatus : FStatus,
        FSearch : FSearch,
        user    : userName1,
        },
        
        error: function(){
            if(fungsilogout){
    
                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        },

    },

    
    //STYLING KOLOM

    columnDefs: [
        { className: "center aligned", targets: [2] },
        // { className: "right aligned", targets: [5] },
        // {className : "collapsing", targets: [1,2,5,11,12]},
        // { "orderable": false, "targets": 13 },
    ],

// "columnDefs": [
//     { "orderable": false, "targets": 10 }
//   ],
    });
    

}
// END OF DATATABLE LIST NAMA ROLE





// >>> FUNGSI DATATABLE LIST ROLE KARYAWAN
function datatable_tb_karyawan(FSearch) {
        

    $('#tb_list_karyawan').DataTable({

        dom: "<'ui stackable grid'" +
            "<'row'" +
            "<'left aligned ten wide column'>" +
            ">" +
            "<'row dt-table'" +
            "<'sixteen wide column'tr>" +
            ">" +
            "<'row'" +
            "<'left aligned eight wide column'B>" +
            "<'right aligned eight wide column'p>" +
            ">" +
            ">",

        buttons: 
        [
            {
                text: '10',
                action: function (e, dt, node, config) {
                    $('#tb_list_karyawan').DataTable().page.len(10).draw();
                }
            },
            {
                text: '25',
                action: function (e, dt, node, config) {
                    $('#tb_list_karyawan').DataTable().page.len(25).draw();
                }
            },
            {
                text: '50',
                action: function (e, dt, node, config) {
                    $('#tb_list_karyawan').DataTable().page.len(50).draw();

                }
            },
            {
                text: '100',
                action: function (e, dt, node, config) {
                    $('#tb_list_karyawan').DataTable().page.len(100).draw();

                }
            },
            // {
            //     text: '500',
            //     action: function (e, dt, node, config) {
            //         $('#tb_list_tab').DataTable().page.len(500).draw();
            //     }
            // },
            // {
            //     text: '1000',
            //     action: function (e, dt, node, config) {
            //         $('#tb_list_tab').DataTable().page.len(1000).draw();
            //     }
            // }
        ],


    destroy: true,
    stateSave: false,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    pageLength: 10,
    data: [],

    language: {
        sLengthMenu: "_MENU_",
        search: "",
        searchPlaceholder: "Search..",
        processing: '<i class="circle notch loading icon huge"></i>',
        emptyTable: 'tidak ada data yang ditampilkan',
    },

    order: [[0, "desc"]],

    columns: [
        
        { data  : 'namakar' },
        { data  : 'n_roles'},
        // { data  : null,
        //     render: function(data,row){

        //             //return `<i class="book icon editdata">`;

        //             return `<span class='docicon' style='white-space: nowrap !important; word-spacing:5px !important;'><i class="ui edit outline icon iconcoloredit edit_role" btnid="${data['idrole']}"></i>&nbsp;<i class="ui trash icon iconcoloredit delete_role" btnid="${data['idrole']}"></i></span>`;
        //             //return '<i class="edit icon editdata" idedit="${data[0]}">
        //     }
            
        // },

    ],

    


    
    ajax: {
        
        url     : `${restlocmds}table_roleuser`,
        type    : 'POST',
        //PENTING!! error uncaught lenght
        headers: {
            user: vusrnm,
            token: vtoken,
        },
        // data search
        data    : {
        // FStatus : FStatus,
        FSearch : FSearch,
        user    : userName1,
        },
        
        error: function(){
            if(fungsilogout){
    
                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        },

    },

    
    //STYLING KOLOM

    columnDefs: [
        // { className: "center aligned", targets: [2] },
        // { className: "right aligned", targets: [5] },
        // {className : "collapsing", targets: [1,2,5,11,12]},
        // { "orderable": false, "targets": 13 },
    ],

// "columnDefs": [
//     { "orderable": false, "targets": 10 }
//   ],
    });
    

}
// END OF DATATABLE LIST NAMA ROLE




// >>> FUNGSI KLIK TOMBOL TAMBAH ROLE KE KARYAWAN YANG DIPILIH
$("#simpan_nama_karyawan").on("click",function(){
    let val_kar=$("#drop_karyawan").dropdown('get value');
    let val_namakar=$("#drop_karyawan").dropdown('get text');
    let val_role=$("#drop_roles").dropdown('get value');
    

    if(val_kar==null||val_kar==""){
        // JIKA NAMA VAL NULL ATAU KOSONG -> TOLAK

        Swal.fire({
            title: "pilih nama karyawan terlebih dahulu",
            text: "",
            icon: 'error',
            showCancelButton: false,
            confirmButtonText: 'Ya',
        });

    }else{

        if(val_role==null||val_role==""){
            // JIKA NAMA VAL NULL ATAU KOSONG -> TOLAK
    
            Swal.fire({
                title: "pilih role yang ingin ditambahkan terlebih dahulu",
                text: "",
                icon: 'error',
                showCancelButton: false,
                confirmButtonText: 'Ya',
            });
    
        }else{
    
            simpan_role_karyawan(val_kar,val_role,val_namakar); // id karyawan , id role
    
        }

    }
});
// ##############


// >>> FUNGSI UNTUK MENYIMPAN NAMA TAB DAN KETERANGANNYA
function simpan_role_karyawan(idkar,idrole,namakar){


    $.ajax({
    type: "POST",
    url: `${restlocmds}create_roleuser`,

    headers: {
        user: vusrnm,
        token: vtoken,
    },
    data:{
        idkar: idkar,
        idrole: idrole,
    },
        success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
                
                Swal.fire({
                    title: "Gagal menyimpan nama tab",
                    text: "",
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
            
            
            } else if(obj.status==false) {
            // tableType();
                Swal.fire({
                    title: obj.message,
                    text: "",
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
            
            } else {
            
                Swal.fire({
                    title: "Berhasil mendaftarkan role pada karyawan",
                    text: "",
                    icon: 'success',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });

                get_info_karyawan(idkar,namakar)
                datatable_tb_karyawan(searchvalkar)
            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        }
    });


}
// ################


// >>> FUNGSI KLIK TOMBOL SIMPAN NAMA TAB DAN KETERANGAN 
$("#simpan_nama_role").on("click",function(){
    let nama_val=$("#nama_role_in").val();
    let keterangan_val=$("#keterangan_role_in").val();

    if(nama_val==null||nama_val==""){
        // JIKA NAMA VAL NULL ATAU KOSONG -> TOLAK

        Swal.fire({
            title: "Nama role tidak boleh kosong",
            text: "",
            icon: 'error',
            showCancelButton: false,
            confirmButtonText: 'Ya',
        });

    }else{

        simpan_nama_role(nama_val,keterangan_val);

    }
});
// #### END OF KLIK TOMBOL SIMPAN NAMA TAB


// >>> FUNGSI UNTUK MENYIMPAN NAMA TAB DAN KETERANGANNYA
function simpan_nama_role(namarole,keterangan){


    $.ajax({
    type: "POST",
    url: `${restlocmds}create_role`,

    headers: {
        user: vusrnm,
        token: vtoken,
    },
    data:{
        namarole: namarole,
        keteranganrole:keterangan,
    },
        success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
                
                Swal.fire({
                    title: "Gagal menyimpan nama tab",
                    text: "",
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
            
            
            } else if(obj.status==false) {
            // tableType();
                Swal.fire({
                    title: obj.message,
                    text: "",
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
            
            } else {
            
                Swal.fire({
                    title: 'berhasil menyimpan tab baru',
                    icon: 'success',
                    text: "klik refresh untuk melihat perubahan",
                    // showDenyButton: true,
                    // showCancelButton: true,
                    confirmButtonText: 'refresh',
                    // denyButtonText: `tumpuk data lama`,
                    // confirmButtonColor: '#21ba45',
                    // confirmButtonColor: '#3085d6',
                  }).then((result) => {
                    location.reload(); // force reload
                    if (result.isConfirmed) {
                        location.reload();
                    }
                
                  })

                  datatable_tb_role(searchval);
                  clean_input_role();
            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        }
    });


}


function clean_input_role(){

    $("#nama_role_in").val("");
    $("#keterangan_role_in").val("");
}



// >>> FUNGSI UNTUK MENGAMBIL DATA KARYAWAN BESERTA ROLENYA
function get_info_karyawan(id_kar,nama_kar){


    $.ajax({
    type: "POST",
    url: `${restlocmds}view_karyawan`,

    headers: {
        user: vusrnm,
        token: vtoken,
    },
    data:{
        idkar: id_kar,
        namakar:nama_kar,
    },
        success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
                
                Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
            
            
            } else if(obj.status==false) {
            // karyawan belum memiliki role khusus
                
                $("#td_list_roleuser").html("belum ada role khusus").removeClass('except')
            
            } else {
            
                let datarole = obj.data;

                let str_id=datarole[id_kar]['list_id'];
                let arr_id = str_id.split(';|;');
                let str_namarole=datarole[id_kar]['list_nama'];
                let arr_namarole = str_namarole.split(';|;');
                let str_iddata=datarole[id_kar]['list_iddata'];
                let arr_iddata= str_iddata.split(';|;');
                let html_tag="";

                let banyakrole = arr_id.length;

                for(let j=0;j<banyakrole;j++){

                    html_tag+=`
                    <a class="ui label label_rolekaryawan">
                        ${arr_namarole[j]}
                        <i class="delete icon delroleuser" idrole="${arr_id[j]}" idkar="${id_kar}" iddata="${arr_iddata[j]}"></i>
                    </a>
                    `

                }

                $("#td_list_roleuser").html(html_tag).addClass('except')
            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        }
    });


}



$("#td_list_roleuser").on("click",".delroleuser",function(){
    let iddataroleuser=$(this).attr("iddata")
    let iduser_drop = $("#drop_karyawan").dropdown("get value");
    let namauser_drop = $("#drop_karyawan").dropdown("get text");
    if(iduser_drop!="" && iduser_drop!=null){
        // let idkarrole=$("#stored_id_data").val();
        if(iddataroleuser==""&&iddataroleuser==null){
            Swal.fire({
                title: "id role user kosong",
                text: "",
                icon: 'error',
                showCancelButton: false,
                confirmButtonText: 'Ya',
            });
        }else{

            Swal.fire({
            title: '<h2>Hapus role ini dari karyawan ini?</h2>',
            text: "",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Ya'
            }).then((result) => {
                console.log(result);
                if(result.isConfirmed){
                    delete_roleuser(iddataroleuser,iduser_drop,namauser_drop);
                }
                
            })

            
        }
    }else{

        Swal.fire({
            title: "pilih karyawan terlebih dahulu",
            text: "",
            icon: 'error',
            showCancelButton: false,
            confirmButtonText: 'Ya',
        })

    }
    
})



$("#tb_list_role").on("click",".delete_role1",function(){
    let iddel=$(this).attr("btnid")
    
    
        if(iddel==""&&iddel==null){
            Swal.fire({
                title: "id role kosong",
                text: "",
                icon: 'error',
                showCancelButton: false,
                confirmButtonText: 'Ya',
            });
        }else{

            Swal.fire({
            title: '<h2>Hapus role ini?</h2>',
            text: "",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Ya'
            }).then((result) => {
                console.log(result);
                if(result.isConfirmed){
                    delete_role(iddel);
                }
                
            })

            
        
    }
    
})



// >>> FUNGSI UNTUK DELETE DATA ROLE PADA USER
function delete_roleuser(iddatarole,idusr,nusr){
    

    $.ajax({
    type: "POST",
    url: `${restlocmds}delete_roleuser`,

    headers: {
        user: vusrnm,
        token: vtoken,
    },
    data:{
        iddatarole: iddatarole,
        
    },
        success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
                
                Swal.fire({
                    title: "Gagal menghapus data role",
                    text: "",
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
            
            
            } else if(obj.status==false) {
            // tableType();
                Swal.fire({
                    title: obj.message,
                    text: "",
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
            
            } else {
            
                Swal.fire({
                    title: obj.message,
                    text: "",
                    icon: 'success',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
                datatable_tb_karyawan(searchvalkar)
                get_info_karyawan(idusr,nusr)
            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        }
    });


}
// ################


// >>> FUNGSI UNTUK DELETE DATA ROLE PADA USER
function delete_role(iddel){
    

    $.ajax({
    type: "POST",
    url: `${restlocmds}delete_role`,

    headers: {
        user: vusrnm,
        token: vtoken,
    },
    data:{
        iddatarole: iddel,
        
    },
        success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
                
                Swal.fire({
                    title: "Gagal menghapus data role",
                    text: "",
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
            
            
            } else if(obj.status==false) {
            // tableType();
                Swal.fire({
                    title: obj.message,
                    text: "",
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'Ya',
                });
            
            } else {
            
                Swal.fire({
                    title: obj.message,
                    icon: 'success',
                    text: "klik refresh untuk melihat perubahan",
                    // showDenyButton: true,
                    // showCancelButton: true,
                    confirmButtonText: 'refresh',
                    // denyButtonText: `tumpuk data lama`,
                    // confirmButtonColor: '#21ba45',
                    // confirmButtonColor: '#3085d6',
                  }).then((result) => {
                    location.reload(); // force reload
                    if (result.isConfirmed) {
                        location.reload();
                    }
                
                  })
                datatable_tb_karyawan(searchvalkar);
                datatable_tb_role(searchval);
            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        }
    });


}
// ################




// FILTER SEARCH
$('#search_list_karyawan').keyup( function() {

    searchval = $("#search_list_karyawan").val();

    datatable_tb_karyawan(searchval);
})