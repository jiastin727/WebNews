$(".ui.dropdown").dropdown();
$(".menu .item").tab();

// Global Variable
const NonceValue = "rdsystem2020";
const LogoutProtect = false;

// const ColorSignNo  = "#00139f";
// const ColorOwner  = "#00139f";
// const BgColorOwner  = "#eff0ff";
// const ColorRelease= "#505050";
// const ColorCancel = "#be0000";
// const ColorLock = "#860954";
// const BgColorLock = "#f3ebeb";

var VUserName = getCookie("usrnm");
var VToken    = getCookie("token");
var RestLocBP = decodeURIComponent(getCookie("restlocpsc"));
let Ucrypt = new Encryption();


function TableListFunc() {

  var JsonFilter = getCookie('FilterAktivaTimeline');
  var ArrayF = JSON.parse(JsonFilter);
  if(JsonFilter){
    var SearchF   = ArrayF[0];
    var JenisF    = ArrayF[1];
  } else {
    var SearchF   = "";
    var JenisF    = "AKTIVA";
  }

  if (SearchF) {
    $("#fsearch_timelineaktiva").val(SearchF);
    var SearchFStart = SearchF;
  } else {
    var SearchFStart = "";
  }

  if (JenisF) {
    $("#fjns_timelineaktiva").dropdown("set selected", JenisF);
    var JenisFStart = JenisF;
  } else {
    var JenisFStart = "AKTIVA";
  }
  
  // console.log(JenisFStart);

  var FiterArry = [SearchFStart];
  var JsonFilter = JSON.stringify(FiterArry);
  setCookie("FilterAktivaTimeline", JsonFilter, 5);

  var DTables = $("#tableTimeline").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned seven wide column'B>" +
      "<'left aligned two wide column'i>" +
      "<'right aligned seven wide column'p>" +
      ">" +
      ">",
    buttons: [
      {
        text: "10",
        action: function (e, dt, node, config) {
          $("#tableTimeline").DataTable().page.len(10).draw();
        },
      },
      {
        text: "25",
        action: function (e, dt, node, config) {
          $("#tableTimeline").DataTable().page.len(25).draw();
        },
      },
      {
        text: "50",
        action: function (e, dt, node, config) {
          $("#tableTimeline").DataTable().page.len(50).draw();
        },
      },
      {
        text: "100",
        action: function (e, dt, node, config) {
          $("#tableTimeline").DataTable().page.len(100).draw();
        },
      },
      {
        text: "1000",
        action: function (e, dt, node, config) {
          $("#tableTimeline").DataTable().page.len(1000).draw();
        },
      },
    ],
    destroy     : true,
    stateSave   : true,
    processing  : true,
    deferRender : true,
    serverSide  : true,
    orderClasses: false,
    paging      : true,
    scrollY     : '60vh',
    pageLength  : 10,
    data        : [],
    language    : {
      sLengthMenu : "_MENU_",
      search      : "",
      searchPlaceholder: "Pencarian..",
      processing  : '<i class="circle notch loading icon huge"></i>',
      info        : "_START_ sampai _END_ dari _TOTAL_ total data",
      paginate    : {
        "first"   : "Awal",
        "last"    : "Akhir",
        "next"    : "Berikutnya",
        "previous": "Sebelumnya"
      },
      infoEmpty   : "Tidak ada data",
      select  : {
        rows  : ""
      }
    },
    order     : [[1, "desc"]],
    columns   : [
      // { data  : 'no' },
      { data  : 'event' },
      { data  : 'date_item' },
      { data  : 'progress' },
      { data  : 'status' },
      { data  : 'user' },
    //   { data: null,
    //     render: function (data) {
    //       if(DGrup === "ADMINISTRATOR"){
    //         return data['query'];
    //       } else {
    //         return ``;
    //       }
    //     },
    //   },
    ],

    createdRow: function (row, data, index) {
      $(row).find("td:eq(0)").css("background-color", "#f5fbff");
    },

    columnDefs: [
      // { className : "collapsing", targets: [2] },
    ],

    ajax : {
      url     : `../RND_BackEnd/backend_aktiva/getTimeline`,
      type    : "POST",
      headers : {
        user  : VUserName,
        token : VToken,
      },
      data    : {
        FSearch   : SearchFStart,
        FJenis    : JenisFStart
      },

      error: function () {
        IsTimeOut(LogoutProtect);
      },
    },
  });
}

$(document).ready(function () {

  TableListFunc();

  //RESPON KETIKA INPUT PENCARIAN DI KETIK
  $("#fsearch_timelineaktiva").on("keyup", function () {
    var FilterCari = $("#fsearch_timelineaktiva").val();
    var FilterJenis = $("#fjns_timelineaktiva").val();
    var FiterArry = [FilterCari,FilterJenis];
    var JsonFilter = JSON.stringify(FiterArry);
    setCookie("FilterAktivaTimeline", JsonFilter, 5);
    $("#tableTimeline").DataTable().destroy();
    TableListFunc(FilterCari,FilterJenis);
    $("#tableTimeline").DataTable().page(0).draw();
  });

  //RESPON KETIKA FILTER TAHUN DI RUBAH
  $("#fjns_timelineaktiva").on(
    "change",
    function () {
      var FilterCari = $("#fsearch_timelineaktiva").val();
      var FilterJenis = $("#fjns_timelineaktiva").val();
      var FiterArry = [FilterCari, FilterJenis];
      var JsonFilter = JSON.stringify(FiterArry);
      setCookie("FilterAktivaTimeline", JsonFilter, 5);
      TableListFunc(FilterCari, FilterJenis);
      $("#tableTimeline").DataTable().page(0).draw();
    }
  );

  //RESET FILTER
  $(".resetfilter").on("click", function () {
    $("#fsearch_timelineaktiva").val("");
    $("#fjns_timelineaktiva").dropdown("set selected", "AKTIVA");
    var FiterArry = [""];
    var JsonFilter = JSON.stringify(FiterArry);
    setCookie("FilterAktivaTimeline", JsonFilter, 5);
    $("#tableTimeline").DataTable().destroy();
    TableListFunc("");
    $("#tableTimeline").DataTable().page(0).draw();
  });

  $('#userguidemkg').on('click', function() {
    window.location.href = "./?link=guidemkg";
  });
  
  $('#tabmkglist').on('click', function() {
    window.location.href = "./?link=mkgindex";
  });

  $('#tabAppSetting').on('click', function() { 
    window.location.href = "./?link=mkgappsetting";
  });

});