const NonceValue = "rdsystem2020";
const LogoutProtect = false;

const ColorSignNo = "#00139f";
const ColorOwner = "#00139f";
const BgColorOwner = "#eff0ff";
const ColorRelease = "#505050";
const ColorCancel = "#be0000";
const ColorLock = "#860954";
const BgColorLock = "#f3ebeb";

var restlocactiva = decodeURIComponent(getCookie("restlocactiva"));
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
let Ucrypt = new Encryption();
var Udecrypt = Ucrypt.decrypt(EncU, NonceValue);
var Jdecrypt = Ucrypt.decrypt(EncJ, NonceValue);
var Sdecrypt = Ucrypt.decrypt(EncS, NonceValue);

// function ListMutasi() {
//   $.ajax({
//     type: "POST",
//     url: `../RND_BackEnd/backend_aktiva/list_no_mutasi`,
//     headers: {
//       user: vusrnm,
//       token: vtoken,
//     },
//     data: {
//       no_mutasi: no_mutasi
//     },
//     cache: false,
//     success: function (response) {
//       var obj = JSON.parse(response);
//       if (obj.status == false) {
//         IsResponseFalse(obj.message);
//       } else {
//         // var dataimage2 = "<img width='350' src='../RND_Upload/Aktiva/"+obj.message+"'>";
//         // IsResponseTrue(obj.message);
//         $("#FeedListAppMutasi").empty();
//         var len = obj.length;
//         for (i = 0; i < len; i++) {
//           var idAk = obj[i]['id'];
//           $("#TableListAppMutasi").find("tbody").append(
//             "<tr>" +
//             "<td width='100%'>" + obj[i]['nmr_aktiva'] + "</td>" +
//             "<td width='100%'>" + obj[i]['description'] + "</td>" +
//             "<td width='100%' data-tooltip='View Detail' data-inverted='' data-variation='basic'><i class='eye iconcolorblack icon viewdetailmutasi' eid = " + idAk + "></i></td>" +
//             "</tr>"
//           );
//         }

//       }
//     },
//     error: function () {
//       IsTimeOut(LogoutProtect);
//     },
//   });
// }

function LoadDataAktiva(idAktiva) {
  $.ajax({
    type: "POST",
    url: `${restlocactiva}aktiva/load-datamutasi/` + idAktiva,
    headers: {
      user: vusrnm,
      token: vtoken
    },
    cache: false,
    success: function (data) {
      var obj = JSON.parse(data);
      $('#modalNoAktiva').html(obj.nomor_aktiva);
      $('#modalJenis').html(obj.jenis);
      $('#modalMaterialNumber').html(obj.material_number);
      $('#modalDescription').html(obj.description);
      $('#modalNIK').html(obj.nik);
      $('#modalMerk').html(obj.merk);
      $('#modalPeminta').html(obj.peminta);
      $('#modalVMaterialNumber').html(obj.vendor_material_number);
      $('#modalCostCenter').html(obj.cost_center);
      $('#modalGR').html(obj.gr);
      $('#modalNoSeri').html(obj.no_seri);
      $('#modalGolongan').html(obj.golongan);
      $('#modalCurrency').html(obj.currency);
      $('#modalSatuan').html(obj.satuan);
      $('#modalPrice').html(obj.harga);
      $('#modalVendor').html(obj.vendor);

    },
    error: function () {
      IsTimeOut(LogoutProtect);
    }
  });
}

function LoadSign() {
  $.ajax({
    type: "POST",
    url: `${restlocactiva}loadDetailSignMutasi`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      no_mutasi: no_mutasi
    },
    cache: false,
    success: function (data) {
      var objs = JSON.parse(data);
      var obj = objs['loadSignMutasi'];
      var objl = objs['listNoMutasi'];
      // console.log(objl);
      if (obj.status === false) {
        // IsResponseFalse(obj.message);
        $("#NoSignMsg").show();
        $("#FeedListAppMutasi").empty();
        var len = objl.length;
        console.log(len);
        for (i = 0; i < len; i++) {
          var idAk = objl[i]['id'];
          $("#TableListAppMutasi").find("tbody").append(
            "<tr>" +
            "<td width='100%'>" + objl[i]['nmr_aktiva'] + "</td>" +
            "<td width='100%'>" + objl[i]['description'] + "</td>" +
            "<td width='100%' data-tooltip='View Detail' data-inverted='' data-variation='basic'><i class='eye iconcolorblack icon viewdetailmutasi' eid = " + idAk + "></i></td>" +
            "</tr>"
          );
        }
        if(objs['loadCancelMutasi'].status !== false ){
          $('.messagecancel').text("Permintaan Approval Write Off ini di "+objs['loadCancelMutasi'][0]['type']+" oleh "+objs['loadCancelMutasi'][0]['pic']+" pada tanggal "+objs['loadCancelMutasi'][0]['date']+" karena "+objs['loadCancelMutasi'][0]['reason']);
        }
      } else {
        console.log(objs['loadCancelMutasi']);
        if(objs['loadCancelMutasi'].status !== false ){
          $('.messagecancel').text("Permintaan Approval Write Off ini di "+objs['loadCancelMutasi'][0]['type']+" oleh "+objs['loadCancelMutasi'][0]['pic']+" pada tanggal "+objs['loadCancelMutasi'][0]['date']+" karena "+objs['loadCancelMutasi'][0]['reason']);
        
        }
        $("#FeedListAppMutasi").empty();
        var len = objl.length;
        for (i = 0; i < len; i++) {
          var idAk = objl[i]['id'];
          $("#TableListAppMutasi").find("tbody").append(
            "<tr>" +
            "<td width='100%'>" + objl[i]['nmr_aktiva'] + "</td>" +
            "<td width='100%'>" + objl[i]['description'] + "</td>" +
            "<td width='100%' data-tooltip='View Detail' data-inverted='' data-variation='basic'><i class='eye iconcolorblack icon viewdetailmutasi' eid = " + idAk + "></i></td>" +
            "</tr>"
          );
        }
        if(obj.pic_signby !== null){
          if(obj.pic_name === obj.pic_signby){
            $('#Pic').text(obj.pic_name);
          }
          else{
            $('#Pic').text(obj.pic_name+" a.n.  Signed By "+obj.pic_signby);
          }
        }
        else{
          $('#Pic').text(obj.pic_name);
        }
        $('#PicJabatan').text(obj.pic_jabatan);
        $('#PicBagian').text(obj.bagian_pic);
        if (vusrnm === obj.pic_username) {
          if (obj.pic_sign === "SIGNED") {
            $('#DateSignPic').text(obj.datesign_pic);
            $('#BtnSignPic').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Signed" data-position="top left">SIGNED</a>');
          } else {
            $('#BtnSignPic').html('<a class="ui tiny bottom green attached button signpic" asid="MD1" data-tooltip="Sign setelah melengkapi data" data-position="top left">SIGN</a>');
          }
        } else {
          if (obj.pic_sign === "SIGNED") {
            $('#DateSignPic').text(obj.datesign_pic);
            $('#BtnSignPic').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Signed" data-position="top left">SIGNED</a>');
          } else {
            console.log(obj.rnd_bagian_pic+" "+Sdecrypt);
            if ((obj.rnd_bagian_pic === Sdecrypt && Jdecrypt == "HEAD OF") || EPic === "ADMCOSTCENTER" ) {
              $('#BtnSignPic').html('<a class="ui tiny bottom violet attached button signpic" asid="MD1" data-tooltip="Sign setelah melengkapi data" data-position="top left">a.n SIGN</a>');
            } else {
              $('#BtnSignPic').html('<a class="ui tiny disabled bottom attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">SIGN</a>');
            }
          }
        }

        if (obj.head_of_pic) {
          if(obj.head_of_pic_signby !== null){
            if(obj.head_of_pic === obj.head_of_pic_signby){
              $('#HeadOf').text(obj.head_of_pic);
            }
            else if(obj.head_of_picby !== obj.head_of_pic_signby){
              $('#HeadOf').text(obj.head_of_pic+" a.n.  Signed By  "+obj.head_of_pic_signby);
            }
          }
          else{
            $('#HeadOf').text(obj.head_of_pic);
          }
          $('#HeadOfJabatan').text(obj.head_of_jabatan);
          $('#HeadOfBagian').text(obj.bagian_head_of_pic);
          if (obj.pic_sign === "SIGNED") {
            if (vusrnm === obj.head_of_pic_username) {
              if (obj.head_of_pic_sign === "SIGNED") {
                $('#DateSignHeadOf').text(obj.datesign_head_of);
                $('#BtnSignHeadOfM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">APPROVED</a>');
              } else {
                $('#BtnSignHeadOfM').html('<div class="ui tiny two bottom attached buttons"><div class="ui green button signho" asid="app1" data-tooltip="Confirm Activa" data-position="top left">APPROVE</div><div class="ui redreject button rejectapp" asid="Head of" data-tooltip="Reject Approval" data-position="top left">Reject</div></div>');
                EnSign();
              }
            } else {
              if (obj.head_of_pic_sign === "SIGNED") {
                $('#DateSignHeadOf').text(obj.datesign_head_of);
                $('#BtnSignHeadOfM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Confirmed" data-position="top left">APPROVED</a>');
              } else {
                if (obj.rnd_bagian_head_of === Sdecrypt && Jdecrypt == "HEAD OF") {
                  $('#BtnSignHeadOfM').html('<div class="ui tiny two bottom attached buttons"><div class="ui violet button signho" asid="app1" data-tooltip="Confirm Activa" data-position="top left">a.n. APPROVE</div><div class="ui redreject button rejectapp" asid="Head of" data-tooltip="Reject Approval" data-position="top left">Reject</div></div>');
                  EnSign();
                } else {
                  $('#BtnSignHeadOfM').html('<a class="ui tiny disabled bottom attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">APPROVE</a>');
                }
              }
            }
          } else {
            if (obj.head_of_sign === "SIGNED") {
              $('#DateSignHeadOf').text(obj.datesign_head_of);
              $('#BtnSignHeadOfM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Confirmed" data-position="top left">APPROVED</a>');
            } else {
              $('#BtnSignHeadOfM').html('<a class="ui tiny disabled bottom attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">APPROVE</a>');
            }
          }
        }
        
        if (obj.picbaru_name && obj.head_of_pic_sign === "SIGNED") {
          if(obj.picbaru_signby !== null){
            if(obj.picbaru_name === obj.picbaru_signby){
              $('#NPic').text(obj.picbaru_name);
            }
            else if(obj.picbaru_name !== obj.picbaru_signby){
              $('#NPic').text(obj.picbaru_name+" a.n.  Signed By  "+obj.picbaru_signby);
            }
          }
          else{
            $('#NPic').text(obj.picbaru_name);
          }
          $('#NPicJabatan').text(obj.picbaru_jabatan);
          $('#NPicBagian').text(obj.bagian_picbaru);
          if (vusrnm === obj.picbaru_username) {
            if (obj.picbaru_sign === "SIGNED") {
              $('#NDateSignPic').text(obj.datesign_picbaru);
              $('#BtnSignPicNM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Signed" data-position="top left">SIGNED</a>');
            } else {
              $('#BtnSignPicNM').html('<div class="ui tiny two bottom attached buttons"><div class="ui green button signpicn" asid="app1" data-tooltip="Confirm Activa" data-position="top left">SIGN</div><div class="ui redreject button rejectapp" asid="Head of" data-tooltip="Reject Approval" data-position="top left">Reject</div></div>');
            }
          } else {
            if (obj.picbaru_sign === "SIGNED") {
              $('#NDateSignPic').text(obj.datesign_picbaru);
              $('#BtnSignPicNM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Signed" data-position="top left">SIGNED</a>');
            } else {
              if (obj.rnd_bagian_picbaru === Sdecrypt && Jdecrypt == "HEAD OF") {
                $('#BtnSignPicNM').html('<div class="ui tiny two bottom attached buttons"><div class="ui violet button signpicn" asid="app1" data-tooltip="Confirm Activa" data-position="top left">a.n. SIGN</div><div class="ui redreject button rejectapp" asid="Head of" data-tooltip="Reject Approval" data-position="top left">Reject</div></div>');
              } else {
                $('#BtnSignPicNM').html('<a class="ui tiny disabled bottom attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">SIGN</a>');
              }
            }
          }
        }

        if (obj.head_of_picbaru) {
          if(obj.head_of_picbaru_signby !== null){
            if(obj.head_of_picbaru === obj.head_of_picbaru_signby){
              $('#NHeadOf').text(obj.head_of_picbaru);
            }
            else if(obj.head_of_picbaru !== obj.head_of_picbaru_signby){
              $('#NHeadOf').text(obj.head_of_picbaru+" a.n.  Signed By  "+obj.head_of_picbaru_signby);
            }
          }
          else{
            $('#NHeadOf').text(obj.head_of_picbaru);
          }
          $('#NHeadOfJabatan').text(obj.head_of_picbaru_jabatan);
          $('#NHeadOfBagian').text(obj.bagian_head_of_picbaru);
          if (obj.picbaru_sign === "SIGNED") {
            if (vusrnm === obj.head_of_picbaru_username) {
              if (obj.head_of_picbaru_sign === "SIGNED") {
                $('#NDateSignHeadOf').text(obj.datesign_head_of_picbaru);
                $('#BtnSignHeadOfNM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">APPROVED</a>');
              } else {
                $('#BtnSignHeadOfNM').html('<div class="ui tiny two bottom attached buttons"><div class="ui green button signhon" asid="app1" data-tooltip="Confirm Activa" data-position="top left">APPROVE</div><div class="ui redreject button rejectapp" asid="Head of" data-tooltip="Reject Approval" data-position="top left">Reject</div></div>');
                EnSign();
              }
            } else {
              if (obj.head_of_picbaru_sign === "SIGNED") {
                $('#NDateSignHeadOf').text(obj.datesign_head_of);
                $('#BtnSignHeadOfNM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Confirmed" data-position="top left">APPROVED</a>');
              } else {
                if (obj.rnd_bagian_head_of_picbaru === Sdecrypt && Jdecrypt == "HEAD OF") {
                  $('#BtnSignHeadOfNM').html('<div class="ui tiny two bottom attached buttons"><div class="ui violet button signhon" asid="app1" data-tooltip="Confirm Activa" data-position="top left">a.n. APPROVE</div><div class="ui redreject button rejectapp" asid="Head of" data-tooltip="Reject Approval" data-position="top left">Reject</div></div>');
                  EnSign();
                } else {
                  $('#BtnSignHeadOfNM').html('<a class="ui tiny disabled bottom attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">APPROVE</a>');
                }
              }
            }
          } else {
            if (obj.head_of_picbaru_sign === "SIGNED") {
              $('#NDateSignHeadOf').text(obj.datesign_head_of_picbaru);
              $('#BtnSignHeadOfNM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Confirmed" data-position="top left">APPROVED</a>');
            } else {
              $('#BtnSignHeadOfNM').html('<a class="ui tiny disabled bottom attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">APPROVE</a>');
            }
          }
        }

        if (obj.admin && obj.head_of_picbaru_sign === "SIGNED") {
          $('#GenAdmin').text(obj.admin);
          $('#GenAdminJabatan').text(obj.admin_jabatan);
          $('#GenAdminBagian').text(obj.bagian_admin);
          if (vusrnm === obj.admin_username) {
            if (obj.admin_sign === "SIGNED") {
              $('#DateSignAdmin').text(obj.datesign_admin);
              $('#BtnSignAdminM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Signed" data-position="top left">SIGNED</a>');
            } else {
              $('#BtnSignAdminM').html('<a class="ui tiny bottom green attached button signadmin" asid="MD1" data-tooltip="Sign setelah melengkapi data" data-position="top left">SIGN</a>');
            }
          } else {
            if (obj.admin_sign === "SIGNED") {
              $('#DateSignAdmin').text(obj.datesign_admin);
              $('#BtnSignAdminM').html('<a class="ui tiny bottom basic green attached button" asid="MD1" data-tooltip="Signed" data-position="top left">SIGNED</a>');
            } else {
              if (obj.rnd_bagian_admin === Sdecrypt && Jdecrypt == "HEAD OF") {
                $('#BtnSignAdminM').html('<a class="ui tiny bottom green attached button signadmin" asid="MD1" data-tooltip="Sign setelah melengkapi data" data-position="top left">SIGN</a>');
              } else {
                $('#BtnSignAdminM').html('<a class="ui tiny disabled bottom attached button" asid="MD1" data-tooltip="Masih dalam proses" data-position="top left">SIGN</a>');
              }
            }
          }
        }

        SignGenAdmin();
        SignPIC();
        SignHo();
        SignHoN();
        SignPICN();
        RejectApp();

      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function SignGenAdmin() {
  $(".signadmin").on("click", function () {
    var dlink = Ucrypt.encrypt(no_mutasi, NonceValue);
    Swal.fire({
      title: "<h3>Apakah sudah yakin untuk Mutasi aktiva ini?</h3>",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url: `../RND_BackEnd/backend_aktiva/sign-genadminm`,
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            iditem: no_mutasi,
            dlink: 'aktivaSignAdd&n=' + dlink,
            user: Udecrypt
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
              IsResponseFalse(obj.message);
            } else {
              IsResponseTrue(obj.message);
              LoadSign();
            }
          },
          error: function () {
            IsTimeOut(LogoutProtect);
          },
        });
      }
    });
  });
}

function SignPIC() {
  $(".signpic").on("click", function () {
    $(".xwinaddheadof").modal({
      autofocus: false,
    }).modal("show");
    $("#inputPICMutasi").dropdown("clear");

  });
}

function SignPICN() {
  $(".signpicn").on("click", function () {
    $(".xwinaddheadofn").modal({
      autofocus: false,
    }).modal("show");
    $("#inputPICMutasi").dropdown("clear");
  });
}

$('#btnAddtoDB').on('click', function () {
  data = [{
    // IdMkg : IdEdit,
    JnsAct: $("#JenisAktiva").val(),
    MrkAct: $("#MerkAktiva").val(),
    DscAct: $("#DescAktiva").val(),
    EqpAct: $("#NoEquipAktiva").val(),
    AstAct: $("#NoAssetAktiva").val(),
    CstAct: $("#adminCC").val(),
    MatAct: $("#MatNumAktiva").val(),
    NikAct: $("#NIKAktiva").val(),
    Plant: $("#PlantAktiva").val(),
    user: Udecrypt,
    PicAct: $("#PICAktiva").val(),
    DeptAct: $("#DeptAktiva").val(),
    VendAct: $("#VendorAktiva").val(),
    VMatAct: $("#VendorMatNumAktiva").val(),
    NamHAct: $("#NamaHistoryAktiva").val(),
    DeptHAct: $("#DeptHistoryAktiva").val(),
    SeriAct: $("#NoSeriAktiva").val(),
    BagHAct: $("#BagHistoryAktiva").val(),
    JmlAct: $("#JumlahAktiva").val(),
    GolAct: $("#golonganItem").val(),
    BaseAct: $("#BaseUnitAktiva").val(),
    StBrAct: $("#statusBarang").val(),
    KDStAct: $("#kodeStatus").val(),
    NoGRAct: $("#NOGRAktiva").val(),
    DtGrAct: $("#DateGRAktiva").val(),
    GRyrAct: $("#GRYearAktiva").val(),
    PrceAct: $("#PriceAktiva").val(),
    KalbAct: $("#kalibrasiItem").val(),
    GRLnAct: $("#GRLineAktiva").val(),
    CurrAct: $("#matauang").val(),
    NoteAct: $("#NoteAktiva").val(),
    action: "UpdateActiva",
  }, ];
  $.ajax({
    type: "POST",
    url: `${restlocactiva}CreateItemOutstanding/` + no_mutasi,
    headers: {
      user: vusrnm,
      token: vtoken
    },
    data: {
      data: data
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (isEmpty(obj)) {
        IsResponseEmptyObj();
      } else if (obj) {
        if (obj.status == false) {
          IsResponseFalse(obj.message);
        } else {
          IsResponseTrue(obj.message);
          window.location.href = "./?link=aktiva";
        }
      } else {
        Swal.fire('Error', 'Ada kendal di koneksi/database, data tidak tersimpan !', 'error')
      }
    },
    error: function () {
      if (LogoutProtect) {
        window.location.href = "./?link=loclogout";
      } else {
        Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
      }
    },
  });
});

// function SignPic() {
$("#SaveDataHO").on("click", function () {
  var ho = $("#HeadOfPic").val();
  var dlink = Ucrypt.encrypt(no_mutasi, NonceValue);
  $.ajax({
    type: "POST",
    url: `../RND_BackEnd/backend_aktiva/sign-pic-mutasi`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      ho: ho,
      iditem: no_mutasi,
      dlink: 'aktivaSignApprovalMutasi&n=' + dlink,
      user: Udecrypt
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        IsResponseFalse(obj.message);
      } else {
        IsResponseTrue(obj.message);
        LoadSign();
        $(".xwinaddheadof").modal("hide");
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
});
// }

$("#SaveDataHOn").on("click", function () {
  var ho = $("#HeadOfPicn").val();
  console.log(ho);
  var dlink = Ucrypt.encrypt(no_mutasi, NonceValue);
  $.ajax({
    type: "POST",
    url: `../RND_BackEnd/backend_aktiva/sign-picn-mutasi`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      ho: ho,
      iditem: no_mutasi,
      dlink: 'aktivaSignApprovalMutasi&n=' + dlink,
      user: Udecrypt
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        IsResponseFalse(obj.message);
      } else {
        IsResponseTrue(obj.message);
        LoadSign();
        $(".xwinaddheadofn").modal("hide");
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
});

$("#btncancelmutasi").on("click", function () {
  $(".xwincancelmutasi").modal({
    autofocus: false,
  }).modal("show");
  // $("#inputPICMutasi").dropdown("clear");

});

$("#cancelmutasi").on("click", function () {
  var reason = $("#alasan_cancel").val();
  var dlink = Ucrypt.encrypt(no_mutasi, NonceValue);
  Swal.fire({
    title: "<h3>Yakin Cancel Approval Mutasi ?</h3>",
    // text: nm_docupo,
    icon: "warning",
    confirmButtonText: "Ya",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `../RND_BackEnd/backend_aktiva/cancel-mutasi`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: no_mutasi,
          reason : reason,
          dlink: 'aktivaSignApprovalMutasi&n=' + dlink,
          user: Udecrypt
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(response);
          if (obj.status == false) {
            IsResponseFalse(obj.message);
          } else {
            IsResponseTrue(obj.message);
            window.location.href = "./?link=aktivaApprovalMutasiIndex";
          }
        },
        error: function () {
          if (LogoutProtect){
            window.location.href = "./?link=loclogout";
          } else {
            Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
          }
        },
      });
    }
  });

});

$("#btnEmailKalibrasiMutasi").on("click", function () {
  $(".xwinsendemailkalibrasi").modal({
    autofocus: false,
  }).modal("show");
  $("#FormatFile_a").text('Format file yang direkomendasikan:pdf');

});

$("#btnUploadPdfMut").on("click", function () {
  $(".xwinuploadpdfmut").modal({
    autofocus: false,
  }).modal("show");
  $("#FormatFile_a").text('Format file yang direkomendasikan:pdf');

});

$("#perluFile").on('change', function(){
  var perlu = $("#perluFile").val();
  console.log(perlu);
  if(perlu === "No" || perlu === "File Lama"){
    $("#upload-file").hide();
    $("#note-file").hide();
  }else if(perlu === "Yes"){
    $("#upload-file").show();
    $("#note-file").show();
  }
    
});

$("#perluFileF").on('change', function(){
  var perlu = $("#perluFileF").val();
  console.log(perlu);
  if(perlu === "No" || perlu === "File Lama"){
    $("#upload-fileF").hide();
    $("#note-fileF").hide();
  }else if(perlu === "Yes"){
    $("#upload-fileF").show();
    $("#note-fileF").show();
  }
    
});

$("#btnSaveKalibrasi").click(function () {
  fileprop = $('#field-upload-fileK').prop("files")[0];
  var desc = $("#desc").val();
  var perlu = $("#perluFile").val();
  no_mut = no_mutasi;

  var dataupload = new FormData();
  dataupload.append("file", fileprop);
  dataupload.append("no_mutasi",no_mut);
  dataupload.append("desc",desc);
  dataupload.append("perluFile",perlu);
  dataupload.append("pic",Udecrypt);
  dataupload.append("kat","MUTASI");

  $.ajax({
    url: `../RND_BackEnd/backend_aktiva/sendEmailKalibrasiAktiva`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
      type: 'POST',
      dataType: 'html',
      processData: false,
      contentType: false,
      cache: false,
      data: dataupload,
      success: function (response) {
          var obj = JSON.parse(response);
          if (obj.status == false) {
              IsResponseFalse(obj.message);
          } else {
              IsResponseTrue(obj.message);
          }
      },
      error: function () {
          if (LogoutProtect) {
              window.location.href = "./?link=loclogout";
          } else {
            IsResponseEmptyObj();
          }
      }
  });
  $("#xwinsendemailkalibrasi").modal('hide');
});

$("#btnuploadpdfmut").click(function () {
  // fileprop = $('#field-upload-file').prop("files")[0];
  var desc = $("#desc").val();
  no_mut = no_mutasi;

  var dataupload = new FormData();
  dataupload.append("file", fileprop);
  dataupload.append("no_mutasi",no_mut);
  dataupload.append("desc",desc);
  dataupload.append("pic",Udecrypt);

  $.ajax({
    url: `../RND_BackEnd/backend_aktiva/uploadPDFMut`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
      type: 'POST',
      dataType: 'html',
      processData: false,
      contentType: false,
      cache: false,
      data: dataupload,
      success: function (response) {
          var obj = JSON.parse(response);
          if (obj.status == false) {
              IsResponseFalse(obj.message);
          } else {
              IsResponseTrue(obj.message);
          }
      },
      error: function () {
          if (LogoutProtect) {
              window.location.href = "./?link=loclogout";
          } else {
            IsResponseEmptyObj();
          }
      }
  });
  $("#xwinsendemailkalibrasi").modal('hide');
});

$("#btnEmailFinanceMutasi").on("click", function () {
  $('.xwinsendemailfinance').modal('show');
  $("#FormatFile_a").text('Format file yang direkomendasikan:xlsx');
});

function EnSign() {
  $('.ensign').click(function () {
    // var rl = $(this).attr('rl');
    // var nm = $(this).attr('nm');
    // var hc = $(this).attr('hc');
    $(".xwinaddheadof").modal({
      autofocus: false,
    }).modal("show");
    $("#HeadOfPic").dropdown("clear");

  });
}

function SignHo() {
  $(".signho").on("click", function () {
    var dlink = Ucrypt.encrypt(no_mutasi, NonceValue);
    Swal.fire({
      title: "<h3>Approve Permintaan Aktiva ini ?</h3>",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url: `../RND_BackEnd/backend_aktiva/sign-ho-mutasi`,
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            iditem: no_mutasi,
            dlink: 'aktivaSignApprovalMutasi&n=' + dlink,
            user: Udecrypt
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
              IsResponseFalse(obj.message);
            } else {
              IsResponseTrue(obj.message);
              LoadSign();
            }
          },
          error: function () {
            IsTimeOut(LogoutProtect);
          },
        });
      }
    });
  });
}

function SignHoN() {
  $(".signhon").on("click", function () {
    var dlink = Ucrypt.encrypt(no_mutasi, NonceValue);
    Swal.fire({
      title: "<h3>Approve Permintaan Aktiva ini ?</h3>",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url: `../RND_BackEnd/backend_aktiva/sign-hon-mutasi`,
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            iditem: no_mutasi,
            dlink: 'aktivaSignApprovalMutasi&n=' + dlink,
            user: Udecrypt
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
              IsResponseFalse(obj.message);
            } else {
              IsResponseTrue(obj.message);
              LoadSign();
            }
          },
          error: function () {
            IsTimeOut(LogoutProtect);
          },
        });
      }
    });
  });
}

function RejectApp() {
  $(".rejectapp").on("click", function () {
    $(".xwinrejectapp").modal('show');
    var SignAs = $(this).attr("asid");
    $("#asid").val(SignAs);
  });
}

$('#ViewMutPDF').click(function(){
    
  var sct = getCookie("section");
  var jbt = getCookie("jabatan");
  // console.log(pic);
  $.ajax({
    type    : "POST",
    url     : `../RND_BackEnd/backend_aktiva/load-viewmutpdf`,
    headers : {
      user  : vusrnm,
      token : vtoken
    },
    data: {
      no_mutasi: no_mutasi
    },
    cache: false,
    success: function (response){
      var obj = JSON.parse(response);
      $(".xwinviewuploadpdfmutasi").modal({
        autofocus: false,
      }).modal("show");
      if(isEmpty(obj)) {
        IsResponseEmptyObj();
      } else {
        
        $("#ReportList").empty();
        // console.log(pic);
        jmlData = obj.length;
        
        for (a = 0; a < jmlData; a++) {
          
            var filelink = "<a target='_blank' href='../RND_Upload/Aktiva/PDFMutasi/"+obj[a]["NamaFile"]+"'><i class='file pdf red icon'></i></a>";
            $("#TableReportList").find("tbody").append(
              "<tr>"+ 
              "<td width='20%'>"+obj[a]['no_mut']+"</td>"+
              "<td width='10%'>"+obj[a]['rev']+"</td>"+
              "<td width='30%'>"+obj[a]['note']+"</td>"+
              "<td width='20%'>"+obj[a]['Date']+"</td>"+
              "<td width='20%'>"+filelink+"</td>"+
              "</tr><tr></tr>"
            );
             
        }
        $("#FootFeedCheckList").empty();
          
       
        
      }
    }
});
// $("#PSCRejectSection").dropdown("clear");
});

$('#ViewMutasiPDF').click(function(){
    
  var sct = getCookie("section");
  var jbt = getCookie("jabatan");
  // console.log(pic);
  $.ajax({
    type    : "POST",
    url     : `../RND_BackEnd/backend_aktiva/load-viewmutasipdf`,
    headers : {
      user  : vusrnm,
      token : vtoken
    },
    data: {
      no_mutasi: no_mutasi
    },
    cache: false,
    success: function (response){
      var obj = JSON.parse(response);
      $(".xwinviewuploadpdfmut").modal({
        autofocus: false,
      }).modal("show");
      if(isEmpty(obj)) {
        IsResponseEmptyObj();
      } else {
        
        $("#ReportListMutasi").empty();
        // console.log(pic);
        jmlData = obj.length;
        
        for (a = 0; a < jmlData; a++) {
          
            var filelink = "<a target='_blank' href='../RND_Upload/Aktiva/PDFMutasi/"+obj[a]["NamaFile"]+"'><i class='file pdf red icon'></i></a>";
            $("#TableReportListMutasi").find("tbody").append(
              "<tr>"+ 
              "<td width='20%'>"+obj[a]['no_mut']+"</td>"+
              "<td width='10%'>"+obj[a]['rev']+"</td>"+
              "<td width='30%'>"+obj[a]['note']+"</td>"+
              "<td width='20%'>"+obj[a]['Date']+"</td>"+
              "<td width='20%'>"+filelink+"</td>"+
              "</tr><tr></tr>"
            );
             
        }
        $("#FootFeedCheckListMutasi").empty();
          
       
        
      }
    }
});
// $("#PSCRejectSection").dropdown("clear");
});

$('#ViewDataKal').click(function(){
    
  var sct = getCookie("section");
  var jbt = getCookie("jabatan");
  // console.log(pic);
  $.ajax({
    type    : "POST",
    url     : `../RND_BackEnd/backend_aktiva/load-datakalibrasi`,
    headers : {
      user  : vusrnm,
      token : vtoken
    },
    data: {
      no_mutasi: no_mutasi
    },
    cache: false,
    success: function (response){
      var obj = JSON.parse(response);
      $(".xwinviewuploadkalibrasi").modal({
        autofocus: false,
      }).modal("show");
      if(isEmpty(obj)) {
        IsResponseEmptyObj();
      } else {
        
        $("#ReportListKalibrasi").empty();
        // console.log(pic);
        jmlData = obj.length;
        
        for (a = 0; a < jmlData; a++) {
          
            var filelink = "<a target='_blank' href='../RND_Upload/Aktiva/PDFMutasi/"+obj[a]["NamaFile"]+"'><i class='file pdf red icon'></i></a>";
            $("#TableReportListKalibrasi").find("tbody").append(
              "<tr>"+ 
              "<td width='20%'>"+obj[a]['no_mut']+"</td>"+
              "<td width='10%'>"+obj[a]['rev']+"</td>"+
              "<td width='30%'>"+obj[a]['note']+"</td>"+
              "<td width='20%'>"+obj[a]['Date']+"</td>"+
              "<td width='20%'>"+filelink+"</td>"+
              "</tr><tr></tr>"
            );
             
        }
        $("#FootFeedCheckListKalibrasi").empty();
          
       
        
      }
    }
});
// $("#PSCRejectSection").dropdown("clear");
});

$("#RejectApp").on("click", function (e) {
  var reason = $("#rejectreason").val();
  var asid = $("#asid").val();
  var dlink = Ucrypt.encrypt(no_mutasi, NonceValue);
  Swal.fire({
    title: "<h3>Reject Permintaan Approval Aktiva ini ?</h3>",
    text: reason,
    icon: "warning",
    confirmButtonText: "Reject!",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `${restlocactiva}reject_approval_mutasi`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          no_mutasi: no_mutasi,
          reason: reason,
          asid: asid,
          dlink: 'aktivaSignApprovalMutasi&n=' + dlink,
          nama: Udecrypt
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(response);
          if (obj.status == false) {
            IsResponseFalse(obj.message);
          } else {
            IsResponseTrue(obj.message);
            location.reload();
            LoadSign();
            // window.location.href = "./?link=mkgitem&i=" + IdUrl;
          }
        },
        error: function () {
          if (LogoutProtect) {
            window.location.href = "./?link=loclogout";
          } else {
            Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
          }
        },
      });
    }j
  });
});

$("#btnEditHeaderMutasi").on("click", function () {
  // var eid = $(this).attr("eid");
  // let encryption = new Encryption();
  var eidENC = Ucrypt.encrypt(no_mutasi, NonceValue);
  window.location.href = "./?link=aktivaEditMutasi&i=" + eidENC;
});

$("#TableListAppMutasi").on("click", ".viewdetailmutasi", function () {
  var idAktiva = $(this).attr('eid')
  $('.xwindetailitem').modal('show');
  LoadDataAktiva(idAktiva);
});

$('#btnUploadPDFMut').click(function(){
  $('.xwinuploadpdfMut').modal('show');
});

$('.btnCloseModal').click(function () {
  $('.xwindetailitem').modal('hide');
  $(".xwinaddheadof").modal('hide');
  $(".xwinaddheadofn").modal('hide');
  $('.xwinuploadpdfMut').modal('hide');
});

$("#btnPrintQR").on("click", function (e) {
  $.ajax({
    type: "POST",
    url: `../RND_BackEnd/backend_aktiva/createQR`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      iditem: no_mutasi
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        IsResponseFalse(obj.message);
      } else {
        var dataimage2 = "<img width='350' src='../RND_Upload/Aktiva/" + obj.message + "'>";
        // IsResponseTrue(obj.message);
        $("#FeedCheckList").empty();
        $(".xwinaddqr").modal('show');
        $("#TableFeedCheckList").find("tbody").append(
          "<tr>" +
          "<td width='100%'>" + dataimage2 + "</td>" +
          "</tr>"
        );
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
});

$("#btnHistoryPicM").on("click", function (e) {
  $.ajax({
    type: "POST",
    url: `../RND_BackEnd/backend_aktiva/history-pic-mutasi`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      iditem: no_mutasi
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        IsResponseFalse(obj.message);
      } else {
        // var dataimage2 = "<img width='350' src='../RND_Upload/Aktiva/"+obj.message+"'>";
        // IsResponseTrue(obj.message);
        $("#FeedHistoryPIC").empty();
        $(".xwinhistorypic").modal('show');
        $("#TableHistoryPIC").find("tbody").append(
          "<tr>" +
          "<td width='50%'>" + obj.pic + "</td>" +
          "<td width='50%'>" + obj.pichistory + "</td>" +
          "</tr>"
        );
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
});

$(document).ready(function () {

  //Load dokumen upload upo
  LoadSign();
  // ListMutasi();

  $("#EditHeader").on("click", function () {
    var nonceValue = decodeURIComponent(getCookie("nonceValue"));
    // let encryption = new Encryption();
    var eidupoENC = Ucrypt.encrypt(MKG_ID, nonceValue);
    window.location.href = "./?link=mkgreqnew&i=" + eidupoENC;
  });

  $('.CloseModal').click(function () {
    $(".ui.modal").modal("hide");
  });

  $("#btnUploadPDFMutasi").click(function () {
    fileprop = $('#field-upload-file').prop("files")[0];
    var desc = $("#desc").val();
    noMutasi = no_mutasi;
    console.log(fileprop);

    var dataupload = new FormData();
    dataupload.append("file", fileprop);
    dataupload.append("no_mutasi",noMutasi);
    dataupload.append("desc",desc);
    dataupload.append("pic",Udecrypt);
    $.ajax({
      url: `../RND_BackEnd/backend_aktiva/uploadPDFMutasi`,
      headers: {
        user: vusrnm,
        token: vtoken,
      },
        type: 'POST',
        dataType: 'html',
        processData: false,
        contentType: false,
        cache: false,
        data: dataupload,
        success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
                Swal.fire({
                    text: obj.message,
                    timer: 1500,
                    icon: "warning",
                    showConfirmButton: false,
                });
            } else {
                Swal.fire('<h3>Success</h3>', '', 'success');
            }
        },
        error: function () {
            if (LogoutProtect) {
                window.location.href = "./?link=loclogout";
            } else {
                Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
            }
        }
    });
    $("#modal-upload").modal('hide');
  });

  $("#btnUploadPDF").click(function () {
    var fileprop = $('#field-upload-fileF').prop("files")[0];
    var desc = $("#descF").val();
    var perlu = $("#perluFileF").val();
    noMutasi = no_mutasi;
    console.log(fileprop);

    var dataupload = new FormData();
    dataupload.append("file", fileprop);
    dataupload.append("no_mut",noMutasi);
    dataupload.append("desc",desc);
    dataupload.append("pic",Udecrypt);
    dataupload.append("perluFile",perlu);

    $.ajax({
      url: `../RND_BackEnd/backend_aktiva/uploadPDFMut`,
      headers: {
        user: vusrnm,
        token: vtoken,
      },
        type: 'POST',
        dataType: 'html',
        processData: false,
        contentType: false,
        cache: false,
        data: dataupload,
        success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
                IsResponseFalse(obj.message);
            } else {
                IsResponseTrue(obj.message);
            }
        },
        error: function () {
            if (LogoutProtect) {
                window.location.href = "./?link=loclogout";
            } else {
                Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
            }
        }
    });
    $("#modal-upload").modal('hide');
  });

  $('.ui.search.appset')
    .search({
      apiSettings: {
        url: '3_aktiva/_autocompletenik.php?q={query}'
      },
      fields: {
        results: 'data',
        title: 'name',
        description: 'nik'
      },
      minCharacters: 1,
      onSelect: function (response) {
        console.log(response.nik);
        $('#HeadOfPic').val(response.nik);
        $('#NIKHO').val(response.nik);
        // LoadDataHRIS();
      },
    });

  $('.ui.dropdown').dropdown();

});