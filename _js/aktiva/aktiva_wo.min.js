const NonceValue = "rdsystem2020";
const LogoutProtect = false;

const ColorSignNo = "#00139f";
const ColorOwner = "#00139f";
const BgColorOwner = "#eff0ff";
const ColorRelease = "#505050";
const ColorCancel = "#be0000";
const ColorLock = "#860954";
const BgColorLock = "#f3ebeb";

var restlocactiva = decodeURIComponent(getCookie("restlocactiva"));
var restlocpscxls = decodeURIComponent(getCookie("restlocpscxls"));
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
let Ucrypt = new Encryption();
var Udecrypt = Ucrypt.decrypt(EncU, NonceValue);
var Jdecrypt = Ucrypt.decrypt(EncJ, NonceValue);

if (id_writeoff === "create_writeoff") {
    LoadTempAktivaWO();
}

if(id_writeoff === "edit_writeoff"){
    LoadTempAktivaEditWO();
}

function readnoaktiva(ty){
    // $('#inputNoAktivaMutasi').on('change', function(e){
        $.ajax({
          type: "POST",
          url: `${restlocactiva}readnoaktiva`,
          async: false,
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            pic: Udecrypt,
            cat: ty,
            user: vusrnm,
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(response);
            jmlData = obj.length;
            if (obj.status == false) {
              IsResponseFalse(obj.message);
            } else {
              $('#inputNoAktivaWO').dropdown('clear');
              $('#inputNoAktivaWO').empty();
              $('.ui.dropdown.fullsearch').dropdown( {fullTextSearch:'exact', sortSelect: true, match:'text'} );
              $('#inputNoAktivaWO').append(`<option value=""></option>`);
            for (a = 0; a < jmlData; a++) {
                $('#inputNoAktivaWO').append(`<option value="${obj[a]['nomor_aktiva']}">${obj[a]['nomor_aktiva']} (${obj[a]['description']}) - ${obj[a]['peminta']}</option>`);
              }
            }
          },
          error: function () {
            IsTimeOut(LogoutProtect);
          },
        });
    
      // });
      
    
  }

function loadautcompleteactiva(ty) {
    $('.nmrAktivaWO')
    .search({
        apiSettings: {
            url: '3_aktiva/_autocompletenoaktiva.php?q={query}&ty='+ty
        },
        fields: {
            results: 'data',
            title: 'nomor_aktiva',
            description: 'description'
        },
        minCharacters: 1,
        clearable : true,
        filterRemoteData : false,
        saveRemoteData : true,
        onSelect: function (response) {
            console.log(response.nik);
            $('#inputPICAktiva').val(response.peminta);
            $('#inputNIKAktiva').val(response.nik);
            // LoadDataHRIS();
        },
    });
}

//Fuction Load Temp Aktiva
function LoadTempAktivaWOEdit() {

    $('#tbTempEditWriteoff').find('tbody').empty();
    $.ajax({
        type: "POST",
        url: `${restlocactiva}read_tempactivawoedit`,
        headers: {
            user: vusrnm,
            token: vtoken
        },
        data: {
            pic: Udecrypt
        },
        cache: false,
        success: function (response) {
            var obj = JSON.parse(response);
            // console.log(obj);
            if (isEmpty(obj)) {
                IsResponseEmptyObj();
            } else if (obj) {
                if (obj.status == 'error8') {
                    $('#tbTempEditWriteoff').find('tbody').append(
                        "<tr><td width='400px'>&nbsp;" +
                        "</td><td class='center' >" +
                        "</td><td class='center'></td></tr>");
                } else {
                    jmlData = obj.length;
                    for (a = 0; a < jmlData; a++) {
                        $('#tbTempEditWriteoff').find('tbody').append(
                            "<tr id='" + a + "'>" +
                            "<td width='400px'>" + obj[a]["nomor_aktiva"] +
                            "</td><td class='center' width='80px'>" + obj[a]["material_number"] +
                            "</td><td class='center' width='150px'>" + obj[a]["description"] +
                            "</td><td class='center' width='150px'>" + obj[a]["merk"] +
                            "</td><td class='center' width='150px'>" + obj[a]["vendor_material_number"] +
                            "</td><td class='center' width='100px'>" + obj[a]["curr_pic"] +
                            "</td><td class='center' data-tooltip='Hapus data' data-inverted='' data-variation='basic'><i class='trash actdeleteprjid iconcoloredit icon' id='" + obj[a]["id_temp"] + "'></i></td></tr>");
                    }

                    //Hapus Project ID
                    $('.actdeleteprjid').on('click', function (e) {
                        var IdTemp = $(this).attr('id');
                        $.ajax({
                            type: "POST",
                            url: `${restlocactiva}Delete_TempAktivaWO`,
                            headers: {
                                user: vusrnm,
                                token: vtoken
                            },
                            data: {
                                IdTemp: IdTemp
                            },
                            cache: false,
                            success: function (response) {
                                var obj = JSON.parse(response);
                                if (obj.status == false) {
                                    IsResponseFalse(obj.message);
                                } else {
                                    IsResponseTrue(obj.message);
                                    LoadTempAktivaWOEdit();
                                    readnoaktiva('EW');
                                }
                            },
                            error: function () {
                                IsTimeOut(LogoutProtect);
                            },
                        });
                    });
                }
            }
        },
        error: function () {
            IsTimeOut(LogoutProtect);
        },
    });
}

//Fuction Load Temp Aktiva
function LoadTempAktivaWO() {

    $('#tbTempWriteoff').find('tbody').empty();
    $.ajax({
        type: "POST",
        url: `${restlocactiva}read_tempactivawo`,
        headers: {
            user: vusrnm,
            token: vtoken
        },
        data: {
            pic: Udecrypt
        },
        cache: false,
        success: function (response) {
            var obj = JSON.parse(response);
            // console.log(obj);
            if (isEmpty(obj)) {
                IsResponseEmptyObj();
            } else if (obj) {
                if (obj.status == 'error8') {
                    $('#tbTempWriteoff').find('tbody').append(
                        "<tr><td width='400px'>&nbsp;" +
                        "</td><td class='center' >" +
                        "</td><td class='center'></td></tr>");
                } else {
                    jmlData = obj.length;
                    for (a = 0; a < jmlData; a++) {
                        $('#tbTempWriteoff').find('tbody').append(
                            "<tr id='" + a + "'>" +
                            "<td width='400px'>" + obj[a]["nomor_aktiva"] +
                            "</td><td class='center' width='80px'>" + obj[a]["material_number"] +
                            "</td><td class='center' width='150px'>" + obj[a]["description"] +
                            "</td><td class='center' width='150px'>" + obj[a]["merk"] +
                            "</td><td class='center' width='150px'>" + obj[a]["vendor_material_number"] +
                            "</td><td class='center' width='100px'>" + obj[a]["curr_pic"] +
                            "</td><td class='center' data-tooltip='Hapus data' data-inverted='' data-variation='basic'><i class='trash actdeleteprjid iconcoloredit icon' id='" + obj[a]["id_temp"] + "'></i></td></tr>");
                    }

                    //Hapus Project ID
                    $('.actdeleteprjid').on('click', function (e) {
                        var IdTemp = $(this).attr('id');
                        $.ajax({
                            type: "POST",
                            url: `${restlocactiva}Delete_TempAktivaWO`,
                            headers: {
                                user: vusrnm,
                                token: vtoken
                            },
                            data: {
                                IdTemp: IdTemp
                            },
                            cache: false,
                            success: function (response) {
                                var obj = JSON.parse(response);
                                if (obj.status == false) {
                                    IsResponseFalse(obj.message);
                                } else {
                                    IsResponseTrue(obj.message);
                                    LoadTempAktivaWO();
                                    readnoaktiva('CW');
                                }
                            },
                            error: function () {
                                IsTimeOut(LogoutProtect);
                            },
                        });
                    });
                }
            }
        },
        error: function () {
            IsTimeOut(LogoutProtect);
        },
    });
}

function LoadTempAktivaEditWO() {
    $('#tbTempEditWriteoff').find('tbody').empty();
    $.ajax({
      type: "POST",
      url: `${restlocactiva}read_tempeditWo`,
      headers: {
        user: vusrnm,
        token: vtoken
      },
      data: {
        pic: Udecrypt,
        user: vusrnm,
        noWO: no_wo
      },
      cache: false,
      success: function (response) {
        var obj = JSON.parse(response);
        if (isEmpty(obj)) {
          IsResponseEmptyObj();
        } else if (obj) {
          if (obj.status == 'error8') {
            $('#tbTempEditWriteoff').find('tbody').append(
              "<tr><td width='400px'>&nbsp;" +
              "</td><td class='center' >" +
              "</td><td class='center'></td></tr>");
          }
          else if(obj.status == false){
            Swal.fire({
              title: '<h3>'+obj.message+' !</h3>',
              text: "Ambil alih writeoff ini ?",
              icon: 'info',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#999',
              confirmButtonText: 'Ya'
            }).then((result) => {
              if (result.value) {
                $.ajax({
                  type: "POST",
                  url: `${restlocactiva}read_tempeditWo`,
                  headers: {
                    user: vusrnm,
                    token: vtoken
                  },
                  data: {
                    pic: Udecrypt,
                    noWO: no_wo,
                    code : 'overwrite'
                  },
                  cache: false,
                  success: function(response){
                    var obj = JSON.parse(response);
                  // var nPIC = obj[0]["pic_baru"];
                  // LoadNewPIC(nPIC);
                  if (isEmpty(obj)) {
                    IsResponseEmptyObj();
                  } else if (obj) {
                    if (obj.status == 'error8') {
                      $('#tbTempEditMutasi').find('tbody').append(
                        "<tr><td width='400px'>&nbsp;" +
                        "</td><td class='center' >" +
                        "</td><td class='center'></td></tr>");
                    }
                    else if(obj.status == false){
                        IsResponseFalse(obj.message);
              
                    }
                    else {
                        // console.log("DATA EXISTS");
                        jmlData = obj.length;
                        $("#inputNotesWriteoff").val(obj[0]["note"]);
                        $("#statusWO").dropdown("set selected", obj[0]["status_item"]);
                        for (a = 0; a < jmlData; a++) {
                          $('#tbTempEditWriteoff').find('tbody').append(
                            "<tr id='" + a + "'>" +
                            "<td width='400px'>" + obj[a]["nomor_aktiva"] +
                            "</td><td class='center' width='80px'>" + obj[a]["material_number"] +
                            "</td><td class='center' width='150px'>" + obj[a]["description"] +
                            "</td><td class='center' width='100px'>" + obj[a]["merk"] +
                            "</td><td class='center' width='150px'>" + obj[a]["vendor_material_number"] +
                            "</td><td class='center' width='100px'>" + obj[a]["curr_pic"] +
                            "</td><td class='center' data-tooltip='Hapus data' data-inverted='' data-variation='basic'><i class='trash actdeleteprjid iconcoloredit icon' id='" + obj[a]["id_temp"] + "'></i></td></tr>");
                        }
              
                        //Hapus Project ID
                        $('.actdeleteprjid').on('click', function (e) {
                          var IdTemp = $(this).attr('id');
                          $.ajax({
                            type: "POST",
                            url: `${restlocactiva}Delete_TempAktivaWO`,
                            headers: {
                              user: vusrnm,
                              token: vtoken
                            },
                            data: {
                              IdTemp: IdTemp
                            },
                            cache: false,
                            success: function (response) {
                              var obj = JSON.parse(response);
                              if (obj.status == false) {
                                IsResponseFalse(obj.message);
                              } else {
                                IsResponseTrue(obj.message);
                                LoadTempAktivaWOEdit();
                              }
                            },
                            error: function () {
                              IsTimeOut(LogoutProtect);
                            },
                          });
                        });
                      }
                  }
                  },
                  // error: function(){
                  //   Swal.fire({
                  //     text : `Server tidak merespon, segera hubungi Administrator di ext. 3553 !` 
                  //   })
                  // }
                });
              }else{
                window.history.back();
              }
            })
    
          }
          else {
            // console.log("DATA EXISTS");
            jmlData = obj.length;
            $("#inputNotesWriteoff").val(obj[0]["note"]);
            $("#statusWO").dropdown("set selected", obj[0]["status_item"]);
            for (a = 0; a < jmlData; a++) {
              $('#tbTempEditWriteoff').find('tbody').append(
                "<tr id='" + a + "'>" +
                "<td width='400px'>" + obj[a]["nomor_aktiva"] +
                "</td><td class='center' width='80px'>" + obj[a]["material_number"] +
                "</td><td class='center' width='150px'>" + obj[a]["description"] +
                "</td><td class='center' width='100px'>" + obj[a]["merk"] +
                "</td><td class='center' width='150px'>" + obj[a]["vendor_material_number"] +
                "</td><td class='center' width='100px'>" + obj[a]["curr_pic"] +
                "</td><td class='center' data-tooltip='Hapus data' data-inverted='' data-variation='basic'><i class='trash actdeleteprjid iconcoloredit icon' id='" + obj[a]["id_temp"] + "'></i></td></tr>");
            }
  
            //Hapus Project ID
            $('.actdeleteprjid').on('click', function (e) {
              var IdTemp = $(this).attr('id');
              $.ajax({
                type: "POST",
                url: `${restlocactiva}Delete_TempAktivaWO`,
                headers: {
                  user: vusrnm,
                  token: vtoken
                },
                data: {
                  IdTemp: IdTemp
                },
                cache: false,
                success: function (response) {
                  var obj = JSON.parse(response);
                  if (obj.status == false) {
                    IsResponseFalse(obj.message);
                  } else {
                    IsResponseTrue(obj.message);
                    LoadTempAktivaWOEdit();
                  }
                },
                error: function () {
                  IsTimeOut(LogoutProtect);
                },
              });
            });
          }
        }
      },
      error: function () {
        IsTimeOut(LogoutProtect);
      },
    });
  }

function TableListFunc(FilterCariWO, FilterPICWO, FilterStatusWO, FilterProgressWO, FilterTahunWo) {
    var DTables = $("#tableListWriteOff").DataTable({
        dom: "<'ui stackable grid'" +
            "<'row'" +
            "<'left aligned sixteen wide column'>" +
            ">" +
            "<'row dt-table'" +
            "<'sixteen wide column'tr>" +
            ">" +
            "<'row'" +
            "<'left aligned seven wide column'B>" +
            "<'left aligned two wide column'i>" +
            "<'right aligned seven wide column'p>" +
            ">" +
            ">",
        buttons: [{
                text: "10",
                action: function (e, dt, node, config) {
                    $("#tableListWriteOff").DataTable().page.len(10).draw();
                },
            },
            {
                text: "25",
                action: function (e, dt, node, config) {
                    $("#tableListWriteOff").DataTable().page.len(25).draw();
                },
            },
            {
                text: "50",
                action: function (e, dt, node, config) {
                    $("#tableListWriteOff").DataTable().page.len(50).draw();
                },
            },
            {
                text: "100",
                action: function (e, dt, node, config) {
                    $("#tableListWriteOff").DataTable().page.len(100).draw();
                },
            },
            {
                text: "1000",
                action: function (e, dt, node, config) {
                    $("#tableListWriteOff").DataTable().page.len(1000).draw();
                },
            },
        ],
        destroy: true,
        stateSave: true,
        processing: true,
        deferRender: true,
        serverSide: true,
        orderClasses: false,
        pageLength: 10,
        data: [],
        language: {
            sLengthMenu: "_MENU_",
            search: "",
            searchPlaceholder: "Pencarian..",
            processing: '<i class="circle notch loading icon huge"></i>',
            info: "_START_ sampai _END_ dari _TOTAL_ total data",
            paginate: {
                "first": "Awal",
                "last": "Akhir",
                "next": "Berikutnya",
                "previous": "Sebelumnya"
            },
            infoEmpty: "Tidak ada data",
            select: {
                rows: ""
            }
        },
        order: [
            [0, "desc"]
        ],
        columns: [{
                data: 'nomor_aktiva'
            },
            {
                data: 'material_number'
              },
            {
                data: 'description'
            },
            {
                data: 'jenis'
            },
            {
                data: 'kalibrasi'
            },
            {
                data: 'merk'
            },
            {
                data: 'vendor_material_number'
            },
            {
                data: 'no_seri'
            },
            {
                data: 'vendor'
            },
            {
                data: 'peminta'
            },
            {
                data: 'detail_status'
            },
            {
                data: 'detail_progress'
            },

        ],
        columnDefs: [{
                className: "center aligned",
                targets: [2]
            },
            {
                className: "collapsing",
                targets: [3, 7, 8]
            },
        ],

        createdRow: function (row, data, index) {

            //WARNA OWNER & STATUS ACTIVE/DRAFT
            if (data["peminta"] == Udecrypt) {
                $(row).find("td").css("color", ColorOwner);
            }

        },

        ajax: {
            url: `${restlocactiva}getListWO`,
            type: "POST",
            headers: {
                user: vusrnm,
                token: vtoken,
            },
            data: {
                FSearch: FilterCariWO,
                FNama: FilterPICWO,
                FStatus: FilterStatusWO,
                FProgress: FilterProgressWO,
                FTahun: FilterTahunWo,
            },

            error: function () {
                if (LogoutProtect) {
                    window.location.href = "./?link=loclogout";
                } else {
                    Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
                }
            },
        },
    });
}


$("#tableListWriteOff").on("click", ".btnAddData", function () {
    var eid = $(this).attr("eid");
    // let encryption = new Encryption();
    var eidENC = Ucrypt.encrypt(eid, NonceValue);
    window.location.href = "./?link=aktivaAddItem&i=" + eidENC;
});

$('#createTempWO').on('click', function () {
    data = [{
        inputNoAktivaWO: $("#inputNoAktivaWO").val(),
        inputNIKWO: $("#inputNIKWO").val(),
        inputNamaWO: $("#inputNamaWO").val(),
        inputStatusWO: $("#statusWO").val(),
        pic: Udecrypt,
    }, ];
    $.ajax({
        type: "POST",
        url: `${restlocactiva}CreateTempWO`,
        headers: {
            user: vusrnm,
            token: vtoken
        },
        data: {
            data: data
        },
        cache: false,
        success: function (response) {
            var obj = JSON.parse(response);
            if (isEmpty(obj)) {
                IsResponseEmptyObj();
            } else if (obj) {
                if (obj.status === false) {
                    IsResponseFalse(obj.message);
                } else {
                    IsResponseTrue(obj.message);
                    // window.location.href = "./?link=aktiva";
                    LoadTempAktivaWO();
                    $("#inputNoAktivaWO").dropdown("clear");
                    readnoaktiva('CW');
                }
            } else {
                Swal.fire('Error', 'Ada kendal di koneksi/database, data tidak tersimpan !', 'error')
            }
        },
        error: function () {
            if (LogoutProtect) {
                window.location.href = "./?link=loclogout";
            } else {
                Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
            }
        },
    });
});

$('#createTempWOEdit').on('click', function () {
    data = [{
        inputNoAktivaWO: $("#inputNoAktivaWO").val(),
        pic: Udecrypt,
    }, ];
    $.ajax({
      type: "POST",
      url: `${restlocactiva}CreateTempWOEdit`,
      headers: {
        user: vusrnm,
        token: vtoken
      },
      data: {
        data: data
      },
      cache: false,
      success: function (response) {
        var obj = JSON.parse(response);
        if (isEmpty(obj)) {
          IsResponseEmptyObj();
        } else if (obj) {
          if (obj.status === false) {
            IsResponseFalse(obj.message);
          } else {
            IsResponseTrue(obj.message);
            // window.location.href = "./?link=aktiva";
            LoadTempAktivaWOEdit();
            readnoaktiva('EW');
          }
        } else {
          Swal.fire('Error', 'Ada kendal di koneksi/database, data tidak tersimpan !', 'error')
        }
      },
      error: function () {
        if (LogoutProtect) {
          window.location.href = "./?link=loclogout";
        } else {
          Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
        }
      },
    });
  });

$('#btnInsertWriteoff').on('click', function () {
    data = [{
        inputNotesWO: $("#inputNotesWriteoff").val(),
        inputPICAktiva: $("#inputPICAktiva").val(),
        inputNIKAktiva: $("#inputNIKAktiva").val(),
        inputNoAktivaWO: $("#inputNoAktivaWO").val(),
        inputNIKWO: $("#inputNIKWO").val(),
        inputNamaWO: $("#inputNamaWO").val(),
        inputStatusWO: $("#statusWO").val(),
        pic: Udecrypt,
    }, ];
    $.ajax({
        type: "POST",
        url: `${restlocactiva}CreateWO`,
        headers: {
            user: vusrnm,
            token: vtoken
        },
        data: {
            data: data
        },
        cache: false,
        success: function (response) {
            var obj = JSON.parse(response);
            if (isEmpty(obj)) {
                IsResponseEmptyObj();
            } else if (obj) {
                if (obj.status == false) {
                    IsResponseFalse(obj.message);
                } else {
                    IsResponseTrue(obj.message);
                    window.location.href = "./?link=aktivaApprovalWriteoff";
                    LoadTempAktivaWO();
                }
            } else {
                Swal.fire('Error', 'Ada kendal di koneksi/database, data tidak tersimpan !', 'error')
            }
        },
        error: function () {
            if (LogoutProtect) {
                window.location.href = "./?link=loclogout";
            } else {
                Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
            }
        },
    });
});

$('#btnUpdateWriteoff').on('click', function () {
    data = [{
        inputNotesWO: $("#inputNotesWriteoff").val(),
        inputPICAktiva: $("#inputPICAktiva").val(),
        inputNIKAktiva: $("#inputNIKAktiva").val(),
        inputNoAktivaWO: $("#inputNoAktivaWO").val(),
        inputNIKWO: $("#inputNIKWO").val(),
        inputNamaWO: $("#inputNamaWO").val(),
        inputStatusWO: $("#statusWO").val(),
        pic: Udecrypt,
        noWo : no_wo
    }, ];
    $.ajax({
        type: "POST",
        url: `${restlocactiva}UpdateWO`,
        headers: {
            user: vusrnm,
            token: vtoken
        },
        data: {
            data: data
        },
        cache: false,
        success: function (response) {
            var obj = JSON.parse(response);
            if (isEmpty(obj)) {
                IsResponseEmptyObj();
            } else if (obj) {
                if (obj.status == false) {
                    IsResponseFalse(obj.message);
                } else {
                    IsResponseTrue(obj.message);
                    window.location.href = "./?link=aktivaApprovalWriteoff";
                    LoadTempAktivaWO();
                }
            } else {
                Swal.fire('Error', 'Ada kendal di koneksi/database, data tidak tersimpan !', 'error')
            }
        },
        error: function () {
            if (LogoutProtect) {
                window.location.href = "./?link=loclogout";
            } else {
                Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !", "error");
            }
        },
    });
});

$('#btnCreateWriteoff').click(function () {
    window.location.href = "./?link=aktivaCreateWriteof";
});

$('.btnCreateWriteoff').click(function () {
    window.location.href = "./?link=aktivaCreateWriteof";
});


$('#btnDownloadExcelWriteoff').on('click', function () {
    var FilterCariWO = $("#FilterCariWO").val();
    var FilterPICWO = $("#FilterPICWO").val();
    var FilterStatusWO = $("#FilterStatusWO").val();
    var FilterProgressWO = $("#FilterProgressWO").val();
    $.ajax({
        type: "GET",
        url: `${restlocpscxls}DownloadExcelWriteoff`,
        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data: {
            FSearch: FilterCariWO,
            FNama: FilterPICWO,
            FStatus: FilterStatusWO,
            FProgress: FilterProgressWO,
            FTahun: FilterTahunWo,
        },
        cache: false,
        success: function (response) {
            window.location.href = "../RND_Upload/Aktiva/Excel/ListItemWriteoff.xlsx";
        },
        error: function () {
            IsTimeOut(LogoutProtect);
        },
    });
});


$(document).ready(function () {
    if (id_writeoff === "create_writeoff") {
        readnoaktiva('CW');
    }
    
    if(id_writeoff === "edit_writeoff"){
        readnoaktiva('EW');
    }

    $("#signApprovalWO").click(function () {
        window.location.href = "./?link=aktivaSignApprovalWriteoff";
    });

    $('#btnAddManual').click(function () {
        window.location.href = "./?link=aktivaKeyIn";
    });


    $('#btnCancelAdd').click(function () {
        window.location.href = "./?link=aktiva";
    });


    //Read Filter Cookies
    var d = new Date();
    var yearnow = d.getFullYear();

    var json_str = getCookie('FilterListWOActiva');
    var arr = JSON.parse(json_str);
    if (json_str) {
        var sfilter = arr[0];
        var pfilter = arr[1];
        var stfilter = arr[2];
        var pgfilter = arr[3];
        var thfilter = arr[4];
    } else {
        var sfilter = "";
        var pfilter = "ALL";
        var stfilter = "ALL";
        var pgfilter = "ALL";
        var thfilter = "ALL";
    }

    if (sfilter) {
        $("#FilterCariWO").val(sfilter);
        var sfilterstart = sfilter;
    } else {
        var sfilterstart = "";
    }
    if (pfilter) {
        $("#FilterPICWO").dropdown("set selected", pfilter);
        var pfilterstart = pfilter;
    } else {
        var pfilterstart = "ALL";
    }
    if (stfilter) {
        $("#FilterStatusWO").dropdown("set selected", stfilter);
        var stfilterstart = stfilter;
    } else {
        var stfilterstart = "ALL";
    }
    if (pgfilter) {
        $("#FilterProgressWO").dropdown("set selected", pgfilter);
        var pgfilterstart = pgfilter;
    } else {
        var pgfilterstart = "ALL";
    }
    if (thfilter) {
        $("#fthn_wo").dropdown("set selected", thfilter);
        var thfilterstart = thfilter;
      } else {
        var thfilterstart = "ALL";
      }

    var FiterArry = [sfilterstart, pfilterstart, stfilterstart, pgfilterstart];
    var JsonFilter = JSON.stringify(FiterArry);
    setCookie("FilterListWOActiva", JsonFilter, 5);

    TableListFunc(sfilterstart, pfilterstart, stfilterstart, pgfilterstart);

    $("#addnewmutasi").on("click", function () {
        window.location.href = "./?link=aktivaKeyIn";
    });

    $("#tableListItem").on("click", ".signItemAdd", function () {
        var eid = $(this).attr("eid");
        window.location.href = "./?link=aktivaSignAdd&n=" + eid;
    });

    $('[data-toggle="datepicker"]').datepicker({
        format: 'yyyy-mm-dd',
        autoHide: true,
        weekStart: 1
    });

    //RESPON KETIKA INPUT PENCARIAN DI KETIK
    $("#FilterCariWO").on("keyup", function () {
        var FilterCariWO = $("#FilterCariWO").val();
        var FilterPICWO = $("#FilterPICWO").val();
        var FilterStatusWO = $("#FilterStatusWO").val();
        var FilterProgressWO = $("#FilterProgressWO").val();
        var FilterTahunWo = $("#fthn_wo").val();
        var FiterArry = [FilterCariWO, FilterPICWO, FilterStatusWO, FilterProgressWO,FilterTahunWo];
        var JsonFilter = JSON.stringify(FiterArry);
        setCookie("FilterListWOActiva", JsonFilter, 5);
        $("#tableListWriteOff").DataTable().destroy();
        TableListFunc(FilterCariWO, FilterPICWO, FilterStatusWO, FilterProgressWO,FilterTahunWo);
        $("#tableListWriteOff").DataTable().page(0).draw();

    });

    //RESPON KETIKA FILTER TAHUN DI RUBAH
    $("#FilterPICWO, #FilterStatusWO, #FilterProgressWO,#fthn_wo").on(
        "change",
        function () {
            var FilterCariWO = $("#FilterCariWO").val();
            var FilterPICWO = $("#FilterPICWO").val();
            var FilterStatusWO = $("#FilterStatusWO").val();
            var FilterProgressWO = $("#FilterProgressWO").val();
            var FilterTahunWo = $("#fthn_wo").val();
            var FiterArry = [FilterCariWO, FilterPICWO, FilterStatusWO, FilterProgressWO,FilterTahunWo];
            var JsonFilter = JSON.stringify(FiterArry);
            setCookie("FilterListWOActiva", JsonFilter, 5);
            TableListFunc(FilterCariWO, FilterPICWO, FilterStatusWO, FilterProgressWO,FilterTahunWo);
            // var table = $("#PSSList").DataTable();
            // var inff = table.page.info();
            // console.log(inff);
            $("#tableListWriteOff").DataTable().page(0).draw();

        }
    );

    // //RESET FILTER
    $(".resetfilter").on("click", function () {
        var d = new Date();
        var yearnow = d.getFullYear();
        $("#FilterCariWO").val("");
        $("#FilterPICWO").dropdown("set selected", "ALL");
        $("#FilterStatusWO").dropdown("set selected", "ALL");
        $("#FilterProgressWO").dropdown("set selected", "ALL");
        $("#fthn_wo").dropdown("set selected", yearnow);
        var FiterArry = ["", "ALL", "ALL", "ALL",yearnow];
        var JsonFilter = JSON.stringify(FiterArry);
        setCookie("FilterListWOActiva", JsonFilter, 5);
        $("#tableListWriteOff").DataTable().destroy();
        TableListFunc("", "ALL", "ALL", "ALL",yearnow);
        $("#tableListWriteOff").DataTable().page(0).draw();

    });

    // $("#FilterPICWO").on('change', function(){
    //     var pic = document.getElementById("FilterPICWO").value;
    //     var jenis = document.getElementById("filterJenis").value;
    //     TableListFunc(pic, jenis);
    // });

    // $("#filterJenis").on('change', function(){
    //     var pic = document.getElementById("FilterPICWO").value;
    //     var jenis = document.getElementById("filterJenis").value;
    //     TableListFunc(pic, jenis);
    // });
    var typeM = 'm'

    
    

    $('.ui.search.nama')
        .search({
            apiSettings: {
                url: '3_aktiva/_autocompletenik.php?q={query}'
            },
            fields: {
                results: 'data',
                title: 'name',
                description: 'nik'
            },
            minCharacters: 1,
            onSelect: function (response) {
                console.log(response.name);
                $('#inputNIKMutasi').val(response.nik);
                $('#inputNamaMutasi').val(response.name);
                // LoadDataHRIS();
            },
        });

    $.ajax({
        type: "GET",
        url: "3_aktiva/_artemis.php",
        cache: false,
        success: function (response) {
            setCookie('atoken', response, 1 / 24);
        }
    });


});