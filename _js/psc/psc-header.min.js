$('.ui.dropdown').dropdown(); 
var restlocpsc = decodeURIComponent(getCookie("restlocpsc"));
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
const NonceValue = "rdsystem2020";
const LogoutProtect = false;


// var MTable = $('#Master').DataTable({
//   "dom"       : "<'ui stackable grid'"+
//                     "<'row'"+
//                         "<'left aligned ten wide column'<'TitleNegoList'>>"+
//                         "<'right aligned six wide column'f>"+
//                     ">"+
//                     "<'row dt-table'"+
//                         "<'sixteen wide column'tr>"+
//                     ">"+
//                     "<'row'"+
//                         "<'left aligned ten wide column'l>"+
//                         "<'right aligned four wide column'p>"+
//                     ">"+
//                 ">",
//   "stateSave" : false,
//   "pageLength"  : 25,
//   "data"      : [],
//   "order"     : [[ 0, "asc" ]],
//   "language"  : { sLengthMenu: "_MENU_", search: "",searchPlaceholder: "Search.." },
//   "columnDefs": [
//               { type: 'natural', targets: 0 },

//             ],
//   "columns"   : [
//     { "data"    : null, render    : function(data, type, row) 
//       { return '<span class="actedit" enm="'+data["nama_negosiator"]+'">'+data["nama_negosiator"]+'</span>';
//       }
//     },
//     { "data"    : null, render    : function(data, type, row) 
//       { return '<span class="actedit" enm="'+data["nama_negosiator"]+'">'+data["job_handle"]+'</span>';
//       }
//     }
//   ]
// });


$(document).ready(function() {

  $('.ExAudio').show();
  ReadHimbauanState();

  if(IdEditPSC){
    $('.inputsupply').addClass("disabled");
    
    $('#PSCCycle').dropdown("clear");
    $('#PSCCycle').dropdown("set selected", PicCy);

    $('#PSCElectronic').dropdown("clear");
    $('#PSCElectronic').dropdown("set selected", PicEl);

    $('#PSCMDE').dropdown("clear");
    $('#PSCMDE').dropdown("set selected", PicMD);

    $('#PSCIDE').dropdown("clear");
    $('#PSCIDE').dropdown("set selected", PicID);

    $('#PSCSW').dropdown("clear");
    $('#PSCSW').dropdown("set selected", PicSW);

    $('#PSCHOGROUP').dropdown("clear");
    $('#PSCHOGROUP').dropdown("set selected", HOGrp);

    $('#PSCDQAHO').dropdown("clear");
    $('#PSCDQAHO').dropdown("set selected", HODQA);

    $('#PSCDSGBP').dropdown("clear");
    $('#PSCDSGBP').dropdown("set selected", PicBP);

    $('#PSCGroupProduct').dropdown("clear");
    $('#PSCGroupProduct').dropdown("set selected", GrpPrd);

    $('#PSCSubPrd').dropdown('clear');
    $('#PSCSubPrd').dropdown("set selected", SUB);
    
    $.ajax({
      type: "POST",
      url: `${restlocpsc}readsubprd`,
      async: false,
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        prd  : PRD,
      },
      cache: false,
      success: function (response) {
        var obj = JSON.parse(response);
        jmlData = obj.length;
        // console.log(obj);
        if (obj.status == false) {
        } else {
          $('#PSCSubPrd').dropdown('clear');
          $('#PSCSubPrd').empty();
          $('#PSCSubPrd').append(`<option value="-"></option>`);
          for (a = 0; a < jmlData; a++) {
            if(obj[a]['sub_product'] === SUB){
              $('#PSCSubPrd').append(`<option selected value="${obj[a]['sub_product']}">${obj[a]['sub_product']}</option>`);
            } else {
              $('#PSCSubPrd').append(`<option value="${obj[a]['sub_product']}">${obj[a]['sub_product']}</option>`);

            }
          }
          
        }
          
      },
      error: function () {
        if (LogoutProtect){
          window.location.href = "./?link=loclogout";
        } else {
          Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
        }
      },
    });


    if(JNSPRD === "AUDIO"){
      $('.ExAudio').hide();
    } else {
      $('.ExAudio').show();
    }

    if (GrpPrd === "BROWN GOODS") {
      $('.CycleUnitTd').addClass('disabled');
      $('.CycleUnitDiv').hide();
      $('#PSCCycle').dropdown("clear");
      $('#PSCCycle').dropdown("set selected", '-');
    } else {
      $('.CycleUnitTd').removeClass('disabled');
      $('.CycleUnitDiv').show();
    }

  } else {
    $('#PSCGroupProduct').dropdown("clear");
  }


  $('#tabpsclist').on('click', function() {
    window.location.href = "./?link=pscindex";
  });

  $('#PSCGroupProduct').on('change', function() {
    var grprd = $(this).val();
    if (grprd === "BROWN GOODS") {
      $('.CycleUnitTd').addClass('disabled');
      $('.CycleUnitDiv').hide();
      $('#PSCCycle').dropdown("clear");
      $('#PSCCycle').dropdown("set selected", '-');
    } else {
      $('.CycleUnitTd').removeClass('disabled');
      $('.CycleUnitDiv').show();
    }
  });

  $('#PSCSupply').keyup(function (event) {
    if (event.keyCode == 13) {
      LoadDataPTB();
    }
  });

  $('#PSCSupply').on('blur', function() {
    LoadDataPTB();
  });

  function GetValuePTB(a){
    if(a){
      return a;
    } else {
      return '-';
    }
  }

  function LoadDataPTB(){
    var itype = $('#PSCSupply').val();
    if(itype){
      $('.PTBInput').addClass('loading');
      $.ajax({
        type    : "POST",
        url     : `${restlocpsc}dataptb`,
        headers : {
          user  : vusrnm,
          token : vtoken
        },
        data: {
          typesupply    : itype,
        },
        cache: false,
        success: function (response){
          var obj = JSON.parse(response);
          if(response.length > 3){
            var brn = obj.brand;
            var dmd = obj.type_mfg_demand;
            var bsc = obj.type_basic;
            var ctk = obj.type_barang_demand;
            var chs = obj.chassis;
            var cab = obj.cabinet;
            var mar = obj.market;
            var lot = obj.lot_inventory;
            var frm = obj.format;
            // var fam = obj.family;
            var jns = (obj.jenis_produk);
            var prd = obj.produk;
            $('.PTBInput').removeClass('loading');
            $('#PSCBrand').val(GetValuePTB(brn));
            $('#PSCTDemand').val(GetValuePTB(dmd));
            $('#PSCTBasic').val(GetValuePTB(bsc));
            $('#PSCTCetak').val(GetValuePTB(ctk));
            $('#PSCChassis').val(GetValuePTB(chs));
            $('#PSCCabinet').val(GetValuePTB(cab));
            $('#PSCMarket').val(GetValuePTB(mar));
            $('#PSCLotInv').val(GetValuePTB(lot));
            $('#PSCFormat').val(GetValuePTB(frm));
            // $('#PSCFamily').val(GetValuePTB(fam));
            $('#PSCJenisProduct').val((GetValuePTB(jns)).toUpperCase());
            $('#PSCProduct').val(GetValuePTB(prd));
  
              $.ajax({
                type: "POST",
                url: `${restlocpsc}readsubprd`,
                headers: {
                  user: vusrnm,
                  token: vtoken,
                },
                data: {
                  prd  : prd,
                },
                cache: false,
                success: function (response) {
                  var obj = JSON.parse(response);
                  jmlData = obj.length;
                  // console.log(obj);
                  if (obj.status == false) {
                    // Swal.fire({
                    //   text: "Sub Product masih kosong, untuk menambahkan silakan di menu Library > General > Sub Product!",
                    //   timer: 3000,
                    //   icon: "info",
                    //   showConfirmButton: false,
                    // });
                  } else {
                    $('#PSCSubPrd').dropdown('clear');
                    $('#PSCSubPrd').empty();
                    $('#PSCSubPrd').append(`<option value="-"></option>`);
                    for (a = 0; a < jmlData; a++) {
                    $('#PSCSubPrd').append(`<option value="${obj[a]['sub_product']}">${obj[a]['sub_product']}</option>`);
                    }
                  }
                },
                error: function () {
                  if (LogoutProtect){
                    window.location.href = "./?link=loclogout";
                  } else {
                    Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
                  }
                },
              });

              if(jns.toUpperCase() === "AUDIO"){
                $('.ExAudio').hide();
              } else {
                $('.ExAudio').show();
              }

          } else {
            $('.PTBInput').removeClass('loading');
            $('#PSCBrand').val('-');
            $('#PSCTDemand').val('-');
            $('#PSCTBasic').val('-');
            $('#PSCTCetak').val('-');
            $('#PSCChassis').val('-');
            $('#PSCCabinet').val('-');
            $('#PSCMarket').val('-');
            $('#PSCLotInv').val('-');
            $('#PSCFormat').val('-');
            $('#PSCFamily').val('-');
            $('#PSCJenisProduct').val('-');
            $('#PSCProduct').val('-');
            $('.ExAudio').show();
            Swal.fire({
              text: "Data tidak ditemukan di Database PTB !",
              timer: 3000,
              toast: true,
              showConfirmButton: false,
            });
          }
        },
        error: function () {
          if (LogoutProtect){
            window.location.href = "./?link=loclogout";
          } else {
            Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
          }
        },
      });
    }
  }


  $('#HeaderButtonSave').on('click', function() {
    var dsgbp = $("#PSCDSGBP").val();
    var prd   = $("#PSCProduct").val();
    var subprd = $("#PSCSubPrd").val();
    console.log(dsgbp);
    if(PRD!== '' && SUB !== ''){
      console.log("1");
      if(PRD !== prd || SUB !== subprd){
        Swal.fire({
          title: "<h3>Product dan Sub Product berbeda akan mengakibatkan perubahan template, apakah tetap lanjut ?</h3>",
          // text: d,
          icon: "warning",
          confirmButtonText: "Ya",
          showCancelButton: true,
        }).then((result) => {
          if (result.value) {
            if(dsgbp === null || dsgbp === '-'){
              Swal.fire({
                title: "<h3>Apakah tidak perlu Buku Petunjuk ?</h3>",
                // text: d,
                icon: "warning",
                confirmButtonText: "Ya",
                showCancelButton: true,
              }).then((result) => {
                if (result.value) {
                  $.ajax({
                    type    : "POST",
                    url     : `${restlocpsc}create_headerpsc`,
                    headers : {
                      user  : vusrnm,
                      token : vtoken
                    },
                    data: {
                      IdPSC         : IdEditPSC,
                      PSCSupply     : $("#PSCSupply").val(),
                      PSCTDemand    : $("#PSCTDemand").val(),
                      PSCTBasic     : $("#PSCTBasic").val(),
                      PSCTCetak     : $("#PSCTCetak").val(),
                      PSCChassis    : $("#PSCChassis").val(),
                      PSCCabinet    : $("#PSCCabinet").val(),
                      PSCFamily     : $("#PSCFamily").val(),
                      PSCFormat     : $("#PSCFormat").val(),
                      PSCBrand      : $("#PSCBrand").val(),
                      PSCGroupProduct : $("#PSCGroupProduct").val(),
                      PSCJenisProduct : $("#PSCJenisProduct").val(),
                      PSCProduct    : $("#PSCProduct").val(),
                      PSCSubProduct : $("#PSCSubPrd").val(),
                      PSCMarket     : $("#PSCMarket").val(),
                      PSCLotInv     : $("#PSCLotInv").val(),
                      PSCCycle      : $("#PSCCycle").val(),
                      PSCElectronic : $("#PSCElectronic").val(),
                      PSCMDE        : $("#PSCMDE").val(),
                      PSCIDE        : $("#PSCIDE").val(),
                      PSCSW         : $("#PSCSW").val(),
                      PSCHO         : $("#PSCHO").val(),
                      PSCHOGROUP    : $("#PSCHOGROUP").val(),
                      PSCDQAHO      : $("#PSCDQAHO").val(),
                      PSCDSGBP      : $("#PSCDSGBP").val(),
                      PSCPL         : $("#PSCPL").val(),
                      PSCNote       : $("#PSCNote").val(),
                      RNDSection    : RNDSection,
                    },
                    cache: false,
                    success: function (response){
                      var obj = JSON.parse(response);
                      if(isEmpty(obj)) {
                        console.log('Gagal Simpan mas brooo, data kosong');
                      } else if(obj) {
                        if (obj.status == false){
                          Swal.fire({
                            text: obj.message,
                            timer: 1500,
                            icon: 'warning',
                            showConfirmButton: false
                          })
                        } else {
                          Swal.fire({
                            title: 'Berhasil',
                            text: obj.message,
                            timer: 1500,
                            position: 'top-end',
                            icon: 'success',
                            showConfirmButton: false
                          })
                          window.location.href = "./?link=pscindex";
                        }
                      } else {
                        Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
                      }
                    },
                    error: function () {
                      if (LogoutProtect){
                        // window.location.href = "./?link=loclogout";
                      } else {
                        Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
                      }
                    },
                  });
                }
              });
          
            }else{
              $.ajax({
                type    : "POST",
                url     : `${restlocpsc}create_headerpsc`,
                headers : {
                  user  : vusrnm,
                  token : vtoken
                },
                data: {
                  IdPSC         : IdEditPSC,
                  PSCSupply     : $("#PSCSupply").val(),
                  PSCTDemand    : $("#PSCTDemand").val(),
                  PSCTBasic     : $("#PSCTBasic").val(),
                  PSCTCetak     : $("#PSCTCetak").val(),
                  PSCChassis    : $("#PSCChassis").val(),
                  PSCCabinet    : $("#PSCCabinet").val(),
                  PSCFamily     : $("#PSCFamily").val(),
                  PSCFormat     : $("#PSCFormat").val(),
                  PSCBrand      : $("#PSCBrand").val(),
                  PSCGroupProduct : $("#PSCGroupProduct").val(),
                  PSCJenisProduct : $("#PSCJenisProduct").val(),
                  PSCProduct    : $("#PSCProduct").val(),
                  PSCSubProduct : $("#PSCSubPrd").val(),
                  PSCMarket     : $("#PSCMarket").val(),
                  PSCLotInv     : $("#PSCLotInv").val(),
                  PSCCycle      : $("#PSCCycle").val(),
                  PSCElectronic : $("#PSCElectronic").val(),
                  PSCMDE        : $("#PSCMDE").val(),
                  PSCIDE        : $("#PSCIDE").val(),
                  PSCSW         : $("#PSCSW").val(),
                  PSCHO         : $("#PSCHO").val(),
                  PSCHOGROUP    : $("#PSCHOGROUP").val(),
                  PSCDQAHO      : $("#PSCDQAHO").val(),
                  PSCDSGBP      : $("#PSCDSGBP").val(),
                  PSCPL         : $("#PSCPL").val(),
                  PSCNote       : $("#PSCNote").val(),
                  RNDSection    : RNDSection,
                },
                cache: false,
                success: function (response){
                  var obj = JSON.parse(response);
                  if(isEmpty(obj)) {
                    console.log('Gagal Simpan mas brooo, data kosong');
                  } else if(obj) {
                    if (obj.status == false){
                      Swal.fire({
                        text: obj.message,
                        timer: 1500,
                        icon: 'warning',
                        showConfirmButton: false
                      })
                    } else {
                      Swal.fire({
                        title: 'Berhasil',
                        text: obj.message,
                        timer: 1500,
                        position: 'top-end',
                        icon: 'success',
                        showConfirmButton: false
                      })
                      window.location.href = "./?link=pscindex";
                    }
                  } else {
                    Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
                  }
                },
                error: function () {
                  if (LogoutProtect){
                    // window.location.href = "./?link=loclogout";
                  } else {
                    Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
                  }
                },
              });
          
            }
          }
        });
            
      }
      else{
        if(dsgbp === null || dsgbp === '-'){
          Swal.fire({
            title: "<h3>Apakah tidak perlu Buku Petunjuk ?</h3>",
            // text: d,
            icon: "warning",
            confirmButtonText: "Ya",
            showCancelButton: true,
          }).then((result) => {
            if (result.value) {
              $.ajax({
                type    : "POST",
                url     : `${restlocpsc}create_headerpsc`,
                headers : {
                  user  : vusrnm,
                  token : vtoken
                },
                data: {
                  IdPSC         : IdEditPSC,
                  PSCSupply     : $("#PSCSupply").val(),
                  PSCTDemand    : $("#PSCTDemand").val(),
                  PSCTBasic     : $("#PSCTBasic").val(),
                  PSCTCetak     : $("#PSCTCetak").val(),
                  PSCChassis    : $("#PSCChassis").val(),
                  PSCCabinet    : $("#PSCCabinet").val(),
                  PSCFamily     : $("#PSCFamily").val(),
                  PSCFormat     : $("#PSCFormat").val(),
                  PSCBrand      : $("#PSCBrand").val(),
                  PSCGroupProduct : $("#PSCGroupProduct").val(),
                  PSCJenisProduct : $("#PSCJenisProduct").val(),
                  PSCProduct    : $("#PSCProduct").val(),
                  PSCSubProduct : $("#PSCSubPrd").val(),
                  PSCMarket     : $("#PSCMarket").val(),
                  PSCLotInv     : $("#PSCLotInv").val(),
                  PSCCycle      : $("#PSCCycle").val(),
                  PSCElectronic : $("#PSCElectronic").val(),
                  PSCMDE        : $("#PSCMDE").val(),
                  PSCIDE        : $("#PSCIDE").val(),
                  PSCSW         : $("#PSCSW").val(),
                  PSCHO         : $("#PSCHO").val(),
                  PSCHOGROUP    : $("#PSCHOGROUP").val(),
                  PSCDQAHO      : $("#PSCDQAHO").val(),
                  PSCDSGBP      : $("#PSCDSGBP").val(),
                  PSCPL         : $("#PSCPL").val(),
                  PSCNote       : $("#PSCNote").val(),
                  RNDSection    : RNDSection,
                },
                cache: false,
                success: function (response){
                  var obj = JSON.parse(response);
                  if(isEmpty(obj)) {
                    console.log('Gagal Simpan mas brooo, data kosong');
                  } else if(obj) {
                    if (obj.status == false){
                      Swal.fire({
                        text: obj.message,
                        timer: 1500,
                        icon: 'warning',
                        showConfirmButton: false
                      })
                    } else {
                      Swal.fire({
                        title: 'Berhasil',
                        text: obj.message,
                        timer: 1500,
                        position: 'top-end',
                        icon: 'success',
                        showConfirmButton: false
                      })
                      window.location.href = "./?link=pscindex";
                    }
                  } else {
                    Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
                  }
                },
                error: function () {
                  if (LogoutProtect){
                    // window.location.href = "./?link=loclogout";
                  } else {
                    Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
                  }
                },
              });
            }
          });
      
        }else{
          $.ajax({
            type    : "POST",
            url     : `${restlocpsc}create_headerpsc`,
            headers : {
              user  : vusrnm,
              token : vtoken
            },
            data: {
              IdPSC         : IdEditPSC,
              PSCSupply     : $("#PSCSupply").val(),
              PSCTDemand    : $("#PSCTDemand").val(),
              PSCTBasic     : $("#PSCTBasic").val(),
              PSCTCetak     : $("#PSCTCetak").val(),
              PSCChassis    : $("#PSCChassis").val(),
              PSCCabinet    : $("#PSCCabinet").val(),
              PSCFamily     : $("#PSCFamily").val(),
              PSCFormat     : $("#PSCFormat").val(),
              PSCBrand      : $("#PSCBrand").val(),
              PSCGroupProduct : $("#PSCGroupProduct").val(),
              PSCJenisProduct : $("#PSCJenisProduct").val(),
              PSCProduct    : $("#PSCProduct").val(),
              PSCSubProduct : $("#PSCSubPrd").val(),
              PSCMarket     : $("#PSCMarket").val(),
              PSCLotInv     : $("#PSCLotInv").val(),
              PSCCycle      : $("#PSCCycle").val(),
              PSCElectronic : $("#PSCElectronic").val(),
              PSCMDE        : $("#PSCMDE").val(),
              PSCIDE        : $("#PSCIDE").val(),
              PSCSW         : $("#PSCSW").val(),
              PSCHO         : $("#PSCHO").val(),
              PSCHOGROUP    : $("#PSCHOGROUP").val(),
              PSCDQAHO      : $("#PSCDQAHO").val(),
              PSCDSGBP      : $("#PSCDSGBP").val(),
              PSCPL         : $("#PSCPL").val(),
              PSCNote       : $("#PSCNote").val(),
              RNDSection    : RNDSection,
            },
            cache: false,
            success: function (response){
              var obj = JSON.parse(response);
              if(isEmpty(obj)) {
                console.log('Gagal Simpan mas brooo, data kosong');
              } else if(obj) {
                if (obj.status == false){
                  Swal.fire({
                    text: obj.message,
                    timer: 1500,
                    icon: 'warning',
                    showConfirmButton: false
                  })
                } else {
                  Swal.fire({
                    title: 'Berhasil',
                    text: obj.message,
                    timer: 1500,
                    position: 'top-end',
                    icon: 'success',
                    showConfirmButton: false
                  })
                  window.location.href = "./?link=pscindex";
                }
              } else {
                Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
              }
            },
            error: function () {
              if (LogoutProtect){
                // window.location.href = "./?link=loclogout";
              } else {
                Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
              }
            },
          });
      
        }
      } 
    }else{
      if(dsgbp === '-'){
        Swal.fire({
          title: "<h3>Apakah tidak perlu Buku Petunjuk ?</h3>",
          // text: d,
          icon: "warning",
          confirmButtonText: "Ya",
          showCancelButton: true,
        }).then((result) => {
          if (result.value) {
            $.ajax({
              type    : "POST",
              url     : `${restlocpsc}create_headerpsc`,
              headers : {
                user  : vusrnm,
                token : vtoken
              },
              data: {
                IdPSC         : IdEditPSC,
                PSCSupply     : $("#PSCSupply").val(),
                PSCTDemand    : $("#PSCTDemand").val(),
                PSCTBasic     : $("#PSCTBasic").val(),
                PSCTCetak     : $("#PSCTCetak").val(),
                PSCChassis    : $("#PSCChassis").val(),
                PSCCabinet    : $("#PSCCabinet").val(),
                PSCFamily     : $("#PSCFamily").val(),
                PSCFormat     : $("#PSCFormat").val(),
                PSCBrand      : $("#PSCBrand").val(),
                PSCGroupProduct : $("#PSCGroupProduct").val(),
                PSCJenisProduct : $("#PSCJenisProduct").val(),
                PSCProduct    : $("#PSCProduct").val(),
                PSCSubProduct : $("#PSCSubPrd").val(),
                PSCMarket     : $("#PSCMarket").val(),
                PSCLotInv     : $("#PSCLotInv").val(),
                PSCCycle      : $("#PSCCycle").val(),
                PSCElectronic : $("#PSCElectronic").val(),
                PSCMDE        : $("#PSCMDE").val(),
                PSCIDE        : $("#PSCIDE").val(),
                PSCSW         : $("#PSCSW").val(),
                PSCHO         : $("#PSCHO").val(),
                PSCHOGROUP    : $("#PSCHOGROUP").val(),
                PSCDQAHO      : $("#PSCDQAHO").val(),
                PSCDSGBP      : $("#PSCDSGBP").val(),
                PSCPL         : $("#PSCPL").val(),
                PSCNote       : $("#PSCNote").val(),
                RNDSection    : RNDSection,
              },
              cache: false,
              success: function (response){
                var obj = JSON.parse(response);
                if(isEmpty(obj)) {
                  console.log('Gagal Simpan mas brooo, data kosong');
                } else if(obj) {
                  if (obj.status == false){
                    Swal.fire({
                      text: obj.message,
                      timer: 1500,
                      icon: 'warning',
                      showConfirmButton: false
                    })
                  } else {
                    Swal.fire({
                      title: 'Berhasil',
                      text: obj.message,
                      timer: 1500,
                      position: 'top-end',
                      icon: 'success',
                      showConfirmButton: false
                    })
                    window.location.href = "./?link=pscindex";
                  }
                } else {
                  Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
                }
              },
              error: function () {
                if (LogoutProtect){
                  // window.location.href = "./?link=loclogout";
                } else {
                  Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
                }
              },
            });
          }
        });
    
      }else{
        $.ajax({
          type    : "POST",
          url     : `${restlocpsc}create_headerpsc`,
          headers : {
            user  : vusrnm,
            token : vtoken
          },
          data: {
            IdPSC         : IdEditPSC,
            PSCSupply     : $("#PSCSupply").val(),
            PSCTDemand    : $("#PSCTDemand").val(),
            PSCTBasic     : $("#PSCTBasic").val(),
            PSCTCetak     : $("#PSCTCetak").val(),
            PSCChassis    : $("#PSCChassis").val(),
            PSCCabinet    : $("#PSCCabinet").val(),
            PSCFamily     : $("#PSCFamily").val(),
            PSCFormat     : $("#PSCFormat").val(),
            PSCBrand      : $("#PSCBrand").val(),
            PSCGroupProduct : $("#PSCGroupProduct").val(),
            PSCJenisProduct : $("#PSCJenisProduct").val(),
            PSCProduct    : $("#PSCProduct").val(),
            PSCSubProduct : $("#PSCSubPrd").val(),
            PSCMarket     : $("#PSCMarket").val(),
            PSCLotInv     : $("#PSCLotInv").val(),
            PSCCycle      : $("#PSCCycle").val(),
            PSCElectronic : $("#PSCElectronic").val(),
            PSCMDE        : $("#PSCMDE").val(),
            PSCIDE        : $("#PSCIDE").val(),
            PSCSW         : $("#PSCSW").val(),
            PSCHO         : $("#PSCHO").val(),
            PSCHOGROUP    : $("#PSCHOGROUP").val(),
            PSCDQAHO      : $("#PSCDQAHO").val(),
            PSCDSGBP      : $("#PSCDSGBP").val(),
            PSCPL         : $("#PSCPL").val(),
            PSCNote       : $("#PSCNote").val(),
            RNDSection    : RNDSection,
          },
          cache: false,
          success: function (response){
            var obj = JSON.parse(response);
            if(isEmpty(obj)) {
              console.log('Gagal Simpan mas brooo, data kosong');
            } else if(obj) {
              if (obj.status == false){
                Swal.fire({
                  text: obj.message,
                  timer: 1500,
                  icon: 'warning',
                  showConfirmButton: false
                })
              } else {
                Swal.fire({
                  title: 'Berhasil',
                  text: obj.message,
                  timer: 1500,
                  position: 'top-end',
                  icon: 'success',
                  showConfirmButton: false
                })
                window.location.href = "./?link=pscindex";
              }
            } else {
              Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
            }
          },
          error: function () {
            if (LogoutProtect){
              // window.location.href = "./?link=loclogout";
            } else {
              Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
            }
          },
        });
    
      }
    } 
  });


  $('#HeaderButtonBack').on('click', function() {
    window.location.href = "./?link=pscindex";
  });

  $('#tabcompare').on('click', function() {
    window.location.href = "./?link=psccompare";
  });

  $('.tabuserguide').on('click', function() {
    window.location.href = "./?link=guidepsc";
  });
  $('.tabsuratgolive').on('click', function() {
    window.location.href = "./?link=golivepsc";
  });
  $('.tabhasilmonitoring').on('click', function() {
    window.location.href = "./?link=monitorpsc";
  });
  $('.tabversion').on('click', function() {
    window.location.href = "./?link=versionhistory&app=PSC";
  });


  // $('.ui.dropdown').dropdown({ fullTextSearch: true });
  $('.ui.dropdown.fullsearch').dropdown( {fullTextSearch:'exact', sortSelect: true, match:'text'} );

  $('.ui.accordion').accordion({
    onChange: function() {
      $.ajax({
        type    : "POST",
        url     : `${restlocpsc}save_statehimbauan`,
        headers : {
          user  : vusrnm,
          token : vtoken
        },
        data: {
          Application  : "PSC",
          User  : vusrnm,
          Tabel : "HIMBAUAN",
        },
        cache: false,
        success: function (response){
          var obj = JSON.parse(response);
          if(isEmpty(obj)) {
            console.log('data kosong');
          } else if(obj) {
            console.log('state-saved');
          } else {
            console.log('Ada kendal di koneksi/database, data tidak tersimpan !');
          }
        },
        error: function () {
          if (LogoutProtect){
            window.location.href = "./?link=loclogout";
          } else {
            Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
          }
        },
      });
    },
    onClosing: function() {
      Swal.fire({
      title: "<h4>Pastikan anda telah memahami <br>Himbauan Alternatif Prosedur Sign/Approval saat <br>PIC Sign/Approval Tugas Keluar/Cuti/WFH</h4>",
      confirmButtonText: "Ya, saya sudah paham",
      showCancelButton: false,
    })
    }
   
  });



  
  // $('#PSCGroupProduct').on('change', function() {
  //   var vusrnm  = getCookie('usrnm');
  //   var vtoken  = getCookie('token');
  //   var nmgrup  = $(this).val();
  //   $('#PSCJenisProduct').empty();
  //   $('#PSCJenisProduct').dropdown("clear");
  //   $('#PSCJenisProduct').dropdown("set selected", '');

  //   $.ajax({
  //     type    : "POST",
  //     url     : `${restlocpsc}readsubprd`,
  //     headers : {
  //       user  : vusrnm,
  //       token : vtoken
  //     },
  //     data: {
  //       nmgrup    : nmgrup,
  //     },
  //     cache: false,

  //     success: function (response){
  //       var obj = JSON.parse(response);
  //       if(isEmpty(obj)) {
  //         console.log('Gagal loading, data kosong');
  //       } else if(obj) {
          
  //         $('#PSCJenisProduct').append('<option value="">Jenis Produk</option>');
  //         for (a = 0; a < obj.length; a++) { 
  //           if(obj[a][0]){
  //             $('#PSCJenisProduct').append( '<option value="'+obj[a][0]+'">'+obj[a][0]+'</option>' );
  //           }
  //         }

  //       } else {
  //         Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
  //       }
  //     },

  //     error: function () {
  //       if (LogoutProtect){
  //         window.location.href = "./?link=loclogout";
  //       } else {
  //         Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
  //       }
  //     },
  //   });
  // });

  // $('#PSCJenisProduct').on('change', function() {
  //   var vusrnm  = getCookie('usrnm');
  //   var vtoken  = getCookie('token');
  //   var nmgrup  = $('#PSCGroupProduct').val();
  //   var namasub  = $(this).val();
  //   $('#PSCProduct').empty();
  //   $('#PSCProduct').dropdown("clear");
  //   $('#PSCProduct').dropdown("set selected", '');

  //   $.ajax({
  //     type    : "POST",
  //     url     : `${restlocpsc}readcatprd`,
  //     headers : {
  //       user  : vusrnm,
  //       token : vtoken
  //     },
  //     data: {
  //       namasub   : namasub,
  //       nmgrup    : nmgrup,
  //     },
  //     cache: false,

  //     success: function (response){
  //       var obj = JSON.parse(response);
  //       if(isEmpty(obj)) {
  //         console.log('Gagal loading, data kosong');
  //       } else if(obj) {
  //         $('#PSCProduct').append('<option value="">Jenis Produk</option>');
  //         for (a = 0; a < obj.length; a++) { 
  //           if(obj[a][0]){
  //             $('#PSCProduct').append( '<option value="'+obj[a][0]+'">'+obj[a][0]+'</option>' );
  //           }
  //         }
  //       } else {
  //         Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
  //       }
  //     },

  //     error: function () {
  //       if (LogoutProtect){
  //         window.location.href = "./?link=loclogout";
  //       } else {
  //         Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
  //       }
  //     },
  //   });
  // });
});

function ReadHimbauanState(){
  $.ajax({
    type    : "POST",
    url     : `${restlocpsc}read_statehimbauan`,
    headers : {
      user  : vusrnm,
      token : vtoken
    },
    data: {
      Application  : "PSC",
      User  : vusrnm,
      Tabel : "HIMBAUAN",
    },
    cache: false,
    success: function (response){
      var obj = JSON.parse(response);
      if(isEmpty(obj)) {
        setTimeout(function() { 
            $(".AccTitleHimbauan").addClass("active");
          }, 50);
      } else if(obj) {
        if(obj[0]['Kondisi'] === 'CLOSE'){
          setTimeout(function() { 
            $(".AccTitleHimbauan").removeClass("active");
          }, 50);
        } else {
          setTimeout(function() { 
            $(".AccTitleHimbauan").addClass("active");
          }, 50);
        }
      } 
    },
    error: function () {
      if (LogoutProtect){
        window.location.href = "./?link=loclogout";
      } else {
        Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
      }
    },
  });

}

