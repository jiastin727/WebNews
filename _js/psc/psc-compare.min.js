$(".ui.dropdown").dropdown();
$(".menu .item").tab();

// Global Variable
const NonceValue = "rdsystem2020";
const LogoutProtect = true;

var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocpsc = decodeURIComponent(getCookie("restlocpsc"));
var restlocpscxls = decodeURIComponent(getCookie("restlocpscxls"));
let Ucrypt = new Encryption();
// var Udecrypt = Ucrypt.decrypt(EncU, NonceValue);


if(idpsc){
  $.ajax({
    url: `${restlocpsc}comparepsc`,
    type: "POST",
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      PSCId1     : PSCId1,
      PSCId2     : PSCId2,
      PSCId3     : PSCId3,
      c_product  : PscPrd,
      c_jenisprd : PscJPrd,
    },
    success: function (response) {
      var obj = JSON.parse(response);
      if (isEmpty(obj)) {
        console.log("Gagal load, data kosong");
        return false;

      } else if (obj) {
        $('#TableContent').find("tbody").append(
          "<tr style='background-color: #e2e4cc;height: 35px;'>"+
          "<td width='34%' class='left aligned' ><b>LIST OF CONTENTS</b></td>"+
          "<td width='22%' class='left aligned' ><b>"+PSCType1+"</b><br>"+PSCTypeD1+"</td>"+
          "<td width='22%' class='left aligned' ><b>"+PSCType2+"</b><br>"+PSCTypeD2+"</td>"+
          "<td width='22%' class='left aligned' ><b>"+PSCType3+"</b><br>"+PSCTypeD3+"</td>"+
        "</tr>"
        );
        jmlDataa = Object.keys(obj["read_content"]).length;
        for (a = 0; a < jmlDataa; a++) {
          var cont_a  = obj["read_content"][a]['c_name'];
          var val_a   = obj["read_content"][a]['VAL1'];
          var val_a2  = obj["read_content"][a]['VAL2'];
          var val_a3  = obj["read_content"][a]['VAL3'];
          var diff_a  = obj["read_content"][a]['diff'];
          if((val_a === null)  || (typeof val_a  === "undefined")){ val_a =""; }
          if((val_a2 === null) || (typeof val_a2 === "undefined")){ val_a2 =""; }
          if((val_a3 === null) || (typeof val_a3 === "undefined")){ val_a3 =""; }
          if(diff_a > 1){ var collordiff_a = "#960909"; } else {var collordiff_a = "#000";}
          $('#TableContent').find("tbody").append(
            "<tr>"+
            "<td width='34%' class='left aligned' ><b>"+cont_a+"</b></td>"+
            "<td style='color: "+collordiff_a+";' width='22%' class='left aligned' >"+val_a+"</td>"+
            "<td style='color: "+collordiff_a+";' width='22%' class='left aligned' >"+val_a2+"</td>"+
            "<td style='color: "+collordiff_a+";' width='22%' class='left aligned' >"+val_a3+"</td>"+
          "</tr>"
          );
          if (typeof obj["read_content"][a]['nodes'] !== "undefined") {
            jmlDatab = obj["read_content"][a]['nodes'].length;
            for (b = 0; b < jmlDatab; b++) {
              var cont_b  = obj["read_content"][a]['nodes'][b]['c_name'];
              var input_b = obj["read_content"][a]['nodes'][b]['c_input'];
              var val_b   = obj["read_content"][a]['nodes'][b]['VAL1'];
              var val_b2  = obj["read_content"][a]['nodes'][b]['VAL2'];
              var val_b3  = obj["read_content"][a]['nodes'][b]['VAL3'];
              var diff_b  = obj["read_content"][a]['nodes'][b]['diff'];
              if(input_b ==="IMAGE") {
                if(val_b){
                  var val_b = "<img width='250' src='../RND_Upload/ProductSpec/"+val_b+"'>"
                }
                if(val_b2){
                  var val_b2 = "<img width='250' src='../RND_Upload/ProductSpec/"+val_b2+"'>"
                }
                if(val_b3){
                  var val_b3 = "<img width='250' src='../RND_Upload/ProductSpec/"+val_b3+"'>"
                }
              }
              if((val_b === null) || (typeof val_b  === "undefined")){ val_b =""; }
              if((val_b2 === null) || (typeof val_b2  === "undefined")){ val_b2 =""; }
              if((val_b3 === null) || (typeof val_b3  === "undefined")){ val_b3 =""; }
              if(diff_b > 1){ var collordiff_b = "#960909"; } else {var collordiff_b = "#000";}
              $('#TableContent').find("tbody").append(
                "<tr>"+
                "<td width='34%' class='left aligned' >&nbsp;&nbsp;&nbsp;&nbsp;"+cont_b+"</td>"+
                "<td style='color: "+collordiff_b+";' width='22%' class='left aligned' >"+val_b+"</td>"+
                "<td style='color: "+collordiff_b+";' width='22%' class='left aligned' >"+val_b2+"</td>"+
                "<td style='color: "+collordiff_b+";' width='22%' class='left aligned' >"+val_b3+"</td>"+
              "</tr>"
              );


              if (typeof obj["read_content"][a]['nodes'][b]['nodes'] !== "undefined") {
                jmlDatac = obj["read_content"][a]['nodes'][b]['nodes'].length;
                for (c = 0; c < jmlDatac; c++) {
                  var cont_c  = obj["read_content"][a]['nodes'][b]['nodes'][c]['c_name'];
                  var input_c = obj["read_content"][a]['nodes'][b]['nodes'][c]['c_input'];
                  var val_c   = obj["read_content"][a]['nodes'][b]['nodes'][c]['VAL1'];
                  var val_c2  = obj["read_content"][a]['nodes'][b]['nodes'][c]['VAL2'];
                  var val_c3  = obj["read_content"][a]['nodes'][b]['nodes'][c]['VAL3'];
                  var diff_c  = obj["read_content"][a]['nodes'][b]['nodes'][c]['diff'];
                  if(input_c ==="IMAGE") {
                    if(val_c){
                      var val_c = "<img width='250' src='../RND_Upload/ProductSpec/"+val_c+"'>"
                    }
                    if(val_c2){
                      var val_c2 = "<img width='250' src='../RND_Upload/ProductSpec/"+val_c2+"'>"
                    }
                    if(val_c3){
                      var val_c3 = "<img width='250' src='../RND_Upload/ProductSpec/"+val_c3+"'>"
                    }
                  }
                  if((val_c === null) || (typeof val_c  === "undefined")){ val_c =""; }
                  if((val_c2 === null) || (typeof val_c2  === "undefined")){ val_c2 =""; }
                  if((val_c3 === null) || (typeof val_c3  === "undefined")){ val_c3 =""; }
                  if(diff_c > 1){ var collordiff_c = "#960909"; } else {var collordiff_c = "#000";}
                  $('#TableContent').find("tbody").append(
                    "<tr>"+
                    "<td width='34%' class='left aligned' >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+cont_c+"</td>"+
                    "<td style='color: "+collordiff_c+";' width='22%' class='left aligned' >"+val_c+"</td>"+
                    "<td style='color: "+collordiff_c+";' width='22%' class='left aligned' >"+val_c2+"</td>"+
                    "<td style='color: "+collordiff_c+";' width='22%' class='left aligned' >"+val_c3+"</td>"+
                  "</tr>"
                  );


                  if (typeof obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'] !== "undefined") {
                    jmlDatad = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'].length;
                    for (d = 0; d < jmlDatad; d++) {
                      var cont_d  = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['c_name'];
                      var input_d = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['c_input'];
                      var val_d   = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['VAL1'];
                      var val_d2  = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['VAL2'];
                      var val_d3  = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['VAL3'];
                      var diff_d  = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['diff'];
                      if(input_d ==="IMAGE") {
                        if(val_d){
                          var val_d = "<img width='250' src='../RND_Upload/ProductSpec/"+val_d+"'>"
                        }
                        if(val_d2){
                          var val_d2 = "<img width='250' src='../RND_Upload/ProductSpec/"+val_d2+"'>"
                        }
                        if(val_d3){
                          var val_d3 = "<img width='250' src='../RND_Upload/ProductSpec/"+val_d3+"'>"
                        }
                      }
                      if((val_d === null) || (typeof val_d  === "undefined")){ val_d =""; }
                      if((val_d2 === null) || (typeof val_d2  === "undefined")){ val_d2 =""; }
                      if((val_d3 === null) || (typeof val_d3  === "undefined")){ val_d3 =""; }
                      if(diff_d > 1){ var collordiff_d = "#960909"; } else {var collordiff_d = "#000";}
                      $('#TableContent').find("tbody").append(
                        "<tr>"+
                        "<td width='34%' class='left aligned' >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+cont_d+"</td>"+
                        "<td style='color: "+collordiff_d+";' width='22%' class='left aligned' >"+val_d+"</td>"+
                        "<td style='color: "+collordiff_d+";' width='22%' class='left aligned' >"+val_d2+"</td>"+
                        "<td style='color: "+collordiff_d+";' width='22%' class='left aligned' >"+val_d3+"</td>"+
                      "</tr>"
                      );

                      if (typeof obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['nodes'] !== "undefined") {
                        jmlDatae = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['nodes'].length;
                        for (e = 0; e < jmlDatae; e++) {
                          var cont_e  = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['nodes'][e]['c_name'];
                          var input_e = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['nodes'][e]['c_input'];
                          var val_e   = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['nodes'][e]['VAL1'];
                          var val_e2  = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['nodes'][e]['VAL2'];
                          var val_e3  = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['nodes'][e]['VAL3'];
                          var diff_e  = obj["read_content"][a]['nodes'][b]['nodes'][c]['nodes'][d]['nodes'][e]['diff'];
                          if(input_e ==="IMAGE") {
                            if(val_e){
                              var val_e = "<img width='250' src='../RND_Upload/ProductSpec/"+val_e+"'>"
                            }
                            if(val_e2){
                              var val_e2 = "<img width='250' src='../RND_Upload/ProductSpec/"+val_e2+"'>"
                            }
                            if(val_e3){
                              var val_e3 = "<img width='250' src='../RND_Upload/ProductSpec/"+val_e3+"'>"
                            }
                          }
                          if((val_e === null) || (typeof val_e  === "undefined")){ val_e =""; }
                          if((val_e2 === null) || (typeof val_e2  === "undefined")){ val_e2 =""; }
                          if((val_e3 === null) || (typeof val_e2  === "undefined")){ val_e3 =""; }
                          if(diff_e > 1){ var collordiff_e = "#960909"; } else {var collordiff_e = "#000";}
                          $('#TableContent').find("tbody").append(
                            "<tr>"+
                            "<td width='34%' class='left aligned' >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+cont_e+"</td>"+
                            "<td style='color: "+collordiff_e+";' width='22%' class='left aligned' >"+val_e+"</td>"+
                            "<td style='color: "+collordiff_e+";' width='22%' class='left aligned' >"+val_e2+"</td>"+
                            "<td style='color: "+collordiff_e+";' width='22%' class='left aligned' >"+val_e3+"</td>"+
                          "</tr>"
                          );
            
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  })
}


$('#TypeA').dropdown('clear');
$('#TypeA').dropdown('set selected',PSCType1);

$('#TypeB').dropdown('clear');
$('#TypeB').dropdown('set selected',PSCType2);

$('#TypeC').dropdown('clear');
$('#TypeC').dropdown('set selected',PSCType3);


$(document).ready(function () {

  $('#TypeA').on('change', function() {
    var id_a = $('#TypeA').val();
    var id_b = '';
    var id_c = '';
    var AllID = id_a+"|"+id_b+"|"+id_c;
    var nonceValue = decodeURIComponent(getCookie("nonceValue"));
    let encryption = new Encryption();
    var allidtype = encryption.encrypt(AllID, nonceValue);
    window.location.href = "./?link=psccompare&t="+allidtype;
    // window.location.href = "./?link=psccompare&t="+id_a;
  });

  $('#TypeB, #TypeC').on('change', function() {
    var id_a = $('#TypeA').val();
    var id_b = $('#TypeB').val();
    var id_c = $('#TypeC').val();
    var AllID = id_a+"|"+id_b+"|"+id_c;
    var nonceValue = decodeURIComponent(getCookie("nonceValue"));
    let encryption = new Encryption();
    var allidtype = encryption.encrypt(AllID, nonceValue);
    window.location.href = "./?link=psccompare&t="+allidtype;
    // window.location.href = "./?link=psccompare&t="+id_a;
  });

  $('#resetcompare').on('click', function() {
    window.location.href = "./?link=psccompare";
  });
 
  $('#downloalcompare').on('click', function() {
    var id_1 = $('#TypeA').val();
    var id_2 = $('#TypeB').val();
    var id_3 = $('#TypeC').val();
    var c_p  = PscPrd;
    var c_j = PscJPrd;

    $.ajax({
      type    : "GET",
      url     : `${restlocpscxls}comparespec`,
      headers : {
        user  : vusrnm,
        token : vtoken
      },
      data: {
        id_1    : id_1,
        id_2    : id_2,
        id_3    : id_3,
        c_p     : c_p,
        c_j     : c_j,
      },
      cache: false,
      success: function (response){
        
        console.log('berhasil');
        window.location.href = "../RND_Upload/Excel/PSC/CompareProductSpec"+id_1+id_2+id_3+".xlsx";
      },
      error: function () {
       Swal.fire("Error", "Download Product Specification (Excel) Gagal !","error" );
      },
    });
  });
  
  $('#downloalcomparepdf').on('click', function() {
    var id_1 = $('#TypeA').val();
    var id_2 = $('#TypeB').val();
    var id_3 = $('#TypeC').val();
    var c_p  = PscPrd;
    var c_j = PscJPrd;
    window.location.href = "./?link=psccomparepdf&id1="+id_1+"&id2="+id_2+"&id3="+id_3+"&jenis="+c_j+"&prd="+c_p;
    // window.location.href = `./1_productspec/download_comparepdf.php?id1=${id_1}&id2=${id_2}&id3=${id_3}&jenis=${c_j}&prd=${c_p}`;
  });
 

  $('#tabpsclist').on('click', function() {
    window.location.href = "./?link=pscindex";
  });

  $('#tabcompare').on('click', function() {
    window.location.href = "./?link=psccompare";
  });

  $('#DownloadNPI').on('click', function() {
    window.location.href = `./1_productspec/createpptx.php?id=${idpsc}`;
  });

  $('.tabuserguide').on('click', function() {
    window.location.href = "./?link=guidepsc";
  });
  $('.tabsuratgolive').on('click', function() {
    window.location.href = "./?link=golivepsc";
  });
  $('.tabhasilmonitoring').on('click', function() {
    window.location.href = "./?link=monitorpsc";
  });
  $('.tabversion').on('click', function() {
    window.location.href = "./?link=versionhistory&app=PSC";
  });

});



