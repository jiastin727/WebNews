const LogoutProtect = false;

var GetCookieAllPIC = decodeURIComponent(getCookie("CooAllPIC"));
var ArryAllPIC   = GetCookieAllPIC.split(", ");
var restlocpscxls = decodeURIComponent(getCookie("restlocpscxls"));

function TableListFunc() {  
  var JsonFilter = getCookie('FilterMPPKebutuhan');
  var ArrayF = JSON.parse(JsonFilter);

  if(JsonFilter){
    var SearchF   = ArrayF[0];
    var SalesF    = ArrayF[1];
    var ResinF    = ArrayF[2];
    var ColorF    = ArrayF[3];
  } else {
    var SearchF   = "";
    var SalesF    = "ALL";
    var ResinF    = "ALL";
    var ColorF    = "ALL";
  }

  if (SearchF) {
    $("#fcari_mpp").val(SearchF);
    var SearchFStart = SearchF;
  } else {
    var SearchFStart = "";
  }
  if (SalesF) {
    $("#fsales_mpp").dropdown("set selected", SalesF);
    var SalesFStart = SalesF;
  } else {
    var SalesFStart = "ALL";
  }
  if (ResinF) {
    $("#fresin_mpp").dropdown("set selected", ResinF);
    var ResinFStart = ResinF;
  } else {
    var ResinFStart = "ALL";
  }
  if (ColorF) {
    $("#fcolor_mpp").dropdown("set selected", ColorF);
    var ColorFStart = ColorF;
  } else {
    var ColorFStart = "ALL";
  }

  var FiterArry = [SearchFStart, SalesFStart, ResinFStart, ColorFStart];
  var JsonFilter = JSON.stringify(FiterArry);
  setCookie("FilterMPPKebutuhan", JsonFilter, 5);


  $("#TableList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned seven wide column'>" +
      "<'left aligned two wide column'>" +
      "<'right aligned seven wide column'>" +
      ">" +
      ">",
    destroy     : true,
    stateSave   : true,
    processing  : true,
    deferRender : true,
    serverSide  : true,
    orderClasses: false,
    ordering    : false,
    scrollX     : true,
    scrollCollapse: true,
    paging      : true,
    scrollY     : '50vh',
    scroller: {
      loadingIndicator: true
    },
    fixedColumns:   {
      leftColumns: 6
    },
    data        : [],
    language    : {
      sLengthMenu : "_MENU_",
      search      : "",
      searchPlaceholder: "Pencarian..",
      processing  : '<i class="spinner loading icon huge"></i>',
      info        : "_START_ sampai _END_ dari _TOTAL_ total data",
      paginate    : {
        "first"   : "Awal",
        "last"    : "Akhir",
        "next"    : "<i class='chevron right icon'></i>",
        "previous": "<i class='chevron left icon'></i>"
      },
      infoEmpty   : "Tidak ada data",
      select  : {
        rows  : ""
      }
    },
    order     : [[1, "desc"]],
    columns   : [
      { data: null,
        render: function (data) {

          if (ArryAllPIC.includes(DUser)){
            if(data['Resin']!=='' && data['Resin']!=='-'){
            return `<span class="BtnEditKebutuhan clicklink" eid="${data['IdItemMPP']}" edesc="${data['IdItemMPP']}" esc="${data['SalesContract']}" data-tooltip="Edit Item MPP" data-inverted="" data-position="right center"><i class="pencil alternate link circular blue icon "></i></span>`;
            } else {
              return '';
            }
          } else {
            return '';
          }
        },
      },
      { data  : 'SalesContract' },
      { data  : 'NoItem' },
      { data  : 'Description' },
      { data  : 'DrawingNum' },
      { data  : 'Cavity' },
      { data  : 'CavShoot' },
      { data  : 'StdUsed' },
      { data  : 'VendorName' },
      { data  : 'VendorCode' },
      { data  : 'Curr' },      
      { data  : 'DrawingLoc' },
      { data  : 'WbsProject' },
      { data  : 'Resin' },
      { data  : 'Brand' },
      { data  : 'Grade' },
      { data  : 'ResinMatNum' },
      { data  : 'ResinMatDescript' },
      { data  : 'ColorType' },
      { data  : 'BasedResin' },
      { data  : 'Color' },
      { data  : 'ColorPercent' },
      { data  : 'ColorMatNum' },
      { data  : 'ColorMatDescrip' },
      { data  : 'ColorVend' },
      { data  : 'Tonnage' },
      { data  : 'RunnerWeight' },
      { data  : 'ProductWeight' },
      { data  : 'TotalWeight' },
      { data  : 'PSSTD' },
      { data  : 'T1ID' },
      { data  : 'T1MD' },
      { data  : 'T1PL' },
      { data  : 'T1MSCP' },
      { data  : 'T1SC' },
      { data  : 'T1Total' },
      { data  : 'T1MB' },
      { data  : 'T1Resin' },
      { data  : 'T2ID' },
      { data  : 'T2MD' },
      { data  : 'T2PL' },
      { data  : 'T2SC' },
      { data  : 'T2Total' },
      { data  : 'T2MB' },
      { data  : 'T2Resin' },
      { data  : 'T3ID' },
      { data  : 'T3MD' },
      { data  : 'T3PL' },
      { data  : 'T3SC' },
      { data  : 'T3Total' },
      { data  : 'T3MB' },
      { data  : 'T3Resin' },
      { data  : 'T4ID' },
      { data  : 'T4MD' },
      { data  : 'T4PL' },
      { data  : 'T4SC' },
      { data  : 'T4Total' },
      { data  : 'T4MB' },
      { data  : 'T4Resin' },
      { data  : 'T5ID' },
      { data  : 'T5MD' },
      { data  : 'T5PL' },
      { data  : 'T5SC' },
      { data  : 'T5Total' },
      { data  : 'T5MB' },
      { data  : 'T5Resin' },
      { data  : 'TFID' },
      { data  : 'TFMD' },
      { data  : 'TFPL' },
      { data  : 'TFSC' },
      { data  : 'TFTotal' },
      { data  : 'TFMB' },
      { data  : 'TFResin' },
    ],
    columnDefs: [
      { className : "center aligned", targets: [0,2,4,5,6,7,21] },
      { className : "right aligned", targets: [23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70] },
      { render: function ( data, type, row ) {
          return data ? roundUp(1*data,2) : '';//$.number
          // return data ? $.number(data,2,',','.') : '';//$.number
        },
        targets: [ 36,37,43,44,50,51,57,58,64,65,71,72 ]  
      }
    ],
    createdRow: function (row, data, index) {

      //WARNA FREEZE LEFT COLUMNS 
      $(row).find("td:eq(5)").css("border-right", "inset");
      $(row).find("td:eq(5)").css("border-right-color", ColorBorderFreeze);

      var arympp = data['NoItem'].split('-');
      var nompp = arympp[1]+'-'+arympp[2]+'-'+arympp[3];
      if (nompp ==="00-00-00"){
        $(row).find("td").css("background-color", BgColor000000);
      } 
      if (data['Cavity'] ==="INSERT"){
        $(row).find("td").css("background-color", BgColorInsert);
      } 

      if(DSect ==='MECHANICAL DESIGN+PROTOTYPE' && DJbtn !=='PROJECT LEADER'){
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1MD']==='' || data['T1MD']===null || data['T2MD']==='' || data['T2MD']===null || data['T3MD']==='' || data['T3MD']===null || data['T4MD']==='' || data['T4MD']===null || data['T5MD']==='' || data['T5MD']===null || data['TFMD']==='' || data['TFMD']===null)){
          $(row).find("td").css("color", ColorKebNull);
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1MD']==='' || data['T1MD']===null )){
          $(row).find("td:eq(31)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T2MD']==='' || data['T2MD']===null )){
          $(row).find("td:eq(39)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T3MD']==='' || data['T3MD']===null )){
          $(row).find("td:eq(46)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T4MD']==='' || data['T4MD']===null )){
          $(row).find("td:eq(53)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T5MD']==='' || data['T5MD']===null )){
          $(row).find("td:eq(60)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['TFMD']==='' || data['TFMD']===null )){
          $(row).find("td:eq(67)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
      }

      if(DSect ==='INDUSTRIAL DESIGN' && DJbtn !=='PROJECT LEADER'){
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1ID']==='' || data['T1ID']===null || data['T2ID']==='' || data['T2ID']===null || data['T3ID']==='' || data['T3ID']===null || data['T4ID']==='' || data['T4ID']===null || data['T5ID']==='' || data['T5ID']===null || data['TFID']==='' || data['TFID']===null)){
          $(row).find("td").css("color", ColorKebNull);
        }

        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1ID']==='' || data['T1ID']===null )){
          $(row).find("td:eq(30)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T2ID']==='' || data['T2ID']===null )){
          $(row).find("td:eq(38)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T3ID']==='' || data['T3ID']===null )){
          $(row).find("td:eq(45)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T4ID']==='' || data['T4ID']===null )){
          $(row).find("td:eq(52)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T5ID']==='' || data['T5ID']===null )){
          $(row).find("td:eq(59)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['TFID']==='' || data['TFID']===null )){
          $(row).find("td:eq(66)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }

      }

      if(DJbtn ==='PROJECT LEADER'){
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1PL']==='' || data['T1PL']===null || data['T2PL']==='' || data['T2PL']===null || data['T3PL']==='' || data['T3PL']===null || data['T4PL']==='' || data['T4PL']===null || data['T5PL']==='' || data['T5PL']===null || data['TFPL']==='' || data['TFPL']===null)){
          $(row).find("td").css("color", ColorKebNull);
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1PL']==='' || data['T1PL']===null )){
          $(row).find("td:eq(32)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T2PL']==='' || data['T2PL']===null )){
          $(row).find("td:eq(40)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T3PL']==='' || data['T3PL']===null )){
          $(row).find("td:eq(47)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T4PL']==='' || data['T4PL']===null )){
          $(row).find("td:eq(54)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T5PL']==='' || data['T5PL']===null )){
          $(row).find("td:eq(61)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['TFPL']==='' || data['TFPL']===null )){
          $(row).find("td:eq(68)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
      }

      if(DSect ==='MULTI SOURCING' && DJbtn !=='PROJECT LEADER'){
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1MSCP']==='' || data['T1MSCP']===null )){
          $(row).find("td").css("color", ColorKebNull);
          $(row).find("td:eq(33)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }

        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1ID']==='' || data['T1ID']===null )){
          $(row).find("td:eq(30)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T2ID']==='' || data['T2ID']===null )){
          $(row).find("td:eq(38)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T3ID']==='' || data['T3ID']===null )){
          $(row).find("td:eq(45)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T4ID']==='' || data['T4ID']===null )){
          $(row).find("td:eq(52)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T5ID']==='' || data['T5ID']===null )){
          $(row).find("td:eq(59)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['TFID']==='' || data['TFID']===null )){
          $(row).find("td:eq(66)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }


        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1MD']==='' || data['T1MD']===null )){
          $(row).find("td:eq(31)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T2MD']==='' || data['T2MD']===null )){
          $(row).find("td:eq(39)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T3MD']==='' || data['T3MD']===null )){
          $(row).find("td:eq(46)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T4MD']==='' || data['T4MD']===null )){
          $(row).find("td:eq(53)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T5MD']==='' || data['T5MD']===null )){
          $(row).find("td:eq(60)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['TFMD']==='' || data['TFMD']===null )){
          $(row).find("td:eq(67)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }


        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T1PL']==='' || data['T1PL']===null )){
          $(row).find("td:eq(32)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T2PL']==='' || data['T2PL']===null )){
          $(row).find("td:eq(40)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T3PL']==='' || data['T3PL']===null )){
          $(row).find("td:eq(47)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T4PL']==='' || data['T4PL']===null )){
          $(row).find("td:eq(54)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['T5PL']==='' || data['T5PL']===null )){
          $(row).find("td:eq(61)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }
        if((nompp ==="00-00-00" || data['Cavity'] ==="INSERT" ) && (data['TFPL']==='' || data['TFPL']===null )){
          $(row).find("td:eq(68)").html("<i class='exclamation triangle orange disabled icon'></i>");
        }

      }


      if ( data['Diff'] !== 'null' && data['Diff'] !== null) {
        
        var CollIndex = ['col0','sales_contract','no','description','drawing_number','cavity','cav_shoot','drawing_loc','std_use','resin','wbs_project','brand','grade','manuf','code','curr','resin_mat_num','resin_description','color_type','based_resin','color','color_percent','color_mat_num','color_mat_descript','color_vend','tonnage_ton','runner','product','total_weight_shoot_g','psstd','t1_id','t1_md','t1_pl','t1_mscp','t1_total','t1_mb','t1_resin','t2_id','t2_md','t2_pl','t2_total','t2_mb','t2_resin','t3_id','t3_md','t3_pl','t3_total','t3_mb','t3_resin','t4_id','t4_md','t4_pl','t4_total','t4_mb','t4_resin','t5_id','t5_md','t5_pl','t5_total','t5_mb','t5_resin','tf_id','tf_md','tf_pl','tf_total','tf_mb','tf_resin'];

        if (data['Diff'] === "*") {
          $(row).find("td").css("color", ColorAllDiff);
          $(row).find("td").css("font-weight", 'bold');
        } else {
          var AryDiff = data['Diff'].split(',');
          var LenDiff = AryDiff.length;
          for (let i = 0; i < LenDiff; i++) {
            var index = CollIndex.findIndex((col) => col === AryDiff[i]);
            $(row).find("td:eq("+index+")").css("color", ColorItemDiff);
            $(row).find("td:eq("+index+")").css("font-weight", 'bold');
            if(index>0){
              $(row).find("td:eq(1)").css("color", ColorItemDiff);
              $(row).find("td:eq(1)").css("font-weight", 'bold');
            }
          }
        }

        $('#FeatureNotifQty').html('<table><tr><td width="500px" valign="top"><div class="ui negative message"><div class="header">Perhatian</div><p>Dalam tabel kebutuhan ini ada material/qty yang berubah dibandingkan dengan MPP sebelum revisi ini!</p></div></td></tr></table>');

      }

    },

    footerCallback: function ( row, data, start, end, display ) {
      var api = this.api(), data;
  
      // Remove the formatting to get integer data for summation
      var intVal = function ( i ) {
          return typeof i === 'string' ?
              i.replace(/[\$,]/g, '')*1 :
              typeof i === 'number' ?
                  i : 0;
      };
  
      // Total over this page
      TotalMBT1 = api.column( 36, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST1 = api.column( 37, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBT2 = api.column( 43, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST2 = api.column( 44, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBT3 = api.column( 50, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST3 = api.column( 51, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBT4 = api.column( 57, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST4 = api.column( 58, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBT5 = api.column( 64, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST5 = api.column( 65, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBTF = api.column( 71, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRSTF = api.column( 72, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );

      // Update footer
      $( api.column( 36 ).footer() ).html('<b>'+TotalMBT1+'</b>');
      $( api.column( 37 ).footer() ).html('<b>'+TotalRST1+'</b>');
      $( api.column( 43 ).footer() ).html('<b>'+TotalMBT2+'</b>');
      $( api.column( 44 ).footer() ).html('<b>'+TotalRST2+'</b>');
      $( api.column( 50 ).footer() ).html('<b>'+TotalMBT3+'</b>');
      $( api.column( 51 ).footer() ).html('<b>'+TotalRST3+'</b>');
      $( api.column( 57 ).footer() ).html('<b>'+TotalMBT4+'</b>');
      $( api.column( 58 ).footer() ).html('<b>'+TotalRST4+'</b>');
      $( api.column( 64 ).footer() ).html('<b>'+TotalMBT5+'</b>');
      $( api.column( 65 ).footer() ).html('<b>'+TotalRST5+'</b>');
      $( api.column( 71 ).footer() ).html('<b>'+TotalMBTF+'</b>');
      $( api.column( 72 ).footer() ).html('<b>'+TotalRSTF+'</b>');
    },
   
    ajax      : {
      url     : '../RND_BackEnd/backend_mpp/kebutuhan/load-detail/'+IdMPP,
      type    : "POST",
      headers : {
        user  : VUserName,
        token : VToken,
      },
      data    : {
        FSearch   : SearchFStart,
        FSales    : SalesFStart,
        FResin    : ResinFStart,
        FColor    : ColorFStart,
      },
      error: function () {
        IsTimeOut(LogoutProtect);
      },
    },
  });
}

function TableListFuncDisabled() {  
  $("#TableList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned seven wide column'>" +
      "<'left aligned two wide column'>" +
      "<'right aligned seven wide column'>" +
      ">" +
      ">",
    destroy     : true,
    stateSave   : true,
    processing  : true,
    deferRender : true,
    serverSide  : true,
    orderClasses: false,
    ordering    : false,
    scrollX     : true,
    scrollCollapse: true,
    paging      : true,
    scrollY     : '50vh',
    scroller: {
      loadingIndicator: true
    },
    fixedColumns:   {
      leftColumns: 6
    },
    data        : [],
    language    : {
      sLengthMenu : "_MENU_",
      search      : "",
      searchPlaceholder: "Pencarian..",
      processing  : '<i class="spinner loading icon huge"></i>',
      info        : "_START_ sampai _END_ dari _TOTAL_ total data",
      paginate    : {
        "first"   : "Awal",
        "last"    : "Akhir",
        "next"    : "<i class='chevron right icon'></i>",
        "previous": "<i class='chevron left icon'></i>"
      },
      infoEmpty   : "Tidak ada data",
      select  : {
        rows  : ""
      }
    },
    order     : [[1, "desc"]],
    columns   : [
      { data: null,
        render: function (data) {
          return '';
        },
      },
      { data  : 'SalesContract' },
      { data  : 'NoItem' },
      { data  : 'Description' },
      { data  : 'DrawingNum' },
      { data  : 'Cavity' },
      { data  : 'CavShoot' },
      { data  : 'StdUsed' },
      { data  : 'VendorName' },
      { data  : 'VendorCode' },
      { data  : 'Curr' },      
      { data  : 'DrawingLoc' },
      { data  : 'WbsProject' },
      { data  : 'Resin' },
      { data  : 'Brand' },
      { data  : 'Grade' },
      { data  : 'ResinMatNum' },
      { data  : 'ResinMatDescript' },
      { data  : 'ColorType' },
      { data  : 'BasedResin' },
      { data  : 'Color' },
      { data  : 'ColorPercent' },
      { data  : 'ColorMatNum' },
      { data  : 'ColorMatDescrip' },
      { data  : 'ColorVend' },
      { data  : 'Tonnage' },
      { data  : 'RunnerWeight' },
      { data  : 'ProductWeight' },
      { data  : 'TotalWeight' },
      { data  : 'PSSTD' },
      { data  : 'T1ID' },
      { data  : 'T1MD' },
      { data  : 'T1PL' },
      { data  : 'T1MSCP' },
      { data  : 'T1SC' },
      { data  : 'T1Total' },
      { data  : 'T1MB' },
      { data  : 'T1Resin' },
      { data  : 'T2ID' },
      { data  : 'T2MD' },
      { data  : 'T2PL' },
      { data  : 'T2SC' },
      { data  : 'T2Total' },
      { data  : 'T2MB' },
      { data  : 'T2Resin' },
      { data  : 'T3ID' },
      { data  : 'T3MD' },
      { data  : 'T3PL' },
      { data  : 'T3SC' },
      { data  : 'T3Total' },
      { data  : 'T3MB' },
      { data  : 'T3Resin' },
      { data  : 'T4ID' },
      { data  : 'T4MD' },
      { data  : 'T4PL' },
      { data  : 'T4SC' },
      { data  : 'T4Total' },
      { data  : 'T4MB' },
      { data  : 'T4Resin' },
      { data  : 'T5ID' },
      { data  : 'T5MD' },
      { data  : 'T5PL' },
      { data  : 'T5SC' },
      { data  : 'T5Total' },
      { data  : 'T5MB' },
      { data  : 'T5Resin' },
      { data  : 'TFID' },
      { data  : 'TFMD' },
      { data  : 'TFPL' },
      { data  : 'TFSC' },
      { data  : 'TFTotal' },
      { data  : 'TFMB' },
      { data  : 'TFResin' },
    ],
    columnDefs: [
      { className : "center aligned", targets: [0,2,4,5,6,7,21] },
      { className : "right aligned", targets: [23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70] },
      { render: function ( data, type, row ) {
          return data ? roundUp(1*data,2) : '';
        },
        targets: [ 36,37,43,44,50,51,57,58,64,65,71,72 ]  
      }
    ],

    createdRow: function (row, data, index) {

      //WARNA FREEZE LEFT COLUMNS 
      $(row).find("td:eq(5)").css("border-right", "inset");
      $(row).find("td:eq(5)").css("border-right-color", ColorBorderFreeze);

      var arympp = data['NoItem'].split('-');
      var nompp = arympp[1]+'-'+arympp[2]+'-'+arympp[3];
      if (nompp ==="00-00-00"){
        $(row).find("td").css("background-color", BgColor000000);
      } 
      if (data['Cavity'] ==="INSERT"){
        $(row).find("td").css("background-color", BgColorInsert);
      }

      if ( data['Diff'] !== 'null' && data['Diff'] !== null) {
        
        var CollIndex = ['col0','sales_contract','no','description','drawing_number','cavity','cav_shoot','drawing_loc','std_use','resin','wbs_project','brand','grade','manuf','code','curr','resin_mat_num','resin_description','color_type','based_resin','color','color_percent','color_mat_num','color_mat_descript','color_vend','tonnage_ton','runner','product','total_weight_shoot_g','psstd','t1_id','t1_md','t1_pl','t1_mscp','t1_total','t1_mb','t1_resin','t2_id','t2_md','t2_pl','t2_total','t2_mb','t2_resin','t3_id','t3_md','t3_pl','t3_total','t3_mb','t3_resin','t4_id','t4_md','t4_pl','t4_total','t4_mb','t4_resin','t5_id','t5_md','t5_pl','t5_total','t5_mb','t5_resin','tf_id','tf_md','tf_pl','tf_total','tf_mb','tf_resin'];

        if (data['Diff'] === "*") {
          $(row).find("td").css("color", '#df00ff');
          $(row).find("td").css("font-weight", 'bold');
        } else {
          var AryDiff = data['Diff'].split(',');
          var LenDiff = AryDiff.length;
          for (let i = 0; i < LenDiff; i++) {
            var index = CollIndex.findIndex((col) => col === AryDiff[i]);
            $(row).find("td:eq("+index+")").css("color", '#df00ff');
            $(row).find("td:eq("+index+")").css("font-weight", 'bold');
            if(index>0){
              $(row).find("td:eq(1)").css("color", '#df00ff');
              $(row).find("td:eq(1)").css("font-weight", 'bold');
            }
          }
        }
        

      }

      $('#FeatureNotifQty').html('');

    },

    footerCallback: function ( row, data, start, end, display ) {
      var api = this.api(), data;
  
      // Remove the formatting to get integer data for summation
      var intVal = function ( i ) {
          return typeof i === 'string' ?
              i.replace(/[\$,]/g, '')*1 :
              typeof i === 'number' ?
                  i : 0;
      };
  
      // Total over this page
      TotalMBT1 = api.column( 36, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST1 = api.column( 37, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBT2 = api.column( 43, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST2 = api.column( 44, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBT3 = api.column( 50, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST3 = api.column( 51, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBT4 = api.column( 57, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST4 = api.column( 58, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBT5 = api.column( 64, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRST5 = api.column( 65, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );
      TotalMBTF = api.column( 71, { page: 'current'} ).data().reduce( function (a, b) { return (roundUp(intVal(a),2) + roundUp(intVal(b),2));}, 0 );
      TotalRSTF = api.column( 72, { page: 'current'} ).data().reduce( function (a, b) { return (intVal(a) + intVal(b)).toFixed(2);}, 0 );

      // Update footer
      $( api.column( 36 ).footer() ).html('<b>'+TotalMBT1+'</b>');
      $( api.column( 37 ).footer() ).html('<b>'+TotalRST1+'</b>');
      $( api.column( 43 ).footer() ).html('<b>'+TotalMBT2+'</b>');
      $( api.column( 44 ).footer() ).html('<b>'+TotalRST2+'</b>');
      $( api.column( 50 ).footer() ).html('<b>'+TotalMBT3+'</b>');
      $( api.column( 51 ).footer() ).html('<b>'+TotalRST3+'</b>');
      $( api.column( 57 ).footer() ).html('<b>'+TotalMBT4+'</b>');
      $( api.column( 58 ).footer() ).html('<b>'+TotalRST4+'</b>');
      $( api.column( 64 ).footer() ).html('<b>'+TotalMBT5+'</b>');
      $( api.column( 65 ).footer() ).html('<b>'+TotalRST5+'</b>');
      $( api.column( 71 ).footer() ).html('<b>'+TotalMBTF+'</b>');
      $( api.column( 72 ).footer() ).html('<b>'+TotalRSTF+'</b>');
      
    },
   
    ajax      : {
      url     : '../RND_BackEnd/backend_mpp/kebutuhan/load-detail/'+IdMPP,
      type    : "POST",
      headers : {
        user  : VUserName,
        token : VToken,
      },
      error: function () {
        IsTimeOut(LogoutProtect);
      },
    },
  });
}

function roundToTwo(num) {
  // return +(Math.round(num + "e+2")  + "e-2");
  return(Math.round(num * 100) / 100);
}

function roundUp(num, precision) {
  precision = Math.pow(10, precision)
  return Math.ceil(num * precision) / precision
}
//Function Load Data Header
function LoadDataHeaderMPP(a){
  $.ajax({
    type: "POST",
    url     : `../RND_BackEnd/backend_mpp/mpp/load-header/`+a,
    headers: {
      user  : VUserName,
      token : VToken
    },
    cache: false,
    success: function (data){
      var obj = JSON.parse(data);
      $('#HeaderNoMPP').text(obj.NoMPP+' '+obj.Rev);
      $('#HeaderTitle').text(obj.Title);
      $('#HeaderPrjId').text(obj.ProjectIDs);
      $("#HeaderJenisPrj").text(obj.JenisProject);
      $("#HeaderPrd").text(obj.Product);
      $("#HeaderChs").text(obj.Chassis);
      $("#HeaderCab").text(obj.Cabinet);
      $('#HeaderVendor').text(obj.Vendor);
      $('#HeaderMDDes').text(obj.DesignerMD1+'; '+obj.DesignerMD2+'; '+obj.DesignerMD3+'; '+obj.DesignerMD4+'; '+obj.DesignerMD5);
      $('#HeaderIDDes').text(obj.DesignerID1+'; '+obj.DesignerID2+'; '+obj.DesignerID3+'; '+obj.DesignerID4+'; '+obj.DesignerID5);
      $('#HeaderHOMD').text(obj.HeadOfMD);
      $('#HeaderHOID').text(obj.HeadOfID);
      $('#HeaderPL').text(obj.ProjectLeader);
      $('#HeaderNego').text(obj.Negotiator);

      if(obj.Status === "MPP-REJECT-NEGOSIATOR" && obj.DesignerMD1 === DUser){
        $('#SignAvoidMD1').html('<a class="ui mini label teal signavoidcanceldesigner" asid="MD1" data-tooltip="Hindari pembatalan MPP dan aktifkan lagi" data-position="top left">Aviod Cancel</a>');
      } else {
        $('#SignAvoidMD1').html('');
      }

      setCookie('mppmd1',obj.DesignerMD1,5);
      setCookie('mppmd2',obj.DesignerMD2,5);
      setCookie('mppmd3',obj.DesignerMD3,5);
      setCookie('mppmd4',obj.DesignerMD4,5);
      setCookie('mppmd5',obj.DesignerMD5,5);
      setCookie('mppmd6',obj.DesignerMD6,5);
      setCookie('mppid1',obj.DesignerID1,5);
      setCookie('mppid2',obj.DesignerID2,5);
      setCookie('mppid3',obj.DesignerID3,5);
      setCookie('mppid4',obj.DesignerID4,5);
      setCookie('mppid5',obj.DesignerID5,5);
      setCookie('mpphomd',obj.HeadOfMD,5);
      setCookie('mpphoid',obj.HeadOfID,5);
      setCookie('mpppl',obj.ProjectLeader,5);
      setCookie('mppnego',obj.Negotiator,5);

      setCookie('mppsts',obj.Status,5);
      setCookie('mppprg',obj.Progres,5);
      setCookie('mppsc',obj.SalesContract,5);

      SignAsDesigner(a);
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function LoadSign(a){
  $.ajax({
    type: "POST",
    url     : `../RND_BackEnd/backend_mpp/sign/load/`+a,
    headers: {
      user  : VUserName,
      token : VToken
    },
    cache: false,
    success: function (data){
      var obj = JSON.parse(data);

      $('#DesignerMD1').text(obj.DesignerMD1);
      
      if(DUser === obj.DesignerMD1){
        if(obj.CountMD == 0){
          if(obj.SignByMD1){
            $('#SignMD1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD1).format('llll')+'</span>');
          } else {
            $('#SignMD1').html('<a class="ui mini label blue signdesigner" asid="MD1" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
          }
        } else {
          $('#SignMD1').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
        }
      } else {
        if(obj.SignByMD1){
          $('#SignMD1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD1).format('llll')+'</span>');
        } else {
          $('#SignMD1').html('PREPARE');
        }
      }
      

      if(obj.DesignerMD2){
        $('#trmddesign2').show();
        $('#DesignerMD2').text(obj.DesignerMD2);
        if(obj.SignByMD1){
          if(DUser === obj.DesignerMD2){
            if(obj.CountMD == 0){
              if(obj.SignByMD2){
                $('#SignMD2').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD2).format('llll')+'</span>');
              } else {
                $('#SignMD2').html('<a class="ui mini label blue signdesigner" asid="MD2" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignMD2').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByMD2){
              $('#SignMD2').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD2).format('llll')+'</span>');
            } else {
              $('#SignMD2').html('PREPARE');
            }
          }
        } else {
          if(obj.SignByMD2){
            $('#SignMD2').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD2).format('llll')+'</span>');
          } else {
            $('#SignMD2').html('');
          }
        }
      } else {
        $('#trmddesign2').hide();
      }


      if(obj.DesignerMD3){
        $('#trmddesign3').show();
        $('#DesignerMD3').text(obj.DesignerMD3);
        if(obj.SignByMD2){
          if(DUser === obj.DesignerMD3){
            if(obj.CountMD == 0){
              if(obj.SignByMD3){
                $('#SignMD3').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD3).format('llll')+'</span>');
              } else {
                $('#SignMD3').html('<a class="ui mini label blue signdesigner" asid="MD3" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignMD3').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByMD3){
              $('#SignMD3').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD3).format('llll')+'</span>');
            } else {
              $('#SignMD3').html('PREPARE');
            }
          }
        }
      } else {
        $('#trmddesign3').hide();
      }


      if(obj.DesignerMD4){
        $('#trmddesign4').show();
        $('#DesignerMD4').text(obj.DesignerMD4);
        if(obj.SignByMD3){
          if(DUser === obj.DesignerMD4){
            if(obj.CountMD == 0){
              if(obj.SignByMD4){
                $('#SignMD4').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD4).format('llll')+'</span>');
              } else {
                $('#SignMD4').html('<a class="ui mini label blue signdesigner" asid="MD4" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignMD4').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByMD4){
              $('#SignMD4').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD4).format('llll')+'</span>');
            } else {
              $('#SignMD4').html('PREPARE');
            }
          }
        }
      } else {
        $('#trmddesign4').hide();
      }


      if(obj.DesignerMD5){
        $('#trmddesign5').show();
        $('#DesignerMD5').text(obj.DesignerMD5);
        if(obj.SignByMD4){
          if(DUser === obj.DesignerMD5){
            if(obj.CountMD == 0){
              if(obj.SignByMD5){
                $('#SignMD5').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD5).format('llll')+'</span>');
              } else {
                $('#SignMD5').html('<a class="ui mini label blue signdesigner" asid="MD5" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignMD5').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByMD5){
              $('#SignMD5').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD5).format('llll')+'</span>');
            } else {
              $('#SignMD5').html('PREPARE');
            }
          }
        }
      } else {
        $('#trmddesign5').hide();
      }


      if(obj.DesignerMD6){
        $('#trmddesign6').show();
        $('#DesignerMD6').text(obj.DesignerMD6);
        if( obj.SignByMD5){
          if(DUser === obj.SignByMD6){
            if(obj.CountMD == 0){
              if(obj.SignByMD6){
                $('#SignMD6').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD6).format('llll')+'</span>');
              } else {
                $('#SignMD6').html('<a class="ui mini label blue signdesigner" asid="MD6" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignMD6').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByMD6){
              $('#SignMD6').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignMD6).format('llll')+'</span>');
            } else {
              $('#SignMD6').html('PREPARE');
            }
          }
        }
      } else {
        $('#trmddesign6').hide();
      }




      if(obj.DesignerID1){
        $('#triddesign1').show();
        $('#DesignerID1').text(obj.DesignerID1);

        

        if(obj.DesignerMD6){

          if(obj.SignByMD6){
            if(DUser === obj.DesignerID1){
              if(obj.CountMD == 0){
                if(obj.SignByID1){
                  $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
                } else {
                  $('#SignID1').html('<a class="ui mini label blue signdesigner" asid="ID1" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
                }
              } else {
                $('#SignID1').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByID1){
                $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
              } else {
                $('#SignID1').html('PREPARE');
              }
            }
          } else {
            if(obj.SignByID1){
              $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
            } else {
              $('#SignID1').html('');
            }
          }

        } else if(obj.DesignerMD5){

          if(obj.SignByMD5){
            if(DUser === obj.DesignerID1){
              if(obj.CountID == 0){
                if(obj.SignByID1){
                  $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
                } else {
                  $('#SignID1').html('<a class="ui mini label blue signdesigner" asid="ID1" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
                }
              } else {
                $('#SignID1').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByID1){
                $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
              } else {
                $('#SignID1').html('PREPARE');
              }
            }
          } else {
            if(obj.SignByID1){
              $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
            } else {
              $('#SignID1').html('');
            }
          }

        } else if(obj.DesignerMD4){

          if(obj.SignByMD4){
            if(DUser === obj.DesignerID1){
              if(obj.CountID == 0){
                if(obj.SignByID1){
                  $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
                } else {
                  $('#SignID1').html('<a class="ui mini label blue signdesigner" asid="ID1" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
                }
              } else {
                $('#SignID1').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByID1){
                $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
              } else {
                $('#SignID1').html('PREPARE');
              }
            }
          } else {
            if(obj.SignByID1){
              $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
            } else {
              $('#SignID1').html('');
            }
          }
          
        } else if(obj.DesignerMD3){

          if(obj.SignByMD3){
            if(DUser === obj.DesignerID1){
              if(obj.CountID == 0){
                if(obj.SignByID1){
                  $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
                } else {
                  $('#SignID1').html('<a class="ui mini label blue signdesigner" asid="ID1" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
                }
              } else {
                $('#SignID1').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByID1){
                $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
              } else {
                $('#SignID1').html('PREPARE');
              }
            }
          } else {
            if(obj.SignByID1){
              $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
            } else {
              $('#SignID1').html('');
            }
          }
          
        } else if(obj.DesignerMD2){

          if(obj.SignByMD2){
            if(DUser === obj.DesignerID1){
              if(obj.CountID == 0){
                if(obj.SignByID1){
                  $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
                } else {
                  $('#SignID1').html('<a class="ui mini label blue signdesigner" asid="ID1" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
                }
              } else {
                $('#SignID1').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByID1){
                $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
              } else {
                $('#SignID1').html('PREPARE');
              }
            }
          } else {
            if(obj.SignByID1){
              $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
            } else {
              $('#SignID1').html('');
            }
          }
          
        } else if(obj.DesignerMD1){

          if(obj.SignByMD1){
            if(DUser === obj.DesignerID1){
              if(obj.CountID == 0){
                if(obj.SignByID1){
                  $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
                } else {
                  $('#SignID1').html('<a class="ui mini label blue signdesigner" asid="ID1" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
                }
              } else {
                $('#SignID1').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByID1){
                $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
              } else {
                $('#SignID1').html('PREPARE');
              }
            }
          } else {
            if(obj.SignByID1){
              $('#SignID1').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID1).format('llll')+'</span>');
            } else {
              $('#SignID1').html('');
            }
          }
          
        } 


      } else {
        $('#triddesign1').hide();
      }
      
      if(obj.DesignerID2){
        $('#triddesign2').show();
        $('#DesignerID2').text(obj.DesignerID2);

        if(obj.SignByID1){
          if(DUser === obj.DesignerID2){
            if(obj.CountID == 0){
              if(obj.SignByID2){
                $('#SignID2').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID2).format('llll')+'</span>');
              } else {
                $('#SignID2').html('<a class="ui mini label blue signdesigner" asid="ID2" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignID2').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByID2){
              $('#SignID2').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID2).format('llll')+'</span>');
            } else {
              $('#SignID2').html('PREPARE');
            }
          }
        }
      } else {
        $('#triddesign2').hide();
      }

      if(obj.DesignerID3){
        $('#triddesign3').show();
        $('#DesignerID3').text(obj.DesignerID3);

        if(obj.SignByID2){
          if(DUser === obj.DesignerID3){
            if(obj.CountID == 0){
              if(obj.SignByID3){
                $('#SignID3').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID3).format('llll')+'</span>');
              } else {
                $('#SignID3').html('<a class="ui mini label blue signdesigner" asid="ID3" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignID3').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByID3){
              $('#SignID3').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID3).format('llll')+'</span>');
            } else {
              $('#SignID3').html('PREPARE');
            }
          }
        }
      } else {
        $('#triddesign3').hide();
      }

      if(obj.DesignerID4){
        $('#triddesign4').show();
        $('#DesignerID4').text(obj.DesignerID4);

        if(obj.SignByID3){
          if(DUser === obj.DesignerID4){
            if(obj.CountID == 0){
              if(obj.SignByID4){
                $('#SignID4').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID4).format('llll')+'</span>');
              } else {
                $('#SignID4').html('<a class="ui mini label blue signdesigner" asid="ID4" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignID4').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByID4){
              $('#SignID4').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID4).format('llll')+'</span>');
            } else {
              $('#SignID4').html('PREPARE');
            }
          }
        }

      } else {
        $('#triddesign4').hide();
      }

      if(obj.DesignerID5){
        $('#triddesign5').show();
        $('#DesignerID5').text(obj.DesignerID5);
        
        if(obj.SignByID4){
          if(DUser === obj.DesignerID5){
            if(obj.CountID == 0){
              if(obj.SignByID5){
                $('#SignID5').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID5).format('llll')+'</span>');
              } else {
                $('#SignID5').html('<a class="ui mini label blue signdesigner" asid="ID5" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignID5').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByID5){
              $('#SignID5').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignID5).format('llll')+'</span>');
            } else {
              $('#SignID5').html('PREPARE');
            }
          }
        }

      } else {
        $('#triddesign5').hide();
      }










      if(obj.HeadOfID){
        $('#tridheadof').show();
        $('#HeadOfID').text(obj.HeadOfID);

        if(obj.DesignerID5){

          if(obj.SignByID5){
            if(DUser === obj.HeadOfID){
              if(obj.CountID == 0){
                if(obj.SignByHoID){
                  $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
                } else {
                  $('#SignHOID').html('<a class="ui mini label blue signapprove" asid="HOID" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOID" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
                }
              } else {
                $('#SignHOID').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByHoID){
                $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
              } else {
                $('#SignHOID').html('APPROVAL PROCESS');
              }
            }
          } else {
            $('#SignHOID').html('WAIT');
          }

        } else if(obj.DesignerID4){

          if(obj.SignByID4){
            if(DUser === obj.HeadOfID){
              if(obj.CountID == 0){
                if(obj.SignByHoID){
                  $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
                } else {
                  $('#SignHOID').html('<a class="ui mini label blue signapprove" asid="HOID" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOID" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
                }
              } else {
                $('#SignHOID').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByHoID){
                $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
              } else {
                $('#SignHOID').html('APPROVAL PROCESS');
              }
            }
          } else {
            $('#SignHOID').html('WAIT');
          }

        } else if(obj.DesignerID3){

          if(obj.SignByID3){
            if(DUser === obj.HeadOfID){
              if(obj.CountID == 0){
                if(obj.SignByHoID){
                  $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
                } else {
                  $('#SignHOID').html('<a class="ui mini label blue signapprove" asid="HOID" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOID" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
                }
              } else {
                $('#SignHOID').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByHoID){
                $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
              } else {
                $('#SignHOID').html('APPROVAL PROCESS');
              }
            }
          } else {
            $('#SignHOID').html('WAIT');
          }

        } else if(obj.DesignerID2){

          if(obj.SignByID2){
            if(DUser === obj.HeadOfID){
              if(obj.CountID == 0){
                if(obj.SignByHoID){
                  $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
                } else {
                  $('#SignHOID').html('<a class="ui mini label blue signapprove" asid="HOID" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOID" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
                }
              } else {
                $('#SignHOID').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByHoID){
                $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
              } else {
                $('#SignHOID').html('APPROVAL PROCESS');
              }
            }
          } else {
            $('#SignHOID').html('WAIT');
          }

        } else if(obj.DesignerID1){

          if(obj.SignByID1){
            if(DUser === obj.HeadOfID){
              if(obj.CountID == 0){
                if(obj.SignByHoID){
                  $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
                } else {
                  $('#SignHOID').html('<a class="ui mini label blue signapprove" asid="HOID" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOID" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
                }
              } else {
                $('#SignHOID').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
              }
            } else {
              if(obj.SignByHoID){
                $('#SignHOID').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoID).format('llll')+'</span>');
              } else {
                $('#SignHOID').html('APPROVAL PROCESS');
              }
            }
          } else {
            $('#SignHOID').html('WAIT');
          }

        }

      } else {
        $('#tridheadof').hide();
      }

      if(obj.ProjectLeader){
        $('#ProjLeader').text(obj.ProjectLeader);
        if(obj.SignByHoID){
          if(DUser === obj.ProjectLeader){
            if(obj.CountPL == 0){
              if(obj.SignByPL){
                $('#SignPL').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignPL).format('llll')+'</span>');
              } else {
                $('#SignPL').html('<a class="ui mini label blue signdesigner" asid="PL" data-tooltip="Sign setelah melengkapi data kebutuhan" data-position="top left">SIGN</a>');
              }
            } else {
              $('#SignPL').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByPL){
              $('#SignPL').html('SIGNED<br><span class="DateSign"> '+moment(obj.DateSignPL).format('llll')+'</span>');
            } else {
              $('#SignPL').html('SIGN PROCESS');
            }
          }
        } else {
          $('#SignPL').html('WAIT');
        }
      } else {
        $('#SignPL').html('BYPASSED');
      }
      



      $('#HeadOfMD').text(obj.HeadOfHoMD);
      if(obj.ProjectLeader){

        if(obj.SignByPL){
          if(DUser === obj.HeadOfHoMD){
            if(obj.CountMD == 0){
              if(obj.SignByHoMD){
                $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
              } else {
                $('#SignHOMD').html('<a class="ui mini label blue signapprove" asid="HOMD" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOMD" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
              }
            } else {
              $('#SignHOMD').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByHoMD){
              $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
            } else {
              $('#SignHOMD').html('APPROVAL PROCESS');
            }
          } 
        } else {
          $('#SignHOMD').html('WAIT');
        }

      } else if(obj.DesignerMD6){

        if(obj.SignByMD6){
          if(DUser === obj.HeadOfHoMD){
            if(obj.CountMD == 0){
              if(obj.SignByHoMD){
                $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
              } else {
                $('#SignHOMD').html('<a class="ui mini label blue signapprove" asid="HOMD" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOMD" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
              }
            } else {
              $('#SignHOMD').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByHoMD){
              $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
            } else {
              $('#SignHOMD').html('APPROVAL PROCESS');
            }
          }
        } else {
          $('#SignHOMD').html('WAIT');
        }

      } else if(obj.DesignerMD5){

        if(obj.SignByMD5){
          if(DUser === obj.HeadOfHoMD){
            if(obj.CountMD == 0){
              if(obj.SignByHoMD){
                $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
              } else {
                $('#SignHOMD').html('<a class="ui mini label blue signapprove" asid="HOMD" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOMD" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
              }
            } else {
              $('#SignHOMD').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByHoMD){
              $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
            } else {
              $('#SignHOMD').html('APPROVAL PROCESS');
            }
          }
        } else {
          $('#SignHOMD').html('WAIT');
        }

      } else if(obj.DesignerMD4){

        if(obj.SignByMD4){
          if(DUser === obj.HeadOfHoMD){
            if(obj.CountMD == 0){
              if(obj.SignByHoMD){
                $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
              } else {
                $('#SignHOMD').html('<a class="ui mini label blue signapprove" asid="HOMD" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOMD" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
              }
            } else {
              $('#SignHOMD').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByHoMD){
              $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
            } else {
              $('#SignHOMD').html('APPROVAL PROCESS');
            }
          }
        } else {
          $('#SignHOMD').html('WAIT');
        }

      } else if(obj.DesignerMD3){

        if(obj.SignByMD3){
          if(DUser === obj.HeadOfHoMD){
            if(obj.CountMD == 0){
              if(obj.SignByHoMD){
                $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
              } else {
                $('#SignHOMD').html('<a class="ui mini label blue signapprove" asid="HOMD" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOMD" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
              }
            } else {
              $('#SignHOMD').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByHoMD){
              $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
            } else {
              $('#SignHOMD').html('APPROVAL PROCESS');
            }
          }
        } else {
          $('#SignHOMD').html('WAIT');
        }

      } else if(obj.DesignerMD2){

        if(obj.SignByMD2){
          if(DUser === obj.HeadOfHoMD){
            if(obj.CountMD == 0){
              if(obj.SignByHoMD){
                $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
              } else {
                $('#SignHOMD').html('<a class="ui mini label blue signapprove" asid="HOMD" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOMD" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
              }
            } else {
              $('#SignHOMD').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByHoMD){
              $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
            } else {
              $('#SignHOMD').html('APPROVAL PROCESS');
            }
          }
        } else {
          $('#SignHOMD').html('WAIT');
        }

      } else if(obj.DesignerMD1){

        if(obj.SignByMD1 && !obj.SignByHoMD){
          if(DUser === obj.HeadOfHoMD){
            if(obj.CountMD == 0){
              if(obj.SignByHoMD){
                $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
              } else {
                $('#SignHOMD').html('<a class="ui mini label blue signapprove" asid="HOMD" data-tooltip="Sign Approve untuk MPP yang di buat Designer" data-position="top left">APPROVE</a><a class="ui mini label red BtnRejectHO" asid="HOMD" data-tooltip="Reject MPP yang di buat Designer" data-position="top left">REJECT</a>');
              }
            } else {
              $('#SignHOMD').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
            }
          } else {
            if(obj.SignByHoMD){
              $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
            } else {
              $('#SignHOMD').html('APPROVAL PROCESS');
            }
          }
        } else if(!obj.SignByMD1 && obj.SignByHoMD){
          $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
        } else if(obj.SignByMD1 && obj.SignByHoMD){
          $('#SignHOMD').html('APPROVED<br><span class="DateSign"> '+moment(obj.DateSignHoMD).format('llll')+'</span>');
        } else {
          $('#SignHOMD').html('WAIT');
        }

      }

      $('#Negotiator').text(obj.Negotiator);
      if(obj.SignByHoMD){
        if(DUser === obj.Negotiator){
          if(obj.CountMSCP == 0){
            if(obj.SignByNego){
              $('#SignNego').html('CONFIRMED<br><span class="DateSign"> '+moment(obj.DateSignNego).format('llll')+'</span>');
            } else {
              if(obj.SignByMD1){
                $('#SignNego').html('<a class="ui mini label blue signconfirm" asid="NEGO" data-tooltip="Konfirmasi MPP sudah diterima oleh Negosiator" data-position="top left">CONFIRM</a><a class="ui mini label red BtnRejectNego" data-tooltip="MPP ditolak karena alasan tertentu" data-position="top left">REJECT</a><a class="ui mini label orange BtnReturnNego" data-tooltip="MPP dikembalikan dikarenakan data belum lengkap" data-position="top left">RETURN</a>');
              } else {
                $('#SignNego').html('WAIT');
              }
            }
          } else {
            $('#SignNego').html('<i class="exclamation small triangle red icon"></i> Qty di List Kebutuhan belum lengkap!');
          }
        } else {
          if(obj.SignByNego){
            $('#SignNego').html('CONFIRMED<br><span class="DateSign"> '+moment(obj.DateSignNego).format('llll')+'</span>');
          } else {
            if(obj.SignByMD1){
              $('#SignNego').html('CONFIRMATION PROCCES');
            } else {
              $('#SignNego').html('WAIT');
            }
          }
        }
      }  else {
        $('#SignNego').html('WAIT');
      }

      SignAsDesigner(a);
      SignApproveHeadOf(a);
      SignConfirmNegotiator(a);

      SignRejectHO(a);
      SignRejectNego(a);
      SignReturnNego(a);

      LoadDataHeaderMPP(IdMPP);
      var ssts = getCookie("mppsts");
      var pprg = getCookie("mppprg");


      if(DSect ==='MECHANICAL DESIGN+PROTOTYPE' && DJbtn !=='PROJECT LEADER' ){
        if((obj.DateSignHoMD===null && obj.SignByHoMD === null ) || ((obj.DateSignHoMD !==null && obj.SignByHoMD !== null) && (ssts ==='MPP-RETURN' || ssts ==='MPP-REJECT'))){
          TableListFunc();
        } else {
          TableListFuncDisabled();
        }
      } else if(DSect ==='INDUSTRIAL DESIGN' && DJbtn !=='PROJECT LEADER'){
        if((obj.DateSignHoID===null && obj.SignByHoID === null && ssts ==='DRAFT') ){
          TableListFunc();
        } else {
          TableListFuncDisabled();
        }
      } else if(DUser ===obj.ProjectLeader && DJbtn ==='PROJECT LEADER'){
        if(obj.DateSignPL===null && obj.SignByPL === null ){
          TableListFunc();
        } else {
          TableListFuncDisabled();
        }
      } else if(DUser ===obj.Negotiator && DSect ==='MULTI SOURCING'){
        if(obj.DateSignNego===null && obj.SignByNego === null ){
          TableListFunc();
        } else {
          TableListFuncDisabled();
        }
      } else {
        TableListFuncDisabled();
      }

    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function LoadDataItemMPP(idx,scx){
  $.ajax({
    type: "POST",
    url     : `../RND_BackEnd/backend_mpp/kebutuhan/load-detail-item/`+idx,
    headers: {
      user  : VUserName,
      token : VToken
    },
    cache: false,
    success: function (data){
      var obj = JSON.parse(data);
      $('#IdItemMPP').val(idx);
      $('#ScItemMPP').val(scx);
      $('#EditDrawingLoc').text(obj.DrawingLoc);
      $('#EditDrawingNum').text(obj.DrawingNum);
      $('#EditDescript').text(obj.Description);
      $('#CavShoot').text(obj.Cav_Shoot+' '+obj.UM);


      if(obj.t1sc && obj.t1sc !== null && obj.t1sc !==''){
        var t1sc_a = obj.t1sc;
      } else {
        var t1sc_a = 25;
      }

      if(obj.t2sc && obj.t2sc !== null && obj.t2sc !==''){
        var t2sc_a = obj.t2sc;
      } else {
        var t2sc_a = 25;
      }

      if(obj.t3sc && obj.t3sc !== null && obj.t3sc !==''){
        var t3sc_a = obj.t3sc;
      } else {
        var t3sc_a = 25;
      }

      if(obj.t4sc && obj.t4sc !== null && obj.t4sc !==''){
        var t4sc_a = obj.t4sc;
      } else {
        var t4sc_a = 25;
      }

      if(obj.t5sc && obj.t5sc !== null && obj.t5sc !==''){
        var t5sc_a = obj.t5sc;
      } else {
        var t5sc_a = 25;
      }
      if(obj.tfsc && obj.tfsc !== null && obj.tfsc !==''){
        var tfsc_a = obj.tfsc;
      } else {
        var tfsc_a = 150;
      }

      $('#KebutuhanIDT1').val(obj.t1id);
      $('#KebutuhanMDT1').val(obj.t1md);
      $('#KebutuhanPLT1').val(obj.t1pl);
      $('#KebutuhanMSCT1').val(obj.t1mscp);

      $('#KebutuhanIDT2').val(obj.t2id);
      $('#KebutuhanMDT2').val(obj.t2md);
      $('#KebutuhanPLT2').val(obj.t2pl);

      $('#KebutuhanIDT3').val(obj.t3id);
      $('#KebutuhanMDT3').val(obj.t3md);
      $('#KebutuhanPLT3').val(obj.t3pl);

      $('#KebutuhanIDT4').val(obj.t4id);
      $('#KebutuhanMDT4').val(obj.t4md);
      $('#KebutuhanPLT4').val(obj.t4pl);

      $('#KebutuhanIDT5').val(obj.t5id);
      $('#KebutuhanMDT5').val(obj.t5md);
      $('#KebutuhanPLT5').val(obj.t5pl);

      $('#KebutuhanIDTF').val(obj.tfid);
      $('#KebutuhanMDTF').val(obj.tfmd);
      $('#KebutuhanPLTF').val(obj.tfpl);
      
      $('#KebutuhanSCT1').val(t1sc_a);
      $('#KebutuhanSCT2').val(t2sc_a);
      $('#KebutuhanSCT3').val(t3sc_a);
      $('#KebutuhanSCT4').val(t4sc_a);
      $('#KebutuhanSCT5').val(t5sc_a);
      $('#KebutuhanSCTF').val(tfsc_a);

     

      $('#QtyShootIDT1, #QtyShootIDT2, #QtyShootIDT3, #QtyShootIDT4, #QtyShootIDT5, #QtyShootIDTF').text(0);
      $('#QtyShootMDT1, #QtyShootMDT2, #QtyShootMDT3, #QtyShootMDT4, #QtyShootMDT5, #QtyShootMDTF').text(0);
      $('#QtyShootSCT1, #QtyShootSCT2, #QtyShootSCT3, #QtyShootSCT4, #QtyShootSCT5, #QtyShootSCTF').text(0);
      $('#QtyShootPLT1, #QtyShootPLT2, #QtyShootPLT3, #QtyShootPLT4, #QtyShootPLT5, #QtyShootPLTF').text(0);
      $('#QtyShootMSCT1').text(0);
      CountQtyShoot(obj.Cav_Shoot,obj.UM);

      $('#QtyShootIDT1').text(obj.t1id*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootIDT2').text(obj.t2id*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootIDT3').text(obj.t3id*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootIDT4').text(obj.t4id*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootIDT5').text(obj.t5id*obj.Cav_Shoot+' '+obj.UM);

      $('#QtyShootMDT1').text(obj.t1md*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootMDT2').text(obj.t2md*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootMDT3').text(obj.t3md*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootMDT4').text(obj.t4md*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootMDT5').text(obj.t5md*obj.Cav_Shoot+' '+obj.UM);

      $('#QtyShootSCT1').text(t1sc_a*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootSCT2').text(t2sc_a*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootSCT3').text(t3sc_a*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootSCT4').text(t4sc_a*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootSCT5').text(t5sc_a*obj.Cav_Shoot+' '+obj.UM);

      $('#QtyShootPLT1').text(obj.t1pl*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootPLT2').text(obj.t2pl*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootPLT3').text(obj.t3pl*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootPLT4').text(obj.t4pl*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootPLT5').text(obj.t5pl*obj.Cav_Shoot+' '+obj.UM);

      $('#QtyShootIDTF').text(obj.tfid*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootMDTF').text(obj.tfmd*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootSCTF').text(tfsc_a*obj.Cav_Shoot+' '+obj.UM);
      $('#QtyShootPLTF').text(obj.tfpl*obj.Cav_Shoot+' '+obj.UM);

      $('#QtyShootMSCT1').text(obj.t1mscp*obj.Cav_Shoot+' '+obj.UM);
      

      var mppmdarr = [];
      var mppidarr = [];
      for (var i = 1; i < 6; i++) {
        if(getCookie("mppmd"+i)){ mppmdarr.push(getCookie("mppmd"+i)); }  
      }
      for (var j = 1; j < 5; j++) {
        if(getCookie("mppid"+j)){ mppidarr.push(getCookie("mppid"+j)); }  
      }
      mppmdarr.push(getCookie("mpphomd"));
      mppidarr.push(getCookie("mpphoid"));
      var mpppl = getCookie("mpppl");
      var mppnego = getCookie("mppnego");

      if (DSect === "MECHANICAL DESIGN+PROTOTYPE" && DJbtn !== "PROJECT LEADER" && mppmdarr.includes(DUser)){
        $('.ListKebutuhanMD').removeClass('disabled');
        $('.ListKebutuhanID').addClass('disabled');
        $('.ListKebutuhanPL').addClass('disabled');
        $('.ListKebutuhanMSC').addClass('disabled');
      } else if (DSect === "INDUSTRIAL DESIGN" && DJbtn !== "PROJECT LEADER" && mppidarr.includes(DUser)){
        $('.ListKebutuhanMD').addClass('disabled');
        $('.ListKebutuhanID').removeClass('disabled');
        $('.ListKebutuhanPL').addClass('disabled');
        $('.ListKebutuhanMSC').addClass('disabled');
      } else if (DJbtn === "PROJECT LEADER" && mpppl === DUser){ 
        $('.ListKebutuhanMD').addClass('disabled');
        $('.ListKebutuhanID').addClass('disabled');
        $('.ListKebutuhanPL').removeClass('disabled');
        $('.ListKebutuhanMSC').addClass('disabled');
      } else if (DSect === "MULTI SOURCING" && DJbtn !== "PROJECT LEADER" && mppnego === DUser){
        $('.ListKebutuhanMD').addClass('disabled');
        $('.ListKebutuhanID').addClass('disabled');
        $('.ListKebutuhanPL').addClass('disabled');
        $('.ListKebutuhanMSC').removeClass('disabled');
      } else {
        $('.ListKebutuhanMD').addClass('disabled');
        $('.ListKebutuhanID').addClass('disabled');
        $('.ListKebutuhanPL').addClass('disabled');
        $('.ListKebutuhanMSC').addClass('disabled');
      }

    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function CountQtyShoot(cav,um){
  
  $('#KebutuhanIDT1').on('change keyup', function() {
    var q = $('#KebutuhanIDT1').val();
    $('#QtyShootIDT1').text(q*cav+' '+um);
  });

  $('#KebutuhanIDT2').on('change keyup', function() {
    var q = $('#KebutuhanIDT2').val();
    $('#QtyShootIDT2').text(q*cav+' '+um);
  });

  $('#KebutuhanIDT3').on('change keyup', function() {
    var q = $('#KebutuhanIDT3').val();
    $('#QtyShootIDT3').text(q*cav+' '+um);
  });

  $('#KebutuhanIDT4').on('change keyup', function() {
    var q = $('#KebutuhanIDT4').val();
    $('#QtyShootIDT4').text(q*cav+' '+um);
  });

  $('#KebutuhanIDT5').on('change keyup', function() {
    var q = $('#KebutuhanIDT5').val();
    $('#QtyShootIDT5').text(q*cav+' '+um);
  });

  $('#KebutuhanIDTF').on('change keyup', function() {
    var q = $('#KebutuhanIDTF').val();
    $('#QtyShootIDTF').text(q*cav+' '+um);
  });

  $('#KebutuhanMDT1').on('change keyup', function() {
    var q = $('#KebutuhanMDT1').val();
    $('#QtyShootMDT1').text(q*cav+' '+um);
  });

  $('#KebutuhanMDT2').on('change keyup', function() {
    var q = $('#KebutuhanMDT2').val();
    $('#QtyShootMDT2').text(q*cav+' '+um);
  });

  $('#KebutuhanMDT3').on('change keyup', function() {
    var q = $('#KebutuhanMDT3').val();
    $('#QtyShootMDT3').text(q*cav+' '+um);
  });

  $('#KebutuhanMDT4').on('change keyup', function() {
    var q = $('#KebutuhanMDT4').val();
    $('#QtyShootMDT4').text(q*cav+' '+um);
  });

  $('#KebutuhanMDT5').on('change keyup', function() {
    var q = $('#KebutuhanMDT5').val();
    $('#QtyShootMDT5').text(q*cav+' '+um);
  });

  $('#KebutuhanMDTF').on('change keyup', function() {
    var q = $('#KebutuhanMDTF').val();
    $('#QtyShootMDTF').text(q*cav+' '+um);
  });



  $('#KebutuhanSCT1').on('change keyup', function() {
    var q = $('#KebutuhanSCT1').val();
    $('#QtyShootSCT1').text(q*cav+' '+um);
  });

  $('#KebutuhanSCT2').on('change keyup', function() {
    var q = $('#KebutuhanSCT2').val();
    $('#QtyShootSCT2').text(q*cav+' '+um);
  });

  $('#KebutuhanSCT3').on('change keyup', function() {
    var q = $('#KebutuhanSCT3').val();
    $('#QtyShootSCT3').text(q*cav+' '+um);
  });

  $('#KebutuhanSCT4').on('change keyup', function() {
    var q = $('#KebutuhanSCT4').val();
    $('#QtyShootSCT4').text(q*cav+' '+um);
  });

  $('#KebutuhanSCT5').on('change keyup', function() {
    var q = $('#KebutuhanSCT5').val();
    $('#QtyShootSCT5').text(q*cav+' '+um);
  });

  $('#KebutuhanSCTF').on('change keyup', function() {
    var q = $('#KebutuhanSCTF').val();
    $('#QtyShootSCTF').text(q*cav+' '+um);
  });





  $('#KebutuhanPLT1').on('change keyup', function() {
    var q = $('#KebutuhanPLT1').val();``
    $('#QtyShootPLT1').text(q*cav+' '+um);
  });

  $('#KebutuhanPLT2').on('change keyup', function() {
    var q = $('#KebutuhanPLT2').val();
    $('#QtyShootPLT2').text(q*cav+' '+um);
  });

  $('#KebutuhanPLT3').on('change keyup', function() {
    var q = $('#KebutuhanPLT3').val();
    $('#QtyShootPLT3').text(q*cav+' '+um);
  });

  $('#KebutuhanPLT4').on('change keyup', function() {
    var q = $('#KebutuhanPLT4').val();
    $('#QtyShootPLT4').text(q*cav+' '+um);
  });

  $('#KebutuhanPLT5').on('change keyup', function() {
    var q = $('#KebutuhanPLT5').val();
    $('#QtyShootPLT5').text(q*cav+' '+um);
  });

  $('#KebutuhanPLTF').on('change keyup', function() {
    var q = $('#KebutuhanPLTF').val();
    $('#QtyShootPLTF').text(q*cav+' '+um);
  });

  $('#KebutuhanMSCT1').on('change keyup', function() {
    var q = $('#KebutuhanMSCT1').val();
    $('#QtyShootMSCT1').text(q*cav+' '+um);
  });

}

function SaveKebutuhan(){
  var IdItemMPP  = $("#IdItemMPP").val();
  var ScItemMPP  = $("#ScItemMPP").val();
  data = {
    IdMPP   : IdMPP,
    IdItemMPP   : IdItemMPP,
    QtyIDT1    : $("#KebutuhanIDT1").val(),
    QtyIDT2    : $("#KebutuhanIDT2").val(),
    QtyIDT3    : $("#KebutuhanIDT3").val(),
    QtyIDT4    : $("#KebutuhanIDT4").val(),
    QtyIDT5    : $("#KebutuhanIDT5").val(),
    QtyIDTF    : $("#KebutuhanIDTF").val(),
    QtyMDT1    : $("#KebutuhanMDT1").val(),
    QtyMDT2    : $("#KebutuhanMDT2").val(),
    QtyMDT3    : $("#KebutuhanMDT3").val(),
    QtyMDT4    : $("#KebutuhanMDT4").val(),
    QtyMDT5    : $("#KebutuhanMDT5").val(),
    QtyMDTF    : $("#KebutuhanMDTF").val(),
    QtySCT1    : $("#KebutuhanSCT1").val(),
    QtySCT2    : $("#KebutuhanSCT2").val(),
    QtySCT3    : $("#KebutuhanSCT3").val(),
    QtySCT4    : $("#KebutuhanSCT4").val(),
    QtySCT5    : $("#KebutuhanSCT5").val(),
    QtySCTF    : $("#KebutuhanSCTF").val(),
    QtyPLT1    : $("#KebutuhanPLT1").val(),
    QtyPLT2    : $("#KebutuhanPLT2").val(),
    QtyPLT3    : $("#KebutuhanPLT3").val(),
    QtyPLT4    : $("#KebutuhanPLT4").val(),
    QtyPLT5    : $("#KebutuhanPLT5").val(),
    QtyPLTF    : $("#KebutuhanPLTF").val(),
    QtyMSCT1   : $("#KebutuhanMSCT1").val(),
    Username   : VUserName,
  };

  $.ajax({
    type    : "POST",
    url     : `../RND_BackEnd/backend_mpp/kebutuhan/edit-detail`,
    headers: {
      user  : VUserName,
      token : VToken
    },
    data: data,
    cache: false,
    success: function (response){
      var obj = JSON.parse(response);
      if(isEmpty(obj)) {
        IsResponseEmptyObj();
      } else if(obj) {
        if (obj.status == false){
          IsResponseFalse(obj.message);
        } else {
          IsResponseTrue(obj.message);
          $(".WindowEditKebutuhan").modal("hide");
          CompareMPP();
          ReCountQtyMaterial(ScItemMPP);
          TableListFunc();
          LoadSign(IdMPP);

          
          
        }
      } else {
        IsResponseErrorElse();
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function SaveKebutuhanToAll(){
  if(DSect === "MECHANICAL DESIGN+PROTOTYPE" && DJbtn !=='PROJECT LEADER'){
    var sect = "MD";
  } else if(DSect ==='INDUSTRIAL DESIGN' && DJbtn !=='PROJECT LEADER'){
    var sect = "ID";
  } else if(DJbtn === "PROJECT LEADER"){
    var sect = "PL";
  } else {
    var sect = "MSCP";
  } 
  data = {
    IdMPP      : IdMPP,
    IdSection  : sect,
    QtyIDT1    : $("#KebutuhanIDT1").val(),
    QtyIDT2    : $("#KebutuhanIDT2").val(),
    QtyIDT3    : $("#KebutuhanIDT3").val(),
    QtyIDT4    : $("#KebutuhanIDT4").val(),
    QtyIDT5    : $("#KebutuhanIDT5").val(),
    QtyIDTF    : $("#KebutuhanIDTF").val(),
    QtyMDT1    : $("#KebutuhanMDT1").val(),
    QtyMDT2    : $("#KebutuhanMDT2").val(),
    QtyMDT3    : $("#KebutuhanMDT3").val(),
    QtyMDT4    : $("#KebutuhanMDT4").val(),
    QtyMDT5    : $("#KebutuhanMDT5").val(),
    QtyMDTF    : $("#KebutuhanMDTF").val(),
    QtySCT1    : $("#KebutuhanSCT1").val(),
    QtySCT2    : $("#KebutuhanSCT2").val(),
    QtySCT3    : $("#KebutuhanSCT3").val(),
    QtySCT4    : $("#KebutuhanSCT4").val(),
    QtySCT5    : $("#KebutuhanSCT5").val(),
    QtySCTF    : $("#KebutuhanSCTF").val(),
    QtyPLT1    : $("#KebutuhanPLT1").val(),
    QtyPLT2    : $("#KebutuhanPLT2").val(),
    QtyPLT3    : $("#KebutuhanPLT3").val(),
    QtyPLT4    : $("#KebutuhanPLT4").val(),
    QtyPLT5    : $("#KebutuhanPLT5").val(),
    QtyPLTF    : $("#KebutuhanPLTF").val(),
    QtyMSCT1   : $("#KebutuhanMSCT1").val(),
    Username   : VUserName,
  };

  $.ajax({
    type    : "POST",
    url     : `../RND_BackEnd/backend_mpp/kebutuhan/edit-detail-all`,
    headers: {
      user  : VUserName,
      token : VToken
    },
    data: data,
    cache: false,
    success: function (response){
      var obj = JSON.parse(response);
      if(isEmpty(obj)) {
        IsResponseEmptyObj();
      } else if(obj) {
        if (obj.status == false){
          IsResponseFalse(obj.message);
        } else {
          IsResponseTrue(obj.message);
          $(".WindowEditKebutuhan").modal("hide");
          CompareMPP();
          TableListFunc();
          var mppsc = getCookie("mppsc");
          ReCountQtyMaterialAll(mppsc);
          LoadSign(IdMPP);
          

        }
      } else {
        IsResponseErrorElse();
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function CompareMPP(){
  $.ajax({
    type    : "POST",
    url     : `../RND_BackEnd/backend_mpp/mpp/revise/compare`,
    headers: {
      user  : VUserName,
      token : VToken
    },
    data: {
      id_mpp   : IdMPP,
      username : VUserName
    },
    cache: false,
    success: function (response){
      
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function ReCountQtyMaterial(Scx){
  $.ajax({
    type    : "POST",
    url     : `../RND_BackEnd/backend_mpp/kebutuhan/final-material/update-qty-send`,
    headers: {
      user  : VUserName,
      token : VToken
    },
    data: {
      id_mpp   : IdMPP,
      username : VUserName,
      sales_contract : Scx
    },
    cache: false,
    success: function (response){
      
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function ReCountQtyMaterialAll(AllSc){
  var AllScx = AllSc.split(', ');
  var data = [];
  var tempData = [];
  for ( var i=0; i<AllScx.length; i++ ) {
    data = { "id_mpp": IdMPP, "username": VUserName, "sales_contract": AllScx[i] };
    tempData.push( data );
  }
  data = tempData;

  $.ajax({
    type    : "POST",
    url     : `../RND_BackEnd/backend_mpp/kebutuhan/final-material/update-qty-send`,
    headers: {
      user  : VUserName,
      token : VToken
    },
    data: {
      data: data
    },
    cache: false,
      success: function (response){
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
}

function SignAsDesigner(b){
  $(".signdesigner").on("click", function () {
    var SignAs = $(this).attr("asid");
    Swal.fire({
      title: "<h3>Sign MPP ini ?</h3>",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url     : `../RND_BackEnd/backend_mpp/sign/designer`,
          headers: {
            user  : VUserName,
            token : VToken
          },
          data: {
            IdMPP   : IdMPP,
            SignAs  : SignAs,
            Username: VUserName
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
              IsResponseFalse(obj.message);
            } else {
              //Send Email Notification Service
              var dlink = Ucrypt.encrypt(IdMPP, NonceValue);
              $.ajax({
                type    : "POST",
                url     : `../RND_BackEnd/backend_mpp/email/notif-sign`,
                cache   : false,
                headers : {
                  user  : VUserName,
                  token : VToken
                },
                data: {
                  IdMPP   : IdMPP,
                  SignAs  : SignAs,
                  Username: VUserName,
                  Dlink   : 'listkebutuhanmpp&i='+dlink,
                  // Dlink   : 'listkebutuhanmpp&i='+IdMPP,
                },
              });
              IsResponseTrue(obj.message);
              LoadSign(b);
            }
          },
          error: function () {
            IsTimeOut(LogoutProtect);
          },
        });
      }
    });
  });


  $(".signavoidcanceldesigner").on("click", function () {
    var SignAs = $(this).attr("asid");
    Swal.fire({
      title: "<h3>Tolak Cancel MPP dan jadikan MPP ini tetep aktif ?</h3>",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url     : `../RND_BackEnd/backend_mpp/avoidsign/designer`,
          headers: {
            user  : VUserName,
            token : VToken
          },
          data: {
            IdMPP   : IdMPP,
            SignAs  : SignAs,
            Username: VUserName
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
              IsResponseFalse(obj.message);
            } else {
              //Send Email Notification Service
              var dlink = Ucrypt.encrypt(IdMPP, NonceValue);
              $.ajax({
                type    : "POST",
                url     : `../RND_BackEnd/backend_mpp/email/notif-rejectcancel`,
                cache   : false,
                headers : {
                  user  : VUserName,
                  token : VToken
                },
                data: {
                  IdMPP   : IdMPP,
                  SignAs  : SignAs,
                  Username: VUserName,
                  Dlink   : 'listkebutuhanmpp&i='+dlink,
                  // Dlink   : 'listkebutuhanmpp&i='+IdMPP,
                },
              });
              IsResponseTrue(obj.message);
              LoadSign(b);
            }
          },
          error: function () {
            IsTimeOut(LogoutProtect);
          },
        });
      }
    });
  });


}

function SignApproveHeadOf(c){
  $(".signapprove").on("click", function () {
    var SignAs = $(this).attr("asid");
    Swal.fire({
      title: "<h3>Approve MPP ini ?</h3>",
      confirmButtonText: "Ya",
      showCancelButton: true,
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "POST",
          url     : `../RND_BackEnd/backend_mpp/sign/designer`,
          headers: {
            user  : VUserName,
            token : VToken
          },
          data: {
            IdMPP   : IdMPP,
            SignAs  : SignAs,
            Username: VUserName
          },
          cache: false,
          success: function (response) {
            var obj = JSON.parse(response);
            if (obj.status == false) {
              IsResponseFalse(obj.message);
            } else {
              //Send Email Notification Service
              var dlink = Ucrypt.encrypt(IdMPP, NonceValue);
              $.ajax({
                type    : "POST",
                url     : `../RND_BackEnd/backend_mpp/email/notif-sign`,
                cache   : false,
                headers : {
                  user  : VUserName,
                  token : VToken
                },
                data: {
                  IdMPP   : IdMPP,
                  SignAs  : SignAs,
                  Username: VUserName,
                  Dlink   : 'listkebutuhanmpp&i='+dlink,
                },
              });
              IsResponseTrue(obj.message);
              LoadSign(c);
            }
          },
          error: function () {
            IsTimeOut(LogoutProtect);
          },
        });
      }
    });
  });
}


function SignConfirmNegotiator(){
  $(".signconfirm").on("click", function () {
    $(".WindowSelectOpr").modal({ autofocus: false, closable : false, }).modal("show");
  });
}

function SignRejectHO(c){
  $(".BtnRejectHO").on("click", function (e) {
    var SignAs = $(this).attr("asid");
    $(".WindowReject").modal({ autofocus: false, closable : false, }).modal("show");
    $("#RjctAs").val(SignAs);
    $("#IdMPPReject").val(c);
  });
}

function SignRejectNego(d){
  $(".BtnRejectNego").on("click", function (e) {
    $(".WindowRejectNego").modal({ autofocus: false, closable : false, }).modal("show");
    $("#IdMPPRejectNego").val(d);
  });
}

function SignReturnNego(d){
  $(".BtnReturnNego").on("click", function (e) {
    $(".WindowReturnNego").modal({ autofocus: false, closable : false, }).modal("show");
    $("#IdMPPReturnNego").val(d);
  });
}

$("#ConfirmNegotiator").on("click", function () {
  var SignAs = "NEGO";
  var OprName = $('#HeaderNamaOperator').val();
  Swal.fire({
    title: "<h3>Confirm MPP ini ?</h3>",
    confirmButtonText: "Ya",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url     : `../RND_BackEnd/backend_mpp/sign/designer`,
        headers: {
          user  : VUserName,
          token : VToken
        },
        data: {
          IdMPP   : IdMPP,
          SignAs  : SignAs,
          Username: VUserName,
          UserOperator: OprName
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(response);
          if (obj.status == false) {
            IsResponseFalse(obj.message);
          } else {
            //Send Email Notification Service
            $.ajax({
              type    : "POST",
              url     : `../RND_BackEnd/backend_mpp/email/notif-mscconfirm`,
              cache   : false,
              headers : {
                user  : VUserName,
                token : VToken
              },
              data: {
                IdMPP   : IdMPP,
                SignAs  : SignAs,
                Username : VUserName,
                UserOperator: OprName
              },
            });
            IsResponseTrue(obj.message);
            LoadSign(IdMPP);
            $(".WindowSelectOpr").modal("hide");
          }
        },
        error: function () {
          IsTimeOut(LogoutProtect);
        },
      });
    }
  });
});


$("#HOReject").on("click", function () {
  var RejectAs  = $('#RjctAs').val();
  var Reason    = $('#RejectReason').val();
  var IdMMPReject = $('#IdMPPReject').val();
  $.ajax({
    type: "POST",
    url     : `../RND_BackEnd/backend_mpp/sign/reject/headof`,
    headers: {
      user  : VUserName,
      token : VToken
    },
    data: {
      IdMPP   : IdMPP,
      RejectAs: RejectAs,
      Username: VUserName,
      Reason  : Reason
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        IsResponseFalse(obj.message);
      } else {
        //Send Email Notification Service
        $.ajax({
          type    : "POST",
          url     : `../RND_BackEnd/backend_mpp/email/notif-horeject`,
          cache   : false,
          headers : {
            user  : VUserName,
            token : VToken
          },
          data: {
            IdMPP   : IdMPP,
            RejectAs: RejectAs,
            Username: VUserName,
            Reason  : Reason
          },
        });
        IsResponseTrue(obj.message);
        $(".WindowReject").modal("hide");
        LoadSign(IdMMPReject);
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
});


$("#NegoReject").on("click", function () {
  var Reason    = $('#RejectReasonNego').val();
  var Action    = "REJECT";
  $.ajax({
    type: "POST",
    url     : `../RND_BackEnd/backend_mpp/sign/reject/negotiator`,
    headers: {
      user  : VUserName,
      token : VToken
    },
    data: {
      IdMPP   : IdMPP,
      Username: VUserName,
      Action  : Action,
      Reason  : Reason
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        IsResponseFalse(obj.message);
      } else {
        //Send Email Notification Service
        $.ajax({
          type    : "POST",
          url     : `../RND_BackEnd/backend_mpp/email/notif-negoreject`,
          cache   : false,
          headers : {
            user  : VUserName,
            token : VToken
          },
          data: {
            IdMPP   : IdMPP,
            Action  : Action,
            Username: VUserName,
            Reason  : Reason
          },
        });
        IsResponseTrue(obj.message);
        $(".WindowRejectNego").modal("hide");
        LoadSign(IdMPP);
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
});


$("#NegoReturn").on("click", function () {
  var Reason    = $('#ReturnReasonNego').val();
  var Action    = "RETURN";
  $.ajax({
    type: "POST",
    url     : `../RND_BackEnd/backend_mpp/sign/reject/negotiator`,
    headers: {
      user  : VUserName,
      token : VToken
    },
    data: {
      IdMPP   : IdMPP,
      Username: VUserName,
      Action  : Action,
      Reason  : Reason
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        IsResponseFalse(obj.message);
      } else {
        //Send Email Notification Service
        $.ajax({
          type    : "POST",
          url     : `../RND_BackEnd/backend_mpp/email/notif-negoreject`,
          cache   : false,
          headers : {
            user  : VUserName,
            token : VToken
          },
          data: {
            IdMPP   : IdMPP,
            Action  : Action,
            Username: VUserName,
            Reason  : Reason
          },
        });
        IsResponseTrue(obj.message);
        $(".WindowReturnNego").modal("hide");
        LoadSign(IdMPP);
      }
    },
    error: function () {
      IsTimeOut(LogoutProtect);
    },
  });
});


$(document).ready(function () {

  LoadDataHeaderMPP(IdMPP);
  
  LoadSign(IdMPP);

  $('#SaveKebutuhan').on('click', function() {
    SaveKebutuhan();
  });

  $('#SaveKebutuhanToAll').on('click', function() {
    SaveKebutuhanToAll();
  });

  

  $(".BtnRejectNego").on("click", function (e) {
    $(".WindowRejectNego").modal({ autofocus: false, closable : false, }).modal("show");
  });

  $(".BtnReturnNego").on("click", function (e) {
    $(".WindowReturnNego").modal({ autofocus: false, closable : false, }).modal("show");
  });

  $("#TableList").on("click", ".BtnEditKebutuhan", function(){
    var idx = $(this).attr('eid');
    var scx = $(this).attr('esc');
    $(".WindowEditKebutuhan").modal({ autofocus: false, closable : false, }).modal("show");
    LoadDataItemMPP(idx,scx);
  });


  // Download XLS
  // $('#DownloadMPPKebutuhan').on('click', function () {
  //   $.redirect(
  //     "./?link=downloadmppkebutuhan",
  //     {
  //       id: IdMPP,
  //       search: $('#fcari_mpp').val(),
  //       salescontract: $('#fsales_mpp').val(),
  //       resin: $('#fresin_mpp').val(),
  //       color: $('#fcolor_mpp').val(),
  //     },
  //     "POST",
  //     "_blank"
  //   )
  // });


  $('#DownloadMPPKebutuhan').on('click', function() {
    $.ajax({
      type    : "GET",
      // url     : `${restlocpscxls}DownloadLabelPacking`,
      url     : `${restlocpscxls}DownloadMPPKebutuhan`,
      headers: {
        user  : VUserName,
        token : VToken
      },
      data: {
        id: IdMPP,
        search: $('#fcari_mpp').val(),
        salescontract: $('#fsales_mpp').val(),
        resin: $('#fresin_mpp').val(),
        color: $('#fcolor_mpp').val(),
      },
      cache: false,
      success: function (response){
        // window.location.href = "../RND_Upload/MPP/MppLabelPacking_.xlsx";
        window.location.href = "../RND_Upload/MPP/MPPKebutuhan_.xlsx";
      },
      error: function () {
        IsTimeOut(LogoutProtect);
      },
    });
  });



  $(".CloseModal").on("click", function (e) {
    $(".WindowEditKebutuhan").modal("hide");
    $(".WindowReject").modal("hide");
    $(".WindowRejectNego").modal("hide");
    $(".WindowReturnNego").modal("hide");
    $(".WindowSelectOpr").modal("hide");
  });

  if (DSect === "MULTI SOURCING"){
    $('.accorddesign').removeClass('active');
    $('.accordhopl').removeClass('active');
    $('.accordnego').addClass('active');
  } else if((DJbtn === "HEAD OF" || DJbtn === "PROJECT LEADER") && DSect != "MULTI SOURCING"){
    $('.accorddesign').removeClass('active');
    $('.accordhopl').addClass('active');
    $('.accordnego').removeClass('active');
  } else {
    $('.accorddesign').addClass('active');
    $('.accordhopl').removeClass('active');
    $('.accordnego').removeClass('active');
  }



  //RESPON KETIKA INPUT PENCARIAN DI KETIK
  $("#submitfilter").on("click", function () {
    var FilterCari  = $("#fcari_mpp").val();
    var FilterSales = $("#fsales_mpp").val();
    var FilterResin = $("#fresin_mpp").val();
    var FilterColor = $("#fcolor_mpp").val();
    var FiterArry   = [FilterCari, FilterSales, FilterResin, FilterColor];
    var JsonFilter  = JSON.stringify(FiterArry);
    setCookie("FilterMPPKebutuhan", JsonFilter, 5);
    $("#TableList").DataTable().destroy();
    TableListFunc();
    $("#TableList").DataTable().page(0).draw();
  });

  //RESPON KETIKA FILTER DI RUBAH
  $("#fsales_mpp, #fresin_mpp, #fcolor_mpp").on("change", function () {
    var FilterCari  = $("#fcari_mpp").val();
    var FilterSales = $("#fsales_mpp").val();
    var FilterResin = $("#fresin_mpp").val();
    var FilterColor = $("#fcolor_mpp").val();
    var FiterArry   = [FilterCari, FilterSales, FilterResin, FilterColor];
    var JsonFilter  = JSON.stringify(FiterArry);
    setCookie("FilterMPPKebutuhan", JsonFilter, 5);
    TableListFunc();
    $("#TableList").DataTable().page(0).draw();
  });

  //RESET FILTER
  $(".resetfilter").on("click", function () {
    $("#fcari_mpp").val("");
    $("#fsales_mpp").dropdown("set selected", "ALL");
    $("#fresin_mpp").dropdown("set selected", "ALL");
    $("#fcolor_mpp").dropdown("set selected", "ALL");
    var FiterArry = ["", "ALL", "ALL", "ALL"];
    var JsonFilter = JSON.stringify(FiterArry);
    setCookie("FilterMPPKebutuhan", JsonFilter, 5);
    $("#TableList").DataTable().destroy();
    TableListFunc("", "ALL", "ALL", "ALL");
    $("#TableList").DataTable().page(0).draw();
  });


});