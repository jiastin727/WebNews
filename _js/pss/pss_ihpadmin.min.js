//Activate dropdown & tab
$(".ui.pssdropdown").dropdown();
$(".ui.dropdown").dropdown();
$(".menu .item").tab();
$(".changenego").dropdown({
  selectOnKeydown: false,
});
// moment().format();

// Global Variable
const ColorOwner = "#00139f";
const ColorActivity = "#7d7d7d";
const ColorFinish = "#5d5d5d";
const ColorCancel = "#7c0000";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocpssopr = decodeURIComponent(getCookie("restlocpssopr"));
var restlocpssihp = decodeURIComponent(getCookie("restlocpssihp"));

function TableListFunc(FSearch, FYear, FBagian, FOperator, FStatus) {
  $("#PSSList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned eight wide column'B>" +
      "<'right aligned eight wide column'p>" +
      ">" +
      ">",
    buttons: [
      {
        text: "10",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(10).draw();
        },
      },
      {
        text: "25",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(25).draw();
        },
      },
      {
        text: "50",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(50).draw();
        },
      },
      {
        text: "100",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(100).draw();
        },
      },
      {
        text: "1000",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(1000).draw();
        },
      },
    ],
    destroy: true,
    stateSave: true,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    scrollX     : true,
    pageLength: 10,
    data: [],
    language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Search..",
      processing: '<i class="circle notch loading icon huge"></i>',
    },
    order: [[2, "desc"]],
    columns: [
      {
        data: null,
        render: function (data) {
          // if (data[19] == "NO_DATA") {
          //   return "";
          // } else {
            // return `<i class="detailpss tasks circular grey link icon" idpss="${data[14]}" iditem="${data[15]}">`;
            return "<span class='detailpss' idpss='"+data['id_pss']+"' iditem='"+data['id_item']+"' data-tooltip='View detail IHP' data-inverted='' data-position='right center'><i class='tasks circular grey icon link'></i></span>";
          // }
        },
      },
      {
        data: null,
        render: function (data) {
          if (
            data['no_ihp'] &&
            (!data['pic_placein'] || data['pic_placein'] == null) &&
            data['progress'] == "PLACE-IN"
          ) {
            // return `<div class="ui teal horizontal label"><span class="placeinihp" iditem="${data[15]}">Receive</span></div>`;
            // return `<i class="sign in alternate clockwise rotated circular teal icon link"></i>`
            return "<span class='placeinihp' iditem='"+data['id_item']+"' data-tooltip='Konfirmasi IHP diterima' data-inverted='' data-position='right center'><i class='handshake outline circular violet icon link'></i></span>";
          } else {
            return '';
          }
        },
      },
      // {
      //   data: null,
      //   render: function (data) {
      //     if (data[19] == "NO_DATA") {
      //       return data[19];
      //     } else {
      //       return data[11];
      //     }
      //   },
      // },
      { data: 'tanggal_ihp' },
      { data: 'no_ihp' },
      { data: 'description_item' },
      { data: 'vendor_material_number' },
      { data: 'vendor' },
      { data: 'product' },
      { data: 'negosiator' },
      { data: 'operator' },
      { data: 'designer' },
      { data: 'status_item' },
      { data: 'qty_confirm' },
      {
        data: null,
        render: function (data) {
          if (
            data['no_ihp'] &&
            (!data['pic_placein'] || data['pic_placein'] == null) &&
            data['progress'] == "PLACE-IN"
          ) {
            return '';
          } else {
            return data['pic_placein'];
          }
        },
      },
      { data: 'tanggal_placein' },
    ],
    columnDefs: [
      { className: "center aligned", targets: [0, 12] },
      { className: "right aligned", targets: [1,14] },
      { targets: [0,1], orderable: false },
      { targets: [2, 14],
        render: function (data, type, row) {
          var dateObj = new Date(data);
          var momentObj = moment(dateObj);
          if (data){
            return momentObj.format('ddd, DD MMM YYYY');
          } else {
            return '';
          }
        }
      }
    ],

    createdRow: function (row, data, index) {
      
      //WARNA IHP
      if (data['status_item'] == "IHP") {
        $(row).find("td").css("color", ColorActivity);
      }
    },

    ajax: {
      url: `${restlocpssopr}table_placein`,
      type: "POST",
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        FSearch: FSearch,
        FYear: FYear,
        FBagian: FBagian,
        FOperator: FOperator,
        FStatus: FStatus,
      },
      error: function () {
        window.location.href = "./?link=loclogout";
        Swal.fire(
          "Error",
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
          "error"
        );
      },
    },
  });
}

//Click Place-In Button
$("#PSSList").on("click", ".placeinihp", function () {
  var iditem = $(this).attr("iditem");
  var user = $("#OprUsername").val();
  Swal.fire({
    title: "<h3>Terima IHP ini ?</h3>",
    text:
      "Pastikan anda telah menerima material yang sesuai dengan No IHP ini.",
    icon: "question",
    confirmButtonText: "Ya",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `${restlocpssopr}update_placein`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          user: user,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(JSON.parse(response));
          if (obj.status == false) {
            Swal.fire(
              "Error",
              "Ada kendal di koneksi/database, data tidak tersimpan !",
              "error"
            );
          } else {
            Swal.fire({
              title: "Received !",
              timer: 1500,
              position: "top-end",
              icon: "success",
              showConfirmButton: false,
            });
            LoadTableList();
          }
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          Swal.fire(
            "Error",
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
            "error"
          );
        },
      });
    }
  });
});

$("#PSSList").on("click", ".detailpss", function () {
  var idpss = $(this).attr("idpss");
  var iditem = $(this).attr("iditem");
  $.ajax({
    type: "POST",
    // url: `${restlocpssihp}load_itemihp`,
    url: `${restlocpssihp}load_itemihpev`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      idpss: idpss,
      iditem: iditem,
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);

      if (isEmpty(obj)) {
        console.log("-Empty-");
        $("#ItemListPSStbody").empty();
        return false;
      } else if (obj) {
        $("#ItemListPSStbody").empty();
        $("#IHPNo").text(obj["read_item"][0]["no_ihp"]);
        $("#IHPDate").text(obj["read_item"][0]["tanggal_ihp"]);
        $("#IHPNoPSS").text(obj["read_item"][0]["ps_no"]);
        $("#IHPChassis").text(obj["read_item"][0]["chasis"]);
        $("#IHPType").text(obj["read_item"][0]["type"]);
        $("#IHPNegoName").text(obj["read_item"][0]["negosiator"]);
        $("#IHPDesgName").text(obj["read_item"][0]["designer"]);
        $("#IHPDescription").text(obj["read_item"][0]["description_item"]);
        $("#IHPCategory").text(obj["read_item"][0]["jenis_project"]);
        $("#IHPVendorMatNum").text(obj["read_item"][0]["vendor_material_number"]);
        $("#IHPVendor").text(obj["read_item"][0]["vendor"]);
        $("#IHPManufacture").text(obj["read_item"][0]["manufacture"]);
        $("#IHPNoGudang").text(obj["read_item"][0]["no_gudang"]);
        $("#IHPIdItem").val(iditem);

        if (obj["read_ihpev"]["status"] !== false) {
          var stsel = obj["read_ihpev"][0]["status_electronic"];
          var stscy = obj["read_ihpev"][0]["status_cycle"];
          var stsme = obj["read_ihpev"][0]["status_mechanic"];
          var stsid = obj["read_ihpev"][0]["status_ind"];
          var stsso = obj["read_ihpev"][0]["status_software"];
          var stspc = obj["read_ihpev"][0]["status_pcb"];
          var stsmq = obj["read_ihpev"][0]["status_mqa"];
          var stsdq = obj["read_ihpev"][0]["status_dqa"];
          var stsat = obj["read_ihpev"][0]["status_autrans"];
          var stsot = obj["read_ihpev"][0]["status_others"];
          var stso1 = obj["read_ihpev"][0]["status_others1"];
          var stso2 = obj["read_ihpev"][0]["status_others2"];
  
          var docel = obj["read_ihpev"][0]["acuan_electronic"];
          var doccy = obj["read_ihpev"][0]["acuan_cycle"];
          var docme = obj["read_ihpev"][0]["acuan_mechanic"];
          var docid = obj["read_ihpev"][0]["acuan_ind"];
          var docso = obj["read_ihpev"][0]["acuan_software"];
          var docpc = obj["read_ihpev"][0]["acuan_pcb"];
          var docmq = obj["read_ihpev"][0]["acuan_mqa"];
          var docdq = obj["read_ihpev"][0]["acuan_dqa"];
          var docat = obj["read_ihpev"][0]["acuan_autrans"];
          var docot = obj["read_ihpev"][0]["acuan_others"];
          var doco1 = obj["read_ihpev"][0]["acuan_others1"];
          var doco2 = obj["read_ihpev"][0]["acuan_others2"];
  
          var lnkel = obj["read_ihpev"][0]["link_electronic"];
          var lnkcy = obj["read_ihpev"][0]["link_cycle"];
          var lnkme = obj["read_ihpev"][0]["link_mechanic"];
          var lnkid = obj["read_ihpev"][0]["link_ind"];
          var lnkso = obj["read_ihpev"][0]["link_software"];
          var lnkpc = obj["read_ihpev"][0]["link_pcb"];
          var lnkmq = obj["read_ihpev"][0]["link_mqa"];
          var lnkdq = obj["read_ihpev"][0]["link_dqa"];
          var lnkat = obj["read_ihpev"][0]["link_autrans"];
          var lnkot = obj["read_ihpev"][0]["link_others"];
          var lnko1 = obj["read_ihpev"][0]["link_others1"];
          var lnko2 = obj["read_ihpev"][0]["link_others2"];
  
          var cfmel = obj["read_ihpev"][0]["date_status_electronic"];
          var cfmcy = obj["read_ihpev"][0]["date_status_cycle"];
          var cfmme = obj["read_ihpev"][0]["date_status_mechanic"];
          var cfmid = obj["read_ihpev"][0]["date_status_ind"];
          var cfmso = obj["read_ihpev"][0]["date_status_software"];
          var cfmpc = obj["read_ihpev"][0]["date_status_pcb"];
          var cfmmq = obj["read_ihpev"][0]["date_status_mqa"];
          var cfmdq = obj["read_ihpev"][0]["date_status_dqa"];
          var cfmat = obj["read_ihpev"][0]["date_status_autrans"];
          var cfmot = obj["read_ihpev"][0]["date_status_others"];
          var cfmo1 = obj["read_ihpev"][0]["date_status_others1"];
          var cfmo2 = obj["read_ihpev"][0]["date_status_others2"];
  
          var picel = obj["read_ihpev"][0]["pic_confirm_electronic"];
          var piccy = obj["read_ihpev"][0]["pic_confirm_cycle"];
          var picme = obj["read_ihpev"][0]["pic_confirm_mechanic"];
          var picid = obj["read_ihpev"][0]["pic_confirm_ind"];
          var picso = obj["read_ihpev"][0]["pic_confirm_software"];
          var picpc = obj["read_ihpev"][0]["pic_confirm_pcb"];
          var picmq = obj["read_ihpev"][0]["pic_confirm_mqa"];
          var picdq = obj["read_ihpev"][0]["pic_confirm_dqa"];
          var picat = obj["read_ihpev"][0]["pic_confirm_autrans"];
          var picot = obj["read_ihpev"][0]["pic_confirm_others"];
          var pico1 = obj["read_ihpev"][0]["pic_confirm_others1"];
          var pico2 = obj["read_ihpev"][0]["pic_confirm_others2"];
  
          var pic1 = obj["read_checker"][0]["checker_electronic"];
          var pic2 = obj["read_checker"][0]["checker_cycle"];
          var pic3 = obj["read_checker"][0]["checker_mechanic"];
          var pic4 = obj["read_checker"][0]["checker_ind"];
          var pic5 = obj["read_checker"][0]["checker_software"];
          var pic6 = obj["read_checker"][0]["checker_pcb"];
          var pic7 = obj["read_checker"][0]["checker_mqa"];
          var pic8 = obj["read_checker"][0]["checker_dqa"];
          var pic9 = obj["read_checker"][0]["checker_autrans"];
          var pic10 = obj["read_checker"][0]["checker_others"];
          var pic11 = obj["read_checker"][0]["checker_others1"];
          var pic12 = obj["read_checker"][0]["checker_others2"];
  
          var chkel = obj["read_checker"][0]["checker_electronic"];
          var chkcy = obj["read_checker"][0]["checker_cycle"];
          var chkme = obj["read_checker"][0]["checker_mechanic"];
          var chkid = obj["read_checker"][0]["checker_ind"];
          var chkso = obj["read_checker"][0]["checker_software"];
          var chkpc = obj["read_checker"][0]["checker_pcb"];
          var chkmq = obj["read_checker"][0]["checker_mqa"];
          var chkdq = obj["read_checker"][0]["checker_dqa"];
          var chkat = obj["read_checker"][0]["checker_autrans"];
          var chkot = obj["read_checker"][0]["checker_others"];
          var chko1 = obj["read_checker"][0]["checker_others1"];
          var chko2 = obj["read_checker"][0]["checker_others2"];
  
  
          if (lnkel && lnkel!==null) {
            if(!docel){ var docel = "Dokumen Electronic"; }
            var linkel =
              '<a target="_blank" href="../RND_Upload/' + lnkel + '">' + ShortText(docel) + "</a>";
          } else {
            var linkel = ShortText(docel);
          }
  
          if (lnkcy) {
            if(!doccy){ var doccy = "Dokumen Energy Conversion"; }
            var linkcy =
              '<a target="_blank" href="../RND_Upload/' + lnkcy + '">' + ShortText(doccy) + "</a>";
          } else {
            var linkcy = ShortText(doccy);
          }
          if (lnkme) {
            if(!docme){ var docme = "Dokumen Mechanic"; }
            var linkme =
              '<a target="_blank" href="../RND_Upload/' + lnkme + '">' + ShortText(docme) + "</a>";
          } else {
            var linkme = ShortText(docme);
          }
          if (lnkid) {
            if(!docid){ var docid = "Dokumen Industrial Design"; }
            var linkid =
              '<a target="_blank" href="../RND_Upload/' + lnkid + '">' + ShortText(docid) + "</a>";
          } else {
            var linkid = ShortText(docid);
          }
          if (lnkso) {
            if(!docso){ var docso = "Dokumen Software"; }
            var linkso =
              '<a target="_blank" href="../RND_Upload/' + lnkso + '">' + ShortText(docso) + "</a>";
          } else {
            var linkso = ShortText(docso);
          }
          if (lnkpc) {
            if(!docpc){ var docpc = "Dokumen PCB"; }
            var linkpc =
              '<a target="_blank" href="../RND_Upload/' + lnkpc + '">' + ShortText(docpc) + "</a>";
          } else {
            var linkpc = ShortText(docpc);
          }
          if (lnkmq) {
            if(!docmq){ var docmq = "Dokumen MQA"; }
            var linkmq =
              '<a target="_blank" href="../RND_Upload/' + lnkmq + '">' + ShortText(docmq) + "</a>";
          } else {
            var linkmq = ShortText(docmq);
          }
          if (lnkdq) {
            if(!docdq){ var docdq = "Dokumen DQA"; }
            var linkdq =
              '<a target="_blank" href="../RND_Upload/' + lnkdq + '">' + ShortText(docdq) + "</a>";
          } else {
            var linkdq = ShortText(docdq);
          }
          if (lnkat) {
            if(!docat){ var docat = "Dokumen Autrans"; }
            var linkat =
              '<a target="_blank" href="../RND_Upload/' + lnkat + '">' + ShortText(docat) + "</a>";
          } else {
            var linkat = ShortText(docat);
          }
          if (lnkot) {
            if(!docot){ var docot = "Dokumen Others"; }
            var linkot =
              '<a target="_blank" href="../RND_Upload/' + lnkot + '">' + ShortText(docot) + "</a>";
          } else {
            var linkot = ShortText(docot);
          }
          if (lnko1) {
            if(!doco1){ var doco1 = "Dokumen Others 1"; }
            var linko1 =
              '<a target="_blank" href="../RND_Upload/' + lnko1 + '">' + ShortText(doco1) + "</a>";
          } else {
            var linko1 = ShortText(doco1);
          }
          if (lnko2) {
            if(!doco2){ var doco2 = "Dokumen Others 2"; }
            var linko2 =
              '<a target="_blank" href="../RND_Upload/' + lnko2 + '">' + ShortText(doco2) + "</a>";
          } else {
            var linko2 = ShortText(doco2);
          }
  
  
          $("#ElSign").text(picel);
          $("#EcSign").text(piccy);
          $("#MeSign").text(picme);
          $("#IdSign").text(picid);
          $("#SoSign").text(picso);
          $("#PcSign").text(picpc);
          $("#MqSign").text(picmq);
          $("#DqSign").text(picdq);
          $("#AuSign").text(picat);
          $("#OtSign").text(picot);
          $("#O1Sign").text(pico1);
          $("#O2Sign").text(pico2);

          $("#ElRslt").text(stsel);
          $("#EcRslt").text(stscy);
          $("#MeRslt").text(stsme);
          $("#IdRslt").text(stsid);
          $("#SoRslt").text(stsso);
          $("#PcRslt").text(stspc);
          $("#MqRslt").text(stsmq);
          $("#DqRslt").text(stsdq);
          $("#AuRslt").text(stsat);
          $("#OtRslt").text(stsot);
          $("#O1Rslt").text(stso1);
          $("#O2Rslt").text(stso2);
  
          $("#ElDate").text(DateIHPEval(cfmel));
          $("#EcDate").text(DateIHPEval(cfmcy));
          $("#MeDate").text(DateIHPEval(cfmme));
          $("#IdDate").text(DateIHPEval(cfmid));
          $("#SoDate").text(DateIHPEval(cfmso));
          $("#PcDate").text(DateIHPEval(cfmpc));
          $("#MqDate").text(DateIHPEval(cfmmq));
          $("#DqDate").text(DateIHPEval(cfmdq));
          $("#AuDate").text(DateIHPEval(cfmat));
          $("#OtDate").text(DateIHPEval(cfmot));
          $("#O1Date").text(DateIHPEval(cfmo1));
          $("#O2Date").text(DateIHPEval(cfmo2));
  
          $("#ElDocs").html(linkel);
          $("#EcDocs").html(linkcy);
          $("#MeDocs").html(linkme);
          $("#IdDocs").html(linkid);
          $("#SoDocs").html(linkso);
          $("#PcDocs").html(linkpc);
          $("#MqDocs").html(linkmq);
          $("#DqDocs").html(linkdq);
          $("#AuDocs").html(linkat);
          $("#OtDocs").html(linkot);
          $("#O1Docs").html(linko1);
          $("#O2Docs").html(linko2);
  
          function DateIHPEval(d){
            if(d){
              return moment(d).format('ddd, DD MMM YYYY');
            } else {
              return d;
            }
          }
  
        } else {
          console.log("Developer Note: Table Error, table kosong/belum terisi ");
        }

        

      }
    },
    error: function () {
      // window.location.href = "./?link=loclogout";
      console.log(
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
      );
    },
  });
  $(".windowdetailitem").modal("show");
});

function LoadTableList() {
  //Read Filter Cookies
  var d = new Date();
  var yearnow = d.getFullYear();
  var sfilter = getCookie("sfilpss");
  var tfilter = getCookie("tfilpss");
  var bfilter = getCookie("bfilpss");
  var ofilter = getCookie("jfilpss");
  var stfilter = getCookie("stfilpss");
  if (sfilter) {
    $("#filtercari").val(sfilter);
    var sfilterstart = sfilter;
  } else {
    setCookie("sfilpss", "", 5);
    var sfilterstart = "";
  }
  if (tfilter) {
    $("#filtertahun").dropdown("set selected", tfilter);
    var tfilterstart = tfilter;
  } else {
    setCookie("tfilpss", yearnow, 5);
    var tfilterstart = yearnow;
  }
  if (bfilter) {
    $("#filterbagian").dropdown("set selected", bfilter);
    var bfilterstart = bfilter;
  } else {
    setCookie("bfilpss", "ALL", 5);
    var bfilterstart = "ALL";
  }
  if (ofilter) {
    $("#filteroperator").dropdown("set selected", ofilter);
    var ofilterstart = ofilter;
  } else {
    setCookie("ofilpss", "ALL", 5);
    var ofilterstart = "ALL";
  }

  if (stfilter) {
    $("#filterstatus").dropdown("set selected", stfilter);
    var stfilterstart = stfilter;
  } else {
    setCookie("stfilpss", "ALL", 5);
    var stfilterstart = "ALL";
  }
  //Load Table
  TableListFunc(
    sfilterstart,
    tfilterstart,
    bfilterstart,
    ofilterstart,
    stfilterstart
  );
}

//RESPON KETIKA INPUT PENCARIAN DI KETIK
$("#filtercari").on("keyup", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterBagian = $("#filterbagian").val();
  var FilterOperator = $("#filteroperator").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("sfilpss", FilterCari, 5);
  setCookie("tfilpss", FilterTahun, 5);
  setCookie("bfilpss", FilterBagian, 5);
  setCookie("ofilpss", FilterOperator, 5);
  setCookie("stfilpss", FilterStatus, 5);
  $("#PSSList").DataTable().destroy();
  TableListFunc(
    FilterCari,
    FilterTahun,
    FilterBagian,
    FilterOperator,
    FilterStatus
  );
});

//RESPON KETIKA FILTER TAHUN DI RUBAH
$("#filtertahun, #filteroperator, #filterbagian, #filterstatus").on(
  "change",
  function () {
    var FilterCari = $("#filtercari").val();
    var FilterTahun = $("#filtertahun").val();
    var FilterBagian = $("#filterbagian").val();
    var FilterOperator = $("#filteroperator").val();
    var FilterStatus = $("#filterstatus").val();
    setCookie("sfilpss", FilterCari, 5);
    setCookie("tfilpss", FilterTahun, 5);
    setCookie("bfilpss", FilterBagian, 5);
    setCookie("ofilpss", FilterOperator, 5);
    setCookie("stfilpss", FilterStatus, 5);
    $("#PSSList").DataTable().destroy();
    TableListFunc(
      FilterCari,
      FilterTahun,
      FilterBagian,
      FilterOperator,
      FilterStatus
    );
  }
);

//RESET FILTER
$(".resetfilter").on("click", function () {
  var d = new Date();
  var yearnow = d.getFullYear();
  $("#filtercari").val("");
  $("#filtertahun").dropdown("set selected", yearnow);
  $("#filterbagian").dropdown("set selected", "ALL");
  $("#filteroperator").dropdown("set selected", "ALL");
  $("#filterstatus").dropdown("set selected", "ALL");
  setCookie("sfilpss", "", 5);
  setCookie("tfilpss", yearnow, 5);
  setCookie("bfilpss", "ALL", 5);
  setCookie("ofilpss", "ALL", 5);
  setCookie("stfilpss", "ALL", 5);
  $("#PSSList").DataTable().destroy();
  TableListFunc("", yearnow, "ALL", "ALL", "ALL");
});

function ShortText(t){
  if(t){
    var lennamafile = t.length;
    return lennamafile > 40 ? t.substring(0, 40).concat('...') : t;
  } else {
    return '';
  }
}

$(document).ready(function () {
  LoadTableList();

  // Download XLS
  $("#dwnldxls").on('click', function() {
    var iddownload = "IHPPLACEIN";
    var search = $('#filtercari').val();
    var thnfilter = $('#filtertahun').val();
    var bagfilter = $('#filterbagian').val();
    var oprfilter = $('#filteroperator').val();
    var stsfilter = $('#filterstatus').val();

    $.redirect(
      "./?link=ihpdwnldxls",
      {
        id: iddownload,
        search: search,
        thnfilter: thnfilter,
        bagfilter: bagfilter,
        oprfilter: oprfilter,
        stsfilter: stsfilter
      },
      "POST",
      "_blank"
    )
  });


  $(".CloseModal").on("click", function (e) {
    $(".windowdetailitem").modal("hide");
  });


});
//------------------------------------------------------------------------------------
