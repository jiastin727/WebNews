//Activate dropdown & tab
$(".ui.pssdropdown").dropdown();
$(".ui.dropdown").dropdown();
$(".menu .item").tab();
moment().format();

// Global Variable for Header Authorization
const NonceValue = "rdsystem2020";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocpssihp = decodeURIComponent(getCookie("restlocpssihp"));
let Ucrypt = new Encryption();
var Udecrypt = Ucrypt.decrypt(EncU, NonceValue);
var Sdecrypt = Ucrypt.decrypt(EncS, NonceValue);
var SIHP = EncSIHP;

const ColorOwner = "#00139f";

const ihpprogress_a = "PROCESS"; //POSISI DI OPERATOR
const ihpprogress_b = "IHP"; //POSISI DI OPERATOR SETELAH KLIK TOMBOL CREATE IHP
const ihpprogress_c = "PLACE-IN"; //OPERATOR KIRIM KE DESIGNER
const ihpprogress_d = "DESIGNER"; //DESIGNER CONFIRM

const ihpprogress_e = "REQ-APPROVAL"; //DESIGNER CLICK REQUEST SHD APPROVAL
const ihpprogress_f = "APPROVED"; //SHD APPROVED IHP
const ihpprogress_g = "-"; //STATUS FINISH-CLOSE
const ihpprogress_h = "IHP KEMBALI"; //IHP DIKEMBALIKAN KE OPERATOR MSC
const ihpprogress_i = "DONE"; //IHP SELESAI

function TableListFunc(FSearch, FYear, FStatus) {
  $("#IHPList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned seven wide column'B>" +
      "<'left aligned two wide column'i>" +
      "<'right aligned seven wide column'p>" +
      ">" +
      ">",
    buttons: [
      {
        text: "10",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(10).draw();
        },
      },
      {
        text: "25",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(25).draw();
        },
      },
      {
        text: "50",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(50).draw();
        },
      },
      {
        text: "100",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(100).draw();
        },
      },
      {
        text: "1000",
        action: function (e, dt, node, config) {
          $("#IHPList").DataTable().page.len(1000).draw();
        },
      },
    ],
    destroy: true,
    stateSave: true,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    scrollX     : true,
    pageLength: 10,
    data: [],
    language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Pencarian..",
      processing: '<i class="circle notch loading icon huge"></i>',
      info: "_START_ sampai _END_ dari _TOTAL_ total data",
      paginate: {
        "first":      "Awal",
        "last":       "Akhir",
        "next":       "Berikutnya",
        "previous":   "Sebelumnya"
      },
      infoEmpty:      "Tidak ada data",
    },
    order: [[1, "desc"]],
    columns: [
      {
        data: null,
        render: function (data, type, row) {
          if (data['no_ihp'] != "") {
            if (data['date_received']) {
              // return `<div class="ui green horizontal label editresult" idpss="${data[14]}" iditem="${data[15]}">Edit</div>`;

              return "<span class='editresult' idpss='"+data['id_pss']+"' iditem='"+data['id_item']+"' data-tooltip='Edit IHP Evaluation' data-inverted='' data-position='right center'><i class='pencil alternate circular teal icon link'></i></span>";
            } else {
              // return `<div class="ui teal horizontal label confirmreceive" idpss="${data[14]}" iditem="${data[15]}">Confirm</div>`;
              return "<span class='confirmreceive' idpss='"+data['id_pss']+"' iditem='"+data['id_item']+"' data-tooltip='Confirm IHP Evaluation' data-inverted='' data-position='right center'><i class='handshake outline circular violet icon link'></i></span>";
            }
          } else {
            return "";
          }
        },
      },
      { data: 'tanggal_ihp' },
      { data: 'no_ihp' },
      { data: 'description_item' },
      { data: 'vendor' },
      { data: 'product' },
      { data: 'chasis' },
      { data: 'type' },
      { data: 'qty_confirm' },
      { data: 'status_item' },
      { data: null,
        render: function (data, type, row) {
          if (data['signing'] !== null) {
            return "<i class='check icon'></i>";
          } else {
            return "";
          }
        },
      },
      { data: 'note' },
      
    ],
    columnDefs: [
      { className: "center aligned", targets: [8, 9, 10, 0] },
      { targets: [0], orderable: false },
      { targets: [1],
        render: function (data, type, row) {
          var dateObj = new Date(data);
          var momentObj = moment(dateObj);
          if (data){
            return momentObj.format('ddd, DD MMM YYYY');
          } else {
            return '';
          }
        }
      }
    ],

    createdRow: function (row, data, index) {

      //WARNA OWNER & STATUS ACTIVE/DRAFT
      if (data['signing'] == null ) {
        $(row).find("td").css("color", ColorOwner);
      }
    },
    
    ajax: {
      url: `${restlocpssihp}table_ihpev`,
      type: "POST",
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        FSearch: FSearch,
        FYear: FYear,
        FStatus: FStatus,
        User: Udecrypt,
        Section: Sdecrypt,
        SIHP: SIHP,
      },
      error: function () {
        // window.location.href = "./?link=loclogout";
        Swal.fire(
          "Error",
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
          "error"
        );
      },
    },
  });
}

//Click Icon Edit item IHP
$("#IHPList").on("click", ".editresult", function () {
  var iditem = $(this).attr("iditem");
  var idpss = $(this).attr("idpss");
  $(".windoweditihp").modal({ closable: false, autofocus: false }).modal("show");
  LoadTableResult(idpss, iditem);
});

function LoadTableResult(IDpssx, IDitemx) {
  $.ajax({
    type: "POST",
    url: `${restlocpssihp}load_itemihpev`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: { idpss: IDpssx, iditem: IDitemx },
    cache: false,
    success: function (response) {
      $("#PSSidx").val(IDpssx);
      $("#IHPidx").val(IDitemx);
      var obj = JSON.parse(response);
      
      if (obj["read_ihpev"]["status"] !== false) {

        var pic     = [];
        let chk     = "checker_";
        const sect  = ["", chk+"electronic", chk+"cycle", chk+"mechanic", chk+"ind", chk+"software", chk+"pcb", chk+"mqa", chk+"dqa", chk+"autrans", chk+"others", chk+"others1", chk+"others2"];

        const sname = ["", "ELECTRONIC H/W","ENERGY CONV","MECHANIC","INDUSTRIAL DESIGN","SOFTWARE","PCB","MQA","DQA","AUTRANS","OTHERS","OTHERS1","OTHERS2"];

        var progressitem = obj["read_item"][0]["progress_item"];

        $("#Bd_IHPResult").empty();
        for (let i = 0; i < sect.length; ++i) {
          if (i>0) {

            pic[i]    = obj["read_checker"][0][sect[i]];
            var jmlhasilev =obj["read_ihpev"][i].length;
            if(pic[i]){

              // if (progressitem == ihpprogress_d || progressitem == ihpprogress_e || progressitem == "ALL CHECKED") {
              if (progressitem == ihpprogress_d || progressitem == "ALL CHECKED") {
                if(pic[i] ===Udecrypt){
                  var BtnEdit = "<span data-position='left center' data-tooltip='Tambahkan hasil pengujian IHP yang baru' data-inverted=''><i class='plus blue link icon circular2 AddNewResultIHP' sidx='"+i+"'></i></span>";
                } else {
                  var BtnEdit = "-";
                }
              } else {
                var BtnEdit = "-";
              }

              if(jmlhasilev > 0){

                for (var a = 0; a < jmlhasilev; ++a) {
                  b=a+1;
                  var TestRst = obj["read_ihpev"][i][a]['result'];
                  var DocReff = IsNull(obj["read_ihpev"][i][a]['doc_ref']);
                  var CreateD = obj["read_ihpev"][i][a]['created_date'];
                  var SignBy  = IsNull(obj["read_ihpev"][i][a]['sign_by']);
                  var SignDt  = IsNull(obj["read_ihpev"][i][a]['date_sign']);
                  var NamaFile  = IsNull(obj["read_ihpev"][i][a]['nama_file']);

                  var lnkel = obj["read_ihpev"][0]["link_electronic"];
                  var LinkReport = "";
                  
                  if(NamaFile){
                    if(!DocReff) {
                      var NamaDocument = "Dokumen_report_IHP";
                    } else {
                      var NamaDocument = DocReff;
                    }
                    var LinkReport = "<a target='_blank' href='../RND_Upload/"+NamaFile+ "'>"+ShortText(NamaDocument)+'</a>';
                  } else {
                    var LinkReport = ShortText(DocReff);
                  }

                  if(jmlhasilev === b){
                    if(pic[i] ===Udecrypt){
                      if(SignBy){
                        if (progressitem == ihpprogress_d || progressitem == "ALL CHECKED") {
                          var BtnEdit = "<span data-position='left center' data-tooltip='Tambahkan hasil pengujian IHP yang barux' data-inverted=''><i class='plus blue link icon circular2 AddNewResultIHP' sidx='"+i+"'></i></span>";
                        } else {
                          var BtnEdit = "-";
                        }
                      } else {
                        if (progressitem == ihpprogress_d || progressitem == "ALL CHECKED") {
                          var BtnEdit = "<span data-position='left center' data-tooltip='Hapus report' data-inverted=''><i class='trash alternate outline red link icon circular2 DelResultIHP' sidx='"+i+"'></i></span> <a class='ui small label teal SignResultIHP' sidx='"+i+"' data-position='top right' data-tooltip='Sign report' data-inverted=''>Sign</a>";
                        } else {
                          var BtnEdit = "-";
                        }
                      }
                    } else {
                      var BtnEdit = "-";
                    }
                  } else {
                    var BtnEdit = "-";
                  }

                  if( a === 0){
                    $("#Tb_IHPResult").find("tbody").append(
                      "<tr>"+
                        "<td rowspan='"+jmlhasilev+"' style='text-align: right;'>"+sname[i]+"<br><b><sup>"+pic[i]+"</sup></b></td>"+
                        "<td>"+b+"</td>"+
                        "<td>"+TestRst+"</td>"+
                        "<td>"+LinkReport+"</td>"+
                        "<td>"+DateIHPEval2(CreateD)+"</td>"+
                        "<td>"+SignBy+"<br><sup>"+DateIHPEval2(SignDt)+"</sup></td>"+
                        "<td class='center aligned collapsing'>"+BtnEdit+"</td>"+
                      "</tr>"
                    );
                  } else {
                    $("#Tb_IHPResult").find("tbody").append(
                      "<tr>"+
                        "<td style='border-left: 1px solid #e8e9e9;'>"+b+"</td>"+
                        "<td>"+TestRst+"</td>"+
                        "<td>"+LinkReport+"</td>"+
                        "<td>"+DateIHPEval2(CreateD)+"</td>"+
                        "<td>"+SignBy+"<br><sup>"+DateIHPEval2(SignDt)+"</sup></td>"+
                        "<td class='center aligned collapsing'>"+BtnEdit+"</td>"+
                      "</tr>"
                    );
                  }
                }
              } else {
                $("#Tb_IHPResult").find("tbody").append(
                  "<tr>"+
                    "<td style='text-align: right;'>"+sname[i]+"<br><b><sup>"+pic[i]+"</sup></b></td>"+
                    "<td></td>"+
                    "<td></td>"+
                    "<td></td>"+
                    "<td></td>"+
                    "<td></td>"+
                    "<td class='center aligned collapsing'>"+BtnEdit+"</td>"+
                  "</tr>"
                );
              }
            }
          }
        }

        $(".AddNewResultIHP").on("click", function (e) {
          var a = $("#PSSidx").val();
          var b = $("#IHPidx").val();
          var c = $(this).attr('sidx');
          $(".windowaddresult").modal("show");
          $("#ResultIHP").val();
          $("#DocIHP").val();
          $("#fileupload").val();
          $("#PSSid2").val(a);
          $("#IHPid2").val(b);
          $("#IHPsid2").val(c);
        });


        // <tr id="trElect" class="">
        //   <td style="text-align: right;">ELECTRONIC HARDWARE</td>
        //   <td><span id="ElectSts"></span></td>
        //   <td><span id="ElectDateSts"></span></td>
        //   <td><span id="ElectDocReff"></span></td>
        //   <td><span id="ElectPIC"></span></td>
        //   <td style="text-align: center;"><span id="ElectSignBtn"></span></td>
        //   <td style="text-align: center;"><span id="ElectEdit"></span></td>
        // </tr>

        // var pic1 = obj["read_checker"][0]["checker_electronic"];
        // var pic2 = obj["read_checker"][0]["checker_cycle"];
        // var pic3 = obj["read_checker"][0]["checker_mechanic"];
        // var pic4 = obj["read_checker"][0]["checker_ind"];
        // var pic5 = obj["read_checker"][0]["checker_software"];
        // var pic6 = obj["read_checker"][0]["checker_pcb"];
        // var pic7 = obj["read_checker"][0]["checker_mqa"];
        // var pic8 = obj["read_checker"][0]["checker_dqa"];
        // var pic9 = obj["read_checker"][0]["checker_autrans"];
        // var pic10 = obj["read_checker"][0]["checker_others"];
        // var pic11 = obj["read_checker"][0]["checker_others1"];
        // var pic12 = obj["read_checker"][0]["checker_others2"];




        // var stsel = obj["read_ihpev"][0]["status_electronic"];
        // var stscy = obj["read_ihpev"][0]["status_cycle"];
        // var stsme = obj["read_ihpev"][0]["status_mechanic"];
        // var stsid = obj["read_ihpev"][0]["status_ind"];
        // var stsso = obj["read_ihpev"][0]["status_software"];
        // var stspc = obj["read_ihpev"][0]["status_pcb"];
        // var stsmq = obj["read_ihpev"][0]["status_mqa"];
        // var stsdq = obj["read_ihpev"][0]["status_dqa"];
        // var stsat = obj["read_ihpev"][0]["status_autrans"];
        // var stsot = obj["read_ihpev"][0]["status_others"];
        // var stso1 = obj["read_ihpev"][0]["status_others1"];
        // var stso2 = obj["read_ihpev"][0]["status_others2"];

        // var docel = obj["read_ihpev"][0]["acuan_electronic"];
        // var doccy = obj["read_ihpev"][0]["acuan_cycle"];
        // var docme = obj["read_ihpev"][0]["acuan_mechanic"];
        // var docid = obj["read_ihpev"][0]["acuan_ind"];
        // var docso = obj["read_ihpev"][0]["acuan_software"];
        // var docpc = obj["read_ihpev"][0]["acuan_pcb"];
        // var docmq = obj["read_ihpev"][0]["acuan_mqa"];
        // var docdq = obj["read_ihpev"][0]["acuan_dqa"];
        // var docat = obj["read_ihpev"][0]["acuan_autrans"];
        // var docot = obj["read_ihpev"][0]["acuan_others"];
        // var doco1 = obj["read_ihpev"][0]["acuan_others1"];
        // var doco2 = obj["read_ihpev"][0]["acuan_others2"];

        // var lnkel = obj["read_ihpev"][0]["link_electronic"];
        // var lnkcy = obj["read_ihpev"][0]["link_cycle"];
        // var lnkme = obj["read_ihpev"][0]["link_mechanic"];
        // var lnkid = obj["read_ihpev"][0]["link_ind"];
        // var lnkso = obj["read_ihpev"][0]["link_software"];
        // var lnkpc = obj["read_ihpev"][0]["link_pcb"];
        // var lnkmq = obj["read_ihpev"][0]["link_mqa"];
        // var lnkdq = obj["read_ihpev"][0]["link_dqa"];
        // var lnkat = obj["read_ihpev"][0]["link_autrans"];
        // var lnkot = obj["read_ihpev"][0]["link_others"];
        // var lnko1 = obj["read_ihpev"][0]["link_others1"];
        // var lnko2 = obj["read_ihpev"][0]["link_others2"];

        // var cfmel = obj["read_ihpev"][0]["date_status_electronic"];
        // var cfmcy = obj["read_ihpev"][0]["date_status_cycle"];
        // var cfmme = obj["read_ihpev"][0]["date_status_mechanic"];
        // var cfmid = obj["read_ihpev"][0]["date_status_ind"];
        // var cfmso = obj["read_ihpev"][0]["date_status_software"];
        // var cfmpc = obj["read_ihpev"][0]["date_status_pcb"];
        // var cfmmq = obj["read_ihpev"][0]["date_status_mqa"];
        // var cfmdq = obj["read_ihpev"][0]["date_status_dqa"];
        // var cfmat = obj["read_ihpev"][0]["date_status_autrans"];
        // var cfmot = obj["read_ihpev"][0]["date_status_others"];
        // var cfmo1 = obj["read_ihpev"][0]["date_status_others1"];
        // var cfmo2 = obj["read_ihpev"][0]["date_status_others2"];

        // var picel = obj["read_ihpev"][0]["pic_confirm_electronic"];
        // var piccy = obj["read_ihpev"][0]["pic_confirm_cycle"];
        // var picme = obj["read_ihpev"][0]["pic_confirm_mechanic"];
        // var picid = obj["read_ihpev"][0]["pic_confirm_ind"];
        // var picso = obj["read_ihpev"][0]["pic_confirm_software"];
        // var picpc = obj["read_ihpev"][0]["pic_confirm_pcb"];
        // var picmq = obj["read_ihpev"][0]["pic_confirm_mqa"];
        // var picdq = obj["read_ihpev"][0]["pic_confirm_dqa"];
        // var picat = obj["read_ihpev"][0]["pic_confirm_autrans"];
        // var picot = obj["read_ihpev"][0]["pic_confirm_others"];
        // var pico1 = obj["read_ihpev"][0]["pic_confirm_others1"];
        // var pico2 = obj["read_ihpev"][0]["pic_confirm_others2"];

        

        // var chkel = obj["read_checker"][0]["checker_electronic"];
        // var chkcy = obj["read_checker"][0]["checker_cycle"];
        // var chkme = obj["read_checker"][0]["checker_mechanic"];
        // var chkid = obj["read_checker"][0]["checker_ind"];
        // var chkso = obj["read_checker"][0]["checker_software"];
        // var chkpc = obj["read_checker"][0]["checker_pcb"];
        // var chkmq = obj["read_checker"][0]["checker_mqa"];
        // var chkdq = obj["read_checker"][0]["checker_dqa"];
        // var chkat = obj["read_checker"][0]["checker_autrans"];
        // var chkot = obj["read_checker"][0]["checker_others"];
        // var chko1 = obj["read_checker"][0]["checker_others1"];
        // var chko2 = obj["read_checker"][0]["checker_others2"];

        // var progressitem = obj["read_item"][0]["progress_item"];

       

        // if (lnkel && lnkel!==null) {
        //   if(!docel){ var docel = "Dokumen Electronic"; }
        //   var linkel =
        //     '<a target="_blank" href="../RND_Upload/' + lnkel + '">' + ShortText(docel) + "</a>";
        // } else {
        //   var linkel = ShortText(docel);
        // }

        // if (lnkcy) {
        //   if(!doccy){ var doccy = "Dokumen Energy Conversion"; }
        //   var linkcy =
        //     '<a target="_blank" href="../RND_Upload/' + lnkcy + '">' + ShortText(doccy) + "</a>";
        // } else {
        //   var linkcy = ShortText(doccy);
        // }
        // if (lnkme) {
        //   if(!docme){ var docme = "Dokumen Mechanic"; }
        //   var linkme =
        //     '<a target="_blank" href="../RND_Upload/' + lnkme + '">' + ShortText(docme) + "</a>";
        // } else {
        //   var linkme = ShortText(docme);
        // }
        // if (lnkid) {
        //   if(!docid){ var docid = "Dokumen Industrial Design"; }
        //   var linkid =
        //     '<a target="_blank" href="../RND_Upload/' + lnkid + '">' + ShortText(docid) + "</a>";
        // } else {
        //   var linkid = ShortText(docid);
        // }
        // if (lnkso) {
        //   if(!docso){ var docso = "Dokumen Software"; }
        //   var linkso =
        //     '<a target="_blank" href="../RND_Upload/' + lnkso + '">' + ShortText(docso) + "</a>";
        // } else {
        //   var linkso = ShortText(docso);
        // }
        // if (lnkpc) {
        //   if(!docpc){ var docpc = "Dokumen PCB"; }
        //   var linkpc =
        //     '<a target="_blank" href="../RND_Upload/' + lnkpc + '">' + ShortText(docpc) + "</a>";
        // } else {
        //   var linkpc = ShortText(docpc);
        // }
        // if (lnkmq) {
        //   if(!docmq){ var docmq = "Dokumen MQA"; }
        //   var linkmq =
        //     '<a target="_blank" href="../RND_Upload/' + lnkmq + '">' + ShortText(docmq) + "</a>";
        // } else {
        //   var linkmq = ShortText(docmq);
        // }
        // if (lnkdq) {
        //   if(!docdq){ var docdq = "Dokumen DQA"; }
        //   var linkdq =
        //     '<a target="_blank" href="../RND_Upload/' + lnkdq + '">' + ShortText(docdq) + "</a>";
        // } else {
        //   var linkdq = ShortText(docdq);
        // }
        // if (lnkat) {
        //   if(!docat){ var docat = "Dokumen Autrans"; }
        //   var linkat =
        //     '<a target="_blank" href="../RND_Upload/' + lnkat + '">' + ShortText(docat) + "</a>";
        // } else {
        //   var linkat = ShortText(docat);
        // }
        // if (lnkot) {
        //   if(!docot){ var docot = "Dokumen Others"; }
        //   var linkot =
        //     '<a target="_blank" href="../RND_Upload/' + lnkot + '">' + ShortText(docot) + "</a>";
        // } else {
        //   var linkot = ShortText(docot);
        // }
        // if (lnko1) {
        //   if(!doco1){ var doco1 = "Dokumen Others 1"; }
        //   var linko1 =
        //     '<a target="_blank" href="../RND_Upload/' + lnko1 + '">' + ShortText(doco1) + "</a>";
        // } else {
        //   var linko1 = ShortText(doco1);
        // }
        // if (lnko2) {
        //   if(!doco2){ var doco2 = "Dokumen Others 2"; }
        //   var linko2 =
        //     '<a target="_blank" href="../RND_Upload/' + lnko2 + '">' + ShortText(doco2) + "</a>";
        // } else {
        //   var linko2 = ShortText(doco2);
        // }


        // if (chkel && (progressitem == ihpprogress_d || progressitem == ihpprogress_e || progressitem == "ALL CHECKED")) {
        //   $("#ElectEdit").html(
        //     '<span class="resultihp addresult" id="editmech" sid="1" pic="'+pic1+'" tid="ELECTRONIC HARDWARE"><i class="tasks large icon"></i></span>'
        //   );
        //   if (stsel && picel) {
        //     $("#ElectSignBtn").text("SIGNED");
        //   } else {
        //     $("#ElectSignBtn").text("");
        //   }
        // } else {
        //   $("#ElectEdit").text("");
        //   $("#ElectSignBtn").text("");
        // }

        // if (chkcy && (progressitem == ihpprogress_d || progressitem == ihpprogress_e || progressitem == "ALL CHECKED")) {
        //   $("#HomeApEdit").html(
        //     '<span class="resultihp addresult" id="editmech" sid="2" pic="'+pic2+'" tid="ENERGY CONVERSION"><i class="tasks large icon"></i></span>'
        //   );
        //   if (stscy && piccy) {
        //     $("#HomeApSignBtn").text("SIGNED");
        //   } else {
        //     $("#HomeApSignBtn").text("");
        //   }
        // } else {
        //   $("#HomeApEdit").text("");
        //   $("#HomeApSignBtn").text("");
        // }

        // if (chkme && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#MechEdit").html(
        //     '<span class="resultihp addresult" id="editmech" sid="3" pic="'+pic3+'" tid="MECHANIC"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stsme && picme) {
        //     $("#MechSignBtn").text("SIGNED");
        //   } else {
        //     $("#MechSignBtn").text("");
        //   }
        // } else {
        //   $("#MechEdit").text("");
        //   $("#MechSignBtn").text("");
        // }

        // if (chkid && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#IDEdit").html(
        //     '<span class="resultihp addresult" id="editind" sid="4" pic="'+pic4+'" tid="INDUSTRIAL DESIGN"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stsid && picid) {
        //     $("#IDSignBtn").text("SIGNED");
        //   } else {
        //     $("#IDSignBtn").text("");
        //   }
        // } else {
        //   $("#IDEdit").text("");
        //   $("#IDSignBtn").text("");
        // }

        // if (chkso && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#SoftEdit").html(
        //     '<span class="resultihp addresult" id="editsoft" sid="5" pic="'+pic5+'" tid="SOFTWARE"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stsso && picso) {
        //     $("#SoftSignBtn").text("SIGNED");
        //   } else {
        //     $("#SoftSignBtn").text("");
        //   }
        // } else {
        //   $("#SoftEdit").text("");
        //   $("#SoftSignBtn").text("");
        // }

        // if (chkpc && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#PCBEdit").html(
        //     '<span class="resultihp addresult" id="editpcb" sid="6" pic="'+pic6+'" tid="PCB"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stspc && picpc) {
        //     $("#PCBSignBtn").text("SIGNED");
        //   } else {
        //     $("#PCBSignBtn").text("");
        //   }
        // } else {
        //   $("#PCBEdit").text("");
        //   $("#PCBSignBtn").text("");
        // }

        // if (chkmq && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#MQAEdit").html(
        //     '<span class="resultihp addresult" id="editmqa" sid="7" pic="'+pic7+'" tid="MQA"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stsmq && picmq) {
        //     $("#MQASignBtn").text("SIGNED");
        //   } else {
        //     $("#MQASignBtn").text("");
        //   }
        // } else {
        //   $("#MQAEdit").text("");
        //   $("#MQASignBtn").text("");
        // }

        // if (chkdq && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#DQAEdit").html(
        //     '<span class="resultihp addresult" id="editdqa" sid="8" pic="'+pic8+'" tid="DQA"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stsdq && picdq) {
        //     $("#DQASignBtn").text("SIGNED");
        //   } else {
        //     $("#DQASignBtn").text("");
        //   }
        // } else {
        //   $("#DQAEdit").text("");
        //   $("#DQASignBtn").text("");
        // }

        // if (chkat && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#AuTEdit").html(
        //     '<span class="resultihp addresult" id="editaut" sid="9" pic="'+pic9+'" tid="AUTRANS"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stsat && picat) {
        //     $("#AuTSignBtn").text("SIGNED");
        //   } else {
        //     $("#AuTSignBtn").text("");
        //   }
        // } else {
        //   $("#AuTEdit").text("");
        //   $("#AuTSignBtn").text("");
        // }

        // if (chkot && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#OthEdit").html(
        //     '<span class="resultihp addresult" id="editoth" sid="10" pic="'+pic10+'" tid="OTHERS"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stsot && picot) {
        //     $("#OthSignBtn").text("SIGNED");
        //   } else {
        //     $("#OthSignBtn").text("");
        //   }
        // } else {
        //   $("#OthEdit").text("");
        //   $("#OthSignBtn").text("");
        // }

        // if (chko1 && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#Oth1Edit").html(
        //     '<span class="resultihp addresult" id="editot1" sid="11" pic="'+pic11+'" tid="OTHERS1"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stso1 && pico1) {
        //     $("#Oth1SignBtn").text("SIGNED");
        //   } else {
        //     $("#Oth1SignBtn").text("");
        //   }
        // } else {
        //   $("#Oth1Edit").text("");
        //   $("#Oth1SignBtn").text("");
        // }

        // if (chko2 && (progressitem == ihpprogress_d || progressitem == ihpprogress_e)) {
        //   $("#Oth2Edit").html(
        //     '<span class="resultihp addresult" id="editot2" sid="12" pic="'+pic12+'" tid="OTHERS2"><i class="tasks large icon"></i></span>'
        //     );
        //   if (stso2 && pico2) {
        //     $("#Oth2SignBtn").text("SIGNED");
        //   } else {
        //     $("#Oth2SignBtn").text("");
        //   }
        // } else {
        //   $("#Oth2Edit").text("");
        //   $("#Oth2SignBtn").text("");
        // }



        // if (chkel) {
        //   $("#trElect").removeClass("negative2");
        // } else {
        //   $("#trElect").addClass("negative2");
        // }
        // if (chkcy) {
        //   $("#trHomeAp").removeClass("negative2");
        // } else {
        //   $("#trHomeAp").addClass("negative2");
        // }
        // if (chkme) {
        //   $("#trMech").removeClass("negative2");
        // } else {
        //   $("#trMech").addClass("negative2");
        // }
        // if (chkid) {
        //   $("#trID").removeClass("negative2");
        // } else {
        //   $("#trID").addClass("negative2");
        // }
        // if (chkso) {
        //   $("#trSoft").removeClass("negative2");
        // } else {
        //   $("#trSoft").addClass("negative2");
        // }
        // if (chkpc) {
        //   $("#trPCB").removeClass("negative2");
        // } else {
        //   $("#trPCB").addClass("negative2");
        // }
        // if (chkmq) {
        //   $("#trMQA").removeClass("negative2");
        // } else {
        //   $("#trMQA").addClass("negative2");
        // }
        // if (chkdq) {
        //   $("#trDQA").removeClass("negative2");
        // } else {
        //   $("#trDQA").addClass("negative2");
        // }
        // if (chkat) {
        //   $("#trAutrans").removeClass("negative2");
        // } else {
        //   $("#trAutrans").addClass("negative2");
        // }
        // if (chkot) {
        //   $("#trOth").removeClass("negative2");
        // } else {
        //   $("#trOth").addClass("negative2");
        // }
        // if (chko1) {
        //   $("#trOth1").removeClass("negative2");
        // } else {
        //   $("#trOth1").addClass("negative2");
        // }
        // if (chko2) {
        //   $("#trOth2").removeClass("negative2");
        // } else {
        //   $("#trOth2").addClass("negative2");
        // }

        // $("#ElectSts").text(stsel);
        // $("#HomeApSts").text(stscy);
        // $("#MechSts").text(stsme);
        // $("#IDSts").text(stsid);
        // $("#SoftSts").text(stsso);
        // $("#PCBSts").text(stspc);
        // $("#MQASts").text(stsmq);
        // $("#DQASts").text(stsdq);
        // $("#AuTSts").text(stsat);
        // $("#OthSts").text(stsot);
        // $("#Oth1Sts").text(stso1);
        // $("#Oth2Sts").text(stso2);

        // $("#ElectPIC").text(pic1);
        // $("#HomeApPIC").text(pic2);
        // $("#MechPIC").text(pic3);
        // $("#IDPIC").text(pic4);
        // $("#SoftPIC").text(pic5);
        // $("#PCBPIC").text(pic6);
        // $("#MQAPIC").text(pic7);
        // $("#DQAPIC").text(pic8);
        // $("#AuTPIC").text(pic9);
        // $("#OthPIC").text(pic10);
        // $("#Oth1PIC").text(pic11);
        // $("#Oth2PIC").text(pic12);

        // $("#ElectDateSts").text(DateIHPEval2(cfmel));
        // $("#HomeApDateSts").text(DateIHPEval2(cfmcy));
        // $("#MechDateSts").text(DateIHPEval2(cfmme));
        // $("#IDDateSts").text(DateIHPEval2(cfmid));
        // $("#SoftDateSts").text(DateIHPEval2(cfmso));
        // $("#PCBDateSts").text(DateIHPEval2(cfmpc));
        // $("#MQADateSts").text(DateIHPEval2(cfmmq));
        // $("#DQADateSts").text(DateIHPEval2(cfmdq));
        // $("#AuTDateSts").text(DateIHPEval2(cfmat));
        // $("#OthDateSts").text(DateIHPEval2(cfmot));
        // $("#Oth1DateSts").text(DateIHPEval2(cfmo1));
        // $("#Oth2DateSts").text(DateIHPEval2(cfmo2));

        // $("#ElectDocReff").html(linkel);
        // $("#HomeApDocReff").html(linkcy);
        // $("#MechDocReff").html(linkme);
        // $("#IDDocReff").html(linkid);
        // $("#SoftDocReff").html(linkso);
        // $("#PCBDocReff").html(linkpc);
        // $("#MQADocReff").html(linkmq);
        // $("#DQADocReff").html(linkdq);
        // $("#AuTDocReff").html(linkat);
        // $("#OthDocReff").html(linkot);
        // $("#Oth1DocReff").html(linko1);
        // $("#Oth2DocReff").html(linko2);
      } else {
        console.log("Developer Note: Table Error, table kosong/belum terisi ");
      }


      // $(".addresult").on("click", function () {
      //   var tidihp = $(this).attr("tid").toUpperCase();
      //   var sid = $(this).attr("sid");
      //   var pic = $(this).attr("pic");
      //   $(".windowresulttable").modal("show");
      //   $("#labelresult").text(tidihp);
      //   $("#PSSid").val(IDpssx);
      //   $("#IHPid").val(IDitemx);
      //   $("#IHPsid").val(sid);
      //   $("#PSSid2").val(IDpssx);
      //   $("#IHPid2").val(IDitemx);
      //   $("#IHPsid2").val(sid);

      //   $.ajax({
      //     type: "POST",
      //     url: `${restlocpssihp}read_report`,
      //     headers: {
      //       user: vusrnm,
      //       token: vtoken,
      //     },
      //     data: {
      //       idpss: IDpssx,
      //       iditem: IDitemx,
      //       sid: sid,
      //     },
      //     cache: false,
      //     success: function (response) {
      //       var obj = JSON.parse(response);
      //       if (isEmpty(obj)) {
      //         console.log("Gagal load, data kosong");
      //         return false;
      //       } else if (obj) {
      //         $("#AddTestResult").show();

      //         if (obj.status == false) {
      //           $("#ReportList").empty();
      //           $("#SignResult").hide();
      //           if((pic ==Udecrypt) && ( obj[a]["date_confirm"] == null)){
      //             $("#AddTestResult").show();
      //           } else {
      //              $("#AddTestResult").hide();
      //           }

      //         } else {

      //           jmlData = obj.length;
      //           $("#ReportList").empty();
      //           for (a = 0; a < jmlData; a++) {
      //             b = a + 1;
      //             if (jmlData == b && obj[a]["user"] == Udecrypt && obj[a]["date_confirm"] == null) {
      //               var icon1 = "<span id='reuploadfile' testr='"+obj[a]["result"]+"' docre='"+obj[a]["doc_ref"]+"' norev='"+obj[a]["jenis"]+"' sid='" +obj[a]["s_id"]+"' pid='" +IDpssx+"' iid='" +IDitemx+"' data-tooltip='Edit Result' data-inverted='' data-position='top left'><i class='pencil alternative circular2 teal icon link'></i></span>";

      //               var icon2 = "<span class='iconedit' id='delfilereport' iid='"+obj[a]["id_item"]+"' pid='" +IDpssx+"' sid='"+obj[a]["s_id"]+"' norev='"+obj[a]["jenis"]+"' data-tooltip='Hapus Result' data-inverted='' data-position='top right'><i class='trash circular2 red icon'></i></span>";
      //             } else {
      //               var icon1 = "";
      //               var icon2 = "";
      //             }
      //             //console.log(Udecrypt);
      //             if((pic ==Udecrypt) && ( obj[a]["date_confirm"] == null)){
      //               $("#SignResult").show();
      //               $("#AddTestResult").show();
      //             } else {
      //                $("#SignResult").hide();
      //                $("#AddTestResult").hide();
      //             }
      //             if(obj[a]["nama_file"] && obj[a]["nama_file"] !==null){
      //               if(obj[a]["doc_ref"] && obj[a]["doc_ref"] !==null){
      //                 var namafile = obj[a]["doc_ref"];
      //               } else {
      //                 var namafile = "Document";
      //               }
      //               var filelink = "<a target='_blank' href='../RND_Upload/"+obj[a]["nama_file"]+"'>";
      //             } else {
      //               var filelink = "";
      //               var namafile = obj[a]["doc_ref"];
      //             }

      //             var len_a = namafile.length;
      //             if(len_a > 40){
      //               namafile = obj[a]["doc_ref"].substring(0, 40).concat('...');
      //               var namafilecopy = obj[a]["doc_ref"];
      //               var btncopy = "<br><input id='copyvalue"+b+"' value='"+namafilecopy+"' type='hidden'><span class='btn' data-tooltip='Copy Doc Reff/file to clipboard' data-inverted='' data-position='bottom right' data-clipboard-target='#copyvalue"+b+"'><i class='copy outline circular2 teal link icon'></i></span>";
      //             } else {
      //               namafile = obj[a]["doc_ref"];
      //               var btncopy = "";
      //             }

      //             $("#TableReportList").find("tbody").append(
      //               "<tr>"+
      //                 "<td class='center aligned'>"+icon1+"</td>"+
      //                 "<td class='center aligned'>"+b+"</td>"+
      //                 "<td>"+obj[a]["result"]+"</td>"+
      //                 "<td>"+moment(obj[a]["date_status"]).format('ddd, DD MMM YYYY')+"</td>"+
      //                 "<td>"+filelink+namafile+"</a>"+btncopy+"</td>"+
      //                 "<td>"+obj[a]["user"]+"</td>"+
      //                 "<td class='center aligned'>"+icon2+"</td>"+
      //               "</tr>"
      //             );

      //           }
      //           ReUplaodFileResult();
      //           BtnCopyClipboard();
      //         }

      //       } else {
      //         Swal.fire(
      //           "Error",
      //           "Ada kendal di koneksi/database, data tidak tersimpan !",
      //           "error"
      //         );
      //       }
      //     },
      //     error: function () {
      //       window.location.href = "./?link=loclogout";
      //       Swal.fire(
      //         "Error",
      //         "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
      //         "error"
      //       );
      //     },
      //   });
      // });

      $(".SignResultIHP").on("click", function () {
        var sid = $(this).attr('sidx');
        Swal.fire({
          title: "<h3>Sign Result ?</h3>",
          text:
            "Pastikan anda telah mengisi data Hasil Pengujian dengan benar.",
          icon: "question",
          confirmButtonText: "Ya",
          showCancelButton: true,
        }).then((result) => {
          if (result.value) {
            $.ajax({
              type: "POST",
              url: `${restlocpssihp}sign_ihpresult`,
              headers: {
                user: vusrnm,
                token: vtoken,
              },
              data: {
                iditem: IDitemx,
                sid: sid,
                user: Udecrypt,
              },
              cache: false,
              success: function (response) {
                var obj = JSON.parse(response);
                if (obj.status == false) {
                  Swal.fire(
                    "Error",
                    "Ada kendal di koneksi/database, data tidak tersimpan !",
                    "error"
                  );
                } else {
                  Swal.fire({
                    text: "Signed",
                    timer: 2000,
                    toast: true,
                    showConfirmButton: false,
                  });
                  //reload table sample distributions
                  LoadTableResult(IDpssx, IDitemx);
                  LoadTableList();

                }
              },
              error: function () {
                window.location.href = "./?link=loclogout";
                Swal.fire(
                  "Error",
                  "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
                  "error"
                );
              },
            });
          }
        });
      });


      $(".DelResultIHP").on("click", function () {
        var sid = $(this).attr('sidx');
        Swal.fire({
          title: "<h3>Hapus Result ?</h3>",
          text :  "Setelah klik Ya, maka data report dan result ini akan dihapus dan tidak bisa di pulihkan lagi.",
          icon : "warning",
          confirmButtonText: "Ya",
          showCancelButton: true,
        }).then((result) => {
          if (result.value) {
            $.ajax({
              type: "POST",
              url: `${restlocpssihp}delete_ihpresult`,
              headers: {
                user: vusrnm,
                token: vtoken,
              },
              data: {
                iditem: IDitemx,
                sid: sid,
                user: Udecrypt,
              },
              cache: false,
              success: function (response) {
                var obj = JSON.parse(response);
                if (obj.status == false) {
                  Swal.fire(
                    "Error",
                    "Ada kendal di koneksi/database, data tidak tersimpan !",
                    "error"
                  );
                } else {
                  Swal.fire({
                    text: "Deleted",
                    timer: 2000,
                    toast: true,
                    showConfirmButton: false,
                  });
                  //reload table sample distributions
                  LoadTableResult(IDpssx, IDitemx);
                  LoadTableList();

                  
                }
              },
              error: function () {
                window.location.href = "./?link=loclogout";
                Swal.fire(
                  "Error",
                  "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
                  "error"
                );
              },
            });
          }
        });
      });

      //Modal Window Control
      // $(".windoweditdistributeihp").modal({
      //   closable: false,
      //   autofocus: false,
      // });

      if (obj["read_item"][0]["file_upload"] == null) {
        var file = "<span style='color: #cfcfcf;'><i>Belum ada spec yang diupload</i></span>";
        var viewall = "";
      } else {
        var file =
          '<a target="_blank" href="./?link=filespecpss&f=' +
          obj["read_item"][0]["file_upload"] +
          '">' +
          obj["read_item"][0]["file_upload"] +
          "</a>";

          var viewall = "<span class='viewspecsupplier' id='viewspecsupplier' data-tooltip='View all Spec' data-inverted='' data-position='top left'><i class='copy outline circular2 teal icon'></i></span>";
      }

      if (obj["read_item"][0]["file_upload_designer"] == null) {
        var filedesigner = "<span style='color: #cfcfcf;'><i>Designer tidak upload file saat pembuatan PSS</i></span>";
      } else {
        var filedesigner =
          '<a target="_blank" href="./?link=filespecpssdesigner&f=' +
          obj["read_item"][0]["file_upload_designer"] +
          '">' +
          obj["read_item"][0]["file_upload_designer"] +
          "</a>";
      }

      if ((obj["read_item"][0]["link"] == null) || (obj["read_item"][0]["link"] == "")) {
        var linkdesigner = "<span style='color: #cfcfcf;'><i>Designer tidak menyertakan Link Spec saat pembuatan PSS</i></span>";
      } else {
        var linkdesigner =
          '<a target="_blank" href="' +
          obj["read_item"][0]["link"] +
          '">' +
          obj["read_item"][0]["link"] +
          "</a>";
      }

      if (isEmpty(obj)) {
        console.log("Gagal load tabel, data kosong");
      } else if (obj) {
        if (obj.status == false) {
          Swal.fire(
            "Error",
            "Ada kendal di koneksi/database, data gagal diload !",
            "error"
          );
        } else {
          $(".windoweditihp").modal("show");
          $("#IHPNo").text(obj["read_item"][0]["no_ihp"]);
          $("#IHPDate").html(DateIHPEval(obj["read_item"][0]["tanggal_ihp"]));
          $("#IHPNoPSS").text(obj["read_item"][0]["ps_no"]);
          $("#IHPChassis").text(obj["read_item"][0]["chasis"]);
          $("#IHPType").text(obj["read_item"][0]["type"]);
          $("#IHPNegoName").text(obj["read_item"][0]["negosiator"]);
          $("#IHPDesgName").text(obj["read_item"][0]["designer"]);
          $("#IHPDescription").text(obj["read_item"][0]["description_item"]);
          $("#IHPCategory").text(obj["read_item"][0]["jenis_project"]);
          $("#IHPVendorMatNum").text(obj["read_item"][0]["vendor_material_number"]);
          $("#IHPVendor").text(obj["read_item"][0]["vendor"]);
          $("#IHPManufacture").text(obj["read_item"][0]["manufacture"]);
          $("#IHPNoGudang").text(obj["read_item"][0]["no_gudang"]);
          $("#IHPPIN").text(obj["read_item"][0]["req_pinbl"]);
          $("#IHPTPIN").html(DateIHPEval(obj["read_item"][0]["target_pelunasan"]));
          $("#IHPTECN").html(DateIHPEval(obj["read_item"][0]["target_pin"]));
          $("#IHPHeadOf").text(obj["read_item"][0]["section_head"]);
          $("#IHPIdItem").val(IDitemx);
          $("#IHPFile").html(file);
          $("#ViewAllSpec").html(viewall);

          $("#IHPFileDesigner").html(filedesigner);
          $("#IHPLinkDesigner").html(linkdesigner);
          ViewSpecSupplier();
        }
      }


    },
    error: function () {
      // window.location.href = "./?link=loclogout";
      Swal.fire(
        "Error",
        "Ada kendal di koneksi/database, data gagal diload !",
        "error"
      );
      console.log(
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
      );
    },
  });
}

//Click Confirm Receive
$("#IHPList").on("click", ".confirmreceive", function () {
  var idpss = $(this).attr("idpss");
  var iditem = $(this).attr("iditem");
  Swal.fire({
    title: "<h3>Terima dan Proses IHP ini ?</h3>",
    text:
      "Pastikan anda telah menerima material yang sesuai dengan No IHP ini.",
    icon: "question",
    confirmButtonText: "Ya",
    showCancelButton: true,
  }).then((result) => {
    if (result.value) {
      $.ajax({
        type: "POST",
        url: `${restlocpssihp}confirm_ihp`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          iditem: iditem,
          idpss: idpss,
          user: Udecrypt,
          section: Sdecrypt,
          SIHP: SIHP,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(JSON.parse(response));
          if (obj.status == false) {
            Swal.fire(
              "Error",
              "Ada kendal di koneksi/database, data tidak tersimpan !",
              "error"
            );
          } else {
            Swal.fire({
              title: "Received !",
              timer: 1500,
              position: "top-end",
              icon: "success",
              showConfirmButton: false,
            });
            LoadTableList();
          }
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          Swal.fire(
            "Error",
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
            "error"
          );
        },
      });
    }
  });
});



// function ReUplaodFileResult() {

//   $("#reuploadfile").on("click", function () {
//     $(".windowreupload").modal("show");
//     var norev = $(this).attr("norev");
//     var testr = $(this).attr("testr");
//     var docre = $(this).attr("docre");
//     var sid = $(this).attr("sid");
//     var pid = $(this).attr("pid");
//     var iid = $(this).attr("iid");
//     $("#ReResultIHP").val(testr);
//     $("#docreupload").val(docre);
//     $("#norev").val(norev);
//     $("#sid_ru").val(sid);
//     $("#pssid_ru").val(pid);
//     $("#iditem_ru").val(iid);
//   });

//   $("#delfilereport").on("click", function () {
//     var norev = $(this).attr("norev");
//     var pid = $(this).attr("pid");
//     var iid = $(this).attr("iid");
//     var sid = $(this).attr("sid");
//     Swal.fire({
//       title: "<h3>Delete Result Test ?</h3>",
//       text: "Ketika berhasil hapus maka data tidak bisa dipulihkan lagi.",
//       icon: "warning",
//       confirmButtonText: "Ya",
//       showCancelButton: true,
//     }).then((result) => {
//       if (result.value) {
//         $.ajax({
//           type: "POST",
//           url: `${restlocpssihp}delete_result`,
//           headers: {
//             user: vusrnm,
//             token: vtoken,
//           },
//           data: {
//             iditem: iid,
//             sid: sid,
//             norev: norev,
//             user: Udecrypt,
//           },
//           cache: false,
//           success: function (response) {
//             var obj = JSON.parse(response);
//             if (obj.status == false) {
//               Swal.fire(
//                 "Error",
//                 "Ada kendal di koneksi/database, data tidak tersimpan !",
//                 "error"
//               );
//             } else {
//               Swal.fire({
//                 text: "Deleted",
//                 timer: 2000,
//                 toast: true,
//                 showConfirmButton: false,
//               });
//               //reload table sample distributions
//               $(".windowresulttable").modal("hide");
//               LoadTableResult(pid, iid);
//             }
//           },
//           error: function () {
//             window.location.href = "./?link=loclogout";
//             Swal.fire(
//               "Error",
//               "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
//               "error"
//             );
//           },
//         });
//       }
//     });
//   });
// }



// $("#SaveIHP").on("click", function () {
//   var idpss = $("#PSSid").val();
//   var iditem = $("#IHPid").val();
//   var sid = $("#IHPsid").val();
//   var result = $("#ResultIHP").val();
//   var docref = $("#DocIHP").val();
//   var linkdoc = $("#LinkIHP").val();
//   $.ajax({
//     type: "POST",
//     url: `${restlocpssihp}save_resultihpyyy`,
//     headers: {
//       user: vusrnm,
//       token: vtoken,
//     },
//     data: {
//       idpss: idpss,
//       iditem: iditem,
//       sid: sid,
//       result: result,
//       docref: docref,
//       linkdoc: linkdoc,
//     },
//     cache: false,
//     success: function (response) {
//       var obj = JSON.parse(response);
//       if (obj.status == false) {
//         Swal.fire(
//           "Error",
//           "aAda kendal di koneksi/database, data tidak tersimpan !",
//           "error"
//         );
//       } else {
//         Swal.fire({
//           text: "Saved !",
//           timer: 2000,
//           toast: true,
//           showConfirmButton: false,
//         });

//         //reload table sample distributions
//         $(".windoweditdistributeihp").modal("hide");
//         $(".windoweditihp").modal("show");
//         LoadTableResult(idpss, iditem);
//       }
//     },
//     error: function () {
//       window.location.href = "./?link=loclogout";
//       Swal.fire(
//         "Error",
//         "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
//         "error"
//       );
//     },
//   });
// });

// $("#DelIHP").on("click", function () {
//   var idpss = $("#PSSid").val();
//   var iditem = $("#IHPid").val();
//   var sid = $("#IHPsid").val();
//   $.ajax({
//     type: "POST",
//     url: `${restlocpssihp}delete_resultihp`,
//     headers: {
//       user: vusrnm,
//       token: vtoken,
//     },
//     data: {
//       iditem: iditem,
//       sid: sid,
//     },
//     cache: false,
//     success: function (response) {
//       var obj = JSON.parse(response);
//       if (obj.status == false) {
//         Swal.fire(
//           "Error",
//           "Ada kendal di koneksi/database, data tidak tersimpan !",
//           "error"
//         );
//       } else {
//         Swal.fire({
//           text: "Deleted !",
//           timer: 2000,
//           toast: true,
//           showConfirmButton: false,
//         });
//         //reload table sample distributions
//         $(".windoweditdistributeihp").modal("hide");
//         $(".windoweditihp").modal("show");
//         LoadTableResult(idpss, iditem);
//       }
//     },
//     error: function () {
//       window.location.href = "./?link=loclogout";
//       Swal.fire(
//         "Error",
//         "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
//         "error"
//       );
//     },
//   });
// });

function ViewSpecSupplier() {
  $("#viewspecsupplier").on("click", function (e) {
    $(".windowspecsupplier").modal("show");
    var idpss = $("#PSSidx").val();
    var iditem = $("#IHPidx").val();

    $.ajax({
      type: "POST",
      url: `${restlocpssihp}read_spec`,
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        idpss: idpss,
        iditem: iditem,
      },
      cache: false,
      success: function (response) {
        var obj = JSON.parse(response);
        if (isEmpty(obj)) {
          console.log("Gagal load, data kosong");
          return false;
        } else if (obj) {

          if (obj.status == false) {
            $("#SpecList").empty();
          } else {
            jmlData = obj.length;
            $("#SpecList").empty();
            for (a = 0; a < jmlData; a++) {
              var filelink = "<a target='_blank' href='../RND_Upload/SpecOperator/"+obj[a]["file"]+"'>";
              var namafile = obj[a]["file"];

              if (obj[a]["note_spec"] == "" || obj[a]["note_spec"]==null){
                var note ="";
              } else {
                var note = obj[a]["note_spec"];
              }

              $("#TableSpecList").find("tbody").append(
                  "<tr><td class='center'>" +
                    obj[a]["created_date"] +
                    "</td><td class='center'>" +
                    filelink+namafile +
                    "</a>" +
                    "</td><td class='center'>" +
                    note +
                    "</td></tr>"
                );
            }
          }
        } else {
          Swal.fire(
            "Error",
            "Ada kendal di koneksi/database, data tidak tersimpan !",
            "error"
          );
        }
      },
      error: function () {
       // window.location.href = "./?link=loclogout";
        Swal.fire(
          "Error",
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
          "error"
        );
      },
    });
  });
}

function LoadTableList() {
  //Read Filter Cookies
  var d = new Date();
  var yearnow = d.getFullYear();
  var sfilter = getCookie("sfilihp");
  var tfilter = getCookie("tfilihp");
  var stfilter = getCookie("stfilihp");

  if (sfilter) {
    $("#filtercari").val(sfilter);
    var sfilterstart = sfilter;
  } else {
    setCookie("sfilihp", "", 5);
    var sfilterstart = "";
  }
  if (tfilter) {
    $("#filtertahun").dropdown("set selected", tfilter);
    var tfilterstart = tfilter;
  } else {
    setCookie("tfilihp", yearnow, 5);
    var tfilterstart = yearnow;
  }
  if (stfilter) {
    $("#filterstatus").dropdown("set selected", stfilter);
    var stfilterstart = stfilter;
  } else {
    setCookie("stfilihp", "ALL", 5);
    var stfilterstart = "ALL";
  }

  //Load Table
  TableListFunc(sfilterstart, tfilterstart, stfilterstart);
}

//RESPON KETIKA INPUT PENCARIAN DI KETIK
$("#filtercari").on("keyup", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterIHP = $("#filterihp").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("sfilihp", FilterCari, 5);
  setCookie("tfilihp", FilterTahun, 5);
  setCookie("stfilihp", FilterStatus, 5);
  $("#IHPList").DataTable().destroy();
  TableListFunc(FilterCari, FilterTahun, FilterStatus);
});

//RESPON KETIKA FILTER TAHUN DI RUBAH
$("#filtertahun, #filterihp, #filterstatus").on("change", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterIHP = $("#filterihp").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("sfilihp", FilterCari, 5);
  setCookie("tfilihp", FilterTahun, 5);
  setCookie("stfilihp", FilterStatus, 5);
  $("#IHPList").DataTable().destroy();
  TableListFunc(FilterCari, FilterTahun, FilterStatus);
});

//RESET FILTER
$(".resetfilter").on("click", function () {
  var d = new Date();
  var yearnow = d.getFullYear();
  $("#filtercari").val("");
  $("#filtertahun").dropdown("set selected", yearnow);
  $("#filterihp").dropdown("set selected", "ALL");
  $("#filterstatus").dropdown("set selected", "ALL");
  setCookie("sfilihp", "", 5);
  setCookie("tfilihp", yearnow, 5);
  setCookie("stfilihp", "ALL", 5);
  $("#IHPList").DataTable().destroy();
  TableListFunc("", yearnow, "ALL");
});

$("#UploadFileResult").on("click", function () {
  var file_data = $("#fileupload").prop("files")[0];
  var idpss = $("#PSSid2").val();
  var iditem = $("#IHPid2").val();
  var sid = $("#IHPsid2").val();
  var result = $("#ResultIHP").val();
  var docref = $("#DocIHP").val();
  var form_data = new FormData();

  form_data.append("file", file_data);
  form_data.append("idpss", idpss);
  form_data.append("iditem", iditem);
  form_data.append("sid", sid);
  form_data.append("result", result);
  form_data.append("user", Udecrypt);
  form_data.append("docref", docref);

  $.ajax({
    type: "POST",
    dataType: "text",
    contentType: false,
    processData: false,
    url: `${restlocpssihp}save_resultihp`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: form_data,
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (obj.status == false) {
        Swal.fire({
          text: obj.message,
          timer: 1500,
          icon: "warning",
          showConfirmButton: false,
        });
      } else {
        Swal.fire({
          text: "Saved !",
          timer: 2000,
          toast: true,
          showConfirmButton: false,
        });

        $(".windowaddresult").modal("hide");
        LoadTableResult(idpss, iditem);
        LoadTableList();
      }
    },
    error: function () {
      window.location.href = "./?link=loclogout";
      Swal.fire(
        "Error",
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
        "error"
      );
    },
  });
});

// $("#ReUploadFileResult").on("click", function () {
//   var file_data = $("#filereupload").prop("files")[0];
//   var docref = $("#docreupload").val();
//   var result = $("#ReResultIHP").val();
//   var norev = $("#norev").val();
//   var sid = $("#sid_ru").val();
//   var pid = $("#pssid_ru").val();
//   var iid = $("#iditem_ru").val();
//   var form_data = new FormData();

//   form_data.append("file", file_data);
//   form_data.append("sid", sid);
//   form_data.append("norev", norev);
//   form_data.append("result", result);
//   form_data.append("iditem", iid);
//   form_data.append("user", Udecrypt);
//   form_data.append("docref", docref);


//   $.ajax({
//     type: "POST",
//     dataType: "text",
//     contentType: false,
//     processData: false,
//     url: `${restlocpssihp}reupload_doc`,
//     headers: {
//       user: vusrnm,
//       token: vtoken,
//     },
//     data: form_data,
//     cache: false,
//     success: function (response) {
//       var obj = JSON.parse(response);
//       if (obj.status == false) {
//         Swal.fire({
//           text: obj.message,
//           timer: 1500,
//           icon: "warning",
//           showConfirmButton: false,
//         });
//       } else {
//         Swal.fire({
//           text: "Saved !",
//           timer: 2000,
//           toast: true,
//           showConfirmButton: false,
//         });

//         $(".windowreupload").modal("hide");
//         LoadTableResult(pid, iid);
//       }
//     },
//     error: function () {
//       window.location.href = "./?link=loclogout";
//       Swal.fire(
//         "Error",
//         "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
//         "error"
//       );
//     },
//   });
// });


function DateIHPEval(d){
  if(d){
    return moment(d).format('ddd, DD MMM YYYY');
  } else {
    return '<i>Tanggal tidak ditentukan</i>';
  }
}

function DateIHPEval2(d){
  if(d){
    return moment(d).format('ddd, DD MMM YYYY');
  } else {
    return '';
  }
}

function ShortText(t){
  if(t){
    var lennamafile = t.length;
    return lennamafile > 40 ? t.substring(0, 40).concat('...') : t;
  } else {
    return '';
  }
}

function BtnCopyClipboard(){
  $(".btn").on("click", function (e) {
    Swal.fire({
      text: "Copied to Clipboard",
      timer: 2000,
      toast: true,
      showConfirmButton: false,
    });
  });
}

function IsNull(a) {
  return (a == null || a == 'null') ? "" : a;
} 


$(document).ready(function () {

  LoadTableList();
  new ClipboardJS('.btn');

  $("#tabregpss").on("click", function () {
    window.location.href = "./?link=pssheader";
  });
  $("#tabpsslist").on("click", function () {
    window.location.href = "./?link=pss";
  });
  $("#tabihp").on("click", function () {
    window.location.href = "./?link=ihp";
  });
  $("#tabihpeval").on("click", function () {
    window.location.href = "./?link=ihpevaluation";
  });
  $("#tabchangepic").on("click", function () {
    window.location.href = "./?link=changepic";
  });
  $("#tabtabelan").on("click", function () {
    window.location.href = "./?link=an";
  });
  $('.tabuserguide').on('click', function() {
    window.location.href = "./?link=guidepss";
  });
  $('.tabsuratgolive').on('click', function() {
    window.location.href = "./?link=golivepss";
  });
  $('.tabhasilmonitoring').on('click', function() {
    window.location.href = "./?link=monitorpss";
  });
  $('.tabversion').on('click', function() {
    window.location.href = "./?link=versionhistory&app=PSS";
  });
  $("#tabpssreport").on("click", function () {
    window.location.href = "./?link=reportingpss";
  });

  //Print IHP in PDF
  $("#PrintIHPPDF").on("click", function (e) {
    var idpss = $("#PSSidx").val();
    var iditem = $("#IHPidx").val();
    $.redirect(
      "./?link=viewihppdf",
      { idpss: idpss, iditem: iditem },
      "POST",
      "_blank"
    );
  });

  //Save IHP
  // $("#OprSave").on("click", function (e) {
  //   SaveIHP();
  // });

  //Create IHP
  // $("#OprCreateIHP").on("click", function (e) {
  //   CreateIHP();
  // });

  //Back Close Modal
  $(".CloseModal").on("click", function (e) {
    $(".windoweditihp").modal("hide");
    $(".windowresulttable").modal("hide");
    $(".windowspecsupplier").modal("hide");
  });

  $("#CloseModal2").on("click", function (e) {
    // $(".windoweditdistributeihp").modal("hide");
    $(".windoweditihp").modal("show");
  });

  // $("#CloseModal3").on("click", function (e) {
    // $(".windowreupload").modal("hide");
    // $(".windoweditihp").modal("show");
  // });

  //????
  // $("#AddTestResult").on("click", function (e) {
  //   var a = $("#PSSidy").val();
  //   var b = $("#IHPidy").val();
  //   var c = $("#IHPsidy").val();
  //   $(".windowaddresult").modal("show");
  //   $("#ResultIHP").val();
  //   $("#DocIHP").val();
  //   $("#fileupload").val();
  //   $("#PSSid2").val(a);
  //   $("#IHPid2").val(b);
  //   $("#IHPsid2").val(c);
  // });

  // $(".AddNewResultIHP").on("click", function (e) {
    // var a = $("#PSSidy").val();
    // var b = $("#IHPidy").val();
    // var c = $("#IHPsidy").val();
    // $(".windowaddresult").modal("show");
    // $("#ResultIHP").val();
    // $("#DocIHP").val();
    // $("#fileupload").val();
    // $("#PSSid").val(a);
    // $("#IHPid").val(b);
    // $("#IHPsid").val(c);
  // });

  // Download XLS
  $("#dwnldxls").on('click', function() {
    var iddownload = "IHPCHECKER";
    var search = $('#filtercari').val();
    var thnfilter = $('#filtertahun').val();
    var ihpfilter = $('#filterihp').val();
    var stsfilter = $('#filterstatus').val();

    $.redirect(
      "./?link=ihpdwnldxls",
      {
        id: iddownload,
        user: Udecrypt,
        section: EncSIHP,
        search: search,
        thnfilter: thnfilter,
        ihpfilter: ihpfilter,
        stsfilter: stsfilter
      },
      "POST",
      "_blank"
    )
  })
});
