//Activate dropdown & tab
$(".ui.pssdropdown").dropdown();
$(".ui.dropdown").dropdown();
$(".menu .item").tab();
$(".changenego").dropdown({
  selectOnKeydown: false,
});
moment().format();

// Global Variable
const NonceValue = "rdsystem2020";
const ColorOwner = "#00139f";
const ColorSHD = "#3b81ff";
const ColorFinish = "#5d5d5d";
const ColorCancel = "#7c0000";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocpssmqa = decodeURIComponent(getCookie("restlocpssmqa"));
var restlocpssihp = decodeURIComponent(getCookie("restlocpssihp"));

let Ucrypt = new Encryption();
var Udecrypt = Ucrypt.decrypt(EncU, NonceValue);
var filelocpss = decodeURIComponent(getCookie("filelocpss"));

function TableListBLPSS(FSearch, FYear, FStatus) {
  $("#PSSList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned seven wide column'B>" +
      "<'left aligned two wide column'i>" +
      "<'right aligned seven wide column'p>" +
      ">" +
      ">",
    buttons: [
      {
        text: "10",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(10).draw();
        },
      },
      {
        text: "25",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(25).draw();
        },
      },
      {
        text: "50",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(50).draw();
        },
      },
      {
        text: "100",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(100).draw();
        },
      },
      {
        text: "1000",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(1000).draw();
        },
      },
    ],
    destroy: true,
    stateSave: true,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    pageLength: 10,
    data: [],
    language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Pencarian..",
      processing: '<i class="circle notch loading icon huge"></i>',
      info: "_START_ sampai _END_ dari _TOTAL_ total data",
      paginate: {
        "first":      "Awal",
        "last":       "Akhir",
        "next":       "Berikutnya",
        "previous":   "Sebelumnya"
      },
      infoEmpty:      "Tidak ada data",
      select: {
        rows: ""
      }
    },
    order: [[0, "desc"]],
    columns: [
      {
        data: null,
        render: function (data, type, row) {
          if (data[0] != "") {
            return `<span  class="editpss clicklink" eid="${data[0]}" edesc="${data[3]}"><i class="tasks icon "></i></span>`;
          } else {
            return "";
          }
        },
      },
      {
        data: null,
        render: function (data) {
          if (data[11] == "NO_DATA") {
            return data[11];
          } else {
            return data[1];
          }
        },
      },
      { data: 2 },
      { data: 3 },
      { data: 4 },
      { data: 5 },
      { data: 6 },
      {
        data: null,
        render: function (data, type, row) {
          if (data[0] != "" && data[6] == "WIP") {
            return `<span  class="approvebl clicklink" eid="${data[0]}" edesc="${data[3]}" iditem="${data[7]}"><div class="ui green tiny label">APPROVAL</div></span>`;
          } else {
            return "";
          }
        },
      },
    ],
    columnDefs: [{ className: "center aligned", targets: [0] }],

    createdRow: function (row, data, index) {
      //WARNA NULL / DATA TIDAK DITEMUKAN
      if (data[11] == "NO_DATA") {
        $(row).addClass("errorhilite");
      }

      //WARNA WIP
      if (data[6] == "WIP") {
        $(row).find("td").css("color", ColorOwner);
      }

      //WARNA REJECTED
      if (data[6] == "REJECTED") {
        $(row).find("td").css("color", ColorCancel);
      }
    },

    ajax: {
      url: `${restlocpssmqa}table_pss`,
      type: "POST",
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        FSearch: FSearch,
        FYear: FYear,
        FStatus: FStatus,
      },
      error: function () {
        window.location.href = "./?link=loclogout";
        Swal.fire(
          "Error",
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
          "error"
        );
      },
    },
  });

  $("#PSSList").on("click", ".editpss", function () {
    var idpss = $(this).attr("eid");
    $.ajax({
      type: "POST",
      url: `${restlocpssmqa}all_detailpss`,
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        idpss: idpss,
      },
      cache: false,
      success: function (response) {
        var obj = JSON.parse(response);
        //console.log(obj);
        if (isEmpty(obj)) {
          console.log("-Empty-");
          $("#ItemListPSStbody").empty();
          return false;
        } else if (obj) {
          $("#ItemListPSStbody").empty();
          $("#DetailNumber").text(obj["read_pss"][0][0]["ps_no"]);
          $("#DetailTitle").text(obj["read_pss"][0][0]["judul_ps"]);
          $("#DetailJenis").text(obj["read_pss"][0][0]["jenis_project"]);
          $("#DetailProduct").text(obj["read_pss"][0][0]["product"]);
          $("#DetailChs").text(obj["read_pss"][0][0]["chasis"]);
          $("#DetailType").text(obj["read_pss"][0][0]["type"]);
          $("#DetailQtyM").text(obj["read_pss"][0][0]["qty"]);
          $("#DetailRev").text("");
          $("#DetailECN").text(obj["read_pss"][0][0]["ecn_jo"]);
          $("#DetailCFO").text(obj["read_pss"][0][0]["cfo"]);
          $("#DetailPIN").text(obj["read_pss"][0][0]["req_pinbl"]);

          $("#DetailDesigner").text(obj["read_pss"][0][0]["pic"]);
          $("#DetailSHD").text(obj["read_pss"][0][0]["section_head"]);
          $("#DetailNego").text(obj["read_pss"][0][0]["negosiator"]);
          $("#DetailStsPSS").text(obj["read_pss"][0][0]["status_ps"]);

          $("#DetailTLun").text(
            moment(obj["read_pss"][0][0]["target_pelunasan"]).format(
              "DD-MM-YYYY"
            )
          );
          $("#DetailTPIN").text(
            moment(obj["read_pss"][0][0]["target_pin"]).format("DD-MM-YYYY")
          );
          jmlData = obj["table_itempss"][0].length;

          for (a = 0; a < jmlData; a++) {
            if (
              obj["table_itempss"][0][a]["no_itempss"] ==
              obj["table_itempss"][0][a]["refer_noitem"]
            ) {
              var icon = "";
              var subitem = "";
            } else {
              var icon = "";
              var subitem = "subitem";
            }
            if (obj["table_itempss"][0][a]["link_documents"] !== "") {
              var link =
                "<a target='_blank' href='" +
                obj["table_itempss"][0][a]["link_documents"] +
                "'>";
            } else if (
              obj["table_itempss"][0][a]["file"] !== null &&
              obj["table_itempss"][0][a]["file"] !== ""
            ) {
              var link =
                "<a target='_blank' href='" +
                filelocpss +
                obj["table_itempss"][0][a]["file"] +
                "'>";
            } else {
              var link = "<span class='nospecv '>";
            }

            $("#ItemListPSS")
              .find("tbody")
              .append(
                "<tr  class='" +
                  subitem +
                  "' id='" +
                  a +
                  "'><td>" +
                  icon +
                  link +
                  obj["table_itempss"][0][a]["description_item"] +
                  "</a>" +
                  "</td><td></td>" +
                  "</td><td class='center'>" +
                  obj["table_itempss"][0][a]["vendor_material_number"] +
                  "</td><td class='center'>" +
                  obj["table_itempss"][0][a]["plant"] +
                  "</td><td class='center'>" +
                  obj["table_itempss"][0][a]["qty_sample"] +
                  "</td><td class='center'>" +
                  obj["table_itempss"][0][a]["base_unit"] +
                  "</td><td class='center'>" +
                  moment(obj["table_itempss"][0][a]["eta_sample"]).format(
                    "DD-MM-YYYY"
                  ) +
                  "</td><td class='center'>" +
                  obj["table_itempss"][0][a]["note"] +
                  "</td></tr>"
              );
          }
        }
      },
      error: function () {
        window.location.href = "./?link=loclogout";
        console.log(
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
        );
      },
    });
    $(".windowdetailitempss").modal("show");
  });
}

function TableListBLIHP(FSearch, FYear, FDesigner, FStatus) {
  $("#IHPList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned eight wide column'B>" +
      "<'right aligned eight wide column'p>" +
      ">" +
      ">",
    buttons: [
      {
        text: "10",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(10).draw();
        },
      },
      {
        text: "25",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(25).draw();
        },
      },
      {
        text: "50",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(50).draw();
        },
      },
      {
        text: "100",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(100).draw();
        },
      },
      {
        text: "1000",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(1000).draw();
        },
      },
    ],
    destroy: true,
    stateSave: true,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    pageLength: 10,
    data: [],
    language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Search..",
      processing: '<i class="circle notch loading icon huge"></i>',
    },
    order: [[0, "desc"]],
    columns: [
      {
        data: null,
        render: function (data, type, row) {
          if (data[0] != "") {
            return `<span  class="editihp clicklink" idpss="${data[14]}" iditem="${data[15]}"><i class="tasks icon "></i></span>`;
          } else {
            return "";
          }
        },
      },
      {
        data: null,
        render: function (data) {
          if (data[19] == "NO_DATA") {
            return data[19];
          } else {
            return data[0];
          }
        },
      },
      { data: 11 },
      { data: 2 },
      { data: 12 },
      { data: 4 },
      { data: 5 },
      { data: 6 },
      { data: 13 },
      {
        data: null,
        render: function (data) {
          if (data[19] == "NO_DATA") {
            return "";
          } else {
            return data[19];
          }
        },
      },
      {
        data: null,
        render: function (data, type, row) {
          if (data[0] != "" && data[19] == "WIP") {
            return `<span  class="approveihpbl clicklink" idpss="${data[14]}" iditem="${data[15]}"><div class="ui green tiny label">APPROVAL</div></span>`;
          } else {
            return "";
          }
        },
      },
    ],
    columnDefs: [{ className: "center aligned", targets: [0] }],

    createdRow: function (row, data, index) {
      //WARNA NULL / DATA TIDAK DITEMUKAN
      if (data[19] == "NO_DATA") {
        $(row).addClass("errorhilite");
      }

      //WARNA WIP
      if (data[19] == "WIP") {
        $(row).find("td").css("color", ColorOwner);
      }

      //WARNA REJECTED
      if (data[19] == "REJECTED") {
        $(row).find("td").css("color", ColorCancel);
      }
    },

    ajax: {
      url: `${restlocpssmqa}table_ihp`,
      type: "POST",
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        FSearch: FSearch,
        FYear: FYear,
        FDesigner: FDesigner,
        FStatus: FStatus,
      },
      error: function () {
        window.location.href = "./?link=loclogout";
        Swal.fire(
          "Error",
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
          "error"
        );
      },
    },
  });

  $("#IHPList").on("click", ".editihp", function () {
    var idpss = $(this).attr("idpss");
    var iditem = $(this).attr("iditem");
    $.ajax({
      type: "POST",
      url: `${restlocpssihp}load_itemihp`,
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        idpss: idpss,
        iditem: iditem,
      },
      cache: false,
      success: function (response) {
        var obj = JSON.parse(response);
        //console.log(obj);
        if (obj["read_item"][0]["file_upload"] == null) {
          var file = "<i>Belum ada spec yang diupload</i>";
        } else {
          var file =
            '<a target="_blank" href="./?link=filespecpss&f=' +
            obj["read_item"][0]["file_upload"] +
            '">' +
            obj["read_item"][0]["file_upload"] +
            "</a>";
        }
        if (isEmpty(obj)) {
          console.log("-Empty-");
          $("#ItemListPSStbody").empty();
          return false;
        } else if (obj) {
          $("#ItemListPSStbody").empty();
          $("#IHPNo").text(obj["read_item"][0]["no_ihp"]);
          $("#IHPDate").text(obj["read_item"][0]["tanggal_ihp"]);
          $("#IHPNoPSS").text(obj["read_item"][0]["ps_no"]);
          $("#IHPChassis").text(obj["read_item"][0]["chasis"]);
          $("#IHPType").text(obj["read_item"][0]["type"]);
          $("#IHPNegoName").text(obj["read_item"][0]["negosiator"]);
          $("#IHPDesgName").text(obj["read_item"][0]["designer"]);
          $("#IHPDescription").text(obj["read_item"][0]["description_item"]);
          $("#IHPVendorMatNum").text(obj["read_item"][0]["vendor_material_number"]);
          $("#IHPVendor").text(obj["read_item"][0]["vendor"]);
          $("#IHPManufacture").text(obj["read_item"][0]["manufacture"]);
          $("#IHPNoGudang").text(obj["read_item"][0]["no_gudang"]);
          $("#IHPTPIN").text(obj["read_item"][0]["target_pelunasan"]);
          $("#IHPTECN").text(obj["read_item"][0]["target_pin"]);
          $("#IHPIdItem").val(iditem);
          $("#IHPFile").html(file);
        }
      },
      error: function () {
        window.location.href = "./?link=loclogout";
        console.log(
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
        );
      },
    });
    $(".windowdetailitem").modal("show");
  });
}

$(document).ready(function () {
  //Tab Action Link
  $("#tabregpss").on("click", function () {
    window.location.href = "./?link=pssheader";
  });
  $("#addnewpss").on("click", function () {
    window.location.href = "./?link=pssheader";
  });
  $('.tabuserguide').on('click', function() {
    window.location.href = "./?link=guidepss";
  });
  $('.tabsuratgolive').on('click', function() {
    window.location.href = "./?link=golivepss";
  });
  $('.tabhasilmonitoring').on('click', function() {
    window.location.href = "./?link=monitorpss";
  });
  $('.tabversion').on('click', function() {
    window.location.href = "./?link=versionhistory&app=PSS";
  });
});

//Function untuk copy ke clipboard
function copyToClipboard(element) {
  var $temp = $("<input>");
  $("body").append($temp);
  $temp.val($(element).text()).select();
  document.execCommand("copy");
  $temp.remove();
  console.log("copied");
  Swal.fire({
    text: "Item yang anda maksud sudah tersalin di clipboard",
    timer: 1500,
    position: "bottom-left",
    toast: true,
    showConfirmButton: false,
  });
}

//Read Filter Cookies PSS
var d = new Date();
var yearnow = d.getFullYear();
var sfilter = getCookie("sfilpssmqa");
var tfilter = getCookie("tfilpssmqa");
var stfilter = getCookie("stfilpssmqa");
if (sfilter) {
  $("#filtercari").val(sfilter);
  var sfilterstart = sfilter;
} else {
  setCookie("sfilpssmqa", "", 5);
  var sfilterstart = "";
}
if (tfilter) {
  $("#filtertahun").dropdown("set selected", tfilter);
  var tfilterstart = tfilter;
} else {
  setCookie("tfilpssmqa", yearnow, 5);
  var tfilterstart = yearnow;
}
if (stfilter) {
  $("#filterstatus").dropdown("set selected", stfilter);
  var stfilterstart = stfilter;
} else {
  setCookie("stfilpssmqa", "ALL", 5);
  var stfilterstart = "ALL";
}
TableListBLPSS(sfilterstart, tfilterstart, stfilterstart);

//Read Filter Cookies IHP
var sfilter2 = getCookie("sfilihpmqa");
var tfilter2 = getCookie("tfilihpmqa");
var dfilter2 = getCookie("dfilihpmqa");
var stfilter2 = getCookie("stfilihpmqa");
if (sfilter2) {
  $("#filtercariIHP").val(sfilter2);
  var sfilterstart2 = sfilter2;
} else {
  setCookie("sfilihpmqa", "", 5);
  var sfilterstart2 = "";
}
if (tfilter2) {
  $("#filtertahunIHP").dropdown("set selected", tfilter2);
  var tfilterstart2 = tfilter2;
} else {
  setCookie("tfilihpmqa", yearnow, 5);
  var tfilterstart2 = yearnow;
}
if (dfilter2) {
  $("#filterdesignrIHP").dropdown("set selected", dfilter2);
  var dfilterstart2 = dfilter2;
} else {
  setCookie("dfilihpmqa", "ALL", 5);
  var dfilterstart2 = "ALL";
}
if (stfilter2) {
  $("#filterstatusIHP").dropdown("set selected", stfilter2);
  var stfilterstart2 = stfilter2;
} else {
  setCookie("stfilihpmqa", "ALL", 5);
  var stfilterstart2 = "ALL";
}
TableListBLIHP(sfilterstart2, tfilterstart2, dfilterstart2, stfilterstart2);

//RESPON KETIKA INPUT PENCARIAN DI KETIK
$("#filtercari").on("keyup", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("sfilpssmqa", FilterCari, 5);
  setCookie("tfilpssmqa", FilterTahun, 5);
  setCookie("stfilpssmqa", FilterStatus, 5);
  $("#PSSList").DataTable().destroy();
  TableListBLPSS(FilterCari, FilterTahun, FilterStatus);
});
$("#filtercariIHP").on("keyup", function () {
  var FilterCari2 = $("#filtercariIHP").val();
  var FilterTahun2 = $("#filtertahunIHP").val();
  var FilterDesgn2 = $("#filterdesignrIHP").val();
  var FilterStatus2 = $("#filterstatusIHP").val();
  setCookie("sfilihpmqa", FilterCari2, 5);
  setCookie("tfilihpmqa", FilterTahun2, 5);
  setCookie("dfilihpmqa", FilterDesgn2, 5);
  setCookie("stfilihpmqa", FilterStatus2, 5);
  $("#IHPList").DataTable().destroy();
  TableListBLIHP(FilterCari2, FilterTahun2, FilterDesgn2, FilterStatus2);
});

//RESPON KETIKA FILTER TAHUN DI RUBAH
$("#filtertahun, #filterstatus").on("change", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("sfilpssmqa", FilterCari, 5);
  setCookie("tfilpssmqa", FilterTahun, 5);
  setCookie("stfilpssmqa", FilterStatus, 5);
  $("#PSSList").DataTable().destroy();
  TableListBLPSS(FilterCari, FilterTahun, FilterStatus);
});
$("#filtertahunIHP, #filterdesignrIHP, #filterstatusIHP").on(
  "change",
  function () {
    var FilterCari2 = $("#filtercariIHP").val();
    var FilterTahun2 = $("#filtertahunIHP").val();
    var FilterDesgn2 = $("#filterdesignrIHP").val();
    var FilterStatus2 = $("#filterstatusIHP").val();
    setCookie("sfilihpmqa", FilterCari2, 5);
    setCookie("tfilihpmqa", FilterTahun2, 5);
    setCookie("dfilihpmqa", FilterDesgn2, 5);
    setCookie("stfilihpmqa", FilterStatus2, 5);
    $("#IHPList").DataTable().destroy();
    TableListBLIHP(FilterCari2, FilterTahun2, FilterDesgn2, FilterStatus2);
  }
);

//RESET FILTER
$(".resetfilter").on("click", function () {
  var d = new Date();
  var yearnow = d.getFullYear();
  $("#filtercari").val("");
  $("#filtertahun").dropdown("set selected", yearnow);
  $("#filterstatus").dropdown("set selected", "ALL");
  setCookie("sfilpssmqa", "", 5);
  setCookie("tfilpssmqa", yearnow, 5);
  setCookie("stfilpssmqa", "ALL", 5);
  $("#PSSList").DataTable().destroy();
  TableListBLPSS("", yearnow, "ALL");
});
$(".resetfilterIHP").on("click", function () {
  var d = new Date();
  var yearnow = d.getFullYear();
  $("#filtercariIHP").val("");
  $("#filtertahunIHP").dropdown("set selected", yearnow);
  $("#filterdesignrIHP").dropdown("set selected", "ALL");
  $("#filterstatusIHP").dropdown("set selected", "ALL");
  setCookie("sfilihpmqa", "", 5);
  setCookie("tfilihpmqa", yearnow, 5);
  setCookie("dfilihpmqa", "ALL", 5);
  setCookie("stfilihpmqa", "ALL", 5);
  $("#IHPList").DataTable().destroy();
  TableListBLIHP("", yearnow, "ALL", "ALL");
});

$("#PSSList").on("click", ".approvebl", function () {
  var idpss = $(this).attr("eid");
  var iditem = $(this).attr("iditem");
  $("#idpss1").val(idpss);
  $("#iditem1").val(iditem);
  $(".windowapproval").modal("show");
});

$("#IHPList").on("click", ".approveihpbl", function () {
  var idpss = $(this).attr("idpss");
  var iditem = $(this).attr("iditem");
  $("#idpss").val(idpss);
  $("#iditem").val(iditem);
  $(".windowapprovalIHP").modal("show");
});

$("#ApproveBack").on("click", function () {
  $(".windowapproval").modal("hide");
});

$("#ApproveBackIHP").on("click", function () {
  $(".windowapprovalIHP").modal("hide");
});

$("#ApproveOK").on("click", function () {
  var id = $("#idpss1").val();
  var iditem = $("#iditem1").val();
  var userpss = $("#userpss1").val();
  $.ajax({
    type: "POST",
    url: `${restlocpssmqa}sign_pssmqa`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      idpss: id,
      iditem: iditem,
      userpss: userpss,
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (isEmpty(obj)) {
        console.log("-Fail-");
        return false;
      } else if (obj) {
      }
      $(".windowapproval").modal("hide");
      TableListBLPSS(sfilterstart, tfilterstart, stfilterstart);
    },
    error: function () {
      window.location.href = "./?link=loclogout";
      console.log(
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
      );
    },
  });
});

$("#ApproveOKIHP").on("click", function () {
  var idpss = $("#idpss").val();
  var iditem = $("#iditem").val();
  var userpss = $("#userpss").val();
  $.ajax({
    type: "POST",
    url: `${restlocpssmqa}sign_itemihp`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: {
      idpss: idpss,
      iditem: iditem,
      userpss: userpss,
    },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      if (isEmpty(obj)) {
        console.log("-Fail-");
        return false;
      } else if (obj) {
      }
      $(".windowapprovalIHP").modal("hide");
      TableListBLIHP(
        sfilterstart2,
        tfilterstart2,
        dfilterstart2,
        stfilterstart2
      );
    },
    error: function () {
      window.location.href = "./?link=loclogout";
      console.log(
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
      );
    },
  });
});

$("#ApproveNG").on("click", function () {
  var id = $("#idpss1").val();
  var iditem = $("#iditem1").val();
  var userpss = $("#userpss1").val();
  console.log(id);

  (async () => {
    const { value: reason } = await Swal.fire({
      title: "Reason",
      input: "text",
      inputPlaceholder: "Alasan Penolakan PIN BL",
    });

    if (reason) {
      $.ajax({
        type: "POST",
        url: `${restlocpssmqa}cancel_pssmqa`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          idpss: id,
          iditem: iditem,
          userpss: userpss,
          reason: reason,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(response);
          if (isEmpty(obj)) {
            console.log("-Fail-");
            return false;
          } else if (obj) {
          }
          $(".windowapproval").modal("hide");
          TableListBLPSS(sfilterstart, tfilterstart, stfilterstart);
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          console.log(
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
          );
        },
      });
    }
  })();
});

$("#ApproveNGIHP").on("click", function () {
  var idpss = $("#idpss").val();
  var iditem = $("#iditem").val();
  var userpss = $("#userpss").val();

  (async () => {
    const { value: reason } = await Swal.fire({
      title: "Reason",
      input: "text",
      inputPlaceholder: "Alasan Penolakan PIN BL",
    });

    if (reason) {
      $.ajax({
        type: "POST",
        url: `${restlocpssmqa}cancel_itemihp`,
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          idpss: idpss,
          iditem: iditem,
          userpss: userpss,
          reason: reason,
        },
        cache: false,
        success: function (response) {
          var obj = JSON.parse(response);
          if (isEmpty(obj)) {
            console.log("-Fail-");
            return false;
          } else if (obj) {
          }
          $(".windowapprovalIHP").modal("hide");
          TableListBLIHP(
            sfilterstart2,
            tfilterstart2,
            dfilterstart2,
            stfilterstart2
          );
        },
        error: function () {
          window.location.href = "./?link=loclogout";
          console.log(
            "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
          );
        },
      });
    }
  })();
});
