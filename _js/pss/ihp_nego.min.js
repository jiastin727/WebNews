//Activate dropdown & tab
$(".ui.pssdropdown").dropdown();
$(".ui.dropdown").dropdown();
$(".menu .item").tab();
$(".changenego").dropdown({
  selectOnKeydown: false,
});
moment().format();

// Global Variable for Header Authorization
const NonceValue = "rdsystem2020";
const ColorOwner = "#00139f";
const ColorActivity = "#7d7d7d";
const ColorFinish = "#5d5d5d";
const ColorCancel = "#7c0000";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocpssopr = decodeURIComponent(getCookie("restlocpssopr"));
var restlocpssneg = decodeURIComponent(getCookie("restlocpssneg"));
var restlocpssihp = decodeURIComponent(getCookie("restlocpssihp"));

// let Ucrypt        = new Encryption();
// var Udecrypt      = Ucrypt.decrypt(EncU, NonceValue);

function TableListFunc(FSearch, FYear, FNama, FOperator, FProgress, FStatus) {
  $("#PSSList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned seven wide column'B>" +
      "<'left aligned two wide column'i>" +
      "<'right aligned seven wide column'p>" +
      ">" +
      ">",
    buttons: [
      {
        text: "5",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(5).draw();
        },
      },
      {
        text: "10",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(10).draw();
        },
      },
      {
        text: "25",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(25).draw();
        },
      },
      {
        text: "50",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(50).draw();
        },
      },
      {
        text: "100",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(100).draw();
        },
      },
      {
        text: "1000",
        action: function (e, dt, node, config) {
          $("#PSSList").DataTable().page.len(1000).draw();
        },
      },
    ],
    destroy: true,
    stateSave: true,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    scrollX     : true,
    pageLength: 5,
    data: [],
    language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Pencarian..",
      processing: '<i class="circle notch loading icon huge"></i>',
      info: "_START_ sampai _END_ dari _TOTAL_ total data",
      paginate: {
        "first":      "Awal",
        "last":       "Akhir",
        "next":       "Berikutnya",
        "previous":   "Sebelumnya"
      },
      infoEmpty:      "Tidak ada data",
      select: {
        rows: ""
      }
    },
    order: [[2, "desc"]],
    columns: [
      
      {
        data: null,
        render: function (data, type, row) {
          if (data[0] != "") {

            return `<span class="viewihp" nomerihp="${data['no_ihp']}" pssid="${data['id_pss']}" iditem="${data['id_item']}" data-tooltip="View detail IHP" data-inverted="" data-position="right center"><i class="tasks link circular teal icon "></i></span>`;

          } else {
            return "";
          }
        },
      },
      {
        data: null,
        render: function (data, type, row) {
          if (data[0] != "") {

            return `<span class="viewhistory" nomerihp="${data['no_ihp']}" pssid="${data['id_pss']}" iditem="${data['id_item']}" data-tooltip="View progress history" data-inverted="" data-position="right center"><i class="history link circular teal icon "></i></span>`;

          } else {
            return "";
          }
        },
      },

      // {
      //   data: null,
      //   render: function (data) {
      //     return "";
      //   },
      // },
      // {
      //   data: null,
      //   render: function (data, type, row) {
      //     if (data[0] != "") {
      //       return `<i class="edit outline viewihp iconcoloredit icon" pssid="${data[14]}" iditem="${data[15]}" stsitem="${data[10]}">`;
      //     } else {
      //       return "";
      //     }
      //   },
      // },
      { data: 'no_ihp' },
      { data: 'tanggal_ihp' },
      { data: 'description_item' },
      { data: 'vendor_material_number' },
      { data: 'vendor' },
      {
        data: null,
        render: function (data, type, row) {
          if (data['product'] == "HOME APPLIANCES") {
            return `HA`;
          } else if (data['product'] == "AUDIO") {
            return `AUD`;
          } else if (data['product'] == "VIDEO") {
            return `VID`;
          } else if (data['product'] == "SPECIAL PRODUCT") {
            return `SPP`;
          } else {
            return `${data['product']}`;
          }
        },
      },
      { data: 'chasis' },
      { data: 'note' },
      { data: 'tahap' },
      { data: 'req_pinbl' },
      { data: 'designer' },
      { data: 'negosiator' },
      { data: 'operator' },
      
      { data: 'final_result' },
      { data: 'status_item' },
      { data: 'progress' },
      
      
    ],
    columnDefs: [
      { className: "center aligned", targets: [0, 1, 7, 8, 10,11] },
      { targets: [0, 1], orderable: false },
      { targets: [3],
        render: function (data, type, row) {
          var dateObj = new Date(data);
          var momentObj = moment(dateObj);
          if (data){
            return momentObj.format('ddd, DD MMM YYYY');
          } else {
            return '';
          }
        }
      }
    ],

    createdRow: function (row, data, index) {
      if (data['status_item'] == "FINISH" || data['status_item'] == "CLOSE") {
        $(row).find("td").css("color", ColorFinish);
      }
      if (data['status_item'] == "CANCEL") {
        $(row).find("td").css("color", ColorCancel);
      }
    },

    ajax: {
      url: `${restlocpssneg}table_ihpnegosiator`,
      type: "POST",
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: {
        FSearch: FSearch,
        FYear: FYear,
        FNama: FNama,
        FOperator: FOperator,
        FProgress: FProgress,
        FStatus: FStatus,
      },
      error: function () {
        window.location.href = "./?link=loclogout";
        Swal.fire(
          "Error",
          "Server tidak merespon, segera hubungi Administrator di ext. 3553 !",
          "error"
        );
      },
    },
  });
}



//Click Icon Edit item IHP
$("#PSSList").on("click", ".viewhistory", function () {
  var idpss = $(this).attr("pssid");
  var iditem = $(this).attr("iditem");
  var noihp = $(this).attr("nomerihp");
  $(".windowhistoryihp").modal("show");
  console.log(noihp);
  $("span#nomerihp").text(noihp);

  $.ajax({
    type: "POST",
    url: `${restlocpssihp}history_ihp`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: { idpss: idpss, iditem: iditem },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      //console.log(obj);
      if (isEmpty(obj)) {
        console.log("Gagal load, data kosong");
        return false;
      } else if (obj) {
        jmlData = obj.length;
        $("#NegoChangeTable").empty();
        for (a = 0; a < jmlData; a++) {
          obj[0]["nego_semula"] = "";
          $("#NegoChangeList")
            .find("tbody")
            .append(
              "<tr><td>" +
                obj[a]["date"] +
                "</td><td class='center'>" +
                obj[a]["progress"] +
                "</td><td class='center'>" +
                obj[a]["user"] +
                "</td></tr>"
            );
        }
      }
    },
    error: function () {
      window.location.href = "./?link=loclogout";
      console.log(
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
      );
    },
  });


});

//Click Icon Edit item IHP
$("#PSSList").on("click", ".viewihp", function () {
  var pssid = $(this).attr("pssid");
  var iditem = $(this).attr("iditem");
  var stsitem = $(this).attr("stsitem");
  $("#NegoUpload").val("");
  $(".windowdetailihp").modal("show");

  $.ajax({
    type: "POST",
    url: `${restlocpssopr}load_itemihpev`,
    headers: {
      user: vusrnm,
      token: vtoken,
    },
    data: { iditem: iditem, idpss: pssid },
    cache: false,
    success: function (response) {
      var obj = JSON.parse(response);
      console.log(obj);

      if (obj["note_ihp"][0]["note"] == null) {
        $(".ihp-noteheader").hide()
      } else {
        $(".ihp-noteheader").show()
        $(".note-ihp-kembali").text(obj["note_ihp"][0]["note"])
      }

      if (obj["read_item"][0]["file_upload"] == null) {
        var file = "<i>Belum ada spec yang diupload</i>";
      } else {
        var file =
          '<a target="_blank" href="./?link=filespecpss&f=' +
          obj["read_item"][0]["file_upload"] +
          '">' +
          obj["read_item"][0]["file_upload"] +
          "</a>";
      }

      if (isEmpty(obj["read_item"])) {
        console.log("Gagal load tabel, data kosong");
      } else if (obj["read_item"]) {
        if (obj["read_item"].status == false) {
          Swal.fire(
            "Error",
            "Ada kendal di koneksi/database, data gagal diload !",
            "error"
          );
        } else {
          //console.log(obj["read_item"])
          if (obj["read_item"][0]["progress_item"] == "IHP KEMBALI") {
            $(".IHPKembaliArea").show();
          } else {
            $(".IHPKembaliArea").hide();
          }

          // $(".windowdetailihp").modal("show");
          $("#NegoNoIHP").text(obj["read_item"][0]["no_ihp"]);
          $("#NegoDateIHP").html(moment(obj["read_item"][0]["tanggal_ihp"]).format('ddd, DD MMM YYYY'));
          $("#NegoNoPSS").text(obj["read_item"][0]["ps_no"]);
          $("#NegoChassis").text(obj["read_item"][0]["chasis"]);
          $("#NegoType").text(obj["read_item"][0]["type"]);
          $("#NegoNegoName").text(obj["read_item"][0]["negosiator"]);
          $("#NegoCategory").text(obj["read_item"][0]["jenis_project"]);
          $("#NegoDesgName").text(obj["read_item"][0]["designer"]);
          $("#NegoTahap").text(obj["read_item"][0]["tahap"]);
          $("#NegoDescript").text(obj["read_item"][0]["description_item"]);
          $("#NegoVendorMatNum").text(
            obj["read_item"][0]["vendor_material_number"]
          );
          $("#NegoNoGudang").text(obj["read_item"][0]["no_gudang"]);
          $("#NegoVendor").text(obj["read_item"][0]["vendor"]);
          $("#NegoManufacture").text(obj["read_item"][0]["manufacture"]);
          $("#NegoMSCNote").text(obj["read_item"][0]["note_ihp"]);
          $("#NegoIHPKembali").html(moment(obj["read_item"][0]["tanggal_ihp_kembali"]).format('ddd, DD MMM YYYY'));
          $("#FinalResult").text(obj["read_item"][0]["final_result"]);

          $("#PSSidx").val(pssid);
          $("#IHPIdItem").val(iditem);
          $("#NegoFileSpec").html(file);

          var stsel = obj["read_ihpev"][0]["status_electronic"];
          var stscy = obj["read_ihpev"][0]["status_cycle"];
          var stsme = obj["read_ihpev"][0]["status_mechanic"];
          var stsid = obj["read_ihpev"][0]["status_ind"];
          var stsso = obj["read_ihpev"][0]["status_software"];
          var stspc = obj["read_ihpev"][0]["status_pcb"];
          var stsmq = obj["read_ihpev"][0]["status_mqa"];
          var stsdq = obj["read_ihpev"][0]["status_dqa"];
          var stsat = obj["read_ihpev"][0]["status_autrans"];
          var stsot = obj["read_ihpev"][0]["status_others"];
          var stso1 = obj["read_ihpev"][0]["status_others1"];
          var stso2 = obj["read_ihpev"][0]["status_others2"];

          var docel = obj["read_ihpev"][0]["acuan_electronic"];
          var doccy = obj["read_ihpev"][0]["acuan_cycle"];
          var docme = obj["read_ihpev"][0]["acuan_mechanic"];
          var docid = obj["read_ihpev"][0]["acuan_ind"];
          var docso = obj["read_ihpev"][0]["acuan_software"];
          var docpc = obj["read_ihpev"][0]["acuan_pcb"];
          var docmq = obj["read_ihpev"][0]["acuan_mqa"];
          var docdq = obj["read_ihpev"][0]["acuan_dqa"];
          var docat = obj["read_ihpev"][0]["acuan_autrans"];
          var docot = obj["read_ihpev"][0]["acuan_others"];
          var doco1 = obj["read_ihpev"][0]["acuan_others1"];
          var doco2 = obj["read_ihpev"][0]["acuan_others2"];

          var lnkel = obj["read_ihpev"][0]["link_electronic"];
          var lnkcy = obj["read_ihpev"][0]["link_cycle"];
          var lnkme = obj["read_ihpev"][0]["link_mechanic"];
          var lnkid = obj["read_ihpev"][0]["link_ind"];
          var lnkso = obj["read_ihpev"][0]["link_software"];
          var lnkpc = obj["read_ihpev"][0]["link_pcb"];
          var lnkmq = obj["read_ihpev"][0]["link_mqa"];
          var lnkdq = obj["read_ihpev"][0]["link_dqa"];
          var lnkat = obj["read_ihpev"][0]["link_autrans"];
          var lnkot = obj["read_ihpev"][0]["link_others"];
          var lnko1 = obj["read_ihpev"][0]["link_others1"];
          var lnko2 = obj["read_ihpev"][0]["link_others2"];

          var picel = obj["read_ihpev"][0]["pic_confirm_electronic"];
          var piccy = obj["read_ihpev"][0]["pic_confirm_cycle"];
          var picme = obj["read_ihpev"][0]["pic_confirm_mechanic"];
          var picid = obj["read_ihpev"][0]["pic_confirm_ind"];
          var picso = obj["read_ihpev"][0]["pic_confirm_software"];
          var picpc = obj["read_ihpev"][0]["pic_confirm_pcb"];
          var picmq = obj["read_ihpev"][0]["pic_confirm_mqa"];
          var picdq = obj["read_ihpev"][0]["pic_confirm_dqa"];
          var picat = obj["read_ihpev"][0]["pic_confirm_autrans"];
          var picot = obj["read_ihpev"][0]["pic_confirm_others"];
          var pico1 = obj["read_ihpev"][0]["pic_confirm_others1"];
          var pico2 = obj["read_ihpev"][0]["pic_confirm_others2"];

          // if (lnkel) {
          //   var linkel =
          //     '<a target="_blank" href="' + lnkel + '">' + docel + "</a>";
          // } else {
          //   var linkel = lnkel;
          // }
          // if (lnkcy) {
          //   var linkcy =
          //     '<a target="_blank" href="' + lnkcy + '">' + doccy + "</a>";
          // } else {
          //   var linkcy = lnkcy;
          // }
          // if (lnkme) {
          //   var linkme =
          //     '<a target="_blank" href="' + lnkme + '">' + docme + "</a>";
          // } else {
          //   var linkme = lnkme;
          // }
          // if (lnkid) {
          //   var linkid =
          //     '<a target="_blank" href="' + lnkid + '">' + docid + "</a>";
          // } else {
          //   var linkid = lnkid;
          // }
          // if (lnkso) {
          //   var linkso =
          //     '<a target="_blank" href="' + lnkso + '">' + docso + "</a>";
          // } else {
          //   var linkso = lnkso;
          // }
          // if (lnkpc) {
          //   var linkpc =
          //     '<a target="_blank" href="' + lnkpc + '">' + docpc + "</a>";
          // } else {
          //   var linkpc = lnkpc;
          // }
          // if (lnkmq) {
          //   var linkmq =
          //     '<a target="_blank" href="' + lnkmq + '">' + docmq + "</a>";
          // } else {
          //   var linkmq = lnkmq;
          // }
          // if (lnkdq) {
          //   var linkdq =
          //     '<a target="_blank" href="' + lnkdq + '">' + docdq + "</a>";
          // } else {
          //   var linkdq = lnkdq;
          // }
          // if (lnkat) {
          //   var linkat =
          //     '<a target="_blank" href="' + lnkat + '">' + docat + "</a>";
          // } else {
          //   var linkat = lnkat;
          // }
          // if (lnkot) {
          //   var linkot =
          //     '<a target="_blank" href="' + lnkot + '">' + docot + "</a>";
          // } else {
          //   var linkot = lnkot;
          // }
          // if (lnko1) {
          //   var linko1 =
          //     '<a target="_blank" href="' + lnko1 + '">' + doco1 + "</a>";
          // } else {
          //   var linko1 = lnko1;
          // }
          // if (lnko2) {
          //   var linko2 =
          //     '<a target="_blank" href="' + lnko2 + '">' + doco2 + "</a>";
          // } else {
          //   var linko2 = lnko2;
          // }

          if (lnkel && lnkel!==null) {
            if(!docel){ var docel = "Dokumen Electronic"; }
            var linkel =
              '<a target="_blank" href="../RND_Upload/' + lnkel + '">' + ShortText(docel) + "</a>";
          } else {
            var linkel = ShortText(docel);
          }

          if (lnkcy) {
            if(!doccy){ var doccy = "Dokumen Energy Conversion"; }
            var linkcy =
              '<a target="_blank" href="../RND_Upload/' + lnkcy + '">' + ShortText(doccy) + "</a>";
          } else {
            var linkcy = ShortText(doccy);
          }
          if (lnkme) {
            if(!docme){ var docme = "Dokumen Mechanic"; }
            var linkme =
              '<a target="_blank" href="../RND_Upload/' + lnkme + '">' + ShortText(docme) + "</a>";
          } else {
            var linkme = ShortText(docme);
          }
          if (lnkid) {
            if(!docid){ var docid = "Dokumen Industrial Design"; }
            var linkid =
              '<a target="_blank" href="../RND_Upload/' + lnkid + '">' + ShortText(docid) + "</a>";
          } else {
            var linkid = ShortText(docid);
          }
          if (lnkso) {
            if(!docso){ var docso = "Dokumen Software"; }
            var linkso =
              '<a target="_blank" href="../RND_Upload/' + lnkso + '">' + ShortText(docso) + "</a>";
          } else {
            var linkso = ShortText(docso);
          }
          if (lnkpc) {
            if(!docpc){ var docpc = "Dokumen PCB"; }
            var linkpc =
              '<a target="_blank" href="../RND_Upload/' + lnkpc + '">' + ShortText(docpc) + "</a>";
          } else {
            var linkpc = ShortText(docpc);
          }
          if (lnkmq) {
            if(!docmq){ var docmq = "Dokumen MQA"; }
            var linkmq =
              '<a target="_blank" href="../RND_Upload/' + lnkmq + '">' + ShortText(docmq) + "</a>";
          } else {
            var linkmq = ShortText(docmq);
          }
          if (lnkdq) {
            if(!docdq){ var docdq = "Dokumen DQA"; }
            var linkdq =
              '<a target="_blank" href="../RND_Upload/' + lnkdq + '">' + ShortText(docdq) + "</a>";
          } else {
            var linkdq = ShortText(docdq);
          }
          if (lnkat) {
            if(!docat){ var docat = "Dokumen Autrans"; }
            var linkat =
              '<a target="_blank" href="../RND_Upload/' + lnkat + '">' + ShortText(docat) + "</a>";
          } else {
            var linkat = ShortText(docat);
          }
          if (lnkot) {
            if(!docot){ var docot = "Dokumen Others"; }
            var linkot =
              '<a target="_blank" href="../RND_Upload/' + lnkot + '">' + ShortText(docot) + "</a>";
          } else {
            var linkot = ShortText(docot);
          }
          if (lnko1) {
            if(!doco1){ var doco1 = "Dokumen Others 1"; }
            var linko1 =
              '<a target="_blank" href="../RND_Upload/' + lnko1 + '">' + ShortText(doco1) + "</a>";
          } else {
            var linko1 = ShortText(doco1);
          }
          if (lnko2) {
            if(!doco2){ var doco2 = "Dokumen Others 2"; }
            var linko2 =
              '<a target="_blank" href="../RND_Upload/' + lnko2 + '">' + ShortText(doco2) + "</a>";
          } else {
            var linko2 = ShortText(doco2);
          }

          $("#ElectResult").text(stsel);
          $("#HAResult").text(stscy);
          $("#MechResult").text(stsme);
          $("#IDeResult").text(stsid);
          $("#SoftResult").text(stsso);
          $("#PCBResult").text(stspc);
          $("#MQAResult").text(stsmq);
          $("#DQAResult").text(stsdq);
          $("#AuTResult").text(stsat);
          $("#OthResult").text(stsot);
          $("#Oth1Result").text(stso1);
          $("#Oth2Result").text(stso2);

          $("#ElectReff").html(linkel);
          $("#HAReff").html(linkcy);
          $("#MechReff").html(linkme);
          $("#IDReff").html(linkid);
          $("#SoftReff").html(linkso);
          $("#PCBReff").html(linkpc);
          $("#MQAReff").html(linkmq);
          $("#DQAReff").html(linkdq);
          $("#AuTReff").html(linkat);
          $("#OthReff").html(linkot);
          $("#Oth1Reff").html(linko1);
          $("#Oth2Reff").html(linko2);

          $("#ElectPIC").text(picel);
          $("#HAPIC").text(piccy);
          $("#MechPIC").text(picme);
          $("#IDePIC").text(picid);
          $("#SoftPIC").text(picso);
          $("#PCBPIC").text(picpc);
          $("#MQAPIC").text(picmq);
          $("#DQAPIC").text(picdq);
          $("#AuTPIC").text(picat);
          $("#OthPIC").text(picot);
          $("#Oth1PIC").text(pico1);
          $("#Oth2PIC").text(pico2);
        }
      }
    },
    error: function () {
      window.location.href = "./?link=loclogout";
      console.log(
        "Server tidak merespon, segera hubungi Administrator di ext. 3553 !"
      );
    },
  });
});

//Function untuk copy ke clipboard
function copyToClipboard(element) {
  var $temp = $("<input>");
  $("body").append($temp);
  $temp.val($(element).text()).select();
  document.execCommand("copy");
  $temp.remove();
  console.log("copied");
  Swal.fire({
    text: "Item yang anda maksud sudah tersalin di clipboard",
    timer: 1500,
    position: "bottom-left",
    toast: true,
    showConfirmButton: false,
  });
}

function LoadTableList() {
  //Read Filter Cookies
  var d = new Date();
  var iyearnow = d.getFullYear();
  var isfilter = getCookie("isfilpss");
  var itfilter = getCookie("itfilpss");
  var imfilter = getCookie("imfilpss");
  var iofilter = getCookie("iofilpss");
  var ipfilter = getCookie("ipfilpss");
  var isitfilter = getCookie("isitfilpss");
  if (isfilter) {
    $("#filtercari").val(isfilter);
    var isfilterstart = isfilter;
  } else {
    setCookie("isfilpss", "", 5);
    var isfilterstart = "";
  }
  if (itfilter) {
    $("#filtertahun").dropdown("set selected", itfilter);
    var itfilterstart = itfilter;
  } else {
    setCookie("itfilpss", iyearnow, 5);
    var itfilterstart = iyearnow;
  }
  if (imfilter) {
    $("#filtermine").dropdown("set selected", imfilter);
    var imfilterstart = imfilter;
  } else {
    setCookie("imfilpss", "ALL", 5);
    var imfilterstart = "ALL";
  }
  if (iofilter) {
    $("#filteroperator").dropdown("set selected", iofilter);
    var iofilterstart = iofilter;
  } else {
    setCookie("iofilpss", "ALL", 5);
    var iofilterstart = "ALL";
  }
  if (ipfilter) {
    $("#filterprogress").dropdown("set selected", ipfilter);
    var ipfilterstart = ipfilter;
  } else {
    setCookie("ipfilpss", "ALL", 5);
    var ipfilterstart = "ALL";
  }
  if (isitfilter) {
    $("#filterstatus").dropdown("set selected", isitfilter);
    var isitfilterstart = isitfilter;
  } else {
    setCookie("isitfilpss", "ALL", 5);
    var isitfilterstart = "ALL";
  }
  //Load Table
  TableListFunc(
    isfilterstart,
    itfilterstart,
    imfilterstart,
    iofilterstart,
    ipfilterstart,
    isitfilterstart
  );

  //Showing input filter when !All
  if (iofilter !== "ALL" || ipfilter !== "ALL" || isitfilter !== "ALL") {
    $(".morefilter").show();
    $(".morefiltertd").show();
  } else {
    $(".morefilter").hide();
    $(".morefiltertd").hide();
  }
}

//Toggle More Filter
$("#morefilter").on("click", function () {
  $(".morefilter").toggle(100);
  $(".morefiltertd").toggle();
});

//RESPON KETIKA INPUT PENCARIAN DI KETIK
$("#filtercari").on("keyup", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterNama = $("#filtermine").val();
  var FilterOperator = $("#filteroperator").val();
  var FilterProgress = $("#filterprogress").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("isfilpss", FilterCari, 5);
  setCookie("itfilpss", FilterTahun, 5);
  setCookie("imfilpss", FilterNama, 5);
  setCookie("iofilpss", FilterOperator, 5);
  setCookie("ipfilpss", FilterProgress, 5);
  setCookie("isitfilpss", FilterStatus, 5);
  $("#PSSList").DataTable().destroy();
  TableListFunc(
    FilterCari,
    FilterTahun,
    FilterNama,
    FilterOperator,
    FilterProgress,
    FilterStatus
  );
});

//RESPON KETIKA FILTER TAHUN DI RUBAH
$(
  "#filtertahun, #filtermine, #filteroperator, #filterprogress, #filterstatus"
).on("change", function () {
  var FilterCari = $("#filtercari").val();
  var FilterTahun = $("#filtertahun").val();
  var FilterNama = $("#filtermine").val();
  var FilterOperator = $("#filteroperator").val();
  var FilterProgress = $("#filterprogress").val();
  var FilterStatus = $("#filterstatus").val();
  setCookie("isfilpss", FilterCari, 5);
  setCookie("itfilpss", FilterTahun, 5);
  setCookie("imfilpss", FilterNama, 5);
  setCookie("iofilpss", FilterOperator, 5);
  setCookie("ipfilpss", FilterProgress, 5);
  setCookie("isitfilpss", FilterStatus, 5);
  $("#PSSList").DataTable().destroy();
  TableListFunc(
    FilterCari,
    FilterTahun,
    FilterNama,
    FilterOperator,
    FilterProgress,
    FilterStatus
  );
});

//RESET FILTER
$(".resetfilter").on("click", function () {
  var d = new Date();
  var iyearnow = d.getFullYear();
  $("#filtercari").val("");
  $("#filtertahun").dropdown("set selected", iyearnow);
  $("#filtermine").dropdown("set selected", "ALL");
  $("#filteroperator").dropdown("set selected", "ALL");
  $("#filterprogress").dropdown("set selected", "ALL");
  $("#filterstatus").dropdown("set selected", "ALL");
  setCookie("isfilpss", "", 5);
  setCookie("itfilpss", iyearnow, 5);
  setCookie("imfilpss", "ALL", 5);
  setCookie("iofilpss", "ALL", 5);
  setCookie("ipfilpss", "ALL", 5);
  setCookie("isitfilpss", "ALL", 5);
  $("#PSSList").DataTable().destroy();
  TableListFunc("", yearnow, "ALL", "ALL", "ALL", "ALL");
  $(".morefilter").hide();
  $(".morefiltertd").hide();
});

function ShortText(t){
  if(t){
    var lennamafile = t.length;
    return lennamafile > 40 ? t.substring(0, 40).concat('...') : t;
  } else {
    return '';
  }
}

$(document).ready(function () {
  //Load Table List IHP
  LoadTableList();

  //IHP List
  $("#tabpsslist").on("click", function () {
    window.location.href = "./?link=pss";
  });

  $('.tabuserguide').on('click', function() {
    window.location.href = "./?link=guidepss";
  });
  $('.tabsuratgolive').on('click', function() {
    window.location.href = "./?link=golivepss";
  });
  $('.tabhasilmonitoring').on('click', function() {
    window.location.href = "./?link=monitorpss";
  });
  $('.tabversion').on('click', function() {
    window.location.href = "./?link=versionhistory&app=PSS";
  });
  $("#tabpssreport").on("click", function () {
    window.location.href = "./?link=reportingpss";
  });

  //Print IHP in PDF
  $("#PrintIHPPDF").on("click", function (e) {
    var idpss = $("#PSSidx").val();
    var iditem = $("#IHPIdItem").val();
    $.redirect(
      "./?link=viewihppdf",
      { idpss: idpss, iditem: iditem },
      "POST",
      "_blank"
    );
  });

  //Back Close Modal
  $(".CloseModal").on("click", function (e) {
    $(".windowdetailihp").modal("hide");
  });

  //Modal Window Control
  $(".windowdetailihp").modal({
    autofocus: false,
  });

   // Download XLS
   $('#dwnldxls').on('click', function () {
    var iddownload = "IHPNEGOTIATOR";
    var search = $('#filtercari').val();
    var thnfilter = $('#filtertahun').val();
    var negosiatorfilter = $('#filtermine').val();
    var oprfilter = $('#filteroperator').val();
    var prgfilter = $('#filterprogress').val();
    var stsfilter = $('#filterstatus').val();

    $.redirect(
      "./?link=ihpdwnldxls",
      {
        id: iddownload,
        search: search,
        thnfilter: thnfilter,
        negosiatorfilter: negosiatorfilter,
        oprfilter: oprfilter,
        prgfilter: prgfilter,
        stsfilter: stsfilter
      },
      "POST",
      "_blank"
    )
  })
});

//------------------------------------------------------------------------------------
