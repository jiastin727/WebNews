$(".ui.dropdown").dropdown();
$(".menu .item").tab();

// Global Variable
const NonceValue = "rdsystem2020";
const LogoutProtect = false;

// const ColorSignNo  = "#00139f";
// const ColorOwner  = "#00139f";
// const BgColorOwner  = "#eff0ff";
// const ColorRelease= "#505050";
// const ColorCancel = "#be0000";
// const ColorLock = "#860954";
// const BgColorLock = "#f3ebeb";

var VUserName = getCookie("usrnm");
var VToken    = getCookie("token");
var RestLocBP = decodeURIComponent(getCookie("restlocpsc"));
let Ucrypt = new Encryption();
var DUser  = Ucrypt.decrypt(EUser, NonceValue);
var DJbtn  = Ucrypt.decrypt(EJbtn, NonceValue);
var DSect  = Ucrypt.decrypt(ESect, NonceValue);
var DGrup  = Ucrypt.decrypt(EGrup, NonceValue);


function TableListFunc() {

  var JsonFilter = getCookie('FilterROMVideoTimeline');
  var ArrayF = JSON.parse(JsonFilter);
  if(JsonFilter){
    var SearchF   = ArrayF[0];
    var JenisF    = ArrayF[1];
  } else {
    var SearchF   = "";
    var JenisF    = "sw";
  }

  if (SearchF) {
    $("#fcari_bp").val(SearchF);
    var SearchFStart = SearchF;
  } else {
    var SearchFStart = "";
  }

  
  // console.log(JenisFStart);

  var FiterArry = [SearchFStart];
  var JsonFilter = JSON.stringify(FiterArry);
  setCookie("FilterROMVideoTimeline", JsonFilter, 5);

  var DTables = $("#TableList").DataTable({
    dom:
      "<'ui stackable grid'" +
      "<'row'" +
      "<'left aligned sixteen wide column'>" +
      ">" +
      "<'row dt-table'" +
      "<'sixteen wide column'tr>" +
      ">" +
      "<'row'" +
      "<'left aligned seven wide column'B>" +
      "<'left aligned two wide column'i>" +
      "<'right aligned seven wide column'p>" +
      ">" +
      ">",
    buttons: [
      {
        text: "10",
        action: function (e, dt, node, config) {
          $("#TableList").DataTable().page.len(10).draw();
        },
      },
      {
        text: "25",
        action: function (e, dt, node, config) {
          $("#TableList").DataTable().page.len(25).draw();
        },
      },
      {
        text: "50",
        action: function (e, dt, node, config) {
          $("#TableList").DataTable().page.len(50).draw();
        },
      },
      {
        text: "100",
        action: function (e, dt, node, config) {
          $("#TableList").DataTable().page.len(100).draw();
        },
      },
      {
        text: "1000",
        action: function (e, dt, node, config) {
          $("#TableList").DataTable().page.len(1000).draw();
        },
      },
    ],
    destroy     : true,
    stateSave   : true,
    processing  : true,
    deferRender : true,
    serverSide  : true,
    orderClasses: false,
    paging      : true,
    scrollY     : '60vh',
    pageLength  : 10,
    data        : [],
    language    : {
      sLengthMenu : "_MENU_",
      search      : "",
      searchPlaceholder: "Pencarian..",
      processing  : '<i class="circle notch loading icon huge"></i>',
      info        : "_START_ sampai _END_ dari _TOTAL_ total data",
      paginate    : {
        "first"   : "Awal",
        "last"    : "Akhir",
        "next"    : "Berikutnya",
        "previous": "Sebelumnya"
      },
      infoEmpty   : "Tidak ada data",
      select  : {
        rows  : ""
      }
    },
    order     : [[1, "desc"]],
    columns   : [
      { data  : 'no_romrelease' },
      { data  : 'event' },
      { data  : 'timestamp' },
      { data  : 'username' },
      { data: null,
        render: function (data) {
          if(DGrup === "ADMINISTRATOR"){
            return data['query'];
          } else {
            return ``;
          }
        },
      },
    ],

    createdRow: function (row, data, index) {
      $(row).find("td:eq(0)").css("background-color", "#f5fbff");
    },

    columnDefs: [
      { className : "collapsing", targets: [2] },
    ],

    ajax : {
      url     : `../RND_BackEnd/backend_softwarerelease/timeline/load/sw`,
      type    : "POST",
      headers : {
        user  : VUserName,
        token : VToken,
      },
      data    : {
        FSearch   : SearchFStart
      },

      error: function () {
        IsTimeOut(LogoutProtect);
      },
    },
  });
}

$(document).ready(function () {

  TableListFunc();

  //RESPON KETIKA INPUT PENCARIAN DI KETIK
  $("#fcari_bp").on("keyup", function () {
    var FilterCari = $("#fcari_bp").val();
    var FiterArry = [FilterCari];
    var JsonFilter = JSON.stringify(FiterArry);
    setCookie("FilterROMVideoTimeline", JsonFilter, 5);
    $("#TableList").DataTable().destroy();
    TableListFunc(FilterCari);
    $("#TableList").DataTable().page(0).draw();
  });



  //RESET FILTER
  $(".resetfilter").on("click", function () {
    $("#fcari_bp").val("");
    var FiterArry = [""];
    var JsonFilter = JSON.stringify(FiterArry);
    setCookie("FilterROMVideoTimeline", JsonFilter, 5);
    $("#TableList").DataTable().destroy();
    TableListFunc("");
    $("#TableList").DataTable().page(0).draw();
  });

  $('#userguidemkg').on('click', function() {
    window.location.href = "./?link=guidemkg";
  });
  
  $('#tabmkglist').on('click', function() {
    window.location.href = "./?link=mkgindex";
  });

  $('#tabAppSetting').on('click', function() { 
    window.location.href = "./?link=mkgappsetting";
  });

});