const fungsilogout = false;
$(".ui.dropdown").dropdown();
$(".menu .item").tab();

const NonceValue = "rdsystem2020";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocdocmgmt = decodeURIComponent(getCookie("restlocdocmgmt"));

projectTableView("");

// >>>> FUNGSI UNTUK AKTIFKAN TOMBOL TAB UPLOAD JIKA DI COOKIES MENGANDUNG LINK
//      HALAMAN UPLOAD

    var json_cookies = getCookie('linkupl');
    // JIKA DI COOKIES TERDAPAT DATA
    if(json_cookies){
        var hasiljson = json_cookies;
        var link_ck= json_cookies;
    
    }
    if(link_ck){
        
            $('#mechupload').removeClass("disabled");
            $("#mechupload").on("click", function(){
                //store data baris
                // var eid = $(this).attr("btnid");
                // let encryption = new Encryption();
                // var eidENC = encryption.encrypt(eid, NonceValue);
                // window.location.href = "./?link=dalamnegeridetail&i=" + eidENC;
                console.log("uplod")
                window.location.href = link_ck;
            });
        
        

    }
// 
// END OF TOMBOL TAB UPLOAD
// ============================================================================


// >>>> FUNGSI MENAMPILKAN DATA PROJECT (DATATABLES)
// 
        /** data yang tampil merupakan data dimana
         *  user login terlibat dengan project tersebut
         */

    function projectTableView(FSearch) {
        

        $('#projectTable').DataTable({

            dom: "<'ui stackable grid'" +
                "<'row'" +
                "<'left aligned ten wide column'>" +
                ">" +
                "<'row dt-table'" +
                "<'sixteen wide column'tr>" +
                ">" +
                "<'row'" +
                "<'left aligned eight wide column'B>" +
                "<'right aligned eight wide column'p>" +
                ">" +
                ">",

            buttons: 
            [
                {
                    text: '10',
                    action: function (e, dt, node, config) {
                        $('#projectTable').DataTable().page.len(10).draw();
                    }
                },
                {
                    text: '25',
                    action: function (e, dt, node, config) {
                        $('#projectTable').DataTable().page.len(25).draw();
                    }
                },
                {
                    text: '50',
                    action: function (e, dt, node, config) {
                        $('#projectTable').DataTable().page.len(50).draw();

                    }
                },
                {
                    text: '100',
                    action: function (e, dt, node, config) {
                        $('#projectTable').DataTable().page.len(100).draw();

                    }
                },
                {
                    text: '500',
                    action: function (e, dt, node, config) {
                        $('#projectTable').DataTable().page.len(500).draw();
                    }
                },
                {
                    text: '1000',
                    action: function (e, dt, node, config) {
                        $('#projectTable').DataTable().page.len(1000).draw();
                    }
                }
            ],


        destroy: true,
        stateSave: false,
        processing: true,
        deferRender: true,
        serverSide: true,
        orderClasses: false,
        pageLength: 10,
        data: [],

        language: {
            sLengthMenu: "_MENU_",
            search: "",
            searchPlaceholder: "Search..",
            processing: '<i class="circle notch loading icon huge"></i>',
            emptyTable: 'tidak ada data yang ditampilkan',
        },

        order: [[0, "desc"]],

        columns: [
            
            { data  : 'group_product' },
            { data  : 'sub_product' },
            { data  : 'category' },
            { data  : 'plant' },
            { data  : 'chassis'},
            
            { data  : 'cabinet' },
            { data  : null,
                render: function (data) {
                    var des="";
                    for(var k=1;k<=10;k++){
                        if(data['designer'+k] !==null && data['designer'+k] !==""){
                            des += data['designer'+k]+",<br>";
                        }
                    }
        
                    des = des.replace(/,\<br\>$/, "");
                    // console.log(des);
                    return des;
                    
                },

            },
            { data  : 'head_of' },
            { data  : 'status_project' },
            // { data  : 27 },
            
            // { data  : 28 },
            
            { data  : null,
                render: function(data,row){

                        //return `<i class="book icon editdata">`;

                        return `<span class='docicon' style='white-space: nowrap !important; word-spacing:5px !important;'><i class="ui edit outline icon iconcoloredit editheader" btnid="${data['id_register']}"></i>&nbsp;<i class="ui upload icon iconcoloredit uploadbtn" btnid="${data['id_register']}"></i>&nbsp;<i class="ui list ul icon iconcoloredit reportbtn" btnid="${data['id_register']}" reqby="${data['username']}" chassis="${data['chassis']}"></i></span>`;
                        //return '<i class="edit icon editdata" idedit="${data[0]}">
                }
                
            },
            
            
        ],

        


        
        ajax: {
            
            url     : `${restlocdocmgmt}table_view`,
            type    : 'POST',
            //PENTING!! error uncaught lenght
            headers: {
                user: vusrnm,
                token: vtoken,
            },
            // data search
            data    : {
            // FStatus : FStatus,
            FSearch : FSearch,
            user    : userName1,
            },
            
            error: function(){
                if(fungsilogout){
        
                    window.location.href="./_logout.php";
                }else{
                    console.log("error session")
                }
            },

        },

        

        
        //STYLING KOLOM

        columnDefs: [
            { className: "center aligned", targets: [0,1,2,3,4,5,6,7,8,9] },

            // { className: "right aligned", targets: [5] },

            // {className : "collapsing", targets: [1,2,5,11,12]},

            // { "orderable": false, "targets": 13 },
    ],

    // "columnDefs": [
    //     { "orderable": false, "targets": 10 }
    //   ],

        


        });
        

    }
//
// AKHIR DARI FUNGSI MENAMPILKAN DATA PROJECT DALAM BENTUK DATATABLES
// ===========================================================================


// >>>> FUNGSI EVENT KLIK TOMBOL
// 

    // TEKAN TOMBOL EDIT HEADER
    $('#projectTable').on('click','.editheader', function() {
        var idproject=$(this).attr('btnid');
        let encryption = new Encryption();
        var idENC = encryption.encrypt(idproject, NonceValue);
        // window.location.href = "./?link=pssitem&i=" + eidENC;
        window.location.href = "./?link=mechdocreg&i="+idENC;
    });

    // TEKAN TOMBOL UPLOAD
    $('#projectTable').on('click','.uploadbtn', function() {
        var idproject=$(this).attr('btnid');
        let encryption = new Encryption();
        var idENC = encryption.encrypt(idproject, NonceValue);
        let linkcookie="./?link=mechdocupl&i="+idENC;
        // window.location.href = "./?link=pssitem&i=" + eidENC;
        setCookie("linkupl",linkcookie,5);
        window.location.href = "./?link=mechdocupl&i="+idENC;
    });

    // TEKAN TOMBOL ICON REPORT
    
        $("#projectTable").on("click",".reportbtn", function(){
           
            let chassis=$(this).attr('chassis');
            let reqby=$(this).attr('reqby');
            console.log("uplod")
            window.location.href = "./?link=mechdocrep&req="+reqby+"&chs="+chassis+"";
        });
    
    // TEKAN TOMBOL TAMBAH PROJECT BARU
        $('#registerproject').on('click', function() {
            window.location.href = "./?link=mechdocreg";
        });

     
    // TEKAN TOMBOL TAB MENU
        $('#mechreg').on('click', function() {
            window.location.href = "./?link=mechdocreg";
        });
        $('#mechsearch').on('click', function() {
            window.location.href = "./?link=mechdocsearch";
        });
        $("#mechreport").on("click", function(){
            
            console.log("uplod")
            window.location.href = "./?link=mechdocrep";
        });
 
        $('.tabuserguide').on('click', function() {
          window.location.href = "./?link=guidemecdoc";
        });
        $('.tabsuratgolive').on('click', function() {
          window.location.href = "./?link=golivemecdoc";
        });
        $('.tabhasilmonitoring').on('click', function() {
          window.location.href = "./?link=monitormecdoc";
        });
        $('.tabversion').on('click', function() {
          window.location.href = "./?link=versionhistory&app=DMN";
        });

// 
// AKHIR DARI EVENT KLIK TOMBOL
// ====================================================================================


// >>>> FUNGSI FILTER SEARCH
// 
    $('#searchdocmgmt').keyup( function() {
        // var ptbsearch
        // $("#MFGsupp_in").val('');
        // $("#filtercari").val('');
        projectTableView($('#searchdocmgmt').val());
    } );
    
// 
// END OF FUNGSI FILTER
// ====================================================================================




  
