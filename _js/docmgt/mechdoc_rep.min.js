const NonceValue = "rdsystem2020";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocdocmgmt = decodeURIComponent(getCookie("restlocdocmgmt"));


const uniquemodal=[
  {"foldername":"DRAWING ID","modalname":'uploaddrawing',"history":true,"history_type":'default',"upl_datatype":"link"},
  {"foldername":"TECHNICAL DISCUSS","modalname":'uploadtech',"history":true,"history_type":'default',"upl_datatype":"link"},
  {"foldername":"CHECKING REPORT","modalname":'uploadcek',"history":false,"history_type":'custom',"upl_datatype":"none"},
  {"foldername":"DESIGN VALIDATION (DVL)","modalname":'uploaddvl',"history":false,"history_type":'multitype',"upl_datatype":"none"},
  {"foldername":"DESIGN VERIFICATION RECORD(DVR)","modalname":'uploaddvr',"history":false,"history_type":'multitype',"upl_datatype":"none"},
  {"foldername":"MPL","modalname":'uploadMPL',"history":false,"history_type":'custom',"upl_datatype":"none"}
  ];


  const runcustomfunc=[
    {"foldername":"MPL","function":viewdataexcel,"function_history":viewdataexcel}
  ]
  
  // console.log($('.ui.modal.historymodal_generalupload').modal('show'));

// ------- TOMBOL TAB
$(".ui.dropdown").dropdown();
$(".ui.modal").modal();
$('.ui.accordion').accordion();

$('#mechreg').on('click', function() {
    window.location.href = "./?link=mechdocreg";
});

$('#mechsearch').on('click', function() {
  window.location.href = "./?link=mechdocsearch";
});

$('#mechproject').on('click', function() {
    window.location.href = "./?link=mechdocmanagement";
});
 
$('.tabuserguide').on('click', function() {
  window.location.href = "./?link=guidemecdoc";
});
$('.tabsuratgolive').on('click', function() {
  window.location.href = "./?link=golivemecdoc";
});
$('.tabhasilmonitoring').on('click', function() {
  window.location.href = "./?link=monitormecdoc";
});
$('.tabversion').on('click', function() {
  window.location.href = "./?link=versionhistory&app=DMN";
});

$('#UploadButtonBack').on('click', function() {
  console.log("oet")
  $('.historymodal').modal('hide');
});
$('#DVLButtonBack').on('click', function() {
  $('.uploaddvl').modal('hide');
});


  // untuk modal khusus history

  $('.close_historyfolder').on('click', function() {
    let namamodal=$(this).attr('modalname');
    $('.historymodal_'+namamodal).modal('hide');
    // $('.uploaddvr').modal('hide');
  });


  // UNTUK AKTIFKAN TOMBOL TAB UPLOAD BILA PENGGUNA PERNAH MENGUNJUNGI MENU UPLOAD
  var json_cookies = getCookie('linkupl');

  if(json_cookies){
      var hasiljson = json_cookies;
    var link_ck= json_cookies;
    
  }
  
  if(link_ck){
      
          $('#mechupload').removeClass("disabled");
          $("#mechupload").on("click", function(){
              //store data baris
              // var eid = $(this).attr("btnid");
              // let encryption = new Encryption();
              // var eidENC = encryption.encrypt(eid, NonceValue);
              // window.location.href = "./?link=dalamnegeridetail&i=" + eidENC;
              console.log("uplod")
              window.location.href = link_ck;
          });
      
      
  
  }


if(filtered_link){
  // DIAKSES DARI TOMBOL REPORT (FILTER BERDASARKAN LINK)
  console.log(filter_reqby);
  console.log(filter_chs);
  $('#frequest').val(filter_reqby);
  $('#fchasis').dropdown('set selected', filter_chs);

      var setarr=["",filter_reqby,filter_chs];
      // var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
      var JsonFilter = JSON.stringify(setarr);
      setCookie("reportfilter",JsonFilter,5);

      console.log(JsonFilter);
      console.log(searchcookie);
      // $('#fgroupprod').dropdown('set selected', 'BG');
      tablelistreport("",filter_reqby,filter_chs);

}else{
  // JIKA BUKAN DIAKSES DARI TOMBOL REPORT 

  // ----------- COOKIE FILTER
      var json_cookies = getCookie('reportfilter');

      // projectTableView(valsearch,valgroup,valsubmodif,valplant,valchs,valstatus);
      // var setarr=[valsearch,valgroup,valsubmodif,valplant,valchs,valstatus];
      if(json_cookies){
          var hasiljson = JSON.parse(json_cookies);
          var cksearch=hasiljson[0];
          var ckrequest=hasiljson[1];
          var ckchs=hasiljson[2];
          
      }

      if(cksearch){

        $('#searchrep').val(cksearch);
        var searchcookie=cksearch;

      }else{

        var searchcookie="";

      }

      if(ckrequest){

        $('#frequest').val(ckrequest);
        var requestcookie=ckrequest;

      }else{

        var requestcookie="";

      }

      if(ckchs){

        $('#fchasis').dropdown('set selected', ckchs);
        var chasiscookie=ckchs;

      }else{

        $('#fchasis').dropdown('set selected', "ALL");
        var chasiscookie="ALL"
        
      }
      var setarr=[searchcookie,requestcookie,chasiscookie];
      // var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
      var JsonFilter = JSON.stringify(setarr);
      setCookie("reportfilter",JsonFilter,5);

      console.log(JsonFilter);
      console.log(searchcookie);
      // $('#fgroupprod').dropdown('set selected', 'BG');
      tablelistreport(searchcookie,requestcookie,chasiscookie);

}




// LIST namafolder
let listfolder=["DRAWING ID","DESIGN VALIDATION (DVL)","DESIGN VERIFICATION RECORD(DVR)","NOTULENSI MEETING","PRODUCT SPECIFICATION","DESIGN REVIEW","TECHNICAL DISCUSS","OTHERS (DESIGN INPUT)","CHECKING REPORT","COSTING","DRAWING","FMEA","MASTER PLASTIC PART","MPL","SUMARIZED REPORT","TIME SCHEDULE","OTHERS (DESIGN OUTPUT)"]

let testfolder=["DRAWING ID","DESIGN VALIDATION (DVL)","TECHNICAL DISCUSS"];








$(".filebtn").on("click", function(){
    //store data baris
    // var eid = $(this).attr("btnid");
    console.log($(this).closest('table').attr('id'));
    var loc=$(this).closest('table').attr('id');
    var namafolder=$(this).text();
    if(namafolder=="Design Validation (DVL)"){

      $('.uploaddvl').modal('show');
          if(loc=="table_input"){
            $('.historyhead').removeClass('th_designoutput');
            $('.historyhead').addClass('th_designinput');
        }else{
            $('.historyhead').addClass('th_designoutput');
            $('.historyhead').removeClass('th_designinput');
        }

    }else{

    
    $('.historymodal').modal('show');
    if(loc=="table_input"){
        $('.historyhead').removeClass('th_designoutput');
        $('.historyhead').addClass('th_designinput');
    }else{
        $('.historyhead').addClass('th_designoutput');
        $('.historyhead').removeClass('th_designinput');
    }
    $('#titletxt').text($(this).text());
    if(namafolder=="Product Spec"){
        $('#tablehistory').find('tbody').empty();
        $('#tablehistory').find('tbody').append(`
        <tr>
        <td style="text-align:center;">
          10-07-2021
        </td>
        <td class="file filespec">
        File_ProdSpec_PLD32D123
        </td>
        <td style="text-align:center;">
          R0
        </td>
      </tr>
      <tr>
        <td style="text-align:center;">
          19-07-2021
        </td>
        <td class="file filespec">
        File_ProdSpec_PLD32D123
        </td>
        <td style="text-align:center;">
          R1
        </td>
      </tr>
        `);
    }else{
      $('#tablehistory').find('tbody').empty();
    $('#tablehistory').find('tbody').append(`
      <tr>
          <td colspan="3" style="text-align:center;">
          belum ada dokumen yang diupload
          </td>
          
      </tr>
    `);
  }
  }
    // let encryption = new Encryption();
    // var eidENC = encryption.encrypt(eid, NonceValue);
    // window.location.href = "./?link=dalamnegeridetail&i=" + eidENC;
    // console.log("uplod")
    // window.location.href = "./?link=mechdocrep";
});


// $('.filespec').on('click', function() {

//   window.open("./_js/docmgt/TEST-FILE.pdf");
// })

// $(document).on('click', '.filespec', function(){
//   window.open("./_js/docmgt/TEST-FILE.pdf");
// });



// tablelistreport(FSearch,FRequest,FChassis);
 // PTB -  TAMPIL TABEL PTB
 function tablelistreport(FSearch,FRequest,FChassis){

  // desplace=$("#Iddes").val();


  var tablerender=$("#reportTable").DataTable({
      dom:
        "<'ui stackable grid'" +
        "<'row'" +
        "<'left aligned sixteen wide column'>" +
        ">" +
        "<'row dt-table'" +
        "<'sixteen wide column'tr>" +
        ">" +
        "<'row'" +
        "<'left aligned eight wide column'B>" +
        "<'right aligned eight wide column'p>" +
        ">" +
        ">",

        rowGroup: {
          enable: false
      },

        buttons:
        [
            {
                text: '10',
                action: function (e, dt, node, config) {
                    $('#reportTable').DataTable().page.len(10).draw();
                }
            },
            {
                text: '25',
                action: function (e, dt, node, config) {
                    $('#reportTable').DataTable().page.len(25).draw();
                }
            },
            {
                text: '50',
                action: function (e, dt, node, config) {
                    $('#reportTable').DataTable().page.len(50).draw();

                }
            },
            {
                text: '100',
                action: function (e, dt, node, config) {
                    $('#reportTable').DataTable().page.len(100).draw();

                }
            },
            {
                text: '500',
                action: function (e, dt, node, config) {
                    $('#reportTable').DataTable().page.len(500).draw();
                }
            },
            {
                text: '1000',
                action: function (e, dt, node, config) {
                    $('#reportTable').DataTable().page.len(1000).draw();
                }
            }
        ],
    
      destroy: true,
      stateSave: false,
      processing: true,
      deferRender: true,
      serverSide: true,
      orderClasses: false,
      pageLength: 10,
      data: [],
      
      language: {
        sLengthMenu: "_MENU_",
        search: "",
        searchPlaceholder: "Search..",
        processing: '<i class="circle notch loading icon huge"></i>',
      },
      // ajax: "./1_documentmanagement/mechanicdesign/report.txt",
      columns: [
        { "data": "chassis" },
        { "data": "cabinet" },
        { data  : null,
          render: function (data) {
              
              let str=`
             <i class="info circle large icon iconcoloredit typemodal" idreg="`+data['id_register']+`"></i>
              `
              
              // console.log(des);
              return str;
              
          },
        
        },
        { "data": "category" },
        { "data": "request_by" },
        { data  : null,
          render: function (data) {
              var des="";
              for(var k=1;k<=10;k++){
                  if(data['designer'+k] !==null && data['designer'+k] !==""){
                      des += data['designer'+k]+",<br>";
                    }
              }
  
              des = des.replace(/,\<br\>$/, "");
              // console.log(des);
              return des;
              
          },
  
        },
        { "data": null,
          render: function (data) {
              let foldername="DRAWING ID";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },

        { "data": null,
          render: function (data) {
              let foldername="DESIGN VALIDATION (DVL)";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },

        { "data": null,
          render: function (data) {
              let foldername="DESIGN VERIFICATION RECORD(DVR)";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="NOTULENSI MEETING";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="PRODUCT SPECIFICATION";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
              // return handler_statusfolder(foldername,wajibarr,uploadedarr);
                

                
          },
        },

        { "data": null,
          render: function (data) {
              let foldername="DESIGN REVIEW";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="TECHNICAL DISCUSS";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="OTHERS (DESIGN INPUT)";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="CHECKING REPORT";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['chassis']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="COSTING";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="DRAWING";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="FMEA";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="MASTER PLASTIC PART";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="MPL";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="SUMARIZED REPORT";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="TIME SCHEDULE";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        
        { "data": null,
          render: function (data) {
              let foldername="OTHERS (DESIGN OUTPUT)";
              
              let wajibarr=data['kewajiban'];
              let uploadedarr=data['nama_folder'];
              return handler_statusfolder(foldername,wajibarr,uploadedarr,data['id_register']);
                

                
          },
        },
        // { "data": null },
        // { "data": "type_mfg_demand" },
        // { "data": "lot_inventory" },
        // { "data": "type_barang_demand" },


       
        // { "data": "chassis" },
        // { "data": "salary" }
        
      ],

      'rowCallback': function(row, data, index){
        // console.log(row)
        let banyakfolder=listfolder.length;
        // offset lokasi tiap folder pada tabel
        let folderloc_offset=6;
        let listnonwajib;
        let listuploaded;
        if(data['kewajiban']==null){
          listnonwajib=[]
        }else{
          listnonwajib= data['kewajiban'].map(v=>listfolder.indexOf(v))
        }

        
        if(data['nama_folder']==null){
          listuploaded=[]
        }else{
          listuploaded= data['nama_folder'].map(v=>listfolder.indexOf(v))
        }



        // if(data['nama_folder']==null){
        //   // BELUM ADA FILE TERUPLOAD
        //       if(data['kewajiban']!=null){
        //           let nonwajibfolder= data['kewajiban'].map(v=>listfolder.indexOf(v))
        //         // ADA YANG TIDAK WAJIB
        //         // TIDAK WAJIB UPLOAD --> color: GRAY
        //         for(var z=0;z<banyakfolder;z++){

        //           let ceknonwajib=jQuery.inArray(z, nonwajibfolder);

        //           if(ceknonwajib!==-1){
        //             let indexlocation=folderloc_offset+z;
        //             $(row).find('td:eq('+indexlocation+')').addClass('nonwajib emptycolor');
        //           }

        //         }

        //       }
          
        //     // WAJIB UPLOAD --> color: RED
          

        // }else{

          // ADA FILE TERUPLOAD --> color: GREEN
            // MENCARI LOKASI FOLDER YANG SUDAH DIUPLOAD

            for(var z=0;z<banyakfolder;z++){
              let isuploaded=jQuery.inArray(z, listuploaded);
              let indexlocation=folderloc_offset+z;
              // console.log(indexlocation);
              if(isuploaded !==-1 || indexlocation === 14){
                // ADA FILE DIUPLOAD
                
                $(row).find('td:eq('+indexlocation+')').find('label').addClass('uploadedcolor selectable');
              }else{

                let isnotwajib=jQuery.inArray(z, listnonwajib);
                if(isnotwajib !==-1){
                  // file tidak wajib || tidak ada upload --> color: grey
                  
                  $(row).find('td:eq('+indexlocation+')').find('label').addClass('nonwajib emptycolor selectable');
                }else{
                  // file wajib || tidak ada upload --> color:red

                  $(row).find('td:eq('+indexlocation+')').find('label').addClass('wajib emptycolor selectable');


                }
              }

            }

            

        // }

        // if(data['nama_folder']== null){
        //     $(row).find('td:eq(3)').css('background-color', 'red');
        // }else{
          
        // }
        // if(data[2].toUpperCase() == 'EE'){
        //     $(row).find('td:eq(2)').css('color', 'blue');
        // }
      },

          columnDefs: [
        { className: "center aligned", targets: [0,1,2,3,4] },
        { className: "nopadding", targets: [6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22] },
        { 'width': "9ex", targets: [6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22] },
        ],

// "columnDefs": [
//     { "orderable": false, "targets": 10 }
//   ],


      
      ajax: {
        url: `${restlocdocmgmt}table_viewreport`,
        type: "POST",
        headers: {
          user: vusrnm,
          token: vtoken,
        },
        data: {
          FSearch:FSearch,
          FRequest:FRequest,
          FChassis:FChassis
        },
        error: function () {
          if (fungsilogout){
            window.location.href = "./?link=loclogout";
          } else {
            Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
          }
        },
      },
    });


    // var table2 = $('#reportTable').DataTable();

    tablerender.on( 'draw', function () {
      $('.infolabel.no_upload').popup({
        position: 'left center',
        inline : false,
        on:'click',
        hoverable:true,
        // hideOnScroll:true,
      })
      // $('.infolabel').popup('bind close on scroll');
    });
    

// $('#MFGsupp_in').keyup( function() {
// // var ptbsearch
// // $("#MFGsupp_in").val('');
// $("#MFGdem_in").val('');
// $("#lotinv_in").val('');
// $("#barangdem_in").val('');
// $("#reff_in").val('');
// console.log(this.value);
// // table.search(""+$('#searchPTB').val()+"").draw();
// table2.search( this.value ).draw();
// // tablePTB.search($('#searchPTB').val()).draw();
// } );

  // $("#designerList").css('cursor', 'pointer');
}

$('#searchrep').keyup( function() {
  var valsearch=$('#searchrep').val();
  var requestor=$('#frequest').val();
  var valchs=$('#fchasis').val();

  var setarr=[valsearch,requestor,valchs];
  // var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
  var JsonFilter = JSON.stringify(setarr);
  setCookie("reportfilter",JsonFilter,5);

  tablelistreport(valsearch,requestor,valchs)
} );

$('#frequest').keyup( function() {
  
  var valsearch=$('#searchrep').val();
  var requestor=$('#frequest').val();
  var valchs=$('#fchasis').val();

  var setarr=[valsearch,requestor,valchs];
  // var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
  var JsonFilter = JSON.stringify(setarr);
  setCookie("reportfilter",JsonFilter,5);

  tablelistreport(valsearch,requestor,valchs)

  });

$("#fchasis").on("change", function(){

  var valsearch=$('#searchrep').val();
  var requestor=$('#frequest').val();
  var valchs=$('#fchasis').val();

  var setarr=[valsearch,requestor,valchs];
  // var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
  var JsonFilter = JSON.stringify(setarr);
  setCookie("reportfilter",JsonFilter,5);

  tablelistreport(valsearch,requestor,valchs)
});

$("#resetfilter").on("click", function(){

  $('#searchrep').val("");
  $('#frequest').val("");
  $('#fchasis').dropdown('set selected','ALL');

  var setarr=["","","ALL"];
  // var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
  var JsonFilter = JSON.stringify(setarr);
  setCookie("reportfilter",JsonFilter,5);

  tablelistreport("","","ALL")
});

function handler_statusfolder(foldername,wajibarr,uploadedarr,idreg){

  
  let wajib=`wajib upload`;
  let uploaded_class="no_upload";
  let uploaded=`belum ada file terupload`;
  let warningstr=`<i class="exclamation triangle large icon iconfile"></i>`;
  if(wajibarr!=null){
    
    let cekwajib=jQuery.inArray( foldername, wajibarr);

    if(cekwajib!==-1){
      // jika file tidak wajib diupload
      wajib=`tidak wajib upload`;
      warningstr="";
    }

  }
  if(foldername === "CHECKING REPORT"){
    uploaded=`ada file terupload`;
    uploaded_class='uploaded';
    warningstr=`<i class="check large icon iconfile"></i>`;
  }

  if(uploadedarr!=null){
    
    let cekuploaded=jQuery.inArray( foldername, uploadedarr);

    if(cekuploaded!==-1){
      uploaded=`ada file terupload`;
      uploaded_class='uploaded';
      warningstr=`<i class="check large icon iconfile"></i>`;
    }
    // console.log(warningstr+foldername)
  }

  let stringlabel=`<label class="infolabel `+uploaded_class+`" data-content="`+wajib +`, `+uploaded+`" foldername='`+foldername+`' idreg='`+idreg+`'>`+warningstr+`</label>`;
  // console.log(stringlabel);
  
  return stringlabel;

}


function handler_warnatd(foldername,wajibarr,uploadedarr){

  let wajib=`<span class='wajibcolor'>wajib</span>`;
  let uploaded=`<i class="close icon iconcolorcross"></i>`

  if(wajibarr!=null){
    
    let cekwajib=jQuery.inArray( foldername, wajibarr);

    if(cekwajib!==-1){
      wajib=`<span class='nowajibcolor'>non-wajib</span>`;

    }

  }

  if(uploadedarr!=null){
    
    let cekuploaded=jQuery.inArray( foldername, uploadedarr);

    if(cekuploaded!==-1){
      uploaded=`<i class="check icon iconcolorcheck"></i>`

    }

  }

  return uploaded+", "+wajib;

}


// >>>> FUNGSI MEMBUKA HISTORY FOLDER 
$(document).on("click",".uploaded", function(){
  
  
  
  var namafolder=$(this).attr('foldername');
  var idreg=$(this).attr('idreg');
  let encryption = new Encryption();
  var eidENC = encryption.encrypt(idreg, NonceValue);
  if(namafolder === "CHECKING REPORT"){
    // window.location.href = "http://10.8.15.42/RND/?link=ihp&chs=" + idreg;
    window.open("http://10.8.15.42/RND/?link=ihp&chs=" + eidENC, '_blank');
  }else{
    
  handler_openfolder_history(namafolder,idreg);
  
  }

  // $('.historymodal').modal('show');

  
  
});


// >>>> FUNGSI MEMBUKA MODAL LIST TYPE
$(document).on("click",".typemodal", function(){
  
  
  
  // var namafolder=$(this).attr('foldername');
  var idreg=$(this).attr('idreg');
  $('.historymodal_modal_type').modal({

    // centered: false,
    className:{
      active:'centering',
    }
  }).modal('show');
  view_listtype(idreg);
  
  
  
  
});


// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 5 MENAMPILKAN LIST TYPE

function view_listtype(idreg){
  // console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}view_listtype`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            idregister : idreg,
            
            
        },
            success: function (response){
        var obj = JSON.parse(response);
        // console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        // tableType();

        $('.listtype_tb').find('tbody').html('<td colspan="13" style="text-align:center;">project ini belum ada type</td>');

        
        } else {
          const list_types=obj.data;

          let str_data="";
          for(var data_type in list_types){

            let msprojects=list_types[data_type]['MSPROJECT_LIST'].split(";");
            // console.log(msprojects);

            let str_owner='<ol class="ui list">';
            let str_prjid='<ol class="ui list">';
            let str_target='<ol class="ui list">';

            for(var list_projects in msprojects){
              
                let projects = msprojects[list_projects].split("||");
                // console.log(projects);
                let owner=projects[0]==""? '-' : projects[0];
                let prjid=projects[1]==""? '-' : projects[1];
                let tgl_target=projects[2]==""? '-' : projects[2];
                let idtype=projects[3]==""? '-' : projects[3];

                str_owner+='<li value="*">'+owner+'</li>';
                str_prjid+='<li value="*">'+prjid+'</li>';
                str_target+='<li value="*">'+tgl_target+'</li>';
            }

            str_owner+='</ol>';
            str_prjid+='</ol>';
            str_target+='</ol>';


            str_data+=`
              <tr>
                <td>`+list_types[data_type]['type_mfg_supply']+`</td>
                <td>`+list_types[data_type]['type_mfg_demand']+`</td>
                <td>`+list_types[data_type]['lot_inventory']+`</td>
                <td>`+list_types[data_type]['type_barang_demand']+`</td>
                <td>`+list_types[data_type]['type_ref']+`</td>
                <td>`+list_types[data_type]['masspro_plan']+`</td>
                <td>`+list_types[data_type]['masspro_actual']+`</td>
                <td>`+list_types[data_type]['cost_plan']+`</td>
                <td>`+list_types[data_type]['cost_actual']+`</td>
                <td>`+str_owner+`</td>
                <td>`+str_prjid+`</td>
                <td>`+str_target+`</td>
                <td><div class="wrapbox2">`+list_types[data_type]['keterangan']+`</div></td>

              </tr>
            `
          }

          $('.listtype_tb').find('tbody').html(str_data);
          
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}


// >>>> FUNGSI UNTUK MEMBUKA MODAL UPLOAD DI SETIAP FOLDER
    /** Pengaturan dilihat dari array uniquemodal */

    function handler_openfolder_history(namafolder,idDEC){
      let upper_namafolder=namafolder.toUpperCase();
      let isunique = uniquemodal.some(o => o.foldername === upper_namafolder);
      let isrunfunction= runcustomfunc.some(o => o.foldername === upper_namafolder && o.function_history!=='none');

      if(isrunfunction){
        console.log('run function')
        let runfunction=runcustomfunc.find(o => o.foldername === upper_namafolder);
        runfunction['function_history'](idDEC);
      }
    
      if(isunique){
            // JIKA MODAL BUKAN MODAL GENERAL (FOLDER MEMILIKI MODAL SENDIRI)
            // folderupload_type='unique';
            let folderinfo = uniquemodal.find(o => o.foldername === upper_namafolder);
            let isviewhistory=folderinfo['history'];
            let history_type=folderinfo['history_type'];
            let modalname = folderinfo['modalname'];
            // let jenisdata = folderinfo['upl_datatype'];
            let class_infokewajiban = "infohistory_"+modalname;
            // console.log(modalname);
    
            // viewketerangan_upload(namafolder,class_infokewajiban);
    
            if(isviewhistory){
              // jika folder menampilkan history default
              if(history_type=="default"){

                tampilhistoryfolder(namafolder,idDEC,'ALL','generalupload');
                $('.historymodal_generalupload').modal('show');

              }else if(history_type=="multitype"){
                view_typeaccordion(idDEC,upper_namafolder);
                $('.historymodal_'+modalname).modal('show');

              }else if(history_type=="custom"){
                $('.historymodal_'+modalname).modal('show');
              }
              
    
            }else{

              if(history_type=="multitype"){
                view_typeaccordion(idDEC,upper_namafolder);
                $('.historymodal_'+modalname).modal('show');

              }else if(history_type=="custom"){
                $('.historymodal_'+modalname).modal('show');
              }
    
            }
    
            // MENGGANTI JUDUL MODAL SESUAI DENGAN NAMA FOLDER YANG BERKAITAN
            $('#titlehistory_'+modalname).empty().append(namafolder);
    
            
      }else{
            // folderupload_type='general';
            console.log('generalmodal')
            // MENGGANTI JUDUL MODAL SESUAI DENGAN NAMA FOLDER YANG BERKAITAN
            $('#titlehistory_generalupload').empty().append(namafolder);

            // FUNGSI UNTUK MEMBUKA MODAL GENERAL
            $('.ui.modal.historymodal_generalupload').modal('show');
            tampilhistoryfolder(namafolder,idDEC,'ALL','generalupload');
 
            // let class_infokewajiban = "infohistory_generalupload";
            // viewketerangan_upload(namafolder,class_infokewajiban);
    
      }
    
      // console.log(isunique);
    }




// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 5 TAMPIL DATA KETERANGAN PER FOLDER

function tampilhistoryfolder(namafolder,idproject,typebtn,namamodal){
  console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_viewuploadheader`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register : idproject,
            namafolder : namafolder,
            typesupply : typebtn,
            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        // tableType();

        console.log(obj.message);
        let strselector="";
        if(typebtn=="ALL"){
          strselector=".historyfolder_"+namamodal;
        }else{
          strselector=".historyfolder_"+namamodal+"."+typebtn+"idtype";
        }
        $(strselector).find('tbody').empty();

        $(strselector).find('tbody').append(`
            <tr>
                <td colspan='3' style="text-align:center;">
                tidak ada link/file tersimpan
                </td>

                
                
            </tr>
          `);
          console.log("[kosong]class selector->"+strselector);
        // Swal.fire({
        //   title: obj.message,
        //   text: "",
        //   icon: 'error',
        //   showCancelButton: false,
        //   confirmButtonText: 'Ya',
        //   });

        
        } else {

          // SELECTOR TABEL HISTORY
          // KALAU MULTITYPE, TIAP HISTORY TABLE MEMILIKI KELAS SPESIFIK SESUAI TIPE
          let strselector="";
          if(typebtn=="ALL"){
            strselector=".historyfolder_"+namamodal;
          }else{
            strselector=".historyfolder_"+namamodal+"."+typebtn+"idtype";
          }
          console.log("class selector->"+strselector);

          $(strselector).find('tbody').empty();
          var banyakhistory=obj['data'].length;

          for(var a=0;a<banyakhistory;a++){
            
            let islastfile=false;
            let islink=false;
            let string_data_history="";
            var jenisdata = obj['data'][a]['jenis'];
            console.log(jenisdata);
            var strpath="";

            if(jenisdata=="LINK"){
              strpath=obj['data'][a]['file'];
              var namafile= obj['data'][a]['file'];
              islink=true;

            }else if(jenisdata=="FILE"){
              strpath=`../RND_Upload/`+obj['data'][a]['file'];
              // var namafile= obj[a]['file'].substring(obj[a]['file'].lastIndexOf('/') + 1);
              var namafile=obj['data'][a]['file_ori'];
              islink=true;
            }else if(jenisdata=="FOLDER_SHARING"){
              
              islink=false;
              var namafile=obj['data'][a]['file_ori'];
            }
            console.log(strpath);


            if(islink){

              string_data_history=`
                <a href="`+strpath+`" target='linktabhandler'>`+namafile+`</a>
              `

            }else{

              string_data_history=`
                <span class='text_history iconcoloredit copyalamat' alamat="`+namafile+`">`+namafile+`&nbsp; </span>
              `

            }


          $(strselector).find('tbody').append(`
            <tr>
                <td style="text-align:center;">
                `+obj['data'][a]['created_date']+`
                </td>

                <td style="text-align:center;" class="cuttext">
                `+string_data_history+`
                </td>

                <td style="text-align:center;" width='10%'>
                `+obj['data'][a]['revisi']+`
                </td>
                
                
                
            </tr>
          `);
          
          }
          
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}

function tampilDQA(namafolder,idproject,typebtn,namamodal,namatype){

  let strselector=".historyfolder_uploaddvr."+typebtn+"idtype";
  let trimmed_type = namatype.replace(/PS-/g, "");
  console.log(trimmed_type)

  // historyfolder_uploaddvr `+obj['data'][i]['id_infotype']+`idtype

  $(strselector).find('tbody').empty().append(`
    <tr>
        <td colspan='3' style="text-align:center;">
        <a href="http://10.8.50.13/?link=svronline&id=`+trimmed_type+`" target="_blank">http://10.8.50.13/?link=svronline&id=`+trimmed_type+`</a>
        </td>

        
        
    </tr>
  `);


}


// >>>> FUNGSI MENAMPILKAN DATA EXCEL YANG TELAH DI IMPORT


function viewdataexcel(idDEC) {
  // console.log(FYear+"<---- tahun dalam func");
  // console.log(restlocdocmgmt);
  
  // var d1 = enc.decrypt(EncR, NonceValue);
  // var d2 = enc.decrypt(erl, NonceValue);

  $('#MPLtable').DataTable({

      dom: "<'ui stackable grid'" +
          "<'row'" +
          "<'left aligned ten wide column'>" +
          ">" +
          "<'row dt-table'" +
          "<'sixteen wide column'tr>" +
          ">" +
          "<'row'" +
          "<'left aligned eight wide column'B>" +
          "<'right aligned eight wide column'p>" +
          ">" +
          ">",

          "scrollY":        "500px",
          "scrollCollapse": true,

      buttons: 
      [
          {
              text: '10',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(10).draw();
              }
          },
          {
              text: '25',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(25).draw();
              }
          },
          {
              text: '50',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(50).draw();

              }
          },
          {
              text: '100',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(100).draw();

              }
          },
          {
              text: '500',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(500).draw();
              }
          },
          {
              text: '1000',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(1000).draw();
              }
          }
      ],


  destroy: true,
  stateSave: false,
  processing: true,
  deferRender: true,
  serverSide: true,
  orderClasses: false,
  pageLength: 10,
  data: [],

  language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Search..",
      processing: '<i class="circle notch loading icon huge"></i>',
      emptyTable: 'tidak ada data yang ditampilkan',
  },

  order: [[0, "desc"]],

  columns: [
      
      { data  : 'drawing_loc' },
      { data  : 'dn' },
      { data  : 'description' },
      { data  : 'vendor' },
      // { data  : 5},
      
      // { data  : 7 },
      { data  : 'designer'},
      
      
      
  ],

  


  
  ajax: {
      
      url     : `${restlocdocmgmt}table_viewexcel`,
      type    : 'POST',
      //PENTING!! error uncaught lenght
      headers: {
          user: vusrnm,
          token: vtoken,
      },
      // data search
      data    : {
      // FStatus : FStatus,
      idregister:idDEC,
      // FSearch : FSearch,
      // FYear   : FYear,
      // FRole   : FRole,
      // FPlant  : FPlant,
      user    : userName1,
      },
      
      error: function(){
          if(fungsilogout){
  
              window.location.href="./_logout.php";
          }else{
              console.log("error session")
          }
      },

  },

  

  
  //STYLING KOLOM

    columnDefs: [
        { className: "center aligned", targets: [0,1,2,3,4] },

        // { className: "right aligned", targets: [5] },

        // {className : "collapsing", targets: [1,2,5,11,12]},

        // { "orderable": false, "targets": 13 },
],

// "columnDefs": [
//     { "orderable": false, "targets": 10 }
//   ],

  


  });
  

}




// --------------------- KUMPULAN AJAX -------------------
// ----- FUNGSI UNTUK MENAMPILKAN DATA TYPE DIDALAM MODAL HISTORY

function view_typeaccordion(idregister,foldername){
  console.log("masuk")

  if(foldername=="DESIGN VERIFICATION RECORD(DVR)"){

    $('.dvraccordion_history_folder').empty();

  }else if(foldername=="DESIGN VALIDATION (DVL)"){
    $('.dvlaccordion_history_folder').empty();

  }

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}view_multitype`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register : idregister,
            
            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        

        
        } else {

          let banyakdata= obj['data'].length;
          let string_accordion="";
          
          if(foldername=="DESIGN VERIFICATION RECORD(DVR)"){
              for(var i=0;i<banyakdata;i++){

                string_accordion+=`
                <div class="dvracc title" typetitle='`+obj['data'][i]['type_mfg_supply']+`' idtype='`+obj['data'][i]['id_infotype']+`' idreg='`+idregister+`' modalname='uploaddvr' foldername='`+foldername+`'>

                  <i class="dropdown icon"></i>
                    `+obj['data'][i]['type_mfg_supply']+`
                </div>

                <div class="content">

                  <table width="100%" style="border:1px solid black;border-radius:5px;" class="tabletypeDVL">

                    <tr>
                      <td style="text-align:center;" colspan="3" class="typecontainer">
                        <b>`+obj['data'][i]['type_mfg_supply']+`<b>
                      </td>
                    </tr>

                    <tr>
                      <td>


                      <table border="0" width="100%">
                        <tr>
                          <td valign="top">

                          </td>
                        </tr>

                        <tr>
                          <td valign="top">

                            <table class="" width="100%">
                              <tbody>
                              
                                <tr>

                                  <td>
                                    <table class="ui small compact striped table single line tb_designoutput historyfolder_uploaddvr `+obj['data'][i]['id_infotype']+`idtype" id="">
                                      <thead class="historyhead">

                                        <th colspan='4'>LINK DVR</th>
                                      
                                      </thead>

                                      <tbody>

                                        <tr>
                                          <td colspan='4' style="text-align:center;">
                                            belum ada link
                                          </td>
                                        </tr>

                                      </tbody>
                                      

                                    </table>
                                  </td>
                                </tr>

                            
                              </tbody>
                            </table>

                            

                          </td>
                          
                        </tr>
                    
                    </table>

                    </td>
                    </tr>
                </table>
                  </div>
              `
              }

              $('.dvraccordion_history_folder').append(string_accordion);
              $('.ui.accordion').accordion();
              

          }else{

              let arrjenis=obj['arrjenis'];

              for(var i=0;i<banyakdata;i++){

                let str_jenis=``

                if(arrjenis!==false){

                  for(var a in arrjenis){

                    str_jenis+=`
                    <tr>
                        <td colspan="3" style='padding-top:15px;'>
                        <h4 class="ui horizontal divider">
                        <span class="redheader"><i class='upload icon'></i></span>  KPI `+arrjenis[a]+`
                        </h4>
                        </td>
                      </tr>

                      <tr style="vertical-align:top;" class="trcontentDVL">

                        <!-- KOLOM PERTAMA -->
                          <td width="33%" class='td_penilaian_folder tdfolder-0-`+obj['data'][i]['id_infotype']+`-`+arrjenis[a]+`'>
                            

                            
                          </td>

                          <!-- KOLOM KEDUA -->
                          <td width="33%" class=' td_penilaian_folder tdfolder-1-`+obj['data'][i]['id_infotype']+`-`+arrjenis[a]+`'>
                          


                          </td>

                          <!-- KOLOM KETIGA -->
                          <td width="33%" class=" td_penilaian_folder tdfolder-2-`+obj['data'][i]['id_infotype']+`-`+arrjenis[a]+` td1">

                            
                          </td>

                      </tr>
                    `;

                  }

                  

                }else{

                  str_jenis+=`
                    <tr>
                      <td colspan="3" >
                        data kategori dan sub kategori penilaian tidak ditemukan
                      </td>
                    </tr>
                  `;

                }

                string_accordion+=`
                <div class="dvlacc title" typetitle='`+obj['data'][i]['type_mfg_supply']+`' idtype='`+obj['data'][i]['id_infotype']+`' idreg='`+idregister+`' modalname='uploaddvr' foldername='`+foldername+`'>
                  <i class="dropdown icon"></i>
                  `+obj['data'][i]['type_mfg_supply']+`
                </div>

              <!-- KONTEN DIDALAM ACCORDION -->
                <div class="content kontendvl">
                  <table border="0" width="100%">
                    
                      <tr>
                        <td colspan="3" class="dvlcontainer">
                            <table width="100%" style="border:1px solid black;border-radius:5px; padding:5px;" class="tabletypeDVL">
                              <tr>
                                <td style="text-align:center;font-size:12pt" colspan="3" class="typecontainer">
                                  <b>
                                  `+obj['data'][i]['type_mfg_supply']+`
                                  <b>
                                </td>
                              </tr>
                              <tr>
                                <td colspan="3">
                                
                                </td>
                                
                              </tr>

                              <tr>
                                <td colspan="3">
                                <table class="" width="100%">
                                  <tbody>
                                  <!-- <tr><td>Title Documents : <div class="ui input fluid small">
                                    <input type="text" id="uploaddescdoc" class="mandatoryclass">
                                    
                                  </div></td></tr> -->
                                  <tr>

                                    <td>
                                      <table class="ui small compact striped table single line tb_designoutput"  width="100%">
                                        <thead class="historyhead" >

                                        
                                        <th width="">LINK SERVER QA</th>
                                        <!-- <th>Nama File</th> -->
                                        
                                        <!-- <th></th> -->
                                        
                                        </thead>

                                        <tbody>
                                          <tr>
                                            
                                            <td style="text-align:center;">
                                              <a href='https://apps.polytron.local/dvl_evalview.php?type_supply=`+obj['data'][i]['type_mfg_supply']+`' target="_blank">https://apps.polytron.local/dvl_evalview.php?type_supply=`+obj['data'][i]['type_mfg_supply']+`</a>
                                            </td>
                                            
                                          
                                          </tr>
                                        </tbody>
                                        

                                      </table>
                                    </td>
                                  </tr>

                                
                                  
                                  </tbody>
                                </table>
                                </td>
                              </tr>

                              <tr>
                                <td valign="top" colspan="3"><b><span class="redheader"><i class='upload icon'></i></span> <span id="" style="text-transform:uppercase;">PENILAIAN</span></b></td>
                              </tr>
                              
                              
                              <tr style="vertical-align:top;" class="trcontentDVL">

                              <!-- KOLOM PERTAMA -->
                                <td width="33%" class='tdfolder-0-`+obj['data'][i]['id_infotype']+`'>
                                  

                                  
                                </td>

                                <!-- KOLOM KEDUA -->
                                <td width="33%" class='tdfolder-1-`+obj['data'][i]['id_infotype']+`'>
                                


                                </td>

                                <!-- KOLOM KETIGA -->
                                <td width="33%" class="tdfolder-2-`+obj['data'][i]['id_infotype']+` td1">

                                  
                                </td>

                              </tr>

                              `+str_jenis+`
                              
                              <tr>
                                <td width="33%">
                                  
                                </td>
                              </tr>
                              
                            </table>
                        </td>
                      </tr>
                    
                  
                  </table>
                </div>
              `
              }

              $('.dvlaccordion_history_folder').append(string_accordion);
              $('.ui.accordion').accordion();  

          }
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}

// KLIK TITLE ACCORDION DI DVL (ISINYA TYPE MFG)
// -->menampilkan data link sesuai type
// -->menampilkan data dinamis penilaian KPI
$(document).on('click','.dvlacc.title', function(){

  console.log(this.classList.contains('active'));

  // CEK EVENT CLICK (MEMBUKA ATAU MENUTUP ACCORDION)
  if(this.classList.contains('active')){
    // JIKA MEMBUKA ACCORDION
    let idregister=$(this).attr('idreg');
    var typeaccordion = $(this).attr('typetitle');
    let idtypeaccordion = $(this).attr('idtype');
    // TAMPIL DATA MULTITYPE
    tampilmultitype_folder(idtypeaccordion,idregister);

    
  }else{
    // JIKA MENUTUP ACCORDION

  }
});

//  ---- TAMPIL HISTORY KETIKA MENEKAN ACCORDION DVR
$(document).on('click','.dvracc.title', function(){
  console.log('test');
  console.log(this.classList.contains('active'));
  let idregister=$(this).attr('idreg');
  let foldername=$(this).attr('foldername');

  if(this.classList.contains('active')){
    // JIKA MEMBUKA ACCORDION
    var typeaccordion = $(this).attr('idtype');
    var namatype = $(this).attr('typetitle');
    var namamodal = $(this).attr('modalname');
    // tampilhistoryfolder(foldername,idregister,typeaccordion,namamodal);
    tampilDQA(foldername,idregister,typeaccordion,namamodal,namatype);
    
  }else{
    // JIKA MENUTUP ACCORDION

  }
});



// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 3. MENAMPIL
// addkategorifunc(id_kategorikpi,id_subkategori,type,namasub);


function tampilmultitype_folder(type,idreg){
  // console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_dvl`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            idregister : idreg,
            typemfgsupply : type,

            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {

          

        
        } else {
          $('.tdfolder-0-'+type+'').empty();
          $('.tdfolder-1-'+type+'').empty();
          $('.tdfolder-2-'+type+'').empty();
          $('.td_penilaian_folder').empty();

          let datakpi=obj;

          for(var itemkpi in datakpi){

            var tdcounter=0;
          
            var categories = Object.keys(obj[itemkpi]);
            var panjangarr=categories.length;
            console.log(categories);
            for(var a=0; a<panjangarr ; a++){
                var stringsub="";
                var tablestring="";
                var totalvalue=0;
                console.log("#"+categories[a]+"-"+type);
                var idtable =categories[a]+"-"+type;
                var idtableedited2 = idtable.replace(/\ /g,"_");
                var idtableedited =idtableedited2.replace(/&/g,"and")+"_folder";
              // CEK APAKAH TABEL SUDAH ADA TERGAMBAR
              if($("#"+idtableedited).length) {
                // JIKA TABEL ADA
  
                
  
              } else{
              // JIKA TABEL BELUM ADA
                
                console.log(obj[itemkpi][categories[a]]);
                var subcategories=obj[itemkpi][categories[a]];
                var banyaksub=subcategories.length;
                
  
                for(var b=0;b<banyaksub;b++){
                  // PERULANGAN UNTUK MEMBUAT BARIS SUB KATEGORI
                  console.log(subcategories[b]);
                  stringsub+=`
                  <tr>
                      <td width="50%">
                      `+subcategories[b]['Nama Sub Kategori']+`
                      </td>
  
                      <td width="40%">
                      `+subcategories[b]['value']+`
                      </td>
  
                      
                      <td width="5%">
                      
                      
  
                      </td>
                      
                    </tr>
                  `;
  
                  totalvalue+=parseInt(subcategories[b]['value']);
  
                }
  
                // STRING UNTUK TABEL YANG AKAN DIGABUNGKAN DENGAN TR SUB KATEGORI YANG TELAH DIBUAT DIATAS
  
                  tablestring=`
                  <table class="ui small compact striped table single line tb_designoutput" width="100%" id="#`+idtableedited+`">
                  <thead class="historyhead th_designinput">
                    <th colspan="3" width="">`+categories[a]+`</th>
                  </thead>
                  <tbody>
                  <tr>
                      <td width="50%">
                      Total
                      </td>
                      <td>
                        <span id="totaldesign">`+totalvalue+`</span>
                      </td>
                      
                      <td>
                      
                      </td>
                      
                  </tr>
                  
                  `+stringsub+`
                    
                  </tbody>
                  
                </table>
                  `;
  
                  $('.tdfolder-'+tdcounter+'-'+type+'-'+itemkpi).append(tablestring);
  
                  if(tdcounter!=2){
                    tdcounter++;
                  }else{
                    tdcounter=0;
                  }
              }
  
  
              
            }
          }

          
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}


// >>>> FUNGSI COPY TEXT KE CLIPBOARD (ALAMAT FOLDER SHARING)
// 
$(document).on('click','.copyalamat',function(){
  let btntext=$(this).attr('alamat');
  // navigator.clipboard.writeText(btntext).then(function() {
  //   console.log('Async: Copying to clipboard was successful!');
  // }, function(err) {
  //   console.error('Async: Could not copy text: ', err);
  // });

  var $temp = $("<input>");
    $("body").append($temp);
    $temp.val(btntext).select();
    document.execCommand("copy");
    

    Swal.fire({
      text: 'Alamat berhasil disalin (alamat: '+$temp.val()+')',
      timer: 2000,
      position: 'center',
      toast: true,
      showConfirmButton: false
      })

      $temp.remove();

});
// 
// END OF FUNGSI COY
// ==========================================================================
