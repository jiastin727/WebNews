const fungsilogout = false;
const NonceValue ="rdsystem2020";
$(".ui.dropdown").dropdown();
$(".menu .item").tab();

$('.ui .dropdown').dropdown({
    forceSelection:false
  })

  var json_cookies = getCookie('linkupl');

if(json_cookies){
    var hasiljson = json_cookies;
  var link_ck= json_cookies;
  
}

if(link_ck){
    
        $('#mechupload').removeClass("disabled");
        $("#mechupload").on("click", function(){
            //store data baris
            // var eid = $(this).attr("btnid");
            // let encryption = new Encryption();
            // var eidENC = encryption.encrypt(eid, NonceValue);
            // window.location.href = "./?link=dalamnegeridetail&i=" + eidENC;
            console.log("uplod")
            window.location.href = link_ck;
        });
    
    

}




// READ COOKIES
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocdocmgmt = decodeURIComponent(getCookie("restlocdocmgmt"));


var json_cookies = getCookie('filtersearchdocmgmt');

// projectTableView(valsearch,valgroup,valsubmodif,valplant,valchs,valstatus);
// var setarr=[valsearch,valgroup,valsubmodif,valplant,valchs,valstatus];
if(json_cookies){
    var hasiljson = JSON.parse(json_cookies);
    var cksearch=hasiljson[0];
    var ckgroup=hasiljson[1];
    var cksub=hasiljson[2];
    var ckplant=hasiljson[3];
    var ckchs=hasiljson[4];
    var ckstatus=hasiljson[5];
    var designerck=hasiljson[6];
}

if(cksearch){

  $('#searchdocmgmt').val(cksearch);
  var searchcookie=cksearch;

}else{

  var searchcookie="";

}

var subcookie="ALL"

if(ckgroup){

  $('#fgroup_prod').dropdown('set selected', ckgroup);
  var groupcookie=ckgroup;
  handler_produkcookie(ckgroup);
  // let resfunc = await isidropsub(valgroup);

  

}else{
  
  var groupcookie="ALL";
  $('#fgroup_prod').dropdown('set selected', 'ALL')
  $('#fsub_prod').dropdown('set selected', 'ALL')
}

if(ckplant){

  $('#fplant').dropdown('set selected', ckplant);
  var plantcookie=ckplant;

}else{

  $('#fplant').dropdown('set selected', "ALL");
  var plantcookie="ALL"
  
}

if(ckchs){

  $('#fchasis').dropdown('set selected', ckchs);
  var chasiscookie=ckchs;

}else{

  $('#fchasis').dropdown('set selected', "ALL");
  var chasiscookie="ALL"
  
}

if(ckstatus){

  $('#fstatus').dropdown('set selected', ckstatus);
  var statuscookie=ckstatus;

}else{

  $('#fstatus').dropdown('set selected', "ALL");
  var statuscookie="ALL"
  
}

if(designerck){

  $('#fdes').dropdown('set selected', designerck);
  var designercookie=designerck;

}else{

  $('#fdes').dropdown('set selected', "ALL");
  var designercookie="ALL"
  
}

var setarr=[searchcookie,groupcookie,subcookie,plantcookie,chasiscookie,statuscookie,designercookie];
// var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
var JsonFilter = JSON.stringify(setarr);
setCookie("filtersearchdocmgmt",JsonFilter,5);

console.log(JsonFilter);

// $('#fgroupprod').dropdown('set selected', 'BG');
projectTableView(searchcookie,groupcookie,subcookie,plantcookie,chasiscookie,statuscookie,designercookie);
// projectTableView(valsearch,valgroupmodif,valsubmodif,valplant,valchs,valstatus,valdesigner);


function projectTableView(FSearch,FGroup,FSub,FPlant,FChassis,FStatus,FDesigner) {
    // console.log(FYear+"<---- tahun dalam func");
    console.log(restlocdocmgmt);
    
    // var d1 = enc.decrypt(EncR, NonceValue);
    // var d2 = enc.decrypt(erl, NonceValue);

    $('#projectTable').DataTable({

        dom: "<'ui stackable grid'" +
            "<'row'" +
            "<'left aligned ten wide column'>" +
            ">" +
            "<'row dt-table'" +
            "<'sixteen wide column'tr>" +
            ">" +
            "<'row'" +
            "<'left aligned eight wide column'B>" +
            "<'right aligned eight wide column'p>" +
            ">" +
            ">",

        buttons: 
        [
            {
                text: '10',
                action: function (e, dt, node, config) {
                    $('#projectTable').DataTable().page.len(10).draw();
                }
            },
            {
                text: '25',
                action: function (e, dt, node, config) {
                    $('#projectTable').DataTable().page.len(25).draw();
                }
            },
            {
                text: '50',
                action: function (e, dt, node, config) {
                    $('#projectTable').DataTable().page.len(50).draw();

                }
            },
            {
                text: '100',
                action: function (e, dt, node, config) {
                    $('#projectTable').DataTable().page.len(100).draw();

                }
            },
            {
                text: '500',
                action: function (e, dt, node, config) {
                    $('#projectTable').DataTable().page.len(500).draw();
                }
            },
            {
                text: '1000',
                action: function (e, dt, node, config) {
                    $('#projectTable').DataTable().page.len(1000).draw();
                }
            }
        ],


    destroy: true,
    stateSave: false,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    pageLength: 10,
    data: [],

    language: {
        sLengthMenu: "_MENU_",
        search: "",
        searchPlaceholder: "Search..",
        processing: '<i class="circle notch loading icon huge"></i>',
        emptyTable: 'tidak ada data yang ditampilkan',
    },

    order: [[0, "desc"]],

    columns: [
        { data  : 'group_product' },
        { data  : 'sub_product' },
        
        { data  : 'category' },
        { data  : 'plant' },
        { data  : 'chassis'},
        { data  : 'cabinet' },
        { data  : null,
          render: function (data) {

            if(data['type_mfg_supply']===null||data['type_mfg_supply']===""||data['type_mfg_supply']==="null"){
              
              return "-";
            }else{

              // console.log(data['type_mfg_supply']);
              var types=`<ol class="ui list">`;
              var panjangarr=data['type_mfg_supply'].length;
              for(var k=0;k<panjangarr;k++){
                  
                      types+=`<li value="*">`+data['type_mfg_supply'][k]+`</li>`;
                    
              }
              types+=`</ol>`;
              // types = types.replace(/,\<br\>$/, "");
              // console.log(des);
              return types;

            }
              
              
          },
  
        },
        
        { data  : null,
          render: function (data) {
              var des="";
              for(var k=1;k<=10;k++){
                  if(data['designer'+k] !==null && data['designer'+k] !==""){
                      des += data['designer'+k]+",<br>";
                    }
              }
  
              des = des.replace(/,\<br\>$/, "");
              // console.log(des);
              return des;
              
          },
  
        },
        { data  : 'head_of' },
        
        // { data  : 'project_leader' },
        // { data  : 'tgl_masspro' },
        { data  : 'status_project' },
        
        // { data  : 28 },
        
        { data  : null,
            render: function(data,row){

              
              

              
              // USER LOGIN ADA DI DESIGNER
              if(userName1==data['username']||userName1==data['head_of']){


                return `<span class='docicon' style='white-space: nowrap !important; word-spacing:5px !important;'><i class="ui edit outline icon iconcoloredit editheader" btnid="${data['id_register']}"></i>&nbsp;<i class="ui upload icon iconcoloredit uploadbtn" btnid="${data['id_register']}"></i>&nbsp;<i class="ui list ul icon iconcoloredit reportbtn" btnid="${data['id_register']}" reqby="${data['username']}" chassis="${data['chassis']}"></i></span>`;

              }else{

                var desarr=[];
                for(var k=1;k<=10;k++){
                    if(data['designer'+k] !==null && data['designer'+k] !==""){
                        desarr.push(data['designer'+k]);
                      }
                }

                var adadesign=jQuery.inArray( userName1, desarr);
                console.log(adadesign);

                if(adadesign!== -1){
                  return `<span class='docicon' style='white-space: nowrap !important; word-spacing:5px !important;'><i class="ui edit outline icon iconcoloredit editheader" btnid="${data['id_register']}"></i>&nbsp;<i class="ui upload icon iconcoloredit uploadbtn" btnid="${data['id_register']}"></i>&nbsp;<i class="ui list ul icon iconcoloredit reportbtn" btnid="${data['id_register']}" reqby="${data['username']}" chassis="${data['chassis']}"></i></span>`;

                }else{
                  return `<span class='docicon' style='white-space: nowrap !important; word-spacing:5px !important;'><i class="ui upload icon iconcoloredit uploadbtn" btnid="${data['id_register']}"></i>&nbsp;<i class="ui list ul icon iconcoloredit reportbtn" btnid="${data['id_register']}" reqby="${data['username']}" chassis="${data['chassis']}"></i></span>`;

                }
              }

                    //return `<i class="book icon editdata">`;

                    
                    //return '<i class="edit icon editdata" idedit="${data[0]}">
            }
            
        },

      ],
        

    


    
    ajax: {
        
        url     : `${restlocdocmgmt}table_viewproject`,
        type    : 'POST',
        //PENTING!! error uncaught lenght
        headers: {
            user: vusrnm,
            token: vtoken,
        },
        // data search
        data    : {
        // FStatus : FStatus,
        FSearch : FSearch,
        FGroup   : FGroup,
        FChassis : FChassis,
        FSub:FSub,
        FPlant:FPlant,
        FStatus:FStatus,
        FDesigner:FDesigner,
        user    : userName1,
        },
        
        error: function(){
            if(fungsilogout){
    
                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        },

    },

    

    
    //STYLING KOLOM

    columnDefs: [
//         { className: "center aligned", targets: [0,1,3,6,8,9,10,11,12,13] },

        { className: "no-wrap", targets: [5] },

//         {className : "collapsing", targets: [1,2,5,11,12]},

//         { "orderable": false, "targets": 13 },
// ],

// "columnDefs": [
//     { "orderable": false, "targets": 10 }
  ],

    


    });

}

async function handler_produkcookie(valgroup){

  try {
    let resfunc = await isidropsub(valgroup);
    console.log(resfunc); // "Promise resolved"

    if(resfunc!=''){
      if(cksub){

        $('#fsub_prod').dropdown('set selected', cksub)
        subcookie=cksub;
      }else{
        $('#fsub_prod').dropdown('set selected', 'ALL')
        subcookie="ALL"
        
        
      }
     
    }

  } catch (err) {
    console.log(err);
  }

}

async function submit_onGroupChange(){
  var valgroup=$('#fgroup_prod').dropdown('get value');
  


  try {
    let resfunc = await isidropsub(valgroup);
    console.log(resfunc); // "Promise resolved"

    if(resfunc!=''){

      var valsearch=$('#searchdocmgmt').val();

      var valsubmodif="";
      if($('#fsub_prod').dropdown('get value')=="ALL"){
        console.log($('#fsub_prod').dropdown('get value'));
        valsubmodif="ALL";
      }else{
        console.log('ada');
        valsubmodif=$('#fsub_prod').dropdown('get text');
      }

      var valgroupmodif="";
      if($('#fgroup_prod').dropdown('get value')=="ALL"){
        console.log($('#fgroup_prod').dropdown('get value'));
        valgroupmodif="ALL";
      }else{
        console.log('ada');
        valgroupmodif=$('#fgroup_prod').dropdown('get text');
      }

      var valplant  = $('#fplant').val();
      var valchs=$('#fchasis').val();
      var valstatus=$('#fstatus').val();
      var valdesigner=$('#fdes').val();
      var setarr=[valsearch,valgroupmodif,valsubmodif,valplant,valchs,valstatus,valdesigner];
      var JsonFilter = JSON.stringify(setarr);
      setCookie("filtersearchdocmgmt",JsonFilter,5);

      $('#projectTable').DataTable().destroy();
      projectTableView(valsearch,valgroupmodif,valsubmodif,valplant,valchs,valstatus,valdesigner);

    }

  } catch (err) {
    console.log(err);
  }
  // console.log(resfunc);
}

function filter_handler(){
    
  var valsearch=$('#searchdocmgmt').val();

  var valsubmodif="";
  if($('#fsub_prod').dropdown('get value')=="ALL"){
    console.log($('#fsub_prod').dropdown('get value'));
    valsubmodif="ALL";
  }else{
    console.log('ada');
    valsubmodif=$('#fsub_prod').dropdown('get text');
  }

  var valgroupmodif="";
  if($('#fgroup_prod').dropdown('get value')=="ALL"){
    console.log($('#fgroup_prod').dropdown('get value'));
    valgroupmodif="ALL";
  }else{
    console.log('ada');
    valgroupmodif=$('#fgroup_prod').dropdown('get text');
  }

  var valplant  = $('#fplant').val();
  var valchs=$('#fchasis').val();
  var valstatus=$('#fstatus').val();
  var valdesigner=$('#fdes').val();
  var setarr=[valsearch,valgroupmodif,valsubmodif,valplant,valchs,valstatus,valdesigner];
  var JsonFilter = JSON.stringify(setarr);
  setCookie("filtersearchdocmgmt",JsonFilter,5);

  $('#projectTable').DataTable().destroy();
  projectTableView(valsearch,valgroupmodif,valsubmodif,valplant,valchs,valstatus,valdesigner);
  
}

$('#searchdocmgmt').keyup( function() {

    
    // projectTableView($('#searchdocmgmt').val());


  var valsearch=$('#searchdocmgmt').val();

  var valsubmodif="";
  if($('#fsub_prod').dropdown('get value')=="ALL"){
    console.log($('#fsub_prod').dropdown('get value'));
    valsubmodif="ALL";
  }else{
    console.log('ada');
    valsubmodif=$('#fsub_prod').dropdown('get text');
  }

  var valgroupmodif="";
  if($('#fgroup_prod').dropdown('get value')=="ALL"){
    console.log($('#fgroup_prod').dropdown('get value'));
    valgroupmodif="ALL";
  }else{
    console.log('ada');
    valgroupmodif=$('#fgroup_prod').dropdown('get text');
  }

  var valplant  = $('#fplant').val();
  var valchs=$('#fchasis').val();
  var valstatus=$('#fstatus').val();
  var valdesigner=$('#fdes').val();
  var setarr=[valsearch,valgroupmodif,valsubmodif,valplant,valchs,valstatus,valdesigner];
  var JsonFilter = JSON.stringify(setarr);
  setCookie("filtersearchdocmgmt",JsonFilter,5);

  $('#projectTable').DataTable().destroy();
  projectTableView(valsearch,valgroupmodif,valsubmodif,valplant,valchs,valstatus,valdesigner);
  });
// $('.uploadbtn').on('click', function() {
//     console.log("uplod")
//     window.location.href = "./?link=mechdocupl";
// });
$("#fgroup_prod").on("change", function(){
    // projectTableView($('#fgroup_prod').val());

    submit_onGroupChange();
    
});


$("#fsub_prod").on("change", function(){
  filter_handler();
});

// FILTER PLANT
$("#fplant").on("change", function(){
  filter_handler();
});

// FILTER CHASIS
$("#fchasis").on("change", function(){
  filter_handler();
});

$("#fchasis2").on("change", function(){
  projectTableView($('#fchasis2').val());
});

$("#fstatus").on("change", function(){
  filter_handler();
});

$("#fdes").on("change", function(){
  filter_handler();
});




$("#projectTable").on("click",".reportbtn", function(){
  //store data baris
  // var eid = $(this).attr("btnid");
  // let encryption = new Encryption();
  // var eidENC = encryption.encrypt(eid, NonceValue);
  // window.location.href = "./?link=dalamnegeridetail&i=" + eidENC;
  let chassis=$(this).attr('chassis');
  let reqby=$(this).attr('reqby');
  console.log("uplod")
  window.location.href = "./?link=mechdocrep&req="+reqby+"&chs="+chassis+"";
});

//BUTTON CLICK

$('#mechreg').on('click', function() {
    window.location.href = "./?link=mechdocreg";
    // tablelistdoc();
});

$('#mechproject').on('click', function() {
  window.location.href = "./?link=mechdocmanagement";
});

$("#mechreport").on("click", function(){
  
  console.log("uplod")
  window.location.href = "./?link=mechdocrep";
});

 
$('.tabuserguide').on('click', function() {
  window.location.href = "./?link=guidemecdoc";
});
$('.tabsuratgolive').on('click', function() {
  window.location.href = "./?link=golivemecdoc";
});
$('.tabhasilmonitoring').on('click', function() {
  window.location.href = "./?link=monitormecdoc";
});
$('.tabversion').on('click', function() {
  window.location.href = "./?link=versionhistory&app=DMN";
});


$('#tabdocument').on('click', function() {
  
  // tablelistdoc("","",'ALL');
  var valsearchdoc=$('#searchdoc').val();
  var valchsdoc=$('#fchasis2').dropdown('get value');
  var valreqdoc=$('#frequestdoc').val();
  
  tablelistdoc(valsearchdoc,valreqdoc,valchsdoc);
});

$('#tabsearch').on('click', function() {
  
  filter_handler();
});

$('#projectTable').on('click','.editheader', function() {

    // let idbtn=$(this).attr('btnid');

    var idproject=$(this).attr('btnid');
    let encryption = new Encryption();
    var idENC = encryption.encrypt(idproject, NonceValue);
    // window.location.href = "./?link=pssitem&i=" + eidENC;
    window.location.href = "./?link=mechdocreg&i="+idENC;

    // window.location.href = "./?link=mechdocreg&c=edit";

});

$("#projectTable").on("click",".uploadbtn", function(){
  
  var idproject=$(this).attr('btnid');
    let encryption = new Encryption();
    var idENC = encryption.encrypt(idproject, NonceValue);
    // window.location.href = "./?link=pssitem&i=" + eidENC;
    window.location.href = "./?link=mechdocupl&i="+idENC;

  
});



// FUNGSI UNTUK MENAMPILKAN DATA PADA TABEL DOKUMEN
  function tablelistdoc(FSearch,FRequest,FChassis){

    // desplace=$("#Iddes").val();


    $("#docTable").DataTable({
        dom:
          "<'ui stackable grid'" +
          "<'row'" +
          "<'left aligned sixteen wide column'>" +
          ">" +
          "<'row dt-table'" +
          "<'sixteen wide column'tr>" +
          ">" +
          "<'row'" +
          "<'left aligned eight wide column'B>" +
          "<'right aligned eight wide column'p>" +
          ">" +
          ">",

          buttons: 
        [
            {
                text: '10',
                action: function (e, dt, node, config) {
                    $('#docTable').DataTable().page.len(10).draw();
                }
            },
            {
                text: '25',
                action: function (e, dt, node, config) {
                    $('#docTable').DataTable().page.len(25).draw();
                }
            },
            {
                text: '50',
                action: function (e, dt, node, config) {
                    $('#docTable').DataTable().page.len(50).draw();

                }
            },
            {
                text: '100',
                action: function (e, dt, node, config) {
                    $('#docTable').DataTable().page.len(100).draw();

                }
            },
            {
                text: '500',
                action: function (e, dt, node, config) {
                    $('#docTable').DataTable().page.len(500).draw();
                }
            },
            {
                text: '1000',
                action: function (e, dt, node, config) {
                    $('#docTable').DataTable().page.len(1000).draw();
                }
            }
        ],
      
          destroy: true,
          stateSave: false,
          processing: true,
          deferRender: true,
          serverSide: true,
          orderClasses: false,
          pageLength: 10,
        data: [],
        language: {
          sLengthMenu: "_MENU_",
          search: "",
          searchPlaceholder: "Search..",
          processing: '<i class="circle notch loading icon huge"></i>',
        },
        order: [[0, "desc"]],
        // "ajax": "./1_documentmanagement/mechanicdesign/doc.txt",
        "columns": [
          // { "data": "type_mfg_supply" },
          { "data": 'chassis' },
        { "data": 'request_by'},
        { "data": null,
          render: function (data, type, row) {
            if(data['jenis']=="FILE"){
            return `<a href="../RND_Upload/${data['file']}" target='_blank'>${data['file_ori']}</a>`
          }else if(data['jenis']=="LINK"){
            return `<a href="${data['file']}" target='_blank'>${data['file_ori']}</a>`
          }else{
            return `
            <span class='text_history copyalamat iconcoloredit' alamat="${data['file_ori']}" data-content="klik untuk salin" data-position="bottom center" >${data['file_ori']}&nbsp; </span>
            `
          }
          },
        },
          { "data": 'revisi'
        },
        { "data": 'nama_folder'
        },
        // { "data": null,
        //   render: function (data, type, row) {
        //     if (data[0] != "") {
        //       return `<span class="">${data["namafolder"]}</span>`;
        //     } else {
        //       return "";
        //     }
        //   },
        // },
        
          // { "data": "type_mfg_demand" },
          // { "data": "lot_inventory" },
          // { "data": "type_barang_demand" },


         
          // { "data": "chassis" },
          // { "data": "salary" }
          
        ],

        
  
        ajax: {
          url: `${restlocdocmgmt}table_viewdokumen`,
          type: "POST",
          headers: {
            user: vusrnm,
            token: vtoken,
          },
          data: {
            FSearch: FSearch,
            FChassis:FChassis,
            FRequest:FRequest
          },
          error: function () {
            if (fungsilogout){
              window.location.href = "./?link=loclogout";
            } else {
              Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
            }
          },
        },


        columnDefs: [
          { className: "cuttextsearch", targets: [2] },
  
          { className: "center aligned", targets: [0,3] },
  
          // {className : "collapsing", targets: [1,2,5,11,12]},
  
          // { "orderable": false, "targets": 13 },
      ],

      });
      // var table2 = $('#docTable').DataTable();

      


// $('#MFGsupp_in').keyup( function() {
//   // var ptbsearch
//   // $("#MFGsupp_in").val('');
//   $("#MFGdem_in").val('');
//   $("#lotinv_in").val('');
//   $("#barangdem_in").val('');
//   $("#reff_in").val('');
//   console.log(this.value);
//   // table.search(""+$('#searchPTB').val()+"").draw();
//   table2.search( this.value ).draw();
//   // tablePTB.search($('#searchPTB').val()).draw();
// } );
  
    // $("#designerList").css('cursor', 'pointer');
}


$("#fchasis2").on("change", function(){
  
  var valsearchdoc=$('#searchdoc').val();
  var valchsdoc=$('#fchasis2').dropdown('get value');
  var valreqdoc=$('#frequestdoc').val();
  
  tablelistdoc(valsearchdoc,valreqdoc,valchsdoc);

});

$('#frequestdoc').keyup( function() {
  var valsearchdoc=$('#searchdoc').val();
  var valchsdoc=$('#fchasis2').dropdown('get value');
  var valreqdoc=$('#frequestdoc').val();
  
  tablelistdoc(valsearchdoc,valreqdoc,valchsdoc);
} );

$('#searchdoc').keyup( function() {

  var valsearchdoc=$('#searchdoc').val();
  var valchsdoc=$('#fchasis2').dropdown('get value');
  var valreqdoc=$('#frequestdoc').val();
  
  tablelistdoc(valsearchdoc,valreqdoc,valchsdoc);
  // var valsearch=$('#searchdoc').val();
  // var requestor=$('#frequestdoc').val();
  // var valchs=$('#fchasis2').val();

  // tablelistdoc(valsearch)
} );

$(document).on('click', '.filespec', function(){
    console.log($(this).text());
    if($(this).text()=="File Drawing PLD32D123 Revisi Mayor"){
        window.open("./_js/docmgt/datagamgbar.png");
    }else{

        window.open("./_js/docmgt/TEST-FILE.pdf");
    }
    
  });



  
// >>>> FUNGSI COPY TEXT KE CLIPBOARD (ALAMAT FOLDER SHARING)
// 
$(document).on('click','.copyalamat',function(){
  let btntext=$(this).attr('alamat');
  // navigator.clipboard.writeText(btntext).then(function() {
  //   console.log('Async: Copying to clipboard was successful!');
  // }, function(err) {
  //   console.error('Async: Could not copy text: ', err);
  // });

  var $temp = $("<input>");
    $("body").append($temp);
    $temp.val(btntext).select();
    document.execCommand("copy");
    

    Swal.fire({
      text: 'Alamat berhasil disalin (alamat: '+$temp.val()+')',
      timer: 2000,
      position: 'center',
      toast: true,
      showConfirmButton: false
      })

      $temp.remove();

});
// 
// END OF FUNGSI COY
// ==========================================================================

  
 // --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX: FUNGSI UNTUK MENGISIA DROPDOWN SUB PRODUCT BERDASARKAN KODE GROUP PRODUCT

function isidropsub(valgroup){

  return new Promise(resolve => {  

  if(valgroup=="ALL"){
    console.log("masukALL")
    $('#fsub_prod').empty()
          .append(`
            <option value="">SUB PRODUCT</option>
            <option value="ALL">ALL SUB PRODUCT</option>
          `);
          $('#fsub_prod').val('ALL');
          resolve('success');
  }else{

      $(document).ready(function () {

    
        $.ajax({
          type: "POST",
          url: `${restlocdocmgmt}table_viewsubproduk`,

          headers: {
              user: vusrnm,
              token: vtoken,
          },
          data:{
              kode:valgroup,
          },
              success: function (response){
          var obj = JSON.parse(response);
          console.log(obj);
          if(isEmpty(obj)) {
          console.log('Gagal tampil, data kosong');
          resolve('failed');
          
          } else if(obj.status==false) {
          // tableType();
          // Swal.fire("Error", obj.message ,"error" );
          resolve('failed');
          
          } else {
            dropstring="<option value=''>SUB PRODUCT</option><option value='ALL'>ALL SUB PRODUCT</option>";
            panjangdrop=obj.length;
            for(var c=0;c<panjangdrop;c++){
              dropstring+=`
              <option value="`+obj[c]['nama_sub']+`">`+obj[c]['nama_sub']+`</option>
              `
            }
            $('#fsub_prod').empty()
            .append(dropstring).dropdown('set selected','ALL');
            
            // $('#fsub_prod').val('ALL');
            // $('#fsub_prod').dropdown('clear');
            // $('.ui.dropdown.fsubdrop').find('.default.text').text('SUB PRODUCT');
            
            resolve('success');

          }
      },
      error: function(){
          if(fungsilogout){

              window.location.href="./_logout.php";
          }else{
              console.log("error session")
          }
      }
      });
    
          
    
    
        
        
    });
  }
  
  
  });
  
}
