$(".ui.dropdown").dropdown();
$(".menu .item").tab();
$('.ui.accordion').accordion();
const fungsilogout = false;
const NonceValue = "rdsystem2020";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocdocmgmt = decodeURIComponent(getCookie("restlocdocmgmt"));
var btnstate="file"; //-- menyimpan status jenis data yang mau diupload
let folderupload_type='';

const uniquemodal=[
{"foldername":"DRAWING ID","modalname":'uploaddrawing',"history":true,"history_type":'default',"upl_datatype":['file','link','folder_sharing']},
{"foldername":"TECHNICAL DISCUSS","modalname":'uploadtech',"history":true,"history_type":'default',"upl_datatype":['file','link','folder_sharing']},
{"foldername":"CHECKING REPORT","modalname":'uploadcek',"history":false,"history_type":'custom',"upl_datatype":"none"},
{"foldername":"DESIGN VALIDATION (DVL)","modalname":'uploaddvl',"history":false,"history_type":'custom',"upl_datatype":"none"},
{"foldername":"DESIGN VERIFICATION RECORD(DVR)","modalname":'uploaddvr',"history":false,"history_type":'custom',"upl_datatype":"none"},
{"foldername":"MPL","modalname":'uploadMPL',"history":false,"history_type":'custom',"upl_datatype":"none"}
];

const runcustomfunc=[
  {"foldername":"MPL","function":viewdataexcel,"function_history":viewdataexcel_history}
]

// var json_cookies = getCookie('linkupl');

// >>>> FUNGSI CUSTOM
// ------ MENGUBAH PROPERTI CONTAINS MENJADI CASE INSENSITIVE
jQuery.expr[':'].insensitivecontains = function(a, i, m) {
  return jQuery(a).text().toUpperCase()
      .indexOf(m[3].toUpperCase()) >= 0;
};


// UNTUK AKTIFKAN TAB UPLOAD BILA SEBELUMNYA PERNAH AKSES HALAMAN UPLOAD
var json_cookies = getCookie('linkupl');

if(json_cookies){
    var hasiljson = json_cookies;
  var link_ck= json_cookies;
  
}

if(link_ck){
    
        $('#mechupload').removeClass("disabled");
        $("#mechupload").on("click", function(){

            console.log("uplod")
            window.location.href = link_ck;
        });
    
    

}

// ----- FUNGSI ON READY DOCUMENT READY
// ---- JALAN KETIKA HALAMAN READY
$(document).ready(function () {
  view_lastuploaded()
  


  $("#nama_folder").val('');

  // MENAMPILKAN DATA KEWAJIBAN
  getkewajiban();
  // view_lastuploaded();
});



// >>>>> __ FUNGSI KLIK TOMBOL PILIH UPLOAD LINK ATAU FILE __ <<<<<

    /** akan mengganti variable 'btnstate'
     * btnstate ketika halaman load secara default adalah file
     * file = data yang ingin diupload berupa file
     * link = data yang ingin diuplaod berupa link
    */

// $(document).on('click','.btnlink', function() {
//   console.log("test");
//   let namamodal=$(this).attr('modalname');
//   let idinput="inputupload_"+namamodal;
//     if(btnstate=="file"){

//         document.getElementById("jenisupl_"+namamodal).innerHTML = `
//         Upload Link : 
//         <div class="ui input fluid small">
//           <input id="`+idinput+`" type="text" id="2" placeholder="Cantumkan lengkap beserta http:// atau https:// - nya.">
//         </div>
//     `;
//     $(this).html("Gunakan File");
//     btnstate="link"
//     }else{
//         document.getElementById("jenisupl_"+namamodal).innerHTML = `
//         Upload File : <div class="ui input fluid small">
//                     <input type="file" id="`+idinput+`" class="inputupload_generalupload" modalname='generalupload'>
//         `;
//         btnstate="file";
//         // $("#btntxt").text("Gunakan Link");
//         $(this).html("Gunakan Link")
//         console.log($(this));
//     }

//     console.log("btnstate->>"+btnstate);
    
// });



// 
//_____


// >>>> __ FUNGSI MENEKAN TOMBOL TAB MENU  __ <<<<

$('#mechreg').on('click', function() {
    window.location.href = "./?link=mechdocreg";
});
$('#mechsearch').on('click', function() {
    window.location.href = "./?link=mechdocsearch";
});
$('#mechproject').on('click', function() {
    window.location.href = "./?link=mechdocmanagement";
});
$("#mechreport").on("click", function(){
    
    console.log("uplod")
    window.location.href = "./?link=mechdocrep";
  });

$('#kewajibanButtonBack').on('click', function() {
  $('.kewajibanmodal').modal('hide');
});

// 
// ____


// >>>> __ FUNGSI MENEKAN TOMBOL SILANG 'X' PADA MODAL __ <<<<
    /**
     * menutup modal berdasarkan nama modal yang tersimpan
     * pada atribut 'modalname' pada span tombol
     * 
     */

$('.closemodal_btn').on('click', function() {
  let namamodal=$(this).attr('modalname');
  $('.'+namamodal).modal('hide');
  // $('.uploaddvr').modal('hide');
});

    // untuk modal khusus history

$('.close_historyfolder').on('click', function() {
  let namamodal=$(this).attr('modalname');
  $('.historymodal_'+namamodal).modal('hide');
  // $('.uploaddvr').modal('hide');
});

// ____


$('#folderButtonBack').on('click', function() {
  $('.historymodal').modal('hide');
});

// $('#SaveUploaddvl').on('click', function() {
//   $('.uploaddvl').modal('hide');
// });

// KLIK TITLE ACCORDION DI DVL (ISINYA TYPE MFG)
// -->menampilkan data link sesuai type
// -->menampilkan data dinamis penilaian KPI
$('.dvlaccordion').find('.title').on('click', function(){

  console.log(this.classList.contains('active'));

  // CEK EVENT CLICK (MEMBUKA ATAU MENUTUP ACCORDION)
  if(this.classList.contains('active')){

    // JIKA MENUTUP ACCORDION
  }else{
    // JIKA MEMBUKA ACCORDION
    var typeaccordion = $(this).attr('typetitle');
    let idtypeaccordion = $(this).attr('idtype');
    // TAMPIL DATA MULTITYPE
    tampilmultitype(idtypeaccordion);

  }
});


// KLIK TITLE ACCORDION DI DVL (ISINYA TYPE MFG)
// -->menampilkan data link sesuai type
// -->menampilkan data dinamis penilaian KPI
$('.dvlaccordion_history_folder').find('.title').on('click', function(){

  console.log(this.classList.contains('active'));

  // CEK EVENT CLICK (MEMBUKA ATAU MENUTUP ACCORDION)
  if(this.classList.contains('active')){

    // JIKA MENUTUP ACCORDION
  }else{
    // JIKA MEMBUKA ACCORDION
    var typeaccordion = $(this).attr('typetitle');
    let idtypeaccordion = $(this).attr('idtype');
    // TAMPIL DATA MULTITYPE
    tampilmultitype_folder(idtypeaccordion);

  }
});



//  ---- MULTITYPE UNTUK DVR
$('.dvraccordion').find('.title').on('click', function(){

  console.log(this.classList.contains('active'));

  if(this.classList.contains('active')){

    // JIKA MENUTUP ACCORDION
  }else{
    // JIKA MEMBUKA ACCORDION
    var namafolderdvr = $("#nama_folder").val();
    var typeaccordion = $(this).attr('idtype');
    var namamodal = $(this).attr('modalname');
    // tampilhistoryupl(namafolderdvr,idDEC,typeaccordion,namamodal);

  }
});


//  ---- MULTITYPE UNTUK DVR
$('.dvraccordion_history_folder').find('.title').on('click', function(){

  console.log(this.classList.contains('active'));

  if(this.classList.contains('active')){

    // JIKA MENUTUP ACCORDION
  }else{
    // JIKA MEMBUKA ACCORDION
    var namafolderdvr = $("#nama_folder").val();
    var typeaccordion = $(this).attr('idtype');
    var namamodal = $(this).attr('modalname');
    // tampilhistoryfolder(namafolderdvr,idDEC,typeaccordion,namamodal);

  }
});


// JIKA INPUT DIGANTI
// $('body').on('change','.subinput', function() {
//   console.log(this);
// });

$("body").on("input",'.subinput', function(){
  // Print entered value in a div box
  console.log(this);
  var kondisiinput=$(this).hasClass('changed');
  console.log(kondisiinput);
  if(!kondisiinput){
    $(this).addClass('changed');
  }
});



// TEKAN TOMBOL SIMPAN DVL UNTUK MENYIMPAN SEMUA VALUE DVL
$('.savevaluedvl').on('click', function() {
  var typebutton = $(this).attr('typebutton');
  var iddvl=[];
  var valdvl=[];
  var arrayvalues=getValues(".subinput.changed."+typebutton+"idtype");

  // TAMBAHKAN ALERT KALAU TIDAK ADA DATA DIGANTI ATAU FUNGSI DISABLE BUTTON KETIKA TIDAK ADA YANG DISIMPAN
  console.log(arrayvalues);

  
  $(document).find(".subinput.changed."+typebutton+"idtype").each(function(){
    // console.log(selector);
     var inputval= $(this);
     console.log(inputval);
     iddvl.push(inputval.attr('dataiddvl'));
     valdvl.push(inputval.val());
    //  tempValues[inputval.attr('dataiddvl')] = inputval.val();
   });

   updatevaluedvl(JSON.stringify(iddvl),JSON.stringify(valdvl),typebutton);
  
});



// FUNGSI MENGAMVIL SEMUA VALUE YANG ADA DI SUB KATEGORI DAN MEMASUKKAN KEDALAM ARRAY
function getValues(selector){
  var tempValues = {};
  
  var test=$(document).find(selector);
  console.log(test);
  $(document).find(selector).each(function(){
    console.log(selector);
     var inputval= $(this);
     console.log(inputval);
     tempValues[inputval.attr('dataiddvl')] = inputval.val();
   });
  return tempValues;
}

// FUNGSI KLIK TOMBOL UPLOAD
// $('.ui.dvl.accordion').accordion('open', 0);
$('.uplbtn').on('click', function() {
  
  // AMBIL NAMA FOLDER
  let namafolder=$(this).closest('td').prev('td').prev('td').text();
  let loc=$(this).closest('table').attr('id');

  if(loc=="table_input"){
      $('.historyhead').removeClass('th_designoutput')
      .addClass('th_designinput');
  }else{
      $('.historyhead').addClass('th_designoutput')
      .removeClass('th_designinput');
  }
  
  console.log(namafolder);
  // SIMPAN NAMA FOLDER
  $("#nama_folder").val(namafolder);

  handler_openmodal(namafolder);
  
  // TAMPILKAN DATA HISTORY UPLOAD
  // if(namafolder!=="Design Verification Record(DVR)"||namafolder!=="MPL"){
  //   tampilhistoryupl(namafolder,idDEC,"ALL");
  // }
  
  
  
  
  console.log($("#nama_folder").val());
  
//   if(namafolder=="Design Validation (DVL)"){
//     console.log(typedvl);
//     // tampilmultitype(typedvl[0]);
//     $('.uploaddvl').modal('show');
//           if(loc=="table_input"){
//             $('.historyhead').removeClass('th_designoutput');
//             $('.historyhead').addClass('th_designinput');
//         }else{
//             $('.historyhead').addClass('th_designoutput');
//             $('.historyhead').removeClass('th_designinput');
//         }

        
//         $('#totaldesign').text(Number($('#kekuatan_in').val())+Number($('#konsepdes_in').val())+Number($('#konsepfool_in').val())+Number($('#pbaru_in').val())+Number($('#efek_in').val())+Number($('#pproses_in').val())+Number($('#ptoleransi_in').val())+Number($('#standard_in').val()))
//   }else if(namafolder=="Design Verification Record(DVR)"){
//         $('.uploaddvr').modal('show');
//         if(loc=="table_input"){
//           $('.historyhead').removeClass('th_designoutput');
//           $('.historyhead').addClass('th_designinput');
//       }else{
//           $('.historyhead').addClass('th_designoutput');
//           $('.historyhead').removeClass('th_designinput');
//       }

//   }else if(namafolder=="Drawing Art"){
//         $('.uploaddrawing').modal('show');
//         if(loc=="table_input"){
//           $('.historyhead').removeClass('th_designoutput');
//           $('.historyhead').addClass('th_designinput');
//       }else{
//           $('.historyhead').addClass('th_designoutput');
//           $('.historyhead').removeClass('th_designinput');
//       }

//       btnstate='link';

//   }else if(namafolder=="Technical Discuss"){
//     $('.uploadtech').modal('show');
//     if(loc=="table_input"){
//       $('.historyhead').removeClass('th_designoutput');
//       $('.historyhead').addClass('th_designinput');
//   }else{
//       $('.historyhead').addClass('th_designoutput');
//       $('.historyhead').removeClass('th_designinput');
//   }
// }else if(namafolder=="Checking Report"){
//   $('.uploadcek').modal('show');
//   if(loc=="table_input"){
//     $('.historyhead').removeClass('th_designoutput');
//     $('.historyhead').addClass('th_designinput');
// }else{
//     $('.historyhead').addClass('th_designoutput');
//     $('.historyhead').removeClass('th_designinput');
// }
// }else if(namafolder=="MPL"){
//   $('.uploadMPL').modal('show');
//   if(loc=="table_input"){
//     $('.historyhead').removeClass('th_designoutput');
//     $('.historyhead').addClass('th_designinput');
// }else{
//     $('.historyhead').addClass('th_designoutput');
//     $('.historyhead').removeClass('th_designinput');
// }

//   viewdataexcel();
// }else{
//     $('.uploaddoc').modal('show');

//     $('#titletxt').text($(this).closest('td').prev('td').prev('td').text());
    
//     console.log(loc);
    
//     if(loc=="table_input"){
//         $('.historyhead').removeClass('th_designoutput');
//         $('.historyhead').addClass('th_designinput');
//     }else{
//         $('.historyhead').addClass('th_designoutput');
//         $('.historyhead').removeClass('th_designinput');
//     }
//     // $('#titletxt').text($(this).text());
//     if(namafolder=="Product Specification"){
//       // document.getElementById("tdbtnupl").innerHTML =`
//       // <button class="ui secondary tiny button btnlink" id="linkbtn" ><span id="btntxt">Gunakan Link</span></button>
//       // `;
//       $('#linkbtn').show();
       
//     }else if(namafolder=="Drawing Art"){

//       document.getElementById("jenisupl").innerHTML = `
//     Upload Link : <div class="ui input fluid small">
//               <input type="text" id="" placeholder="Cantumkan lengkap beserta http:// atau https:// - nya.">
//               <!-- <input type="hidden" id="NamaLink"> -->
//             </div>
//     `;
//       $('#linkbtn').hide();
//       $('#tablehistory').find('tbody').empty();
//     $('#tablehistory').find('tbody').append(`
//       <tr>
//           <td colspan="3" style="text-align:center;">
//           belum ada dokumen yang diupload
//           </td>
          
//       </tr>
//     `);
//   }else if(namafolder=="Design Validation (DVL)"){
    


//   }else{
//         $('#tablehistory').find('tbody').empty();
//       $('#tablehistory').find('tbody').append(`
//         <tr>
//             <td colspan="3" style="text-align:center;">
//             belum ada dokumen yang diupload
//             </td>
            
//         </tr>
//       `);
//     }
//   }
});


// >>>> FUNGSI UNTUK MEMBUKA MODAL UPLOAD DI SETIAP FOLDER
    /** Pengaturan dilihat dari array uniquemodal */

    function handler_openfolder_history(namafolder){
      let upper_namafolder=namafolder.toUpperCase();
      let isunique = uniquemodal.some(o => o.foldername === upper_namafolder);
      let isrunfunction= runcustomfunc.some(o => o.foldername === upper_namafolder && o.function_history!=='none');

      if(isrunfunction){
        console.log('run function')
        let runfunction=runcustomfunc.find(o => o.foldername === upper_namafolder);
        runfunction['function_history']();
      }
    
      if(isunique){
            // JIKA MODAL BUKAN MODAL GENERAL (FOLDER MEMILIKI MODAL SENDIRI)
            folderupload_type='unique';
            let folderinfo = uniquemodal.find(o => o.foldername === upper_namafolder);
            let isviewhistory=folderinfo['history'];
            let history_type=folderinfo['history_type'];
            let modalname = folderinfo['modalname'];
            // let jenisdata = folderinfo['upl_datatype'];
            let class_infokewajiban = "infohistory_"+modalname;
            console.log(modalname);
    
            viewketerangan_upload(namafolder,class_infokewajiban);
    
            if(isviewhistory){
              // jika folder menampilkan history default
              if(history_type=="default"){

                tampilhistoryfolder(namafolder,idDEC,'ALL','generalupload');
                $('.historymodal_generalupload').modal('show');

              }else if(history_type=="custom"){

                $('.historymodal_'+modalname).modal('show');

              }
              
    
            }else{

              if(history_type=="custom"){

                $('.historymodal_'+modalname).modal('show');

              }
    
            }
    
            // MENGGANTI JUDUL MODAL SESUAI DENGAN NAMA FOLDER YANG BERKAITAN
            $('#titlehistory_'+modalname).empty().append(namafolder);
    
            
      }else{
            folderupload_type='general';
    
            // MENGGANTI JUDUL MODAL SESUAI DENGAN NAMA FOLDER YANG BERKAITAN
            $('#titlehistory_generalupload').empty().append(namafolder);

            // FUNGSI UNTUK MEMBUKA MODAL GENERAL
            $('.historymodal_generalupload').modal('show');
            tampilhistoryfolder(namafolder,idDEC,'ALL','generalupload');
 
            let class_infokewajiban = "infohistory_generalupload";
            viewketerangan_upload(namafolder,class_infokewajiban);
    
      }
    
      // console.log(isunique);
    }




// >>>> FUNGSI UNTUK MEMBUKA MODAL UPLOAD DI SETIAP FOLDER
    /** Pengaturan dilihat dari array uniquemodal */

function handler_openmodal(namafolder){
  
  let upper_namafolder=namafolder.toUpperCase();
  let isunique = uniquemodal.some(o => o.foldername === upper_namafolder);
  let isrunfunction= runcustomfunc.some(o => o.foldername === upper_namafolder && o.function!=='none');
  console.log(isrunfunction);
  if(isunique){
        // JIKA MODAL BUKAN MODAL GENERAL (FOLDER MEMILIKI MODAL SENDIRI)
        folderupload_type='unique';
        let folderinfo = uniquemodal.find(o => o.foldername === upper_namafolder);
        let isviewhistory=folderinfo['history'];
        let modalname = folderinfo['modalname'];
        let jenisdata = folderinfo['upl_datatype'];
        let class_infokewajiban = "info_"+modalname;
        console.log(modalname);

        viewketerangan_upload(namafolder,class_infokewajiban);

        if(isviewhistory){
          // jika folder membutuhkan untuk menampilkan history upload
          // menampilkan history pada modal unik
          let tbhistoryclass="history_"+modalname;
          tampilhistoryupl(namafolder,idDEC,'ALL',modalname);

        }else{

        }

        // MEMUNCULKAN INPUT FILE/LINK BESERTA TOMBOL UBAH JENIS DATA UPLOAD SESUAI KEBUTUHAN
        if(jenisdata!=="none"){

          drawer_inputupload(modalname,jenisdata)
        }

        if(isrunfunction){
          console.log('run function')
          let runfunction=runcustomfunc.find(o => o.foldername === upper_namafolder);
          runfunction['function']();
        }
        


        // MENGGANTI JUDUL MODAL SESUAI DENGAN NAMA FOLDER YANG BERKAITAN
        $('#titletxt_'+modalname).empty().append(namafolder);

        // menampilkan modal berdasarkan nama modal (dari array uniquemodal)
        $('.'+modalname).modal('show');

        console.log(folderinfo['modalname']);
  }else{
        folderupload_type='general';

        // MENGGANTI JUDUL MODAL SESUAI DENGAN NAMA FOLDER YANG BERKAITAN
        $('#titletxt_generalupload').empty().append(namafolder);

        // MEMUNCULKAN INPUT FILE/LINK BESERTA TOMBOL UBAH JENIS DATA UPLOAD SESUAI KEBUTUHAN
        drawer_inputupload('generalupload',['file','link','folder_sharing']);

        // FUNGSI UNTUK MEMBUKA MODAL GENERAL
        $('.generalupload').modal('show');
        tampilhistoryupl(namafolder,idDEC,'ALL','generalupload');

        

        let class_infokewajiban = "info_general";
        viewketerangan_upload(namafolder,class_infokewajiban);

  }

  // console.log(isunique);
}



// >>>> FUNGSI MEMUNCULKAN INPUT FILE/LINK DI MODAL BERDASARKAN KEBUTUHAN FOLDER
    /** 
     * penentu folder upload file, link atau keduanya diambil dari array uniquemodal
     * untuk folder yang memiliki multi-type tidak masuk fungsi ini --> ada fungsi sendiri
     */
function drawer_inputupload(modalname,jenisupl){

  let typesetting={
    'file':[{'text':'file'}],
    'folder_sharing':[{'text':'folder sharing'}],
    'link':[{'text':'link'}],
  };
  console.log(jenisupl[2]);

    let banyakjenis = jenisupl.length;
    let dropdownstring="";
    for(let y=0;y<banyakjenis;y++){

        if(y===0){
          dropdownstring+=`
          <div class="item active selected" data-value="`+jenisupl[y]+`">
            `+typesetting[jenisupl[y]][0]['text']+`
          </div>
          `;
        }else{
          dropdownstring+=`
          <div class="item" data-value="`+jenisupl[y]+`">
            `+typesetting[jenisupl[y]][0]['text']+`
          </div>
          `;

        }

    }

    let namaclass_input="inputupload_"+modalname;
    let id_tableupload="table_inputupload_"+modalname;
    let id_spaninput="jenisupl_"+modalname;
    // let namaclass_ubah=""
    console.log("id_tableupload->>"+id_tableupload)
    console.log("jenisupl->>"+jenisupl[0])
    let html_inputupload_file=`
        <tr>
            <td>
                <span id="`+id_spaninput+`">
                  <div class="ui input fluid small " style="margin-bottom:5px;">
                  
                  <input type="file" id="`+namaclass_input+`" inputtype="file" modalname='`+modalname+`'>
                  
                  </div>
                  <a class="ui label labelwarning">
                  <i class="ui info icon"></i>
                    ukuran maksimal 10mb

                  </a>
                </span>
            </td>
        </tr>
    `;

    let html_inputupload_link=`
        <tr>
            <td>

              <span id="`+id_spaninput+`">
                <div class="ui input fluid small">
                  <input id="`+namaclass_input+`" type="text" id="2" inputtype="link" placeholder="Cantumkan lengkap beserta http:// atau https:// - nya.">
                </div>
              </span>

            </td>
        </tr>
    `;

    let html_inputupload_foldersharing=`
        <tr>
            <td>

              <span id="`+id_spaninput+`">
                <div class="ui input fluid small">
                  <input id="`+namaclass_input+`" type="text" inputtype="foldersharing" placeholder="alamat folder sharing" value="file:\\\\">
                </div>
              </span>

            </td>
        </tr>
    `;

    let html_btnubahjenis=`
        <tr>
            <td id="">
              Jenis data:
              <div class="ui labeled icon dropdown button dropdownjenis" id="linkbtn1" modalname='`+modalname+`'>
                <i class="dropdown icon"></i>
                <span class="text">jenis data</span>
                <div class="menu">
                  `+dropdownstring+`
                </div>
              </div>

            </td>
        </tr>
    `;

    $('#'+id_tableupload).find('tbody').empty();
    
    if(jenisupl[0]==="folder_sharing"){
      btnstate="folder_sharing";
      console.log("masuk both")
      $('#'+id_tableupload).find('tbody').append(html_btnubahjenis+html_inputupload_foldersharing);

    }else if(jenisupl[0]==="link"){
      btnstate="link";

      $('#'+id_tableupload).find('tbody').append(html_btnubahjenis+html_inputupload_link);

    }else if(jenisupl[0]==="file"){
      btnstate="file";

      $('#'+id_tableupload).find('tbody').append(html_btnubahjenis+html_inputupload_file);
    }

    $(".ui.dropdown.dropdownjenis").dropdown().dropdown('set selected', jenisupl[0]).dropdown({
      showOnFocus: false,
      onChange: function(value){
        console.log(value);

        
        let namamodal=$(this).attr('modalname');
        console.log(namamodal);
        let namaclass_input="inputupload_"+namamodal;

          if(value=="file"){
      
              document.getElementById("jenisupl_"+namamodal).innerHTML = `
                <div class="ui input fluid small" style="margin-bottom:5px;">
                  <input type="file" id="`+namaclass_input+`" inputtype="file" modalname='`+modalname+`'>
                  
                </div>
                <a class="ui label labelwarning">
                  <i class="ui info icon"></i>
                    ukuran maksimal 10mb

                  </a>
              `;
          
              btnstate=value;
          }else if(value=='link'){
              document.getElementById("jenisupl_"+namamodal).innerHTML = `
                <div class="ui input fluid small">
                  <input id="`+namaclass_input+`" modalname='`+modalname+`' type="text" id="2" inputtype="link" placeholder="Cantumkan lengkap beserta http:// atau https:// - nya.">
                </div>
              `;
              btnstate=value;
              // $("#btntxt").text("Gunakan Link");
              
              console.log($(this));
          }else if(value="folder_sharing"){
              document.getElementById("jenisupl_"+namamodal).innerHTML = `
                <div class="ui input fluid small">
                  <input id="`+namaclass_input+`" type="text" modalname='`+modalname+`' inputtype="foldersharing" placeholder="alamat folder sharing1" value="file:\\\\">
                </div>
              `;
              btnstate=value;
          // $("#btntxt").text("Gunakan Link");
              
              // console.log($(this));

          }
      
          console.log("btnstate->>"+btnstate);
      }

    });
    // $('.dropdownjenis').dropdown({
      
    // })

}
// 
// ===========


// TOMBOL KETERANGAN KEWAJIBAN UPLOAD

$(document).on('click', '.wajibcolor', function(){

  // $('.kewajibanmodal').modal('show');
  var lokasifolder = $(this).closest("tr").find("td:first-child").text();
  $('#cekwajibid').checkbox('set checked');
  $('#lokasiinput').val(lokasifolder);
  console.log(lokasifolder);
  $('.kewajibanmodal').modal('show');
});


$(document).on('click', '.delmpl', function(){

  let delid=$(this).attr('delid');
  let deskripsi=$(this).attr('datadesc');
  let dataDN=$(this).attr('dataDN');
  Swal.fire({
    title: '<h2>Hapus data mpl ini?</h2>',
    text: "DATA: "+deskripsi+" pada DN: "+dataDN,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Ya'
    }).then((result) => {

      delete_mplfunc(delid);
    })
  
});

$(document).on('click', '.nowajibcolor', function(){

  // $('.kewajibanmodal').modal('show');
  var lokasifolder = $(this).closest("tr").find("td:first-child").text();
  $('#cekwajibid').checkbox('set unchecked');
  $('#lokasiinput').val(lokasifolder);
  
  console.log(lokasifolder);
  $('.kewajibanmodal').modal('show');
  viewketerangan(lokasifolder);
});


$(document).on('click', '.deletesubprod', function(){

  // $('.kewajibanmodal').modal('show');
  var id_dvl=$(this).attr('iddvl');
  var del_type=$(this).attr('deltype');
  var nama =$(this).attr('namadvl');

  Swal.fire({
    title: '<h2>Hapus sub kategori ini?</h2>',
    text: "DATA: "+nama,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Ya'
    }).then((result) => {

      deletesub(id_dvl,del_type);
    })
});



// MENYIMPAN SETTING KEWAJIBAN FILE
$('#saveketerangan').on('click', function() {

  

  console.log($('.cekwajib').checkbox('is checked'));

  // cek apakah checkbox kewajiban checked atau tidak
  var statuswajib=$('.cekwajib').checkbox('is checked');
  if(statuswajib){

    // Swal.fire({
    //   title:"Setting tersimpan",
    //   text: "",  
    //   timer: 1500,
    //   icon: 'success',
    //   showConfirmButton: false
    // });
    savekewajiban($('#lokasiinput').val(),"wajib");

  }else{

    var keterangan=$('#keterangantxt1').val();
    if(keterangan==""){
      Swal.fire({
        title: "keterangan tidak boleh kosong",
        text: "",
        icon: 'error',
        showCancelButton: false,
        confirmButtonText: 'Ya',
        });
    }else{
      savekewajiban($('#lokasiinput').val(),"tidakwajib");
    }

  }
});


$(document).on('click', '.filespec', function(){
  window.open("./_js/docmgt/TEST-FILE.pdf");
});

$('#EditHeader').on('click', function() {
  // window.location.href = "./?link=mechdocreg&c=edit";
  console.log(idDEC);
  
    let encryption = new Encryption();
    // var idENC = encryption.encrypt(toString(idDEC), NonceValue);
    
    window.location.href = "./?link=mechdocreg&i="+idENC;
});
 
$('.tabuserguide').on('click', function() {
  window.location.href = "./?link=guidemecdoc";
});
$('.tabsuratgolive').on('click', function() {
  window.location.href = "./?link=golivemecdoc";
});
$('.tabhasilmonitoring').on('click', function() {
  window.location.href = "./?link=monitormecdoc";
});
$('.tabversion').on('click', function() {
  window.location.href = "./?link=versionhistory&app=DMN";
});



// $('.filedraw').on('click', function() {

//   window.open("./_js/docmgt/TEST-FILE.pdf");
// })


// KLIK TOMBOL UNTUK MENAMBAH KATEGORI DAN SUB KATEGORI
$('.addkategoribtn').on('click', function() {

let type=$(this).attr('typebutton');
let idtype=$(this).attr('idtype');

if(type!=""){

  var id_kategorikpi=$('.ui.dropdown.kategoriKPI2.'+type+'').dropdown('get value');
  var id_subkategori=$('.ui.dropdown.subKPI2.'+type+'').dropdown('get value');
  var namasub=$('.ui.dropdown.subKPI2.'+type+'').dropdown('get text');
  console.log(id_kategorikpi);
  
    addkategorifunc(id_kategorikpi,id_subkategori,idtype,namasub);

}


  
});

// FUNGSI UNTUK MENGGANTI ISI DROPDOWN SUB KATEGORI KETIKA DROPDOWN KATEGORI DIGANTI

$(".kategoriKPI2").on("change", function(){
  
  var valuekategori=$(this).find(":selected").val();
  var typedrop=$(this).find("select").attr('datatype');
  console.log(typedrop);

// MEMANGGIL FUNGSI UNTUK MENGGANTI DROPDOWN SUB KATEGORI

  gantisub(valuekategori,typedrop);

//   if(kategorikpi2=="EKSTERNAL"){
//     $('.subKPI2')
//   .find('option')
//   .remove()
//   .end()
  
  
// ;
//   }
});



// TOMBOL FOLDER


$(".filebtn").on("click", function(){
  
  console.log($(this).closest('table').attr('id'));
  var loc=$(this).closest('table').attr('id');
  var namafolder=$(this).text();
  $("#nama_folder").val(namafolder);
  console.log(namafolder);
  // $('.historymodal').modal('show');

  handler_openfolder_history(namafolder);
  if(loc=="table_input"){
      $('.historyhead').removeClass('th_designoutput');
      $('.historyhead').addClass('th_designinput');
  }else{
      $('.historyhead').addClass('th_designoutput');
      $('.historyhead').removeClass('th_designinput');
  }
  // $('#titletxt').text($(this).text());
  
  
});


// SETTING OTOMATIS CHECKBOX WAJIB UPLOAD
$('.wajibcek').prop('checked', true);

function wajibchange(checkboxElem){

  if (checkboxElem.checked) {
    $('.keteranganwajib').html(`
    
    `)
  }else{
    $('.keteranganwajib').html(`
    
          <table width="100%">
            <tr>
              <td>
                <b>KETERANGAN:</b>
              </td>
            </tr>
            <tr>
              <td>
                <div class="ui form fluid small right icon">
                <div class="ui field fluid">
                    <textarea rows="2" id="keterangantxt1" class="mandatoryclass" placeholder="isi keterangan  folder dijadikan tidak wajib disini"></textarea>
                </div>
                </div>
              </td>
            </tr>
          </table>
            
            

           
    `)
  }

}






 // --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 1. MENAMPILAKAN DATA KEWAJIBAN UPLOAD

function getkewajiban(){
  
  
  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_viewstatuskewajiban`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register: idDEC,
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
        console.log('Gagal tampil, data kosong');
        
        
        } else if(obj.status==false) {
        // tableType();
        var cekspan= document.getElementsByClassName("nowajibcolor").length;

        if(cekspan>0){
          console.log("masukganti2")
          $('.nowajibcolor').text('wajib');
          $('.nowajibcolor').addClass("wajibcolor");
          $('.nowajibcolor').removeClass("nowajibcolor");
        }
        
        
        console.log("tidak ada data kewajiban pada header ini")
        
        } else {
          var cekspan= document.getElementsByClassName("nowajibcolor").length;

        if(cekspan>0){
          console.log("masukganti")
          $('.nowajibcolor').text('wajib');
          $('.nowajibcolor').addClass("wajibcolor");
          $('.nowajibcolor').removeClass("nowajibcolor");
        }
          console.log(obj[0]['nama_folder']);
          banyakdata=obj.length;

          for(var z=0;z<banyakdata;z++){
            
            var carispan=$(".tbupload td:insensitivecontains("+obj[z]['nama_folder']+")").next().find('span:first');
          carispan.text("tidak wajib");
          carispan.removeClass("wajibcolor");
          carispan.addClass("nowajibcolor");

          }
          
          
          // console.log($(".tb_designinput td:contains("+"Drawing Art"+")").next().find('span:first').text("tidak wajib"));
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  
        
  
  
      
      
  });
  
}




 // --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 1. MENAMPILAKAN DATA UPLOAD TERAKHIR PADA SETIAP FOLDER

function view_lastuploaded(){
  
  $('.filefield').empty();
  $('.tdrevisi').empty();
  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}view_lastuploaded`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register: idDEC,
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
        console.log('Gagal tampil, data kosong');
        
        
        } else if(obj.status==false) {
        
        
        } else {
          
        
          banyakdata=obj['list_folder'].length;
          console.log(banyakdata);

          for(var z=0;z<banyakdata;z++){
            let namafolder=obj['list_folder'][z];
            // console.log(namafolder);
            var carispan=$(".tbupload td:insensitivecontains("+obj['list_folder'][z]+")").filter(function(){
              // console.log($(this).text());
              return $(this).text().toUpperCase() === obj['list_folder'][z];
            }).next().next().next();
            var tdrevisi=$(".tbupload td:insensitivecontains("+obj['list_folder'][z]+")").filter(function(){
              // console.log($(this).text());
              return $(this).text().toUpperCase() === obj['list_folder'][z];
            }).next().next().next().next().empty().html(obj['data'][namafolder]['revisi']);
            let jenisdata=obj['data'][namafolder]['jenis'];

            if(jenisdata=='FILE'){
              carispan.html(`
                <a href='../RND_Upload/`+obj['data'][namafolder]['file']+`' target='_blank'>
                `+obj['data'][namafolder]['file_ori']+`

                </a>
          
              `);

            }else if(jenisdata=='LINK'){
              carispan.html(`
                <a href='`+obj['data'][namafolder]['file']+`' target='_blank'>
                `+obj['data'][namafolder]['file_ori']+`

                </a>
          
              `);

            } else if(jenisdata=='FOLDER_SHARING'){

              carispan.html(`
              <span class='text_history copyalamat iconcoloredit' alamat="`+obj['data'][namafolder]['file_ori']+`" data-content="klik untuk salin" data-position="bottom center" >`+obj['data'][namafolder]['file_ori']+`&nbsp; </span>
          
              `);

              $('.copyalamat')
                .popup({
                  // position: 'top left'
                  // inline: true
                });
              
            } else if(jenisdata=="TEXT"){

              carispan.html(`
              <span class='text_normal' data-content="tekan tombol upload/nama folder untuk melihat data" data-position="bottom center">`+obj['data'][namafolder]['file_ori']+`&nbsp; </span>
          
              `);

              $('.text_normal')
                .popup({
                  // position: 'top left'
                  // inline: true
                })
              ;

            }
          
          // carispan.removeClass("wajibcolor");
          // carispan.addClass("nowajibcolor");

          }
          
        
        
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  
        
  
  
      
      
  });
  
}

// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 2. MENYIMPAN SETTING KEWAJIBAN UPLOAD

function savekewajiban(namafolder,state){
  console.log("masuk")

  if(state=="wajib"){

    var kewajiban="wajib";
    var keterangan="";
  }else{
    var keterangan=$('#keterangantxt1').val();
    var kewajiban="tidak_wajib";
  }
  
  

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}statuskewajiban`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register : idDEC,
            kewajiban : kewajiban,
            keterangan : keterangan,
            namafolder : namafolder,
            user : userName1,
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        // tableType();

        Swal.fire({
          title: obj.message,
          text: "",
          icon: 'error',
          showCancelButton: false,
          confirmButtonText: 'Ya',
          });

        console.log("tidak ada data kewajiban pada header ini")
        
        } else {
          getkewajiban();
        
          $('.kewajibanmodal').modal('hide');
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}


// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 3. TAMPIL DATA KETERANGAN PER FOLDER --> UNTUK FIELD ISI KETERANGAN

function viewketerangan(namafolder){
  console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_viewfolderketerangan`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register : idDEC,
            namafolder : namafolder,
            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        // tableType();

        Swal.fire({
          title: obj.message,
          text: "",
          icon: 'error',
          showCancelButton: false,
          confirmButtonText: 'Ya',
          });

        
        } else {
          
          $('#keterangantxt1').val(obj[0]['keterangan']);
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}



// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 3. TAMPIL DATA KETERANGAN PER FOLDER --> UNTUK INFO DI MODAL UPLOAD

function viewketerangan_upload(namafolder,namaclass){
  console.log(namaclass)
  $('#infogeneral').empty();
  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_viewfolderketerangan`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register : idDEC,
            namafolder : namafolder,
            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
          $('.'+namaclass).empty();
        
        } else if(obj.status==false) {
        // tableType();
        $('.'+namaclass).empty();
        // Swal.fire({
        //   title: obj.message,
        //   text: "",
        //   icon: 'error',
        //   showCancelButton: false,
        //   confirmButtonText: 'Ya',
        //   });

        
        } else {
          console.log('test info')

          $('.'+namaclass).empty().html(`

            <div class="ui tiny warning fluid message">
              
              <div class="header">
                Keterangan Tidak Wajib Upload
              </div>
              `+obj[0]['keterangan']+`
              </div>
          `);
          
          // $('#keterangantxt1').val(obj[0]['keterangan']);
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}

// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 4 FUNGSI UPLOAD FILE KETIKA TEKAN TOMBOL UPLOAD FILE

$('.saveuploadbtn').on('click', function() {

  // UNTUK KEPERLUAN MENGETAHUI BUTTON UNTUK TYPE MFG MANA
  // JIKA YANG BUKAN BERUPA MULTITYPE --> TYPEBTN='ALL'
  var typebtn=$(this).attr('btntype');
  var idtypebtn=$(this).attr('idtype');
  let namamodal=$(this).attr('modalname');
  var foldername=$("#nama_folder").val();
  let class_tbhistory="history_"+namamodal;
  console.log(btnstate);
  if(typebtn=="ALL"){
    var statebtn=btnstate;
  }else{
    // UNTUK UPLOAD DI DVR
    // HANYA BISA BERUPA LINK, DAN UPLOAD DIPISAH BERDASARKAN TIPE
    var statebtn="link";
  }
  

  if(statebtn=='file'){
    var fileupload = $('#inputupload_'+namamodal).prop("files")[0];
    var linkfile="";
  }else{
    var fileupload = "";
    // var linkfile = $('#uploadlinkdoc').val();
    if(typebtn=="ALL"){
      var linkfile = $('#inputupload_'+namamodal).val();
  }else{
    // UNTUK DVR YANG BISA UPLOAD FILE SAJA
    var linkfile = $('.uploadfileclass.'+typebtn+'').val();
  }
  }

  if(foldername==""||foldername==null){
  // error ketika foldername kosong --> kesalahan coding
  }else{

    var dataupload = new FormData();
    
    dataupload.append("file", fileupload);
    dataupload.append("linkfile", linkfile);
    dataupload.append("typesupply", idtypebtn);
    dataupload.append("jenis", statebtn);
    dataupload.append("namafolder", foldername);
    dataupload.append("id_register", idDEC);
    dataupload.append("user", userName1);
    console.log(dataupload);
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}upload_headerfile1`,
        processData: false,
        contentType: false,
        cache:false,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:dataupload,
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
          view_lastuploaded();
        
        } else if(obj.status==false) {
        // tableType();
          
        Swal.fire({
          title: obj.message,
          text: "",
          icon: 'error',
          showCancelButton: false,
          confirmButtonText: 'Ya',
          });
          view_lastuploaded();
        
        } else {

          Swal.fire({
            text: 'berhasil menyimpan '+statebtn+'',
            timer: 2500,
            position: 'top-right',
            toast: true,
            showConfirmButton: false
            })
          
          tampilhistoryupl(foldername,idDEC,idtypebtn,namamodal);
          
          if(typebtn=="ALL"){
            $('#inputupload_'+namamodal).val("");
          }else{
            // UNTUK DVR YANG BISA UPLOAD FILE SAJA
            $('.uploadfileclass.'+typebtn+'').val("");
          }

          view_lastuploaded();
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });

  }

});


// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 5 TAMPIL DATA KETERANGAN PER FOLDER

function tampilhistoryupl(namafolder,idproject,typebtn,namamodal){
  console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_viewuploadheader`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register : idDEC,
            namafolder : namafolder,
            typesupply : typebtn,
            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        // tableType();

        console.log(obj.message);
        let strselector="";
        if(typebtn=="ALL"){
          strselector=".history_"+namamodal;
        }else{
          strselector=".history_"+namamodal+"."+typebtn+"idtype";
        }
        $(strselector).find('tbody').empty();

        $(strselector).find('tbody').append(`
            <tr>
                <td colspan='4' style="text-align:center;">
                tidak ada link/file tersimpan
                </td>

                
                
            </tr>
          `);
          console.log("[kosong]class selector->"+strselector);
        // Swal.fire({
        //   title: obj.message,
        //   text: "",
        //   icon: 'error',
        //   showCancelButton: false,
        //   confirmButtonText: 'Ya',
        //   });

        
        } else {

          // SELECTOR TABEL HISTORY
          // KALAU MULTITYPE, TIAP HISTORY TABLE MEMILIKI KELAS SPESIFIK SESUAI TIPE
          let strselector="";
          if(typebtn=="ALL"){
            strselector=".history_"+namamodal;
          }else{
            strselector=".history_"+namamodal+"."+typebtn+"idtype";
          }
          console.log("class selector->"+strselector);

          $(strselector).find('tbody').empty();
          var banyakhistory=obj['data'].length;

          for(var a=0;a<banyakhistory;a++){
            
            let islastfile=false;
            let islink=false;
            let string_data_history="";
            var jenisdata = obj['data'][a]['jenis'];
            console.log(jenisdata);
            var strpath="";
            if(jenisdata=="LINK"){

              islink=true;
              strpath=obj['data'][a]['file'];
              var namafile= obj['data'][a]['file'];

            }else if(jenisdata=="FILE"){

              islink=true;
              strpath=`../RND_Upload/`+obj['data'][a]['file'];
              // var namafile= obj[a]['file'].substring(obj[a]['file'].lastIndexOf('/') + 1);
              var namafile=obj['data'][a]['file_ori'];

            }else if(jenisdata=="FOLDER_SHARING"){
              
              islink=false;
              var namafile=obj['data'][a]['file_ori'];
            }

            console.log(strpath);

            // cek apakah merupakan revisi terakhir atau tidak
            console.log(obj['lastfile'][namafile]);
            if(obj['lastfile'][namafile][0]===obj['data'][a]['revisi']){
              islastfile=true;
            }else{
              islastfile=false;
            }

            if(islastfile){
              console.log("islast");
              var delbtn="<i class='trash deletefile iconcolorcross icon' directory='"+obj['data'][a]['file']+"' idproject='"+obj['data'][a]['id_register']+"' typebtn='"+typebtn+"' folder='"+obj['data'][a]['nama_folder']+"' rev='"+obj['data'][a]['revisi']+"' namamodal='"+namamodal+"'></i>";
            }else{
              var delbtn="";
            }

            if(islink){

              string_data_history=`
                <a href="`+strpath+`" target='linktabhandler'>`+namafile+`</a>
              `

            }else{

              string_data_history=`
                <span class='text_history iconcoloredit copyalamat' alamat="`+namafile+`">`+namafile+`&nbsp; </span>
              `

            }

            // <button class="ui labeled icon tiny button copyalamat" alamat="`+namafile+`">
            //       <i class="copy outline icon"></i>
            //       copy
            //     </button>

          $(strselector).find('tbody').append(`
            <tr>
                <td style="text-align:center;">
                `+obj['data'][a]['created_date']+`
                </td>

                <td style="text-align:center;" class='cuttext'>
                `+string_data_history+`
                </td>

                <td style="text-align:center;" width='10%'>
                `+obj['data'][a]['revisi']+`
                </td>
                
                <td style="text-align:center;" width='5%'>
                `+delbtn+`
                
                </td>
                
            </tr>
          `);
          
          }
          
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}


// >>>> FUNGSI COPY TEXT KE CLIPBOARD (ALAMAT FOLDER SHARING)
// 
$(document).on('click','.copyalamat',function(){
  let btntext=$(this).attr('alamat');
  // navigator.clipboard.writeText(btntext).then(function() {
  //   console.log('Async: Copying to clipboard was successful!');
  // }, function(err) {
  //   console.error('Async: Could not copy text: ', err);
  // });

  var $temp = $("<input>");
    $("body").append($temp);
    $temp.val(btntext).select();
    document.execCommand("copy");
    

    Swal.fire({
      text: 'Alamat berhasil disalin (alamat: '+$temp.val()+')',
      timer: 2000,
      position: 'center',
      toast: true,
      showConfirmButton: false
      })

      $temp.remove();

});
// 
// END OF FUNGSI COY
// ==========================================================================





// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 5 TAMPIL DATA KETERANGAN PER FOLDER

function tampilhistoryfolder(namafolder,idproject,typebtn,namamodal){
  console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_viewuploadheader`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            id_register : idDEC,
            namafolder : namafolder,
            typesupply : typebtn,
            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        // tableType();

        console.log(obj.message);
        let strselector="";
        if(typebtn=="ALL"){
          strselector=".historyfolder_"+namamodal;
        }else{
          strselector=".historyfolder_"+namamodal+"."+typebtn+"idtype";
        }
        $(strselector).find('tbody').empty();

        $(strselector).find('tbody').append(`
            <tr>
                <td colspan='3' style="text-align:center;">
                tidak ada link/file tersimpan
                </td>

                
                
            </tr>
          `);
          console.log("[kosong]class selector->"+strselector);
        // Swal.fire({
        //   title: obj.message,
        //   text: "",
        //   icon: 'error',
        //   showCancelButton: false,
        //   confirmButtonText: 'Ya',
        //   });

        
        } else {

          // SELECTOR TABEL HISTORY
          // KALAU MULTITYPE, TIAP HISTORY TABLE MEMILIKI KELAS SPESIFIK SESUAI TIPE
          let strselector="";
          if(typebtn=="ALL"){
            strselector=".historyfolder_"+namamodal;
          }else{
            strselector=".historyfolder_"+namamodal+"."+typebtn+"idtype";
          }
          console.log("class selector->"+strselector);

          $(strselector).find('tbody').empty();
          var banyakhistory=obj['data'].length;

          for(var a=0;a<banyakhistory;a++){
            
            let islastfile=false;
            let islink=false;
            let string_data_history="";
            var jenisdata = obj['data'][a]['jenis'];
            console.log(jenisdata);
            var strpath="";
            if(jenisdata=="LINK"){
              strpath=obj['data'][a]['file'];
              var namafile= obj['data'][a]['file'];
              islink=true;

            }else if(jenisdata=="FILE"){
              strpath=`../RND_Upload/`+obj['data'][a]['file'];
              // var namafile= obj[a]['file'].substring(obj[a]['file'].lastIndexOf('/') + 1);
              var namafile=obj['data'][a]['file_ori'];
              islink=true;

            }else if(jenisdata=="FOLDER_SHARING"){
              
              islink=false;
              var namafile=obj['data'][a]['file_ori'];
            }
            console.log(strpath);

            if(islink){

              string_data_history=`
                <a href="`+strpath+`" target='linktabhandler'>`+namafile+`</a>
              `

            }else{

              string_data_history=`
                <span class='text_history iconcoloredit copyalamat' alamat="`+namafile+`">`+namafile+`&nbsp; </span>
              `

            }

          $(strselector).find('tbody').append(`
            <tr>
                <td style="text-align:center;">
                `+obj['data'][a]['created_date']+`
                </td>

                <td style="text-align:center;">
                `+string_data_history+`
                </td>

                <td style="text-align:center;" width='10%'>
                `+obj['data'][a]['revisi']+`
                </td>
                
                
                
            </tr>
          `);
          
          }
          
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}



// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 6 DELETE FILE

$(document).on('click','.deletefile', function() {
  
  let foldername=$(this).attr("folder");
  let directory=$(this).attr("directory");
  let id_project=$(this).attr("idproject");
  let revisi =$(this).attr("rev");
  let typebtn=$(this).attr("typebtn");
  let namamodal=$(this).attr("namamodal");

  Swal.fire({
      title: '<h2>Hapus data ini?</h2>',
      text: "",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Ya'
    }).then((result) => {
    if (result.value) {

      if(foldername==""||foldername==null){
        // error ketika foldername kosong --> kesalahan coding
        console.log("nofolder");
        }else{
      
          $.ajax({
            type    : "POST",
            url     : `${restlocdocmgmt}delete_uploadheader`,
            headers : {
              user  : vusrnm,
              token : vtoken
            },
            data: {
              nama_folder  : foldername,
              directory: directory,
              id_project:id_project,
              user:userName1,
              revisi:revisi
            },
            cache: false,
            success: function (response){
              var obj = JSON.parse(response);
              // console.log(obj);
              if(isEmpty(obj)) {
                console.log('Gagal Hapus mas brooo, data kosong');
              } else if(obj) {
                if (obj.status == false){
                  
                  Swal.fire({
                    text: obj.message,  
                    timer: 1500,
                    icon: 'warning',
                    showConfirmButton: false
                  });
                  view_lastuploaded();
      
                } else {

                  Swal.fire({
                    text: "Sukses menghapus data",  
                    timer: 1500,
                    icon: 'success',
                    showConfirmButton: false
                  });
      
                  tampilhistoryupl(foldername,idDEC,typebtn,namamodal);
                  view_lastuploaded();
             
               }
              } else {
                Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
              }
            },
            error: function () {
              if (LogoutProtect){
                window.location.href = "./?link=loclogout";
              } else {
                Swal.fire("Error", "Server tidak merespon, segera hubungi Administrator di ext. 3553 !","error" );
              }
      
            },
          });
      
        }
        
    }
    });
  

  

});


// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 3. TAMPIL DATA KETERANGAN PER FOLDER
// addkategorifunc(id_kategorikpi,id_subkategori,type,namasub);
function addkategorifunc(id_kategori,id_subkategori,idtype,namasub){
  // console.log("masuk")
  console.log(id_kategori);
  console.log(id_subkategori);
  console.log(idtype);
  console.log(namasub);
  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}create_dvl`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            idregister : idDEC,
            idtype : idtype,
            idkategorikpi : id_kategori,
            idsubkategorikpi :id_subkategori,
            namasub:namasub

            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        // tableType();

        Swal.fire({
          title: obj.message,
          text: "",
          icon: 'error',
          showCancelButton: false,
          confirmButtonText: 'Ya',
          });
          view_lastuploaded();
        
        } else {
          Swal.fire({
            text: 'berhasil menambahkan sub kategori kedalam kategori',
            timer: 2500,
            position: 'top-right',
            toast: true,
            showConfirmButton: false
            })
          view_lastuploaded();
          tampilmultitype(idtype)
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}

// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 3. MENAMPIL
// addkategorifunc(id_kategorikpi,id_subkategori,type,namasub);


function tampilmultitype(type){
  // console.log("masuk")
  view_lastuploaded();

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_dvl`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            idregister : idDEC,
            typemfgsupply : type,

            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {

          $('.td-0-'+type+'').empty();
          $('.td-1-'+type+'').empty();
          $('.td-2-'+type+'').empty();
          // $('.td_penilaian').html(obj.message);
          
        // tableType();

        // Swal.fire({
        //   title: obj.message,
        //   text: "",
        //   icon: 'error',
        //   showCancelButton: false,
        //   confirmButtonText: 'Ya',
        //   });

        
        } else {
          
          $('.td-0-'+type+'').empty();
          $('.td-1-'+type+'').empty();
          $('.td-2-'+type+'').empty();
          $('.td_penilaian').empty();

          let datakpi=obj;

          for(var itemkpi in datakpi){
            $('.td_penilaian.'+itemkpi).empty();

            var tdcounter=0;
          
            var categories = Object.keys(obj[itemkpi]);
            console.log(categories);
            var panjangarr=categories.length;
            console.log(categories);
            for(var a=0; a<panjangarr ; a++){
                var stringsub="";
                var tablestring="";
                var totalvalue=0;
                console.log("#"+categories[a]+"-"+type);
                var idtable =categories[a]+"-"+type;
                var idtableedited2 = idtable.replace(/\ /g,"_");
                var idtableedited =idtableedited2.replace(/&/g,"and");
              // CEK APAKAH TABEL SUDAH ADA TERGAMBAR
              if($("#"+idtableedited).length) {
                // JIKA TABEL ADA
  
                
  
              } else{
              // JIKA TABEL BELUM ADA
                
                console.log(obj[itemkpi][categories[a]]);
                var subcategories=obj[itemkpi][categories[a]];
                var banyaksub=subcategories.length;
                
  
                for(var b=0;b<banyaksub;b++){
                  // PERULANGAN UNTUK MEMBUAT BARIS SUB KATEGORI
                  console.log(subcategories[b]);
                  stringsub+=`
                  <tr>
                      <td width="50%">
                      `+subcategories[b]['Nama Sub Kategori']+`
                      </td>
  
                      <td width="40%">
                      <div class="ui left input fluid small">
                        <input type="number" id="`+subcategories[b]['id_dvl']+`_in" dataiddvl="`+subcategories[b]['id_dvl']+`" style="text-transform: uppercase" class="mandatoryclass subinput `+type+`idtype" placeholder="" min="0" value="`+subcategories[b]['value']+`">
                        </div>
                      </td>
  
                      
                      <td width="5%">
                      
                      <i class='trash deletesubprod iconcolordelete icon'  iddvl='`+subcategories[b]['id_dvl']+`' deltype='`+type+`' namadvl='`+subcategories[b]['Nama Sub Kategori']+`'></i>
  
                      </td>
                      
                    </tr>
                  `;
  
                  totalvalue+=parseInt(subcategories[b]['value']);
  
                }
  
                // STRING UNTUK TABEL YANG AKAN DIGABUNGKAN DENGAN TR SUB KATEGORI YANG TELAH DIBUAT DIATAS
  
                  tablestring=`
                  <table class="ui small compact striped table single line tb_designoutput" width="100%" id="#`+idtableedited+`">
                  <thead class="historyhead th_designinput">
                    <th colspan="3" width="">`+categories[a]+`</th>
                  </thead>
                  <tbody>
                  <tr>
                      <td width="50%">
                      Total
                      </td>
                      <td>
                        <span id="totaldesign">`+totalvalue+`</span>
                      </td>
                      
                      <td>
                      
                      </td>
                      
                  </tr>
                  
                  `+stringsub+`
                    
                  </tbody>
                  
                </table>
                  `;
  
                  $('.td-'+tdcounter+'-'+type+'-'+itemkpi).append(tablestring);
  
                  if(tdcounter!=2){
                    tdcounter++;
                  }else{
                    tdcounter=0;
                  }
              }
  
  
              
            }

          }

          
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}



// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 3. MENAMPIL
// addkategorifunc(id_kategorikpi,id_subkategori,type,namasub);


function tampilmultitype_folder(type){
  // console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_dvl`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            idregister : idDEC,
            typemfgsupply : type,

            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {

          

        
        } else {
          $('.tdfolder-0-'+type+'').empty();
          $('.tdfolder-1-'+type+'').empty();
          $('.tdfolder-2-'+type+'').empty();
          // $('.td_penilaian_folder').empty();

          let datakpi=obj;

          for(var itemkpi in datakpi){
            $('.td_penilaian_folder.'+itemkpi).empty();
            var tdcounter=0;
          
            var categories = Object.keys(obj[itemkpi]);
            var panjangarr=categories.length;
            console.log(categories);
            for(var a=0; a<panjangarr ; a++){
                var stringsub="";
                var tablestring="";
                var totalvalue=0;
                console.log("#"+categories[a]+"-"+type);
                var idtable =categories[a]+"-"+type;
                var idtableedited2 = idtable.replace(/\ /g,"_");
                var idtableedited =idtableedited2.replace(/&/g,"and")+"_folder";
              // CEK APAKAH TABEL SUDAH ADA TERGAMBAR
              if($("#"+idtableedited).length) {
                // JIKA TABEL ADA
  
                
  
              } else{
              // JIKA TABEL BELUM ADA
                
                console.log(obj[itemkpi][categories[a]]);
                var subcategories=obj[itemkpi][categories[a]];
                var banyaksub=subcategories.length;
                
  
                for(var b=0;b<banyaksub;b++){
                  // PERULANGAN UNTUK MEMBUAT BARIS SUB KATEGORI
                  console.log(subcategories[b]);
                  stringsub+=`
                  <tr>
                      <td width="50%">
                      `+subcategories[b]['Nama Sub Kategori']+`
                      </td>
  
                      <td width="40%">
                      `+subcategories[b]['value']+`
                      </td>
  
                      
                      <td width="5%">
                      
                      
  
                      </td>
                      
                    </tr>
                  `;
  
                  totalvalue+=parseInt(subcategories[b]['value']);
  
                }
  
                // STRING UNTUK TABEL YANG AKAN DIGABUNGKAN DENGAN TR SUB KATEGORI YANG TELAH DIBUAT DIATAS
  
                  tablestring=`
                  <table class="ui small compact striped table single line tb_designoutput" width="100%" id="#`+idtableedited+`">
                  <thead class="historyhead th_designinput">
                    <th colspan="3" width="">`+categories[a]+`</th>
                  </thead>
                  <tbody>
                  <tr>
                      <td width="50%">
                      Total
                      </td>
                      <td>
                        <span id="totaldesign">`+totalvalue+`</span>
                      </td>
                      
                      <td>
                      
                      </td>
                      
                  </tr>
                  
                  `+stringsub+`
                    
                  </tbody>
                  
                </table>
                  `;
  
                  $('.tdfolder-'+tdcounter+'-'+type+'-'+itemkpi).append(tablestring);
  
                  if(tdcounter!=2){
                    tdcounter++;
                  }else{
                    tdcounter=0;
                  }
              }
  
  
              
            }
          }

          
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}



// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX  MENGGANTI ISI DROPDOWN SUB KATEGORI

function gantisub(idkategori,type){
  // console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}table_viewsubkategori`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            idkategori : idkategori,

            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {

          
          
        // tableType();

        // Swal.fire({
        //   title: obj.message,
        //   text: "",
        //   icon: 'error',
        //   showCancelButton: false,
        //   confirmButtonText: 'Ya',
        //   });

        
        } else {
          dropstring="";
          panjangdrop=obj.length;
          for(var c=0;c<panjangdrop;c++){
            dropstring+=`
            <option value="`+obj[c]['id_subkategorikpi']+`">`+obj[c]['nama_sub']+`</option>
            `
          }

          $('.subKPI2.'+type).find("select")
          .empty()
          .append(dropstring);
          // .dropdown({forceSelection: false});
          // $('.subKPI2.'+type).dropdown('restore defaults');
                
              }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}


function updatevaluedvl(iddvl,valdvl,typebutton){
  // console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}update_dvl`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            iddvl : iddvl,
            value : valdvl,

            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {

          
          
        // tableType();

        Swal.fire({
          title: obj.message,
          text: "",
          icon: 'error',
          showCancelButton: false,
          confirmButtonText: 'Ya',
          });

        
        } else {
          
          Swal.fire({
            title: "Berhasil meyimpan nilai",
            text: "",
            icon: 'success',
            showCancelButton: false,
            confirmButtonText: 'Ya',
            });

            tampilmultitype(typebutton);
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}



function deletesub(idsub,deltype){
  // console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}delete_dvl`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            idregister : idDEC,
            typemfgsupply : deltype,
            idsubkategori : idsub,

            
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {

          
          
        // tableType();

        Swal.fire({
          title: obj.message,
          text: "",
          icon: 'error',
          showCancelButton: false,
          confirmButtonText: 'Ya',
          });

        
        } else {
          
          Swal.fire({
            title: "Berhasil menghapus data sub kategori",
            text: "",
            icon: 'success',
            showCancelButton: false,
            confirmButtonText: 'Ya',
            });

            tampilmultitype(deltype);
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}




// --------------------- KUMPULAN AJAX -------------------
// -----KUMPULAN AJAX 4 FUNGSI UPLOAD FILE KETIKA TEKAN TOMBOL UPLOAD FILE

$('#linkbtn1mpl').on('click', function() {
  console.log("import excel")
  var typebtn=$(this).attr('btntype');
  
  var foldername=$("#nama_folder").val();

  if(typebtn=="ALL"){
    var statebtn=btnstate;
  }else{
    // UNTUK DVR YANG BISA UPLOAD FILE SAJA
    var statebtn="link";
  }

  Swal.fire({
    title: 'tipe import data excel:',
    showDenyButton: true,
    showCancelButton: true,
    confirmButtonText: 'tambah data',
    denyButtonText: `tumpuk data lama`,
    confirmButtonColor: '#21ba45',
    // confirmButtonColor: '#3085d6',
  }).then((result) => {
    
    /* Read more about isConfirmed, isDenied below */
    if (result.isConfirmed) {
      // JIKA TUMPUK DATA
      
      import_excel('TAMBAH',statebtn);
    } else if (result.isDenied) {
      // JIKA TAMBAH DATA
      
      import_excel('TIMPA',statebtn);
    }

    
  })
  
});

let data_dup = new Array();

function import_excel(action,statebtn){

  if(action==null || action ==""){

    Swal.fire('Error','error: data opsi kosong','error');

  }else{

    var fileuploadexcel = $('#uploadMPL').prop("files")[0];
    var linkfile="";

    var  datauploadmpl = new FormData();
    
    datauploadmpl.append("fileexcel", fileuploadexcel);
    datauploadmpl.append("opsikirim", action);
    datauploadmpl.append("id_register", idDEC);
    datauploadmpl.append("user", userName1);
    // console.log(dataupload);
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}upload_excel`,
        processData: false,
        contentType: false,
        cache:false,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:datauploadmpl,
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {
        // tableType();

          Swal.fire({
            title: obj.message,
            text: "",
            icon: 'error',
            showCancelButton: false,
            confirmButtonText: 'Ya',
            });
            view_lastuploaded();
        
        } else {
          let html_dup="";
          view_lastuploaded();
          if(obj.duped_data!=="nodata"){
            // jika ada data duplikat
            let banyakdata_dup=obj.duped_data.length;
            data_dup=obj.duped_data;

            for(let dataloc in obj.duped_data){
              console.log(dataloc);

              for(let datadn in obj.duped_data[dataloc]){

                console.log(datadn);
                html_dup+=`
                <tr>
                  <td>`+dataloc+`</td>
                  <td>`+datadn+`</td>
                </tr>
                `;
                
              }
            }

            $("#data_duplikat").find('tbody').html(html_dup);
            show_warningduplikat(true);
            // if(banyakdata_dup>0){
              
            //   for(var z=0;z<banyakdata_dup;z++){

            //   }

            // }
            
            

          }

          Swal.fire({
            text: 'berhasil menyimpan '+statebtn+'',
            timer: 2500,
            position: 'top-right',
            toast: true,
            showConfirmButton: false
            })

            viewdataexcel();
          
          // tampilhistoryupl(foldername,idDEC,typebtn);
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });

  }
}

// >>>> FUNGSI IGNORE DATA DUPLIKAT

$("#ignore_dup").on('click',function(){

  data_dup=new Array();

  Swal.fire({
    text: 'data duplikat tidak dimasukkan',
    timer: 1500,
    position: 'center',
    toast: true,
    showConfirmButton: false
  })

  show_warningduplikat(false);
})

// >>>> FUNGSI IGNORE DATA DUPLIKAT

$("#insert_dup").on('click',function(){

  // data_dup=new Array();

  $.ajax({
    type: "POST",
    url: `${restlocdocmgmt}insert_dup`,

    headers: {
        user: vusrnm,
        token: vtoken,
    },
    data:{
        idregister : idDEC,
        data_dup : data_dup,
        

        
    },
        success: function (response){
    var obj = JSON.parse(response);
    console.log(obj);
    if(isEmpty(obj)) {
      Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
    
    
    } else if(obj.status==false) {

    Swal.fire({
      title: obj.message,
      text: "",
      icon: 'error',
      showCancelButton: false,
      confirmButtonText: 'Ya',
      });

    
    } else {
      
      Swal.fire({
        text: obj.message,
        timer: 2500,
        position: 'center',
        toast: true,
        showConfirmButton: false
        })

        viewdataexcel();
        data_dup=new Array();
        show_warningduplikat(false);

    }
},
error: function(){
    if(fungsilogout){

        window.location.href="./_logout.php";
    }else{
        console.log("error session")
    }
}
});

  show_warningduplikat(false);
})


// >>>> FUNGSI UNTUK MEMUNCULKAN WARNING DUPLIKAT
function show_warningduplikat(isactive){

  if(isactive){

    $('.tb_inputfile_mpl').hide();
    $('.tb_warn_duplicate').show();

  }else{
    $('.tb_inputfile_mpl').show();
    $('.tb_warn_duplicate').hide();

    $("#data_duplikat").find('tbody').empty();

  }

}

function viewdataexcel() {
  view_lastuploaded();
  // console.log(FYear+"<---- tahun dalam func");
  // console.log(restlocdocmgmt);
  
  // var d1 = enc.decrypt(EncR, NonceValue);
  // var d2 = enc.decrypt(erl, NonceValue);

  $('#MPLtable').DataTable({

      dom: "<'ui stackable grid'" +
          "<'row'" +
          "<'left aligned ten wide column'>" +
          ">" +
          "<'row dt-table'" +
          "<'sixteen wide column'tr>" +
          ">" +
          "<'row'" +
          "<'left aligned eight wide column'B>" +
          "<'right aligned eight wide column'p>" +
          ">" +
          ">",

          "scrollY":        "500px",
          "scrollCollapse": true,

      buttons: 
      [
          {
              text: '10',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(10).draw();
              }
          },
          {
              text: '25',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(25).draw();
              }
          },
          {
              text: '50',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(50).draw();

              }
          },
          {
              text: '100',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(100).draw();

              }
          },
          {
              text: '500',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(500).draw();
              }
          },
          {
              text: '1000',
              action: function (e, dt, node, config) {
                  $('#MPLtable').DataTable().page.len(1000).draw();
              }
          }
      ],


  destroy: true,
  stateSave: false,
  processing: true,
  deferRender: true,
  serverSide: true,
  orderClasses: false,
  pageLength: 10,
  data: [],

  language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Search..",
      processing: '<i class="circle notch loading icon huge"></i>',
      emptyTable: 'tidak ada data yang ditampilkan',
  },

  order: [[0, "desc"]],

  columns: [
      
      { data  : 'drawing_loc' },
      { data  : 'dn' },
      { data  : 'description' },
      { data  : 'vendor' },
      // { data  : 5},
      
      // { data  : 7 },
      { data  : 'designer'},
      // { data  : 6},
      //  },
      // { data  : 19 },
      // { data  : 20 },
      // // { data  : 27 },
      
      // // { data  : 28 },
      
      { data  : null,
          render: function(data,row){

                  //return `<i class="book icon editdata">`;

                  return `<span class='docicon' style='white-space: nowrap !important; word-spacing:5px !important;'><i class='trash delmpl iconcoloredit icon' delid='${data['id_mpl']}' datadesc='${data['description']}' dataDN='${data['dn']}' ></i></span>`;
                  //return '<i class="edit icon editdata" idedit="${data[0]}">
          }
          
      },
      
      
  ],

  


  
  ajax: {
      
      url     : `${restlocdocmgmt}table_viewexcel`,
      type    : 'POST',
      //PENTING!! error uncaught lenght
      headers: {
          user: vusrnm,
          token: vtoken,
      },
      // data search
      data    : {
      // FStatus : FStatus,
      idregister:idDEC,
      // FSearch : FSearch,
      // FYear   : FYear,
      // FRole   : FRole,
      // FPlant  : FPlant,
      user    : userName1,
      },
      
      error: function(){
          if(fungsilogout){
  
              window.location.href="./_logout.php";
          }else{
              console.log("error session")
          }
      },

  },

  

  
  //STYLING KOLOM

    columnDefs: [
        { className: "center aligned", targets: [0,1,2,3,4,5] },

        // { className: "right aligned", targets: [5] },

        // {className : "collapsing", targets: [1,2,5,11,12]},

        // { "orderable": false, "targets": 13 },
],

// "columnDefs": [
//     { "orderable": false, "targets": 10 }
//   ],

  


  });
  

}




function viewdataexcel_history() {
  // console.log(FYear+"<---- tahun dalam func");
  // console.log(restlocdocmgmt);
  
  // var d1 = enc.decrypt(EncR, NonceValue);
  // var d2 = enc.decrypt(erl, NonceValue);

  $('#MPLtablehistory').DataTable({

      dom: "<'ui stackable grid'" +
          "<'row'" +
          "<'left aligned ten wide column'>" +
          ">" +
          "<'row dt-table'" +
          "<'sixteen wide column'tr>" +
          ">" +
          "<'row'" +
          "<'left aligned eight wide column'B>" +
          "<'right aligned eight wide column'p>" +
          ">" +
          ">",

          "scrollY":        "500px",
          "scrollCollapse": true,

      buttons: 
      [
          {
              text: '10',
              action: function (e, dt, node, config) {
                  $('#MPLtablehistory').DataTable().page.len(10).draw();
              }
          },
          {
              text: '25',
              action: function (e, dt, node, config) {
                  $('#MPLtablehistory').DataTable().page.len(25).draw();
              }
          },
          {
              text: '50',
              action: function (e, dt, node, config) {
                  $('#MPLtablehistory').DataTable().page.len(50).draw();

              }
          },
          {
              text: '100',
              action: function (e, dt, node, config) {
                  $('#MPLtablehistory').DataTable().page.len(100).draw();

              }
          },
          {
              text: '500',
              action: function (e, dt, node, config) {
                  $('#MPLtablehistory').DataTable().page.len(500).draw();
              }
          },
          {
              text: '1000',
              action: function (e, dt, node, config) {
                  $('#MPLtablehistory').DataTable().page.len(1000).draw();
              }
          }
      ],


  destroy: true,
  stateSave: false,
  processing: true,
  deferRender: true,
  serverSide: true,
  orderClasses: false,
  pageLength: 10,
  data: [],

  language: {
      sLengthMenu: "_MENU_",
      search: "",
      searchPlaceholder: "Search..",
      processing: '<i class="circle notch loading icon huge"></i>',
      emptyTable: 'tidak ada data yang ditampilkan',
  },

  order: [[0, "desc"]],

  columns: [
      
      { data  : 'drawing_loc' },
      { data  : 'dn' },
      { data  : 'description' },
      { data  : 'vendor' },
      // { data  : 5},
      
      // { data  : 7 },
      { data  : 'designer'},
      
      
      
  ],

  


  
  ajax: {
      
      url     : `${restlocdocmgmt}table_viewexcel`,
      type    : 'POST',
      //PENTING!! error uncaught lenght
      headers: {
          user: vusrnm,
          token: vtoken,
      },
      // data search
      data    : {
      // FStatus : FStatus,
      idregister:idDEC,
      // FSearch : FSearch,
      // FYear   : FYear,
      // FRole   : FRole,
      // FPlant  : FPlant,
      user    : userName1,
      },
      
      error: function(){
          if(fungsilogout){
  
              window.location.href="./_logout.php";
          }else{
              console.log("error session")
          }
      },

  },

  

  
  //STYLING KOLOM

    columnDefs: [
        { className: "center aligned", targets: [0,1,2,3,4] },

        // { className: "right aligned", targets: [5] },

        // {className : "collapsing", targets: [1,2,5,11,12]},

        // { "orderable": false, "targets": 13 },
],

// "columnDefs": [
//     { "orderable": false, "targets": 10 }
//   ],

  


  });
  

}




// FUNGSI DELETE DATA MPL PADA MENU IMPORT EXCEL


function delete_mplfunc(idmpl){
  // console.log("masuk")

  $(document).ready(function () {

  
      $.ajax({
        type: "POST",
        url: `${restlocdocmgmt}delete_excel`,

        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data:{
            idmpl : idmpl,
            id_project:idDEC,
            // idsubkategori : idsub,
        },
            success: function (response){
        var obj = JSON.parse(response);
        console.log(obj);
        if(isEmpty(obj)) {
          Swal.fire('Error','Ada kendal di koneksi/database, data kosong','error');
        
        
        } else if(obj.status==false) {

          Swal.fire({
            title: obj.message,
            text: "",
            icon: 'error',
            showCancelButton: false,
            confirmButtonText: 'Ya',
            });

        } else {
          
          Swal.fire({
            title: "Berhasil menghapus data MPL",
            text: "",
            icon: 'success',
            timer: 1500,
            showCancelButton: false,
            showConfirmButton: false
            // confirmButtonText: 'Ya',
            });

            viewdataexcel();
          
        }
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
    });
  

  });
  
}
