//PENTING: BEDA JENIS DATA JSON, DATASRC DIHILANGKAN ATAU DIADAKAN
//REMINDER: SET KALAU TIDAK MENEMUKAN DATA, MEMUNCULKAN MESSAGE TIDAK ADA DATA DAN TIDAK ADA KOLOM MUNCUL
//DARI BACKEND KALAU DATA KOSONG JADIKAN ARRAY KOSONG
//DATATABLE DETEKSI ARRAY KOSONG OTOMATIS KELUAR NO DATA
//GANTI COOKIES KE BENTUK ARRAY(1 COOKIES DALAM 1 APLIKASI)
$(".ui.dropdown").dropdown();
$(".menu .item").tab();
const fungsilogout=false;
$(".ui.calendar")
  .calendar()
;
console.log(nikuser);

// Global Variable
const NonceValue = "rdsystem2020";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocbonkasdlnegeri = decodeURIComponent(getCookie("restlocbonkasdlnegeri"));
var d = new Date();
var day = d.getDate() + "";
var month = d.getMonth() + 1 + "";
var setvalue;
if (day.length < 2) {
    day = "0" + day;
}
if (month.length < 2) {
    month = "0" + month;
}
var mdnow = month + day;
var enc = new Encryption();
var erl = enc.encrypt("1" + mdnow, NonceValue);
var maxdateset;

//GET DATA TANGGAL HARI INI
var day = new Date();
tahunsekarang = day.getFullYear();




//BACA COOKIES AWAL

var json_cookies = getCookie('filterdalamnegeri');
var hasiljson = JSON.parse(json_cookies);

if(json_cookies){

    var search_ck=hasiljson[0];
    var tahun_ck=hasiljson[1];
    var status_ck=hasiljson[2];
    var plant_ck=hasiljson[3];
    var data_ck=hasiljson[4];
}

if(search_ck){
    $("#searchdalamnegeri").val(search_ck);
    var searchcookie = search_ck;

}else{

    setCookie("dlnegerisearch","", 5);
    var searchcookie="";
}

if(tahun_ck){
    $("#tahundalamnegeri").dropdown("set selected", tahun_ck);
    var tahuncookie = tahun_ck;
}else{
    setCookie("dlnegeritahun", tahunsekarang, 5);
    var tahuncookie = tahunsekarang;
}

if(status_ck){
    
    $("#statusdalamnegeri").dropdown("set selected", status_ck);
    var statuscookie = status_ck;
    console.log("ini cookies status"+status_ck);
}
else{
    console.log("no cookies")
    
    var statusval= $("#statusdalamnegeri").val();
    var statuscookie = statusval;
    console.log("baca cookie kosong"+statuscookie);
}
if(data_ck){
    $("#roledatadalamnegeri").dropdown("set selected", data_ck);
    var datacookie = data_ck;
}else{
    // setCookie("dlnegeritahun", tahunsekarang, 5);
    var dataroleval = $("#roledatadalamnegeri").val();
    var datacookie = dataroleval;
}

if(plant_ck){
    $("#planttf").dropdown("set selected", plant_ck);
    var plantcookie = plant_ck;
}else{
    // setCookie("dlnegeritahun", tahunsekarang, 5);
    var plantval = $("#roledatadalamnegeri").val();
    var plantcookie = dataroleval;
}

var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
var JsonFilter = JSON.stringify(setarr);
setCookie("filterdalamnegeri",JsonFilter,5);
console.log(searchcookie + "ini cookie search");

console.log(tahun_ck+"<---tahunck cookie luar");
console.log(statuscookie);



console.log(restlocbonkasdlnegeri);

//TEKAN TAB LAIN
$('#dlnegeriitem').on('click', function() {
    window.location.href = "./?link=dalamnegeri";
});
// $('#userguidebon').on('click', function() {
//     window.location.href = "./?link=guidebonkas";
// });
$('.tabuserguide').on('click', function() {
  window.location.href = "./?link=guidebonkas";
});
$('.tabsuratgolive').on('click', function() {
  window.location.href = "./?link=golivebonkas";
});
$('.tabhasilmonitoring').on('click', function() {
  window.location.href = "./?link=monitorbonkas";
});
$('.tabversion').on('click', function() {
  window.location.href = "./?link=versionhistory&app=BON";
});
$('#FAQ').on('click', function() {
  window.location.href = "./?link=FAQ_perjalan_dinas";
});
$('#SK').on('click', function() {
  window.location.href = "./?link=SK_perjalanan_dinas";
});

  $('#UploadPerjalanan').click(function(){
    $(".xwinrevisipsc").modal({
      autofocus: false,
    }).modal("show");
    $('#UploadSection').val();
    $('#FileSection').val();
  });
  $('.CancelData').on('click', function() {
    $('.xwinrevisipsc').modal('hide');
  });
$('#dalamnegeriTable').DataTable().destroy();



dlnegeritablefunc(searchcookie, tahuncookie, statuscookie,plantcookie,datacookie);

console.log(statuscookie+"<---- ini cookies dalam fungsi")
function dlnegeritablefunc(FSearch,FYear,FStatus,FPlant,FRole) {
    console.log(FYear+"<---- tahun dalam func");
    
    var d1 = enc.decrypt(EncR, NonceValue);
    var d2 = enc.decrypt(erl, NonceValue);

    $('#dalamnegeriTable').DataTable({

        dom: "<'ui stackable grid'" +
            "<'row'" +
            "<'left aligned ten wide column'>" +
            ">" +
            "<'row dt-table'" +
            "<'sixteen wide column'tr>" +
            ">" +
            "<'row'" +
            "<'left aligned eight wide column'B>" +
            "<'right aligned eight wide column'p>" +
            ">" +
            ">",

        buttons: 
        [
            {
                text: '10',
                action: function (e, dt, node, config) {
                    $('#dalamnegeriTable').DataTable().page.len(10).draw();
                }
            },
            {
                text: '25',
                action: function (e, dt, node, config) {
                    $('#dalamnegeriTable').DataTable().page.len(25).draw();
                }
            },
            {
                text: '50',
                action: function (e, dt, node, config) {
                    $('#dalamnegeriTable').DataTable().page.len(50).draw();

                }
            },
            {
                text: '100',
                action: function (e, dt, node, config) {
                    $('#dalamnegeriTable').DataTable().page.len(100).draw();

                }
            },
            {
                text: '500',
                action: function (e, dt, node, config) {
                    $('#dalamnegeriTable').DataTable().page.len(500).draw();
                }
            },
            {
                text: '1000',
                action: function (e, dt, node, config) {
                    $('#dalamnegeriTable').DataTable().page.len(1000).draw();
                }
            }
        ],


    destroy: true,
    stateSave: false,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    pageLength: 10,
    data: [],

    language: {
        sLengthMenu: "_MENU_",
        search: "",
        searchPlaceholder: "Search..",
        processing: '<i class="circle notch loading icon huge"></i>',
        emptyTable: 'tidak ada data yang ditampilkan',
    },

    order: [[0, "desc"]],

    columns: [
        
        { data  : 1 },
        { data  : 12 },
        { data  : 2 },
        { data  : 3 },
        { data  : 4 },
        { data  : 5 },
        { data  : 6 },
        { data  : 7 },
        { data  : 10 },    
        { data  : 11 },
        
        { data  : 9 },
        
        { data  : 13 },
        { data  : 8 },
        {data : null,
            
        
            render: function(data,row){

                    //return `<i class="book icon editdata">`;

                    return `<i class="ui edit outline icon iconcoloredit detaildata" btnid="${data[0]}" btnnobon="${data[1]}" btnnama="${data[2]}" btnnik="${data[3]}" btntujuan="${data[4]}" btnnominal="${data[5]}" btnkttujuan="${data[6]}" btnptujuan="${data[7]}" btndurasi="${data[8]}" btntgluang="${data[9]}"></i>`;
                    //return '<i class="edit icon editdata" idedit="${data[0]}">
            }
        },
        
    ],


    
    ajax: {

        url     : `${restlocbonkasdlnegeri}table_perjalanandlnegeri`,
        type    : 'POST',
        //PENTING!! error uncaught lenght
        headers: {
            user: vusrnm,
            token: vtoken,
        },
        // data search
        data    : {
        FStatus : FStatus,
        FSearch : FSearch,
        FYear   : FYear,
        FRole   : FRole,
        FPlant  : FPlant,
        user    : userName1,
        },
        
        error: function(){
            if(fungsilogout){
    
                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        },

    },

    
    //STYLING KOLOM

    columnDefs: [
        { className: "center aligned", targets: [0,1,3,6,8,9,10,11,12,13] },

        { className: "right aligned", targets: [5] },

        {className : "collapsing", targets: [1,2,5,11,12]},

        { "orderable": false, "targets": 13 },
],

// "columnDefs": [
//     { "orderable": false, "targets": 10 }
//   ],

    


    });

}

dlnegeritablefunc(searchcookie, tahuncookie, statuscookie,plantcookie,datacookie);

$.ajax({
    type: "GET",
    url: "3_bonkas/_artemis.php",
    cache: false,
    success: function (response){
    setCookie('atoken', response, 1/24);
    },
    error: function(){
        if(fungsilogout){

            window.location.href="./_logout.php";
        }else{
            console.log("error session")
        }
    }
});


//----------------------------------BUTTON MENAMPILKAN DETAIL BARIS---------------------------------

$("#dalamnegeriTable").on("click",".detaildata", function(){
    //store data baris
    var eid = $(this).attr("btnid");
    let encryption = new Encryption();
    var eidENC = encryption.encrypt(eid, NonceValue);
    window.location.href = "./?link=dalamnegeridetail&i=" + eidENC;
});

//-----------------------------------FUNGSI SEARCH--------------------------------------------------
$('#searchdalamnegeri').on('keyup', function (){

    var valuecari=$('#searchdalamnegeri').val();
    var valuestatus=$('#statusdalamnegeri').val();
    var valuetahun= $('#tahundalamnegeri').val();
    var valuedata=$('#roledatadalamnegeri').val()
    var valueplant  = $('#planttf').val();;
    console.log(valuestatus);

    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterdalamnegeri",JsonFilter,5);
    $('#dalamnegeriTable').DataTable().destroy();
    dlnegeritablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);

});

//-------------------FUNGSI SELECT status-----------------
$('#planttf').on('change', function(){

    var valuecari=$('#searchdalamnegeri').val();
    var valuetahun= $('#tahundalamnegeri').val();
    var valueplant  = $('#planttf').val();
    var valuestatus=$('#statusdalamnegeri').val();
    var valuedata=$('#roledatadalamnegeri').val();
    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("dalamnegeriTable",JsonFilter,5);

    $('#rekeningtfTable').DataTable().destroy();
    dlnegeritablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);

});


//---------------------------------FUNGSI RESET FILTER------------------------------------------
$('.resetfilter').on('click', function() {
    var d = new Date();
    var statusnot="NOT CLOSE";
    var datapertama="DUSER";
    var plantpertama="ALL";
    var yearnow = d.getFullYear();
    $('#searchdalamnegeri').val('');
    $('#tahundalamnegeri').dropdown('set selected',yearnow);
    $("#statusdalamnegeri").dropdown("set selected", statusnot);
    $("#roledatadalamnegeri").dropdown("set selected", datapertama);
    $("#planttf").dropdown("set selected", plantpertama);
    var setarr=["",yearnow,statusnot,plantpertama,datapertama];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterdalamnegeri",JsonFilter,5);
    var statusreset=$('#statusdalamnegeri').val();
    $('#dalamnegeriTable').DataTable().destroy();
    dlnegeritablefunc("",yearnow,statusreset,plantpertama,datapertama);
});


//-------------------------------FUNGSI FILTER TAHUN-----------------------------------------

$('#tahundalamnegeri').on('change', function(){

    var valuecari   = $('#searchdalamnegeri').val();
    var valuetahun  = $('#tahundalamnegeri').val();
    var valuestatus = $('#statusdalamnegeri').val();
    var valuedata=$('#roledatadalamnegeri').val();
    var valueplant  = $('#planttf').val();
    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterdalamnegeri",JsonFilter,5);
    $('#dalamnegeriTable').DataTable().destroy();
    dlnegeritablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);



});

//-------------------FUNGSI SELECT status-----------------
$('#statusdalamnegeri').on('change', function(){

    var valuecari   = $('#searchdalamnegeri').val();
    var valuetahun  = $('#tahundalamnegeri').val();
    var valuestatus = $('#statusdalamnegeri').val();
    var valuedata=$('#roledatadalamnegeri').val();
    var valueplant  = $('#planttf').val();
    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterdalamnegeri",JsonFilter,5);

    $('#dalamnegeriTable').DataTable().destroy();
    dlnegeritablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);

});
//-------------------FUNGSI SELECT DATA SESUAI ROLE-----------------
$('#roledatadalamnegeri').on('change', function(){

    var valuecari   = $('#searchdalamnegeri').val();
    var valuetahun  = $('#tahundalamnegeri').val();
    var valuestatus = $('#statusdalamnegeri').val();
    var valuedata=$('#roledatadalamnegeri').val();
    var valueplant  = $('#planttf').val();
    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterdalamnegeri",JsonFilter,5);

    $('#dalamnegeriTable').DataTable().destroy();
    dlnegeritablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);

});

//FUNGSI AKTIVASI CALENDAR
function datepick(){
$('#tanggaltgs').calendar({
        type: 'date',
        monthFirst: false,
        // minDate : d,

        onChange: function(date){
            maxdateset= date;
            tanggalcek();
            console.log(maxdateset+"<--ini max date");
            // cekdate(date);
            
            
        },
    formatter: {
    date: function (date, settings) {
        if (!date) return "";
        var day = date.getDate() + "";
        if (day.length < 2) {
        day = "0" + day;
        }
        var month = date.getMonth() + 1 + "";
        if (month.length < 2) {
        month = "0" + month;
        }
        var year = date.getFullYear();
        return day + "-" + month + "-" + year;
        // return year + "-" + month + "-" + day;
    }
}
    });

    
}

function datepickuang(){

    $('#tanggaluang').calendar({
        type: 'date',
        monthFirst: false,
        // minDate : d,
        maxDate : maxdateset,
    formatter: {
    date: function (date, settings) {
        if (!date) return "";
        var day = date.getDate() + "";
        if (day.length < 2) {
        day = "0" + day;
        }
        var month = date.getMonth() + 1 + "";
        if (month.length < 2) {
        month = "0" + month;
        }
        var year = date.getFullYear();
        return day + "-" + month + "-" + year;
        // return year + "-" + month + "-" + day;
    }
}
    });

}

function cekdate(tanggal){
    if(tanggal !="" || tanggal!=undefined){

    }else{
        
    }
datepick();

}
//TANGGAL DATEPICKER

// $(document).ready(function() {
//     console.log("masuk calendar");
// $('#tanggal_tgs').calendar({
//     type: 'date',
//     monthFirst: false,
//     formatter: {
//     date: function (date, settings) {
//         if (!date) return "";
//         var day = date.getDate() + "";
//         if (day.length < 2) {
//         day = "0" + day;
//         }
//         var month = date.getMonth() + 1 + "";
//         if (month.length < 2) {
//         month = "0" + month;
//         }
//         var year = date.getFullYear();
//         return day + "-" + month + "-" + year;
//         // return year + "-" + month + "-" + day;
//     }
//     }
// });
// })

// $( function() {
//     $( "#tanggaltgs" ).datepicker();
// } );


// $.datepicker.setDefaults({
//   showOn: "both",
//   buttonImageOnly: true,
//   buttonImage: "calendar.gif",
//   buttonText: "Calendar"
// });


// $('#dlButtonBack').on('click', function() {
//     $(".createmodal")
//     .modal({blurring: false})
//     .modal("hide");
// });


// $( function() {
// 	$( "#datepicker" ).datepicker({
// 		dateFormat: "dd-mm-yy"
// 		,	duration: "fast"
// 	});
// } );

//---------------------------------------AUTO CURRENCY INPUT------------------------------------------
new AutoNumeric('#nominal',{
        currencySymbol: "Rp. ",
        decimalCharacter: ",",
        digitGroupSeparator: ".",
        decimalPlaces: "0",
    }
);


var nikval;
var namaval;
var count;

function tanggalcek(){

    $('#tanggaluang').calendar('set date', undefined);

    if (maxdateset=="" || maxdateset==undefined){

        $("#tgl_uang").prop("disabled",true);
        document.getElementById("tgl_uang").placeholder = "input tgl tugas terlebih dahulu";
    }else{
        $("#tgl_uang").prop("disabled",false);
        document.getElementById("tgl_uang").placeholder = "date";
    }
    datepickuang();
}

//-----------------------------------------------TAMBAH BON----------------------------------------------
    $('#tambahdlnegeri').on('click', function() {

        tanggalcek();

        console.log("ditekan");
        $(".createmodal")
                    .modal({blurring: false})
                    .modal("show");
        datepick();
        datepickuang();
                    // jQuery(document).ready(function ($) {
                    //     var valuenama = '@Request.RequestContext.HttpContext.Session["FullName"]';
                    // });
                    loadlistpenerima();
                    console.log(count);
            
                    // $("#nama_penerima").ready(function(){
                    
                        //if(count==null){
                        //var query =userName1;
                        //console.log(query);

                            //document.getElementById("nama_penerima").value = userName1;

                        console.log(count);

                        //}
                        

                        
                    
                
                    // });
                    
    });



    function datakedua(){
        
            document.getElementById("nama_penerima").value ="";
            var query="";
            console.log("di kedua")
            console.log(query +"dua");

            $('#namaauto').search({
            minCharacters : 1,
            apiSettings   : {
                url: '3_invoice/_autocompletenama.php?q={query}'
            },
            fields: {
                results : 'data',
                title   : 'name',
                description : 'nik'
            },
            onSelect: function(result, response) {
                nikval =result.nik;
                namaval = result.name;
                listpenyusun();
                
            }       
            });
            
        
    }


//----------------------SEARCH COST CENTER----------------------

$('.ui.search.kepaladept')
        .search({
            apiSettings: {
                url: '3_aktiva/_autocompletenik.php?q={query}'
            },
            fields: {
                results: 'data',
                title: 'name',
                description: 'nik'
            },
            minCharacters: 1,
            onSelect: function (response) {
                $('#kepala_dept').val(response.name);
            },
        });

$(".ui.search.costcenter").search({
    minCharacters: 1,
    apiSettings: {
    url: "3_bonkas/_autocompletecost.php?q={query}",
    },
    fields: {
    results: "data",
    title: "id" ,
    description: "desc",
    },
    
    onSearch: function(result, response){
        if(result.id=="-"){
            console.log("tidakadadata");
        }
    },
    
    onSelect: function(result, response) {
        setvalue =result.desc;
        console.log(setvalue);
        
        // $("#costcenter").val(setvalue);
        
    } 
});


console.log($("#costcenter").val())
function isisearchcost(valuecari){
    
}

//-----------------------------SAVE DATA NAMA KE TEMP---------------------------

    function listpenyusun(){
        
        console.log("sebelum="+namaval);
        $(document).ready(function () {
        var lnamaval=namaval;
        var lnikval=nikval;
        var lusernames = getCookie('usrnm');

            $.ajax({
                type: "POST",
                url: "../RND_BackEnd/backend_project_bonkas/create_namapenerima",

                headers: {
                    user: vusrnm,
                    token: vtoken,
                },
                data:{
                    snama  : lnamaval,
                    snik : lnikval,
                    user   : userName1,
                },
                    success: function (response){
                var obj = JSON.parse(response);
                console.log(obj);
                if(isEmpty(obj)) {
                console.log('Gagal save, data kosong');
                
                
                } else if(obj) {
                if (obj.status == false){
                    Swal.fire('Error',obj.message,'error')
                }  else if (obj.code == 'error11'){
                    Swal.fire('Error','data kosong','error')
                }  else {
                    Swal.fire({
                    text: 'Item berhasil ditambahkan',
                    timer: 1000,
                    position: 'top-right',
                    toast: true,
                    showConfirmButton: false
                    })
                    loadlistpenerima();
                    namaval="";
                    nikval="";
                    console.log("sesudah="+namaval);
                    $('#nama_penerima').val('');
                }
                
                } else {
                Swal.fire('Error','','error')
                }
            },
            error: function(){
                if(fungsilogout){

                    window.location.href="./_logout.php";
                }else{
                    console.log("error session")
                }
            }
            });
            
        });
        
    }

    //------------------------LOAD DATA PERTAMA-------------------------------

    function datapertama(){
        
                nikval = nikuser;
                namaval = userName1;
                count=1;    
                listpenyusun();
                
            
    }

    // --------------------TAMPIL DATA TEMP PENERIMA--------------------------
    function loadlistpenerima(){

        var lusername    =  getCookie('usrnm');
        $('#tb_listnama').find('tbody').empty();
        
        $.ajax({
            type: "POST",
            url: "../RND_BackEnd/backend_project_bonkas/table_namapenerima",
            headers: {
                user: vusrnm,
                token: vtoken,
            },
            data: { user :userName1},
            cache:false,

            success: function (response){
                var obj = JSON.parse(response);
                console.log(obj);
                if(obj.status==false) {
                    console.log('Gagal load tabel, data kosong');
                    datapertama();
                    
                }else {
                    console.log("dataada");
                    datakedua();
                    jmlData = obj.length;
                    console.log(jmlData);
                    
                    for(b = 0; b < jmlData; b++){
                        if(b===0){

                        $('#tb_listnama').find('tbody').append(
                            "<tr id='"+b+"'><td>"+obj[b]["nama_penerima"]+
                            "</td><td class='center' width='400px'>"+obj[b]["nik_penerima"]+
                            "</td><td class='center'></td></tr>");
                            
                        }
                    
                    else{
                    $('#tb_listnama').find('tbody').append(
                    "<tr id='"+b+"'><td>"+obj[b]["nama_penerima"]+
                    "</td><td class='center' width='400px'>"+obj[b]["nik_penerima"]+
                    "</td><td class='center'><i class='trash deletepenerima iconcoloredit icon' nmpenerima='"+obj[b]["nama_penerima"]+"' delid='"+obj[b]["id_namapenerima"]+"' delnik='"+obj[b]["nik_penerima"]+"'></i></td></tr>");
                    }

                    $('.deletepenerima').on('click',function(e){
                        var dnama= $(this).attr('nmpenerima');
                        var idnamapenerima1 = $(this).attr('delid');
                        var dnik= $(this).attr('delnik');
                    Swal.fire({
                        title: '<h2>Hapus data ini?</h2>',
                        text: "DATA: "+dnik+" - "+dnama,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Ya'
                        }).then((result) => {
                        if (result.value) {
                            //REST CALON DNPENYUSUN
                            $.ajax({
                            type: "POST",
                            url: "../RND_BackEnd/backend_project_bonkas/delete_namapenerima",
                            headers: {
                                user: vusrnm,
                                token: vtoken,
                            },
                            data: {
                                idnamapenerima : idnamapenerima1,
                                
                            },
                            cache: false,
                            success: function (response){
                                var obj = JSON.parse(response);
                                if (obj.code == 'error9'){
                                Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
                                } else if (obj.code == 'error10'){
                                Swal.fire('Error','Item yang dimaksud tidak ada !','error')
                                }  else {
                                loadlistpenerima();
                                }
                            },
                            error: function(){
                                if(fungsilogout){
                
                                    window.location.href="./_logout.php";
                                }else{
                                    console.log("error session")
                                }
                            },
                            });
                        }
                        })
                    
                    
                    });
                }

            }
        }
        


    });

    
}


// ------------------------DATA DROPDOWN COST CENTER-------------------------

// $('#costcenter').ready( function(){
//     var list;
//         //console.log("dropdown clicked");
//         $.ajax({
//             type: "POST",
//             url:`${restlocbonkasdlnegeri}table_costcenter`,
//             //dataType: "json",
//             success: function (response) {

//                 var obj = JSON.parse(response);
//                 console.log(obj.data);
//                 list=obj.data;
//                 jmldatadrop=list.length;
//                 console.log(jmldatadrop+"ini jumlah data")
//                 console.log(list);
//                 $("#costcenter").empty();
//                 $("#costcenter").append('<option value="">ALL</option>');
//                 console.log("masuk1");
                
//                 for(a=0;a<jmldatadrop;a++){
//                     console.log("masuk");
//                     $("#costcenter").append('<option value="'+list[a][0]+' '+list[a][1]+'">'+list[a][0]+' '+list[a][1]+'</option>');
//                 }
                
//                 }
//         });
        



//     });




//-------------------SAVE DATA TAMBAH DATA --------------------------
    
        $(document).ready(function () {

        $('#savedalamnegeri').on('click', function() {
        console.log($( "#costcenter" ).val());
        tanggaltugas=$('#tgl_tugas').val();
        tanggaluang1=$('#tgl_uang').val();
        if(tanggaltugas!=""){
        var datearr= tanggaltugas.split('-');
        var dateconvert= datearr[2] + '-' + datearr[1] + '-' + datearr[0];
        }else{

            dateconvert="";
        }

        if(tanggaluang1!=""){

        var datearr1= tanggaluang1.split('-');
        var dateconvert1= datearr1[2] + '-' + datearr1[1] + '-' + datearr1[0];
        }else{

            dateconvert1="";
        }
        
        
        console.log(dateconvert+"tanggal yang dikirim")
            $.ajax({


                type: "POST",
                url: `${restlocbonkasdlnegeri}create_perjalanan`,

                headers: {
                    user: vusrnm,
                    token: vtoken,
                },
                data:{
                    tujuantgs: $("#tujuan").val(),
                    nominal: $("#nominal").val(),
                    costcenter: $("#costcenter").val(),
                    // costnumber:$("#costcenter").val(),
                    kotatuj: $("#kota_tujuan").val(),
                    tgltgs: dateconvert,
                    prshntjn: $("#perusahaan_tujuan").val(),
                    lamatgs: $("#lama_tugas").val(),
                    plant: $('#plant').val(),
                    ambiluang: dateconvert1,
                    user: userName1,
                    kepala_dept: $('#kepala_dept').val(),
                    
                },


                success: function(response){

                    var obj = JSON.parse(response);
                    if(obj.status==false){
                    Swal.fire(
                        "Error",
                        obj.message,
                        "error"
                    );
                }else{
                    Swal.fire(
                        'berhasil',
                        'data bon berhasil ditambah',
                        'success'
                    )
                    
                    $('#nama_penerima').val('');
                    $('#costcenter').val('');
                    $('#costcenter').val('');
                    $('#tujuan').val('');
                    $('#nominal').val('');
                    $('#kota_tujuan').val('');
                    $('#perusahaan_tujuan').val('');
                    $('#tgl_tugas').val('');
                    $('#lama_tugas').val('');
                    $('#tgl_uang').val('');
                    AutoNumeric.getAutoNumericElement(document.getElementById('nominal')).set(0);

                    $(".createmodal")
                    .modal({blurring: false})
                    .modal("hide");

                    $("#dalamnegeritable").DataTable().destroy();
                    dlnegeritablefunc(searchcookie, tahuncookie, statuscookie,plantcookie, datacookie);
                }
                },
                error: function(){
                    if(fungsilogout){
    
                        window.location.href="./_logout.php";
                    }else{
                        console.log("error session")
                    }
                }

            });

            

            
            

    });
});

//DOWNLOAD DATA ALL / SESUAI FILTER DAN SEARCHING
$('#dlnegerixls').on('click', function() {
    
    var vcari = $('#searchdalamnegeri').val();
    var vstatus = $('#statusdalamnegeri').val();
    var vtahun   = $('#tahundalamnegeri').val();
    var vdata=$('#roledatadalamnegeri').val();
    window.location.href = "./?link=bknegerixls&c=1&s="+vcari+"&st="+vstatus+"&t="+vtahun+"&r="+vdata;
});


$('#UploadFile').on('click', function() {
    // var vcari = $('#searchdalamnegeri').val();
    // var vstatus = $('#statusdalamnegeri').val();
    // var vtahun   = $('#tahundalamnegeri').val();
    // var vdata=$('#roledatadalamnegeri').val();
    // window.location.href = "./?link=bknegerixls&c=1&s="+vcari+"&st="+vstatus+"&t="+vtahun+"&r="+vdata;
    var sect     = $('#UploadSection').val();
    var file_data   = $('#FileSection').prop("files")[0];
    var form_data = new FormData();
    form_data.append("file", file_data);
    form_data.append("section", sect);
    // console.log(dataupload);
    
    $.ajax({
      url: `${restlocbonkasdlnegeri}uploadperjalanan`,
      type: "POST",
      headers: {
        user: vusrnm,
        token: vtoken,
      },
      data: form_data,
      contentType: false,
      processData: false, 
      success: function (response) {
      var obj = JSON.parse(response);
        if (obj.status == false) {
          Swal.fire({
            text: obj.message,
            timer: 1500,
            icon: "warning",
            showConfirmButton: false,
          });
        } else {
          Swal.fire({
            text: "Success",
            timer: 1500,
            showConfirmButton: false,
          });
          $(".xwinrevisipsc").modal("hide");
          
            $('#UploadSection').val();
            $('#FileSection').val('');
        }
      }
    })
  
  });
        
        
    //TAMPILAN TANGGAL

    

// $('#dalamnegeriTable').DataTable().destroy();
// dlnegeritablefunc(searchcookie);

// console.log(valuecari);
//LOAD TABLE DALAM NEGERI


//------------------ TOMBOL SILANG CLOSE

$('.iconclose').on('click', function() {

    // tesemail();
    $(".createmodal")
    .modal({blurring: false})
    .modal("hide");

})




//--------------- TEST NOTIF EMAIL

function tesemail(){
        
    
    $(document).ready(function () {
    

        $.ajax({
            type: "POST",
            url: "../RND_BackEnd/backend_email/update_duedateemail",

            headers: {
                user: vusrnm,
                token: vtoken,
            },
            data:{
                
            },
                success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
            console.log('Gagal save, data kosong');
            
            
            } else if(obj) {
            if (obj.status == false){
                Swal.fire('Error',obj.message,'error')
            }  else if (obj.code == 'error11'){
                Swal.fire('Error','data kosong','error')
            }  else {
                Swal.fire({
                text: 'Item berhasil ditambahkan',
                timer: 1000,
                position: 'top-right',
                toast: true,
                showConfirmButton: false
                })
               
            }
            
            } else {
            Swal.fire('Error','','error')
            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        }
        });
        
    });
    
}