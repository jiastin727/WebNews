$(".ui.dropdown").dropdown();
$(".menu .item").tab();
const fungsilogout=true;

// Global Variable
const NonceValue = "rdsystem2020";
var vusrnm = getCookie("usrnm");
var vtoken = getCookie("token");
var restlocbonkasdlnegeri = decodeURIComponent(getCookie("restlocbonkasdlnegeri"));
var d = new Date();
var day = d.getDate() + "";
var month = d.getMonth() + 1 + "";
if (day.length < 2) {
    day = "0" + day;
}
if (month.length < 2) {
    month = "0" + month;
}
var mdnow = month + day;
var enc = new Encryption();
var erl = enc.encrypt("1" + mdnow, NonceValue);

//GET DATA TANGGAL HARI INI
var day = new Date();
tahunsekarang = day.getFullYear();




//BACA COOKIES AWAL

var json_cookies = getCookie('filterrekeningtf');
var hasiljson = JSON.parse(json_cookies);

if(json_cookies){

    var search_ck=hasiljson[0];
    var tahun_ck=hasiljson[1];
    var status_ck=hasiljson[2];
    var plant_ck=hasiljson[3];
    var data_ck=hasiljson[4];
}

if(search_ck){
    $("#searchrekeningtf").val(search_ck);
    var searchcookie = search_ck;

}else{

    // setCookie("dlnegerisearch","", 5);
    var searchcookie="";
}

if(tahun_ck){
    $("#tahunrekeningtf").dropdown("set selected", tahun_ck);
    var tahuncookie = tahun_ck;
}else{
    // setCookie("dlnegeritahun", tahunsekarang, 5);
    var tahuncookie = tahunsekarang;
}

if(status_ck){
    
    $("#statusrekeningtf").dropdown("set selected", status_ck);
    var statuscookie = status_ck;
    console.log("ini cookies status"+status_ck);
}
else{
    console.log("no cookies")
    
    var statusval= $("#statusrekeningtf").val();
    var statuscookie = statusval;
    console.log("baca cookie kosong"+statuscookie);
}

if(data_ck){
    $("#roledatadalamnegeri").dropdown("set selected", data_ck);
    var datacookie = data_ck;
}else{
    // setCookie("dlnegeritahun", tahunsekarang, 5);
    var dataroleval = $("#roledatadalamnegeri").val();
    var datacookie = dataroleval;
}

if(plant_ck){
    $("#planttf").dropdown("set selected", plant_ck);
    var plantcookie = plant_ck;
}else{
    // setCookie("dlnegeritahun", tahunsekarang, 5);
    var plantval = $("#roledatadalamnegeri").val();
    var plantcookie = dataroleval;
}
 
// $('#userguidebon').on('click', function() {
//     window.location.href = "./?link=guidebonkas";
// });
$('.tabuserguide').on('click', function() {
  window.location.href = "./?link=guidebonkas";
});
$('.tabsuratgolive').on('click', function() {
  window.location.href = "./?link=golivebonkas";
});
$('.tabhasilmonitoring').on('click', function() {
  window.location.href = "./?link=monitorbonkas";
});
$('.tabversion').on('click', function() {
  window.location.href = "./?link=versionhistory&app=BON";
});

var setarr=[searchcookie,tahuncookie,statuscookie,plantcookie,datacookie];
var JsonFilter = JSON.stringify(setarr);
setCookie("filterrekeningtf",JsonFilter,5);
console.log(searchcookie + "ini cookie search");

console.log(tahun_ck+"<---tahunck cookie luar");
console.log(statuscookie);

rekeningtablefunc(searchcookie, tahuncookie, statuscookie,plantcookie,datacookie);

function rekeningtablefunc(FSearch,FYear,FStatus,FPlant,FRole) {
    // console.log(FYear+"<---- tahun dalam func");
    // var d1 = enc.decrypt(EncR, NonceValue);
    // var d2 = enc.decrypt(erl, NonceValue);

    $('#rekeningtfTable').DataTable({

        dom: "<'ui stackable grid'" +
            "<'row'" +
            "<'left aligned ten wide column'>" +
            ">" +
            "<'row dt-table'" +
            "<'sixteen wide column'tr>" +
            ">" +
            "<'row'" +
            "<'left aligned eight wide column'B>" +
            "<'right aligned eight wide column'p>" +
            ">" +
            ">",

        buttons: 
        [
            {
                text: '10',
                action: function (e, dt, node, config) {
                    $('#rekeningtfTable').DataTable().page.len(10).draw();
                }
            },
            {
                text: '25',
                action: function (e, dt, node, config) {
                    $('#rekeningtfTable').DataTable().page.len(25).draw();
                }
            },
            {
                text: '50',
                action: function (e, dt, node, config) {
                    $('#rekeningtfTable').DataTable().page.len(50).draw();

                }
            },
            {
                text: '100',
                action: function (e, dt, node, config) {
                    $('#rekeningtfTable').DataTable().page.len(100).draw();

                }
            },
            {
                text: '500',
                action: function (e, dt, node, config) {
                    $('#rekeningtfTable').DataTable().page.len(500).draw();
                }
            },
            {
                text: '1000',
                action: function (e, dt, node, config) {
                    $('#rekeningtfTable').DataTable().page.len(1000).draw();
                }
            }
        ],


    destroy: true,
    stateSave: false,
    processing: true,
    deferRender: true,
    serverSide: true,
    orderClasses: false,
    pageLength: 10,
    data: [],

    language: {
        sLengthMenu: "_MENU_",
        search: "",
        searchPlaceholder: "Search..",
        processing: '<i class="circle notch loading icon huge"></i>',
        emptyTable: 'tidak ada data yang ditampilkan',
    },

    order: [[0, "desc"]],

    columns: [
        
        { data  : 2 },
        { data  : 13},
        { data  : 1 },
        { data  : 3 },
        { data  : 4 },
        { data  : 5 },
        { data  : 6 },
        { data  : 7 },
        { data  : 8 },    
        { data  : 9 },
        { data  : 10 },
        { data  : 12},
        
        { data  : 14},
        { data  : 11},
        {data : null,
            
        
            render: function(data,row){

                    //return `<i class="book icon editdata">`;

                    return `<i class="ui edit outline icon iconcoloredit detaildata" btnid="${data[0]}"></i>`;
                    //return '<i class="edit icon editdata" idedit="${data[0]}">
            }
        },
        
    ],


    
    ajax: {

        url     : `${restlocbonkasdlnegeri}table_transfer`,
        type    : 'POST',
        
        headers: {
            user: vusrnm,
            token: vtoken,
        },
        // data search
        data    : {
        FStatus : FStatus,
        FSearch : FSearch,
        FYear   : FYear,
        FRole   : FRole,
        FPlant  : FPlant,
        user    : userNamelrnegeri,
        },
        
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        },

    },

    
    // STYLING KOLOM

    columnDefs: [
        { className: "center aligned", targets: [0,1,2,6,7,8,9,10,11,12,13,14] },

        { className: "right aligned", targets: [] },

        {className: "collapsing", targets: [1,6,7,11,12]},

        { "orderable": false, "targets": 14 },
],
    
// "columnDefs": [
//     { "orderable": false, "targets": 11 }
//   ],



    });

}

rekeningtablefunc(searchcookie, tahuncookie, statuscookie, plantcookie, datacookie);

//----------------------------AUTO CURRENCY INPUT--------------------------------
new AutoNumeric('#nominal',{
    currencySymbol: "Rp. ",
    decimalCharacter: ",",
    digitGroupSeparator: ".",
    decimalPlaces: "0",
}
);

//----------------------------AUTO CURRENCY INPUT--------------------------------
new AutoNumeric('#biayaku',{
    currencySymbol: "Rp. ",
    decimalCharacter: ",",
    digitGroupSeparator: ".",
    decimalPlaces: "0",
}
);

//----------------------------AUTO CURRENCY INPUT--------------------------------
new AutoNumeric('#totalall',{
    currencySymbol: "Rp. ",
    decimalCharacter: ",",
    digitGroupSeparator: ".",
    decimalPlaces: "0",
}
);

//------------- SAMBUNG ARTEMIS ------------------------
$.ajax({
    type: "GET",
    url: "3_bonkas/_artemis.php",
    cache: false,
    success: function (response){
    setCookie('atoken', response, 1/24);
    },
    error: function(){
    Swal.fire({
        text : `Server tidak merespon, segera hubungi Administrator di ext. 3553 !`
    })
    }
});

//---------------------------------FUNGSI RESET FILTER------------------------------
$('.resetfilter').on('click', function() {
    var d = new Date();
    var statusnot="NOT CLOSE";
    var datapertama="DUSER";
    var plantpertama="ALL";
    var yearnow = d.getFullYear();
    $('#searchrekeningtf').val('');
    $('#tahunrekeningtf').dropdown('set selected',yearnow);
    $("#statusrekeningtf").dropdown("set selected", statusnot);
    $("#roledatadalamnegeri").dropdown("set selected", datapertama);
    $("#planttf").dropdown("set selected", plantpertama);
    var setarr=["",yearnow,statusnot,plantpertama,datapertama];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterrekeningtf",JsonFilter,5);
    var statusreset=$('#statusrekeningtf').val();
    $('#rekeningtfTable').DataTable().destroy();
    rekeningtablefunc("",yearnow,statusreset,plantpertama,datapertama);
});


//-----------------------------------FUNGSI SEARCH----------------------------------
$('#searchrekeningtf').on('keyup', function (){

    var valuecari=$('#searchrekeningtf').val();
    var valuestatus=$('#statusrekeningtf').val();
    var valuetahun= $('#tahunrekeningtf').val();
    var valueplant  = $('#planttf').val();
    var valuedata=$('#roledatadalamnegeri').val();
    console.log(valuestatus);

    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterrekeningtf",JsonFilter,5);
    $('#rekeningtfTable').DataTable().destroy();
    rekeningtablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);

});

//-------------------------------FUNGSI FILTER TAHUN-----------------------------------------

$('#tahunrekeningtf').on('change', function(){

    var valuecari   = $('#searchrekeningtf').val();
    var valuetahun  = $('#tahunrekeningtf').val();
    var valuestatus = $('#statusrekeningtf').val();
    var valueplant  = $('#planttf').val();
    var valuedata=$('#roledatadalamnegeri').val();
    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterrekeningtf",JsonFilter,5);
    $('#rekeningtfTable').DataTable().destroy();
    rekeningtablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);



});

// --------------------------- TOMBOL VIEW DETAIL ----------------------------------
$("#rekeningtfTable").on("click",".detaildata", function(){
    //store data baris
    var eid = $(this).attr("btnid");
    let encryption = new Encryption();
    var eidENC = encryption.encrypt(eid, NonceValue);
    window.location.href = "./?link=rekeningtfdetail&i=" + eidENC;
});


//-------------------FUNGSI SELECT status-----------------
$('#statusrekeningtf').on('change', function(){

    var valuecari   = $('#searchrekeningtf').val();
    var valuetahun  = $('#tahunrekeningtf').val();
    var valuestatus = $('#statusrekeningtf').val();
    var valueplant  = $('#planttf').val();
    var valuedata=$('#roledatadalamnegeri').val();
    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterrekeningtf",JsonFilter,5);

    $('#rekeningtfTable').DataTable().destroy();
    rekeningtablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);

});

//-------------------FUNGSI SELECT status-----------------
$('#planttf').on('change', function(){

    var valuecari   = $('#searchrekeningtf').val();
    var valuetahun  = $('#tahunrekeningtf').val();
    var valueplant  = $('#planttf').val();
    var valuestatus = $('#statusrekeningtf').val();
    var valuedata=$('#roledatadalamnegeri').val();
    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterrekeningtf",JsonFilter,5);

    $('#rekeningtfTable').DataTable().destroy();
    rekeningtablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);

});

//-------------------FUNGSI SELECT DATA SESUAI ROLE-----------------
$('#roledatadalamnegeri').on('change', function(){

    var valuecari   = $('#searchrekeningtf').val();
    var valuetahun  = $('#tahunrekeningtf').val();
    var valuestatus = $('#statusrekeningtf').val();
    var valueplant  = $('#planttf').val();
    var valuedata=$('#roledatadalamnegeri').val();
    var setarr=[valuecari,valuetahun,valuestatus,valueplant,valuedata];
    var JsonFilter = JSON.stringify(setarr);
    setCookie("filterrekeningtf",JsonFilter,5);

    $('#rekeningtfTable').DataTable().destroy();
    rekeningtablefunc(valuecari,valuetahun,valuestatus,valueplant,valuedata);
});

//---------------------------------TAMBAH BON-----------------------------
$('#tambahrekeningtf').on('click', function() {

    console.log("ditekan");
    $(".createmodal")
                .modal({blurring: false, closable: false})
                .modal("show");
                datepick();
                datakedua();
                
                $("#nik_pembuat").val(nikdb+" ("+userNamelrnegeri+")");
                $("#nik_pembuat").prop("disabled",true);
                loadlistbank();
                
});

// -------------------- BACK BUTTON CREATE DATA----------------
$('#tfbuttonback').on('click', function() {
    $(".createmodal")
    .modal({blurring: false})
    .modal("hide");

    
});



// --------------------TAMPIL DATA TEMP PENERIMA--------------------------
function loadlistpenerima(){

    var lusername    =  getCookie('usrnm');
    $('#tb_listnama').find('tbody').empty();
    
    $.ajax({
        type: "POST",
        url: "../RND_BackEnd/backend_project_bonkas/table_namatransfer",
        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data: { user :userNamelrnegeri},
        cache:false,

        success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(obj.status==false) {
                console.log('Gagal load tabel, data kosong');
                datapertama();
                
            }else {
                console.log("dataada");
                datapertama();
                jmlData = obj.length;
                console.log(jmlData);
                
                for(b = 0; b < jmlData; b++){
                $('#tb_listnama').find('tbody').append(
                "<tr id='"+b+"'><td>"+obj[b]["nama_supplier"]+
                "</td><td class='center' >"+obj[b]["nik"]+
                "</td><td class='center'><i class='trash deletepenerima iconcoloredit icon' delnama='"+obj[b]["nama_supplier"]+"' delid='"+obj[b]["id_namatransfer"]+"' delnik='"+obj[b]["nik"]+"'></i></td></tr>");
                

                $('.deletepenerima').on('click',function(e){
                    var dnama= $(this).attr('delnama');
                    var idnamapenerima1 = $(this).attr('delid');
                    var dnik= $(this).attr('delnik');
                Swal.fire({
                    title: '<h2>Hapus data ini?</h2>',
                    text: "DATA: "+dnik+" - "+dnama,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Ya'
                    }).then((result) => {
                    if (result.value) {
                        //REST CALON DNPENYUSUN
                        $.ajax({
                        type: "POST",
                        url: "../RND_BackEnd/backend_project_bonkas/delete_namatransfer",
                        headers: {
                            user: vusrnm,
                            token: vtoken,
                        },
                        data: {
                            idnamatransfer : idnamapenerima1,
                            
                        },
                        cache: false,
                        success: function (response){
                            var obj = JSON.parse(response);
                            if (obj.code == 'error9'){
                            Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
                            } else if (obj.code == 'error10'){
                            Swal.fire('Error','Item yang dimaksud tidak ada !','error')
                            }  else {
                            loadlistpenerima();
                            }
                        },
                        error: function(){
                            if(fungsilogout){
            
                                window.location.href="./_logout.php";
                            }else{
                                console.log("error session")
                            }
                        },
                        });
                    }
                    })
                
                
                });
            }

        }
    }
    


});


}

//------------------------LOAD DATA PERTAMA-------------------------------

function datapertama(){
    var query =userNamelrnegeri;
    // document.getElementById("nama_penerima").value = userNamelrnegeri;
    // $('#namaauto').search({
    //     minCharacters : 0,
    //     apiSettings   : {
    //         url: '3_bonkas/_autocompletenama.php?q='+query
    //     },
    //     fields: {
    //         results : 'data',
    //         title   : 'name',
    //         description : 'nik'
    //     },
    //     onSelect:function(result, response) {
    //         nikval = result.nik;
    //         namaval = result.name;
    //         count=1;    
    //         listpenyusun();
            
    //     }   
        
    //     });
    console.log(userNamelrnegeri)
    nikval = nikuser;
    namaval = userNamelrnegeri;
    count=1;    
    listpenyusun();
}

// function datakedua(){
        
//     document.getElementById("nama_penerima").value ="";
//     var query="";
//     console.log("di kedua")
//     console.log(query +"dua");

//     $('#namaauto').search({
//     minCharacters : 1,
//     apiSettings   : {
//         url: '3_invoice/_autocompletenama.php?q={query}'
//     },
//     fields: {
//         results : 'data',
//         title   : 'name',
//         description : 'nik'
//     },
    
//     onSelect: function(result, response) {
//         nikval =result.nik;
//         namaval = result.name;
//         // listpenyusun();
        
//     }       
//     });
    

// }

//-----------------------------SAVE DATA NAMA KE TEMP---------------------------

function listpenyusun(){
        
    console.log("sebelum="+namaval);
    $(document).ready(function () {
    var lnamaval=namaval;
    var lnikval=nikval;
    var lusernames = getCookie('usrnm');
    console.log(lnamaval);

        $.ajax({
            type: "POST",
            url: "../RND_BackEnd/backend_project_bonkas/create_namatransfer",

            headers: {
                user: vusrnm,
                token: vtoken,
            },
            data:{
                namasupplier  : lnamaval,
                nik : lnikval,
                user : userNamelrnegeri
            },
                success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
            console.log('Gagal save, data kosong');
            
            
            } else if(obj) {
            if (obj.status == false){
                Swal.fire('Error',obj.message,'error')
            }  else if (obj.code == 'error11'){
                Swal.fire('Error','data kosong','error')
            }  else {
                Swal.fire({
                text: 'Item berhasil ditambahkan',
                timer: 1000,
                position: 'top-right',
                toast: true,
                showConfirmButton: false
                })
                loadlistpenerima();
                namaval="";
                nikval="";
                console.log("sesudah="+namaval);
                $('#nama_penerima').val('');
            }
            
            } else {
            Swal.fire('Error','','error')
            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        },
        });
        
    });
    
}



//-----------------------------SAVE BANK KE TEMP---------------------------

function listbank(namabank,cabang,atasnama,norek){
        
    $(document).ready(function () {
    var lnamabank = namabank;
    var lcabang = cabang;
    var latasnama = atasnama;
    var lnorek =norek;
    console.log(cabang)
    var lusernames = getCookie('usrnm');
    console.log(lusernames);

        $.ajax({
            type: "POST",
            url: "../RND_BackEnd/backend_project_bonkas/create_bank",

            headers: {
                user: vusrnm,
                token: vtoken,
            },
            data:{
                namabank : lnamabank,
                cabangbank : lcabang,
                atasnama : latasnama,
                norek : lnorek,
                user : userNamelrnegeri
            },
                success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(isEmpty(obj)) {
            console.log('Gagal save, data kosong');
            
            } else if(obj) {
            if (obj.status == false){
                Swal.fire('Error',obj.message,'error')
            }  else if (obj.code == 'error11'){
                Swal.fire('Error','data kosong','error')
            }  else {
                Swal.fire({
                text: 'Item berhasil ditambahkan',
                timer: 2000,
                position: 'top-right',
                toast: true,
                showConfirmButton: false
                })
                loadlistbank();
                $('#nominal_asing').val('');
                
            }
            
            } else {
            Swal.fire('Error','','error')
            }
        },
        error: function(){
            if(fungsilogout){

                window.location.href="./_logout.php";
            }else{
                console.log("error session")
            }
        },
        });
        
    });
    
}

// --------------------TAMPIL DATA TEMP UANG--------------------------
function loadlistbank(){

    var lusername    =  getCookie('usrnm');
    $('#tb_bank').find('tbody').empty();
    
    $.ajax({
        type: "POST",
        url: "../RND_BackEnd/backend_project_bonkas/table_bank",
        headers: {
            user: vusrnm,
            token: vtoken,
        },
        data: { user :userNamelrnegeri},
        cache:false,

        success: function (response){
            var obj = JSON.parse(response);
            console.log(obj);
            if(obj.status==false) {
                console.log('Gagal load tabel, data kosong');
                
                
            }else {
                console.log("dataada");
                jmlData = obj.length;
                console.log(jmlData);
                
                for(b = 0; b < jmlData; b++){
                $('#tb_bank').find('tbody').append(
                "<tr id='"+b+"'><td>"+obj[b]["atas_nama"]+
                "</td><td class='center'>"+obj[b]["nama_bank"]+
                "</td><td class='center'>"+obj[b]["cabang_bank"]+
                "</td><td class='center'>"+obj[b]["nomor_rekening"]+
                "</td><td class='center'><i class='trash deletebank iconcoloredit icon' atasnama='"+obj[b]["atas_nama"]+"' delid='"+obj[b]["id_bank"]+"' namabank='"+obj[b]["nama_bank"]+"'cabangbank='"+obj[b]["cabang_bank"]+"'nomorbank='"+obj[b]["nomor_rekening"]+"'></i></td></tr>");
                

                $('.deletebank').on('click',function(e){
                    var atasnama= $(this).attr('atasnama');
                    var idbank= $(this).attr('delid');
                    var namabank= $(this).attr('namabank');
                    var cabangbank= $(this).attr('cabang_bank');
                    var norek = $(this).attr('nomorbank');
                
                Swal.fire({
                    title: '<h2>Hapus data ini?</h2>',
                    text: "atas nama: "+atasnama+"<br>nama bank: "+namabank+"<br>cabang: "+cabangbank+"<br> norek: "+norek,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Ya'
                    }).then((result) => {
                    if (result.value) {
                        //REST CALON DNPENYUSUN
                        $.ajax({
                        type: "POST",
                        url: "../RND_BackEnd/backend_project_bonkas/delete_bank",
                        headers: {
                            user: vusrnm,
                            token: vtoken,
                        },
                        data: {
                            idbank : idbank,
                            
                        },
                        cache: false,
                        success: function (response){
                            var obj = JSON.parse(response);
                            if (obj.code == 'error9'){
                            Swal.fire('Error','Ada kendal di koneksi/database, data tidak tersimpan !','error')
                            } else if (obj.code == 'error10'){
                            Swal.fire('Error','Item yang dimaksud tidak ada !','error')
                            }  else {
                            loadlistbank();
                            }
                        },
                        error: function(){
                            if(fungsilogout){
            
                                window.location.href="./_logout.php";
                            }else{
                                console.log("error session")
                            }
                        },
                        });
                    }
                    })
                
                
                });
            }

        }
    }
    


});


}

//-------------- TOMBOL SAVE DATA BANK ------------------
$('#savebank').on('click', function() {

    var namabankval = $("#namabank").val();
    var cabangval = $("#cabangbank").val();
    var atasnamaval = $("#atas_nama").val();
    var norekval = $("#norek").val();
    
    listbank(namabankval, cabangval, atasnamaval, norekval);

})


//-------------------SAVE DATA TAMBAH DATA --------------------------
    
    $('#saverekeningtf').on('click', function() {
    // console.log($('#atas_nama').val());

    var idrval=$('#nominal').val();
    var biayakuval=$('#biayaku').val();


    if(idrval!="" || idrval!=null){
    var rawValue = idrval.replace(/[^\d\-]+/g, '');
    }else{
       var rawValue=0;
    };

    
    if(biayakuval=="" || biayakuval==null){
       var rawValue2=0;

    }else{
        console.log(biayakuval)
        var rawValue2 = biayakuval.replace(/[^\d\-]+/g, '');
        
    };

    var totalval = Number(rawValue2) + Number(rawValue);
    AutoNumeric.getAutoNumericElement(document.getElementById('totalall')).set(totalval);
    console.log($('#totalall').val());



    var tanggaltf=$('#tgl_tf').val();
        if(tanggaltf!=""){
        var datearr= tanggaltf.split('-');
        var dateconvert= datearr[2] + '-' + datearr[1] + '-' + datearr[0];
        }else{

            var dateconvert="";
        };
    
        $.ajax({


            type: "POST",
            url: `${restlocbonkasdlnegeri}create_transfer`,

            headers: {
                user: vusrnm,
                token: vtoken,
            },
            data:{
                nik : nikdb,
                nobukti : $('#nobukti').val(),
                namasupplier : $('#supplier').val(),
                gunamembayar:$("#guna_membayar").val(),
                tgltrf:dateconvert,
                viabank:$('#via_bank').val(),
                nominal:$('#nominal').val(),
                biayaku:$('#biayaku').val(),
                totalall:$('#totalall').val(),
                namaterang: $('#nama_penerima1').val(),
                namadept: $('#nama_penerima2').val(),
                plant: $('#plant').val(),

                user: userNamelrnegeri
                
            },


            success: function(response){

                var obj = JSON.parse(response);
                if(obj.status==false){
                Swal.fire(
                    "Error",
                    obj.message,
                    "error"
                );
            }else{
                Swal.fire(
                    'berhasil',
                    'data bon berhasil ditambah',
                    'success'
                )
                $('#nobukti').val('');
                $("#supplier").val('');
                $("#guna_membayar").val('');
                $("#tgl_tf").val('');
                $("#lama_tugas").val('');
                $('#via_bank').val('');
                $('#namabank').val('');
                $('#cabangbank').val('');
                $('#atas_nama').val('');
                $('#norek').val('');
                $('#biayaku').val('');
                
                AutoNumeric.getAutoNumericElement(document.getElementById('nominal')).set(0);

                $(".createmodal")
                .modal({blurring: false})
                .modal("hide");

                $("#rekeningtfTable").DataTable().destroy();
                rekeningtablefunc(searchcookie, tahuncookie,statuscookie,plantcookie,datacookie);
            }
            },
            error: function(){
                if(fungsilogout){

                    window.location.href="./_logout.php";
                }else{
                    console.log("error session")
                }
            },

        });


});

//DOWNLOAD DATA ALL / SESUAI FILTER DAN SEARCHING
$('#lrnegerixls').on('click', function() {
    
    var vcari = $('#searchrekeningtf').val();
    var vstatus = $('#statusrekeningtf').val();
    var vtahun   = $('#tahunrekeningtf').val();
    var vdata=$('#roledatadalamnegeri').val();
    var vplant=$('#planttf').val();
    window.location.href = "./?link=bknegerixls&c=3&s="+vcari+"&st="+vstatus+"&t="+vtahun+"&p="+vplant+"&r="+vdata;
});


//FUNGSI AKTIVASI CALENDAR
function datepick(){
    $('#tanggaltf').calendar({
            type: 'date',
            monthFirst: false,
            // minDate : d,
        formatter: {
        date: function (date, settings) {
            if (!date) return "";
            var day = date.getDate() + "";
            if (day.length < 2) {
            day = "0" + day;
            }
            var month = date.getMonth() + 1 + "";
            if (month.length < 2) {
            month = "0" + month;
            }
            var year = date.getFullYear();
            return day + "-" + month + "-" + year;
            // return year + "-" + month + "-" + day;
        }
    }
        
    });

    
}

// //---------------- FUNGSI SEARCH NAMA

function datakedua(){
        
    // document.getElementById("nama_penerima").value ="";
    var query="";
    console.log("di kedua")
    console.log(query +"dua");

    $('.namaauto').search({
    minCharacters : 1,
    apiSettings   : {
        url: '3_invoice/_autocompletenama.php?q={query}'
    },
    fields: {
        results : 'data',
        title   : 'name',
        description : 'nik'
    },
    onSelect: function(result, response) {
        nikval =result.nik;
        namaval = result.name;
        // listpenyusun();
        
    }       
    });
    

}

$('.iconclose').on('click', function() {

    // tesemail();
    $(".createmodal")
    .modal({blurring: false})
    .modal("hide");

})